(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/layers/LayerView":1471,"esri/views/3d/layers/LayerView3D":1476,"esri/views/3d/layers/support/layerViewUpdatingProperties":1482,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1492,"esri/renderers/visualVariables/support/visualVariableUtils":1493,"esri/core/libs/quickselect/quickselect":1497,"esri/layers/graphics/data/QueryEngineCapabilities":1516,"esri/views/layers/support/popupUtils":1517,"esri/views/3d/layers/support/attributeUtils":1518,"esri/views/3d/webgl-engine/lib/HighlightSet":1529,"esri/libs/draco/DracoDecoder":1540,"esri/views/3d/layers/graphics/QueryEngine":1544,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":1557,"esri/layers/graphics/controllers/I3SOnDemandController":1564,"esri/views/3d/layers/i3s/I3SFrameTask":1565,"esri/views/3d/layers/i3s/I3SIndex":1566,"esri/views/3d/layers/i3s/I3SLodHandling":1567,"esri/views/3d/layers/i3s/I3SNodeLoader":1568,"esri/views/3d/layers/i3s/I3SStreamDataController":1569,"esri/views/3d/layers/i3s/I3SViewportQueries":1570,"esri/views/3d/layers/graphics/Graphics3DCore":1576,"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":1577,"esri/views/3d/layers/graphics/Graphics3DHighlights":1578,"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":1579,"esri/core/libs/rbush/PooledRBush":1600,"esri/renderers/support/renderingInfoUtils":1618,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":1619,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":1620,"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":1632,"esri/views/3d/layers/support/fieldProperties":1633,"esri/renderers/support/rendererConversion":1691,"esri/views/3d/layers/graphics/Graphics3DFeatureStore":1692,"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":1693,"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":1694,"esri/views/3d/layers/graphics/Graphics3DPointSymbol":1695,"esri/views/3d/layers/graphics/SpatialIndex2D":1696,"esri/views/3d/layers/graphics/Graphics3DHighlightSet":1697,"esri/views/3d/layers/graphics/Graphics3DVerticalScale":1730,"esri/views/3d/layers/support/PopupSceneLayerView":1736,"esri/views/3d/layers/SceneLayerGraphicsView3D":2437,"esri/views/3d/support/GraphicsMap":2438})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[42,8],{1471:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(37),r(348),r(255),r(12),r(201),r(9),r(0)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";return s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+i+"', id: '"+r+"')",t),u.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},i([p.property()],t.prototype,"layer",void 0),i([p.property()],t.prototype,"parent",void 0),i([p.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),i([p.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),i([p.property()],t.prototype,"view",void 0),i([p.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),i([p.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),i([p.subclass("esri.views.layers.LayerView")],t)}(p.declared(o,n,a.Identifiable,l))}.apply(null,i))||(e.exports=n)},1476:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(9),r(29),r(0),r(356),r(1471)],void 0===(n=function(e,t,r,i,n,o,a,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create(function(t,r){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var i=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);i?r(i):t()})})},i([a.property()],t.prototype,"view",void 0),i([a.property()],t.prototype,"slicePlaneEnabled",void 0),i([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(l))}.apply(null,i))||(e.exports=n)},1482:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,i))||(e.exports=n)},1492:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1494),r(554),r(552)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new i.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,i))||(e.exports=n)},1493:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(23),r(84),r(12),r(360),r(361),r(354)],void 0===(n=function(e,t,r,i,n,o,a,s){function l(e,t,i){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"color"===e.type})[0]:e;if(n){if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void m.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");var o="number"==typeof t,a=o?null:t,l=a&&a.attributes,u=o?t:null,p=n.field,c=n.cache,d=c.ipData,h=c.hasExpression,y=n.cache.compiledFunc;if(!p&&!h){var _=n.stops;return _&&_[0]&&_[0].color}if("number"!=typeof u)if(h){var g=i&&{viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=s.getViewInfo(g),v=s.createExecContext(a,b);if(!y){var x=s.createSyntaxTree(n.valueExpression);y=s.createFunction(x),n.cache.compiledFunc=y}u=s.executeFunction(y,v)}else l&&(u=l[p]);var w=n.normalizationField,S=l?parseFloat(l[w]):void 0;if(null!=u&&(!w||o||!isNaN(S)&&0!==S)){isNaN(S)||o||(u/=S);var D=f(u,d);if(D){var C=D[0],I=D[1],A=C===I?n.stops[C].color:r.blendColors(n.stops[C].color,n.stops[I].color,D[2],i&&i.color);return new r(A)}}}}function u(e,t,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"opacity"===e.type})[0]:e;if(i){if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void m.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");var n="number"==typeof t,o=n?null:t,a=o&&o.attributes,l=n?t:null,u=i.field,p=i.cache,c=p.ipData,d=p.hasExpression,h=i.cache.compiledFunc;if(!u&&!d){var y=i.stops;return y&&y[0]&&y[0].opacity}if("number"!=typeof l)if(d){var _=r&&{viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=s.getViewInfo(_),b=s.createExecContext(o,g);if(!h){var v=s.createSyntaxTree(i.valueExpression);h=s.createFunction(v),i.cache.compiledFunc=h}l=s.executeFunction(h,b)}else a&&(l=a[u]);var x=i.normalizationField,w=a?parseFloat(a[x]):void 0;if(null!=l&&(!x||n||!isNaN(w)&&0!==w)){isNaN(w)||n||(l/=w);var S=f(l,c);if(S){var D=S[0],C=S[1];if(D===C)return i.stops[D].opacity;var I=i.stops[D].opacity;return I+(i.stops[C].opacity-I)*S[2]}}}}function p(e,t,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"rotation"===e.type})[0]:e;if(i){if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void m.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");var n=i.axis||"heading",o="heading"===n&&"arithmetic"===i.rotationType?90:0,a="heading"===n&&"arithmetic"===i.rotationType?-1:1,l="number"==typeof t?null:t,u=l&&l.attributes,p=i.field,c=i.cache.hasExpression,d=i.cache.compiledFunc,h=0;if(!p&&!c)return h;if(c){var y=r&&{viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},f=s.getViewInfo(y),_=s.createExecContext(l,f);if(!d){var g=s.createSyntaxTree(i.valueExpression);d=s.createFunction(g),i.cache.compiledFunc=d}h=s.executeFunction(d,_)}else u&&(h=u[p]||0);return"number"!=typeof h||isNaN(h)?null:o+a*h}}function c(e,t,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"size"===e.type})[0]:e;if(i){if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void m.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");var n=y(function(e,t,r){var i="number"==typeof t,n=i?null:t,o=n&&n.attributes,l=i?t:null,u=e.cache.isScaleDriven,p=e.cache.compiledFunc;if(u){var c=r&&r.scale,d=r&&r.view;l=null==c||d&&"3d"===d.type?function(e){var t=null,r=null,i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):c}else if(!i)switch(e.inputValueType){case"expression":var h=r&&{viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=s.getViewInfo(h),f=s.createExecContext(n,y);if(!p){var m=s.createSyntaxTree(e.valueExpression);p=s.createFunction(m),e.cache.compiledFunc=p}l=s.executeFunction(p,f);break;case"field":o&&(l=o[e.field]);break;case"unknown":l=null}if(!a.isValidNumber(l))return null;if(i||!e.normalizationField)return l;var _=o?parseFloat(o[e.normalizationField]):null;return a.isValidNumber(_)&&0!==_?l/_:null}(i,t,r),i,t,r,i.cache.ipData);return null===n||void 0===n||isNaN(n)?0:n}}function d(e,t,r){return null==e?null:a.isSizeVariable(e)?c(e,t,r):a.isValidNumber(e)?e:null}function h(e,t,r){return a.isValidNumber(r)&&e>r?r:a.isValidNumber(t)&&e<t?t:e}function y(e,t,r,i,n){switch(t.transformationType){case"additive":return function(e,t,r,i){return e+(d(t.minSize,r,i)||t.minDataValue)}(e,t,r,i);case"constant":return function(e,t,r){var i=e.stops,n=i&&i.length&&i[0].size;return null==n&&(n=e.minSize),d(n,t,r)}(t,r,i);case"clamped-linear":return function(e,t,r,i){var n=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),o=d(t.minSize,r,i),a=d(t.maxSize,r,i),s=i&&i.shape;if(e<=t.minDataValue)return o;if(e>=t.maxDataValue)return a;if("area"===t.scaleBy&&s){var l="circle"===s,u=l?g*Math.pow(o/2,2):o*o,p=u+n*((l?g*Math.pow(a/2,2):a*a)-u);return l?2*Math.sqrt(p/g):Math.sqrt(p)}return o+n*(a-o)}(e,t,r,i);case"proportional":return function(e,t,r,i){var n=i&&i.shape,o=e/t.minDataValue,a=d(t.minSize,r,i),s=d(t.maxSize,r,i);return h("circle"===n?2*Math.sqrt(o*Math.pow(a/2,2)):"square"===n||"diamond"===n||"image"===n?Math.sqrt(o*Math.pow(a,2)):o*a,a,s)}(e,t,r,i);case"stops":return function(e,t,r,i,n){var o=f(e,n),a=o[0],s=o[1],l=o[2];if(a===s)return d(t.stops[a].size,r,i);var u=d(t.stops[a].size,r,i);return u+(d(t.stops[s].size,r,i)-u)*l}(e,t,r,i,n);case"real-world-size":return function(e,t,r,i){var n=(i&&i.resolution?i.resolution:1)*o.meterIn[t.valueUnit],a=d(t.minSize,r,i),s=d(t.maxSize,r,i),l=t.valueRepresentation;return h("area"===l?2*Math.sqrt(e/g)/n:"radius"===l||"distance"===l?2*e/n:e/n,a,s)}(e,t,r,i);case"identity":return function(e){return e}(e);case"unknown":return null}}function f(e,t){if(t){var r=0,i=t.length-1;return t.some(function(t,n){return e<t?(i=n,!0):(r=n,!1)}),[r,i,(e-t[r])/(t[i]-t[r])]}}Object.defineProperty(t,"__esModule",{value:!0});var m=n.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),_=new i,g=Math.PI;t.getColor=l,t.getOpacity=u,t.getRotationAngle=p,t.getSize=c,t.getSizeFromNumberOrVariable=d,t.getSizeForValue=y,t.getSizeRangeAtScale=function(e,t,r){var i=e.cache.isScaleDriven,n=r&&"3d"===r.type;if(!(i&&n||t))return null;var o={scale:t,view:r},a=d(e.minSize,_,o),s=d(e.maxSize,_,o);if(null!=a||null!=s){if(a>s){var l=s;s=a,a=l}return{minSize:a,maxSize:s}}},t.getVisualVariableValues=function(e,t,r){if(e.visualVariables){for(var i=[],n=[],o=[],a=[],s=[],d=0,h=e.visualVariables;d<h.length;d++){var y=h[d];switch(y.type){case"color":n.push(y);break;case"opacity":o.push(y);break;case"rotation":s.push(y);break;case"size":a.push(y)}}return n.forEach(function(e){var n=l(e,t,r);i.push({variable:e,value:n})}),o.forEach(function(e){var n=u(e,t,r);i.push({variable:e,value:n})}),s.forEach(function(e){var n=p(e,t,r);i.push({variable:e,value:n})}),a.forEach(function(e){var n=c(e,t,r);i.push({variable:e,value:n})}),i.filter(function(e){return null!=e.value})}}}.apply(null,i))||(e.exports=n)},1497:function(e,t,r){var i;void 0===(i=function(){"use strict";function e(r,i,n,o,a){for(;o>n;){if(o-n>600){var s=o-n+1,l=i-n+1,u=Math.log(s),p=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*p*(s-p)/s)*(l-s/2<0?-1:1);e(r,i,Math.max(n,Math.floor(i-l*p/s+c)),Math.min(o,Math.floor(i+(s-l)*p/s+c)),a)}var d=r[i],h=n,y=o;for(t(r,n,i),a(r[o],d)>0&&t(r,n,o);h<y;){for(t(r,h,y),h++,y--;a(r[h],d)<0;)h++;for(;a(r[y],d)>0;)y--}0===a(r[n],d)?t(r,n,y):t(r,++y,o),y<=i&&(n=y+1),i<=y&&(o=y-1)}}function t(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function r(e,t){return e<t?-1:e>t?1:0}return function(t,i,n,o,a){e(t,i,n||0,o||t.length-1,a||r)}}.apply(null,[]))||(e.exports=i)},1516:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1517:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(151),r(14),r(106)],void 0===(n=function(e,t,r,i,n,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),i(this,void 0,void 0,function(){var i,s,l,u,p,c,d,h,y,f,m;return r(this,function(r){switch(r.label){case 0:return o.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return i=r.sent(),s=t.lastEditInfoEnabled,l=e.objectIdField,u=e.typeIdField,n.includes(i,"*")?[2,["*"]]:(c=a.fixFields,d=[e.fields],y=(h=i).concat,f=[[u]],(m=s)?[4,a.getFeatureEditFields(e)]:[3,3]);case 2:m=r.sent(),r.label=3;case 3:return(p=c.apply(void 0,d.concat([y.apply(h,f.concat([m||null]))])))&&l&&a.hasField(e.fields,l)&&-1===p.indexOf(l)&&p.push(l),[2,p]}})})},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:o.isSome(t)&&t.defaultPopupTemplateEnabled&&o.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,i))||(e.exports=n)},1518:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),i=0,n=Object.keys(e);i<n.length;i++){var o=n[i];if(o.toLowerCase()===r)return e[o]}return null}}.apply(null,i))||(e.exports=n)},1529:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:t,renderGeometry:e,owner:r})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.owner.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,i))||(e.exports=n)},1540:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(22),r(9),r(1541)],void 0===(n=function(e,t,i,n,o){function a(){return!!i("esri-wasm")}function s(){return e.toUrl("./draco_decoder.wasm")}var l,u;Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(o),t.isSupported=a,t.getDecoderModule=function(){return a()?(l||(l=n.create(function(e,t){return Promise.resolve().then(function(){var t=[r(1541)];(function(t){u=t({locateFile:s}),e(u)}).apply(null,t)}).catch(r.oe)}).catch(function(e){return n.reject(e)})),l):n.reject(new Error("Draco decompression not available, missing WebAssembly support"))}}.apply(null,i))||(e.exports=n)},1541:function(e,t,r){(function(t){var i=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(i){function n(e,t){e||g("Assertion failed: "+t)}function o(e,t){return e?function(e,t,r){for(var i=t+r,n=t;e[n]&&!(n>=i);)++n;if(n-t>16&&e.subarray&&pe)return pe.decode(e.subarray(t,n));for(var o="";t<n;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var l=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var u=a-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}(se,e,t):""}function a(e,t){return e%t>0&&(e+=t-e%t),e}function s(){z.HEAP8=ae=new Int8Array(oe),z.HEAP16=new Int16Array(oe),z.HEAP32=le=new Int32Array(oe),z.HEAPU8=se=new Uint8Array(oe),z.HEAPU16=new Uint16Array(oe),z.HEAPU32=new Uint32Array(oe),z.HEAPF32=new Float32Array(oe),z.HEAPF64=new Float64Array(oe)}function l(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?z.dynCall_v(r):z.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}function u(e){de.unshift(e)}function p(e){fe.unshift(e)}function c(e){return String.prototype.startsWith?e.startsWith(ve):0===e.indexOf(ve)}function d(){try{if(z.wasmBinary)return new Uint8Array(z.wasmBinary);if(z.readBinary)return z.readBinary(xe);throw"both async and sync fetching of the wasm failed"}catch(e){g(e)}}function h(e){function t(e,t){var r=e.exports;z.asm=r,function(e){if(_e--,z.monitorRunDependencies&&z.monitorRunDependencies(_e),0==_e&&(null!==ge&&(clearInterval(ge),ge=null),be)){var t=be;be=null,t()}}()}function r(e){t(e.instance)}function i(e){(z.wasmBinary||!Z&&!J||"function"!=typeof fetch?new Promise(function(e,t){e(d())}):fetch(xe,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+xe+"'";return e.arrayBuffer()}).catch(function(){return d()})).then(function(e){return WebAssembly.instantiate(e,n)}).then(e,function(e){re("failed to asynchronously prepare wasm: "+e),g(e)})}var n={env:e,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:ie};if(_e++,z.monitorRunDependencies&&z.monitorRunDependencies(_e),z.instantiateWasm)try{return z.instantiateWasm(n,t)}catch(e){return re("Module.instantiateWasm callback failed with error: "+e),!1}return z.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||c(xe)||"function"!=typeof fetch?i(r):WebAssembly.instantiateStreaming(fetch(xe,{credentials:"same-origin"}),n).then(r,function(e){re("wasm streaming compile failed: "+e),re("falling back to ArrayBuffer instantiation"),i(r)}),{}}function y(){return!!y.uncaught_exception}function f(){return ae.length}function m(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function _(e){function t(){z.calledRun||(z.calledRun=!0,ue||(me||(me=!0,l(he)),l(ye),z.onRuntimeInitialized&&z.onRuntimeInitialized(),function(){if(z.postRun)for("function"==typeof z.postRun&&(z.postRun=[z.postRun]);z.postRun.length;)p(z.postRun.shift());l(fe)}()))}e=e||z.arguments,_e>0||(function(){if(z.preRun)for("function"==typeof z.preRun&&(z.preRun=[z.preRun]);z.preRun.length;)u(z.preRun.shift());l(de)}(),_e>0||z.calledRun||(z.setStatus?(z.setStatus("Running..."),setTimeout(function(){setTimeout(function(){z.setStatus("")},1),t()},1)):t()))}function g(e){throw z.onAbort&&z.onAbort(e),void 0!==e?(te(e),re(e),e=JSON.stringify(e)):e="",ue=!0,1,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}function b(){}function v(e){return(e||b).__cache__}function x(e,t){var r=v(t),i=r[e];return i||((i=Object.create((t||b).prototype)).ptr=e,r[e]=i)}function w(e){if("string"==typeof e){var t=function(e,t,r){var i=r>0?r:function(e){for(var t=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++r)),i<=127?++t:t+=i<=2047?2:i<=65535?3:4}return t}(e)+1,n=new Array(i),o=function(e,t,r,i){if(!(i>0))return 0;for(var n=r,o=r+i-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(r>=o)break;t[r++]=s}else if(s<=2047){if(r+1>=o)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=o)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=o)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-n}(e,n,0,n.length);return t&&(n.length=o),n}(e),r=ii.alloc(t,ae);return ii.copy(t,ae,r),r}return e}function S(){throw"cannot construct a Status, no constructor in IDL"}function D(){this.ptr=jt(),v(D)[this.ptr]=this}function C(){this.ptr=Ar(),v(C)[this.ptr]=this}function I(){this.ptr=Wt(),v(I)[this.ptr]=this}function A(){this.ptr=qt(),v(A)[this.ptr]=this}function E(){this.ptr=Ce(),v(E)[this.ptr]=this}function G(){this.ptr=_r(),v(G)[this.ptr]=this}function P(){this.ptr=Me(),v(P)[this.ptr]=this}function O(){this.ptr=Ge(),v(O)[this.ptr]=this}function V(){this.ptr=Vt(),v(V)[this.ptr]=this}function F(){this.ptr=cr(),v(F)[this.ptr]=this}function R(){this.ptr=wt(),v(R)[this.ptr]=this}function M(){this.ptr=_t(),v(M)[this.ptr]=this}function N(){this.ptr=Kt(),v(N)[this.ptr]=this}function j(){this.ptr=Te(),v(j)[this.ptr]=this}function T(){this.ptr=ze(),v(T)[this.ptr]=this}function L(){this.ptr=er(),v(L)[this.ptr]=this}function U(){throw"cannot construct a VoidPtr, no constructor in IDL"}function B(){this.ptr=At(),v(B)[this.ptr]=this}function q(){this.ptr=yr(),v(q)[this.ptr]=this}var z=void 0!==(i=i||{})?i:{},k=!1,Q=!1;z.onRuntimeInitialized=function(){k=!0,Q&&"function"==typeof z.onModuleLoaded&&z.onModuleLoaded(z)},z.onModuleParsed=function(){Q=!0,k&&"function"==typeof z.onModuleLoaded&&z.onModuleLoaded(z)},z.isVersionSupported=function(e){if("string"!=typeof e)return!1;var t=e.split(".");return!(t.length<2||t.length>3)&&(1==t[0]&&t[1]>=0&&t[1]<=3||!(0!=t[0]||t[1]>10))};var H,W={};for(H in z)z.hasOwnProperty(H)&&(W[H]=z[H]);z.arguments=[],z.thisProgram="./this.program",z.quit=function(e,t){throw t},z.preRun=[],z.postRun=[];var Y,X,Z=!1,J=!1;Z="object"==typeof window,J="function"==typeof importScripts,Y="object"==typeof process&&!Z&&!J,X=!Z&&!Y&&!J;var K,$,ee="";Y?(ee=t+"/",z.read=function(e,t){var i;return K||(K=r(1561)),$||($=r(1562)),e=$.normalize(e),i=K.readFileSync(e),t?i:i.toString()},z.readBinary=function(e){var t=z.read(e,!0);return t.buffer||(t=new Uint8Array(t)),n(t.buffer),t},process.argv.length>1&&(z.thisProgram=process.argv[1].replace(/\\/g,"/")),z.arguments=process.argv.slice(2),process.on("uncaughtException",function(e){if(!(e instanceof m))throw e}),process.on("unhandledRejection",g),z.quit=function(e){process.exit(e)},z.inspect=function(){return"[Emscripten Module object]"}):X?("undefined"!=typeof read&&(z.read=function(e){return read(e)}),z.readBinary=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(n("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?z.arguments=scriptArgs:void 0!==arguments&&(z.arguments=arguments),"function"==typeof quit&&(z.quit=function(e){quit(e)})):(Z||J)&&(J?ee=self.location.href:document.currentScript&&(ee=document.currentScript.src),e&&(ee=e),ee=0!==ee.indexOf("blob:")?ee.substr(0,ee.lastIndexOf("/")+1):"",z.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},J&&(z.readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),z.readAsync=function(e,t,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){200==i.status||0==i.status&&i.response?t(i.response):r()},i.onerror=r,i.send(null)},z.setWindowTitle=function(e){document.title=e});var te=z.print||("undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null),re=z.printErr||("undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||te);for(H in W)W.hasOwnProperty(H)&&(z[H]=W[H]);W=void 0;var ie={"f64-rem":function(e,t){return e%t},debugger:function(){}};new Array(0),"object"!=typeof WebAssembly&&re("no native wasm support detected");var ne,oe,ae,se,le,ue=!1,pe="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,ce=("undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le"),z.TOTAL_MEMORY||16777216);ce<5242880&&re("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+ce+"! (TOTAL_STACK=5242880)"),z.buffer?oe=z.buffer:"object"==typeof WebAssembly&&"function"==typeof WebAssembly.Memory?(ne=new WebAssembly.Memory({initial:ce/65536}),oe=ne.buffer):oe=new ArrayBuffer(ce),s(),le[4088]=5259264;var de=[],he=[],ye=[],fe=[],me=!1,_e=0,ge=null,be=null;z.preloadedImages={},z.preloadedAudios={};var ve="data:application/octet-stream;base64,",xe="draco_decoder.wasm";c(xe)||(xe=function(e){return z.locateFile?z.locateFile(e,ee):ee+e}(xe)),z.asm=function(e,t,r){return t.memory=ne,t.table=new WebAssembly.Table({initial:490,maximum:490,element:"anyfunc"}),t.__memory_base=1024,t.__table_base=0,h(t)};var we={last:0,caught:[],infos:{},deAdjust:function(e){if(!e||we.infos[e])return e;for(var t in we.infos)for(var r=+t,i=we.infos[r].adjusted,n=i.length,o=0;o<n;o++)if(i[o]===e)return r;return e},addRef:function(e){e&&we.infos[e].refcount++},decRef:function(e){if(e){var t=we.infos[e];n(t.refcount>0),t.refcount--,0!==t.refcount||t.rethrown||(t.destructor&&z.dynCall_vi(t.destructor,e),delete we.infos[e],function(e){try{ti(e)}catch(e){}}(e))}},clearRef:function(e){e&&(we.infos[e].refcount=0)}},Se={e:g,d:function(e){return ri(e)},k:function(){throw ue=!0,"Pure virtual function called!"},c:function(e,t,r){throw we.infos[e]={ptr:e,adjusted:[e],type:t,destructor:r,refcount:0,caught:!1,rethrown:!1},we.last=e,"uncaught_exception"in y?y.uncaught_exception++:y.uncaught_exception=1,e},f:function(e){return z.___errno_location&&(le[z.___errno_location()>>2]=e),e},b:function(){z.abort()},j:f,i:function(e,t,r){se.set(se.subarray(t,t+r),e)},h:function(e){var t=f();if(e>2147418112)return!1;for(var r=Math.max(t,16777216);r<e;)r=r<=536870912?a(2*r,65536):Math.min(a((3*r+2147483648)/4,65536),2147418112);return!!function(e){e=a(e,65536);var t=oe.byteLength;try{return-1!==ne.grow((e-t)/65536)&&(oe=ne.buffer,!0)}catch(e){return!1}}(r)&&(s(),!0)},g:function(){g("trap!")},l:function(e){g("OOM")},a:16352},De=z.asm({},Se,oe);z.asm=De;var Ce=z._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=function(){return z.asm.m.apply(null,arguments)},Ie=z._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=function(){return z.asm.n.apply(null,arguments)},Ae=z._emscripten_bind_AttributeOctahedronTransform___destroy___0=function(){return z.asm.o.apply(null,arguments)},Ee=z._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=function(){return z.asm.p.apply(null,arguments)},Ge=z._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=function(){return z.asm.q.apply(null,arguments)},Pe=z._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=function(){return z.asm.r.apply(null,arguments)},Oe=z._emscripten_bind_AttributeQuantizationTransform___destroy___0=function(){return z.asm.s.apply(null,arguments)},Ve=z._emscripten_bind_AttributeQuantizationTransform_min_value_1=function(){return z.asm.t.apply(null,arguments)},Fe=z._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=function(){return z.asm.u.apply(null,arguments)},Re=z._emscripten_bind_AttributeQuantizationTransform_range_0=function(){return z.asm.v.apply(null,arguments)},Me=z._emscripten_bind_AttributeTransformData_AttributeTransformData_0=function(){return z.asm.w.apply(null,arguments)},Ne=z._emscripten_bind_AttributeTransformData___destroy___0=function(){return z.asm.x.apply(null,arguments)},je=z._emscripten_bind_AttributeTransformData_transform_type_0=function(){return z.asm.y.apply(null,arguments)},Te=z._emscripten_bind_DecoderBuffer_DecoderBuffer_0=function(){return z.asm.z.apply(null,arguments)},Le=z._emscripten_bind_DecoderBuffer_Init_2=function(){return z.asm.A.apply(null,arguments)},Ue=z._emscripten_bind_DecoderBuffer___destroy___0=function(){return z.asm.B.apply(null,arguments)},Be=z._emscripten_bind_Decoder_DecodeBufferToMesh_2=function(){return z.asm.C.apply(null,arguments)},qe=z._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=function(){return z.asm.D.apply(null,arguments)},ze=z._emscripten_bind_Decoder_Decoder_0=function(){return z.asm.E.apply(null,arguments)},ke=z._emscripten_bind_Decoder_GetAttributeByUniqueId_2=function(){return z.asm.F.apply(null,arguments)},Qe=z._emscripten_bind_Decoder_GetAttributeFloatArrayForAllPoints_4=function(){return z.asm.G.apply(null,arguments)},He=z._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=function(){return z.asm.H.apply(null,arguments)},We=z._emscripten_bind_Decoder_GetAttributeFloat_3=function(){return z.asm.I.apply(null,arguments)},Ye=z._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=function(){return z.asm.J.apply(null,arguments)},Xe=z._emscripten_bind_Decoder_GetAttributeIdByName_2=function(){return z.asm.K.apply(null,arguments)},Ze=z._emscripten_bind_Decoder_GetAttributeId_2=function(){return z.asm.L.apply(null,arguments)},Je=z._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=function(){return z.asm.M.apply(null,arguments)},Ke=z._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=function(){return z.asm.N.apply(null,arguments)},$e=z._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=function(){return z.asm.O.apply(null,arguments)},et=z._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=function(){return z.asm.P.apply(null,arguments)},tt=z._emscripten_bind_Decoder_GetAttributeMetadata_2=function(){return z.asm.Q.apply(null,arguments)},rt=z._emscripten_bind_Decoder_GetAttributeUInt16ArrayForAllPoints_4=function(){return z.asm.R.apply(null,arguments)},it=z._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=function(){return z.asm.S.apply(null,arguments)},nt=z._emscripten_bind_Decoder_GetAttributeUInt32ArrayForAllPoints_4=function(){return z.asm.T.apply(null,arguments)},ot=z._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=function(){return z.asm.U.apply(null,arguments)},at=z._emscripten_bind_Decoder_GetAttributeUInt8ArrayForAllPoints_4=function(){return z.asm.V.apply(null,arguments)},st=z._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=function(){return z.asm.W.apply(null,arguments)},lt=z._emscripten_bind_Decoder_GetAttribute_2=function(){return z.asm.X.apply(null,arguments)},ut=z._emscripten_bind_Decoder_GetEncodedGeometryType_1=function(){return z.asm.Y.apply(null,arguments)},pt=z._emscripten_bind_Decoder_GetFaceFromMesh_3=function(){return z.asm.Z.apply(null,arguments)},ct=z._emscripten_bind_Decoder_GetMetadata_1=function(){return z.asm._.apply(null,arguments)},dt=z._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=function(){return z.asm.$.apply(null,arguments)},ht=z._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=function(){return z.asm.aa.apply(null,arguments)},yt=z._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=function(){return z.asm.ba.apply(null,arguments)},ft=z._emscripten_bind_Decoder_SkipAttributeTransform_1=function(){return z.asm.ca.apply(null,arguments)},mt=z._emscripten_bind_Decoder___destroy___0=function(){return z.asm.da.apply(null,arguments)},_t=z._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=function(){return z.asm.ea.apply(null,arguments)},gt=z._emscripten_bind_DracoFloat32Array_GetArray_2=function(){return z.asm.fa.apply(null,arguments)},bt=z._emscripten_bind_DracoFloat32Array_GetValue_1=function(){return z.asm.ga.apply(null,arguments)},vt=z._emscripten_bind_DracoFloat32Array___destroy___0=function(){return z.asm.ha.apply(null,arguments)},xt=z._emscripten_bind_DracoFloat32Array_size_0=function(){return z.asm.ia.apply(null,arguments)},wt=z._emscripten_bind_DracoInt16Array_DracoInt16Array_0=function(){return z.asm.ja.apply(null,arguments)},St=z._emscripten_bind_DracoInt16Array_GetArray_2=function(){return z.asm.ka.apply(null,arguments)},Dt=z._emscripten_bind_DracoInt16Array_GetValue_1=function(){return z.asm.la.apply(null,arguments)},Ct=z._emscripten_bind_DracoInt16Array___destroy___0=function(){return z.asm.ma.apply(null,arguments)},It=z._emscripten_bind_DracoInt16Array_size_0=function(){return z.asm.na.apply(null,arguments)},At=z._emscripten_bind_DracoInt32Array_DracoInt32Array_0=function(){return z.asm.oa.apply(null,arguments)},Et=z._emscripten_bind_DracoInt32Array_GetArray_2=function(){return z.asm.pa.apply(null,arguments)},Gt=z._emscripten_bind_DracoInt32Array_GetValue_1=function(){return z.asm.qa.apply(null,arguments)},Pt=z._emscripten_bind_DracoInt32Array___destroy___0=function(){return z.asm.ra.apply(null,arguments)},Ot=z._emscripten_bind_DracoInt32Array_size_0=function(){return z.asm.sa.apply(null,arguments)},Vt=z._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return z.asm.ta.apply(null,arguments)},Ft=z._emscripten_bind_DracoInt8Array_GetArray_2=function(){return z.asm.ua.apply(null,arguments)},Rt=z._emscripten_bind_DracoInt8Array_GetValue_1=function(){return z.asm.va.apply(null,arguments)},Mt=z._emscripten_bind_DracoInt8Array___destroy___0=function(){return z.asm.wa.apply(null,arguments)},Nt=z._emscripten_bind_DracoInt8Array_size_0=function(){return z.asm.xa.apply(null,arguments)},jt=z._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=function(){return z.asm.ya.apply(null,arguments)},Tt=z._emscripten_bind_DracoUInt16Array_GetArray_2=function(){return z.asm.za.apply(null,arguments)},Lt=z._emscripten_bind_DracoUInt16Array_GetValue_1=function(){return z.asm.Aa.apply(null,arguments)},Ut=z._emscripten_bind_DracoUInt16Array___destroy___0=function(){return z.asm.Ba.apply(null,arguments)},Bt=z._emscripten_bind_DracoUInt16Array_size_0=function(){return z.asm.Ca.apply(null,arguments)},qt=z._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=function(){return z.asm.Da.apply(null,arguments)},zt=z._emscripten_bind_DracoUInt32Array_GetArray_2=function(){return z.asm.Ea.apply(null,arguments)},kt=z._emscripten_bind_DracoUInt32Array_GetValue_1=function(){return z.asm.Fa.apply(null,arguments)},Qt=z._emscripten_bind_DracoUInt32Array___destroy___0=function(){return z.asm.Ga.apply(null,arguments)},Ht=z._emscripten_bind_DracoUInt32Array_size_0=function(){return z.asm.Ha.apply(null,arguments)},Wt=z._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=function(){return z.asm.Ia.apply(null,arguments)},Yt=z._emscripten_bind_DracoUInt8Array_GetArray_2=function(){return z.asm.Ja.apply(null,arguments)},Xt=z._emscripten_bind_DracoUInt8Array_GetValue_1=function(){return z.asm.Ka.apply(null,arguments)},Zt=z._emscripten_bind_DracoUInt8Array___destroy___0=function(){return z.asm.La.apply(null,arguments)},Jt=z._emscripten_bind_DracoUInt8Array_size_0=function(){return z.asm.Ma.apply(null,arguments)},Kt=z._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return z.asm.Na.apply(null,arguments)},$t=z._emscripten_bind_GeometryAttribute___destroy___0=function(){return z.asm.Oa.apply(null,arguments)},er=z._emscripten_bind_Mesh_Mesh_0=function(){return z.asm.Pa.apply(null,arguments)},tr=z._emscripten_bind_Mesh___destroy___0=function(){return z.asm.Qa.apply(null,arguments)},rr=z._emscripten_bind_Mesh_num_attributes_0=function(){return z.asm.Ra.apply(null,arguments)},ir=z._emscripten_bind_Mesh_num_faces_0=function(){return z.asm.Sa.apply(null,arguments)},nr=z._emscripten_bind_Mesh_num_points_0=function(){return z.asm.Ta.apply(null,arguments)},or=z._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=function(){return z.asm.Ua.apply(null,arguments)},ar=z._emscripten_bind_MetadataQuerier_GetEntryName_2=function(){return z.asm.Va.apply(null,arguments)},sr=z._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=function(){return z.asm.Wa.apply(null,arguments)},lr=z._emscripten_bind_MetadataQuerier_GetIntEntry_2=function(){return z.asm.Xa.apply(null,arguments)},ur=z._emscripten_bind_MetadataQuerier_GetStringEntry_2=function(){return z.asm.Ya.apply(null,arguments)},pr=z._emscripten_bind_MetadataQuerier_HasEntry_2=function(){return z.asm.Za.apply(null,arguments)},cr=z._emscripten_bind_MetadataQuerier_MetadataQuerier_0=function(){return z.asm._a.apply(null,arguments)},dr=z._emscripten_bind_MetadataQuerier_NumEntries_1=function(){return z.asm.$a.apply(null,arguments)},hr=z._emscripten_bind_MetadataQuerier___destroy___0=function(){return z.asm.ab.apply(null,arguments)},yr=z._emscripten_bind_Metadata_Metadata_0=function(){return z.asm.bb.apply(null,arguments)},fr=z._emscripten_bind_Metadata___destroy___0=function(){return z.asm.cb.apply(null,arguments)},mr=z._emscripten_bind_PointAttribute_GetAttributeTransformData_0=function(){return z.asm.db.apply(null,arguments)},_r=z._emscripten_bind_PointAttribute_PointAttribute_0=function(){return z.asm.eb.apply(null,arguments)},gr=z._emscripten_bind_PointAttribute___destroy___0=function(){return z.asm.fb.apply(null,arguments)},br=z._emscripten_bind_PointAttribute_attribute_type_0=function(){return z.asm.gb.apply(null,arguments)},vr=z._emscripten_bind_PointAttribute_byte_offset_0=function(){return z.asm.hb.apply(null,arguments)},xr=z._emscripten_bind_PointAttribute_byte_stride_0=function(){return z.asm.ib.apply(null,arguments)},wr=z._emscripten_bind_PointAttribute_data_type_0=function(){return z.asm.jb.apply(null,arguments)},Sr=z._emscripten_bind_PointAttribute_normalized_0=function(){return z.asm.kb.apply(null,arguments)},Dr=z._emscripten_bind_PointAttribute_num_components_0=function(){return z.asm.lb.apply(null,arguments)},Cr=z._emscripten_bind_PointAttribute_size_0=function(){return z.asm.mb.apply(null,arguments)},Ir=z._emscripten_bind_PointAttribute_unique_id_0=function(){return z.asm.nb.apply(null,arguments)},Ar=z._emscripten_bind_PointCloud_PointCloud_0=function(){return z.asm.ob.apply(null,arguments)},Er=z._emscripten_bind_PointCloud___destroy___0=function(){return z.asm.pb.apply(null,arguments)},Gr=z._emscripten_bind_PointCloud_num_attributes_0=function(){return z.asm.qb.apply(null,arguments)},Pr=z._emscripten_bind_PointCloud_num_points_0=function(){return z.asm.rb.apply(null,arguments)},Or=z._emscripten_bind_Status___destroy___0=function(){return z.asm.sb.apply(null,arguments)},Vr=z._emscripten_bind_Status_code_0=function(){return z.asm.tb.apply(null,arguments)},Fr=z._emscripten_bind_Status_error_msg_0=function(){return z.asm.ub.apply(null,arguments)},Rr=z._emscripten_bind_Status_ok_0=function(){return z.asm.vb.apply(null,arguments)},Mr=z._emscripten_bind_VoidPtr___destroy___0=function(){return z.asm.wb.apply(null,arguments)},Nr=z._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=function(){return z.asm.xb.apply(null,arguments)},jr=z._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=function(){return z.asm.yb.apply(null,arguments)},Tr=z._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=function(){return z.asm.zb.apply(null,arguments)},Lr=z._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=function(){return z.asm.Ab.apply(null,arguments)},Ur=z._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return z.asm.Bb.apply(null,arguments)},Br=z._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return z.asm.Cb.apply(null,arguments)},qr=z._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return z.asm.Db.apply(null,arguments)},zr=z._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return z.asm.Eb.apply(null,arguments)},kr=z._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return z.asm.Fb.apply(null,arguments)},Qr=z._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return z.asm.Gb.apply(null,arguments)},Hr=z._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return z.asm.Hb.apply(null,arguments)},Wr=z._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return z.asm.Ib.apply(null,arguments)},Yr=z._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return z.asm.Jb.apply(null,arguments)},Xr=z._emscripten_enum_draco_StatusCode_ERROR=function(){return z.asm.Kb.apply(null,arguments)},Zr=z._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=function(){return z.asm.Lb.apply(null,arguments)},Jr=z._emscripten_enum_draco_StatusCode_IO_ERROR=function(){return z.asm.Mb.apply(null,arguments)},Kr=z._emscripten_enum_draco_StatusCode_OK=function(){return z.asm.Nb.apply(null,arguments)},$r=z._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=function(){return z.asm.Ob.apply(null,arguments)},ei=z._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=function(){return z.asm.Pb.apply(null,arguments)},ti=z._free=function(){return z.asm.Qb.apply(null,arguments)},ri=z._malloc=function(){return z.asm.Rb.apply(null,arguments)};if(z.dynCall_v=function(){return z.asm.Sb.apply(null,arguments)},z.dynCall_vi=function(){return z.asm.Tb.apply(null,arguments)},z.asm=De,z.then=function(e){if(z.calledRun)e(z);else{var t=z.onRuntimeInitialized;z.onRuntimeInitialized=function(){t&&t(),e(z)}}return z},m.prototype=new Error,m.prototype.constructor=m,be=function e(){z.calledRun||_(),z.calledRun||(be=e)},z.run=_,z.abort=g,z.preInit)for("function"==typeof z.preInit&&(z.preInit=[z.preInit]);z.preInit.length>0;)z.preInit.pop()();z.noExitRuntime=!0,_(),b.prototype=Object.create(b.prototype),b.prototype.constructor=b,b.prototype.__class__=b,b.__cache__={},z.WrapperObject=b,z.getCache=v,z.wrapPointer=x,z.castObject=function(e,t){return x(e.ptr,t)},z.NULL=x(0),z.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete v(e.__class__)[e.ptr]},z.compare=function(e,t){return e.ptr===t.ptr},z.getPointer=function(e){return e.ptr},z.getClass=function(e){return e.__class__};var ii={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(ii.needed){for(var e=0;e<ii.temps.length;e++)z._free(ii.temps[e]);ii.temps.length=0,z._free(ii.buffer),ii.buffer=0,ii.size+=ii.needed,ii.needed=0}ii.buffer||(ii.size+=128,ii.buffer=z._malloc(ii.size),n(ii.buffer)),ii.pos=0},alloc:function(e,t){n(ii.buffer);var r,i=t.BYTES_PER_ELEMENT,o=e.length*i;return o=o+7&-8,ii.pos+o>=ii.size?(n(o>0),ii.needed+=o,r=z._malloc(o),ii.temps.push(r)):(r=ii.buffer+ii.pos,ii.pos+=o),r},copy:function(e,t,r){var i=r;switch(t.BYTES_PER_ELEMENT){case 2:i>>=1;break;case 4:i>>=2;break;case 8:i>>=3}for(var n=0;n<e.length;n++)t[i+n]=e[n]}};return S.prototype=Object.create(b.prototype),S.prototype.constructor=S,S.prototype.__class__=S,S.__cache__={},z.Status=S,S.prototype.code=S.prototype.code=function(){var e=this.ptr;return Vr(e)},S.prototype.ok=S.prototype.ok=function(){var e=this.ptr;return!!Rr(e)},S.prototype.error_msg=S.prototype.error_msg=function(){var e=this.ptr;return o(Fr(e))},S.prototype.__destroy__=S.prototype.__destroy__=function(){var e=this.ptr;Or(e)},D.prototype=Object.create(b.prototype),D.prototype.constructor=D,D.prototype.__class__=D,D.__cache__={},z.DracoUInt16Array=D,D.prototype.GetValue=D.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Lt(t,e)},D.prototype.size=D.prototype.size=function(){var e=this.ptr;return Bt(e)},D.prototype.GetArray=D.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Tt(r,e,t)},D.prototype.__destroy__=D.prototype.__destroy__=function(){var e=this.ptr;Ut(e)},C.prototype=Object.create(b.prototype),C.prototype.constructor=C,C.prototype.__class__=C,C.__cache__={},z.PointCloud=C,C.prototype.num_attributes=C.prototype.num_attributes=function(){var e=this.ptr;return Gr(e)},C.prototype.num_points=C.prototype.num_points=function(){var e=this.ptr;return Pr(e)},C.prototype.__destroy__=C.prototype.__destroy__=function(){var e=this.ptr;Er(e)},I.prototype=Object.create(b.prototype),I.prototype.constructor=I,I.prototype.__class__=I,I.__cache__={},z.DracoUInt8Array=I,I.prototype.GetValue=I.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Xt(t,e)},I.prototype.size=I.prototype.size=function(){var e=this.ptr;return Jt(e)},I.prototype.GetArray=I.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Yt(r,e,t)},I.prototype.__destroy__=I.prototype.__destroy__=function(){var e=this.ptr;Zt(e)},A.prototype=Object.create(b.prototype),A.prototype.constructor=A,A.prototype.__class__=A,A.__cache__={},z.DracoUInt32Array=A,A.prototype.GetValue=A.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),kt(t,e)},A.prototype.size=A.prototype.size=function(){var e=this.ptr;return Ht(e)},A.prototype.GetArray=A.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!zt(r,e,t)},A.prototype.__destroy__=A.prototype.__destroy__=function(){var e=this.ptr;Qt(e)},E.prototype=Object.create(b.prototype),E.prototype.constructor=E,E.prototype.__class__=E,E.__cache__={},z.AttributeOctahedronTransform=E,E.prototype.InitFromAttribute=E.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Ie(t,e)},E.prototype.quantization_bits=E.prototype.quantization_bits=function(){var e=this.ptr;return Ee(e)},E.prototype.__destroy__=E.prototype.__destroy__=function(){var e=this.ptr;Ae(e)},G.prototype=Object.create(b.prototype),G.prototype.constructor=G,G.prototype.__class__=G,G.__cache__={},z.PointAttribute=G,G.prototype.size=G.prototype.size=function(){var e=this.ptr;return Cr(e)},G.prototype.GetAttributeTransformData=G.prototype.GetAttributeTransformData=function(){var e=this.ptr;return x(mr(e),P)},G.prototype.attribute_type=G.prototype.attribute_type=function(){var e=this.ptr;return br(e)},G.prototype.data_type=G.prototype.data_type=function(){var e=this.ptr;return wr(e)},G.prototype.num_components=G.prototype.num_components=function(){var e=this.ptr;return Dr(e)},G.prototype.normalized=G.prototype.normalized=function(){var e=this.ptr;return!!Sr(e)},G.prototype.byte_stride=G.prototype.byte_stride=function(){var e=this.ptr;return xr(e)},G.prototype.byte_offset=G.prototype.byte_offset=function(){var e=this.ptr;return vr(e)},G.prototype.unique_id=G.prototype.unique_id=function(){var e=this.ptr;return Ir(e)},G.prototype.__destroy__=G.prototype.__destroy__=function(){var e=this.ptr;gr(e)},P.prototype=Object.create(b.prototype),P.prototype.constructor=P,P.prototype.__class__=P,P.__cache__={},z.AttributeTransformData=P,P.prototype.transform_type=P.prototype.transform_type=function(){var e=this.ptr;return je(e)},P.prototype.__destroy__=P.prototype.__destroy__=function(){var e=this.ptr;Ne(e)},O.prototype=Object.create(b.prototype),O.prototype.constructor=O,O.prototype.__class__=O,O.__cache__={},z.AttributeQuantizationTransform=O,O.prototype.InitFromAttribute=O.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Pe(t,e)},O.prototype.quantization_bits=O.prototype.quantization_bits=function(){var e=this.ptr;return Fe(e)},O.prototype.min_value=O.prototype.min_value=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ve(t,e)},O.prototype.range=O.prototype.range=function(){var e=this.ptr;return Re(e)},O.prototype.__destroy__=O.prototype.__destroy__=function(){var e=this.ptr;Oe(e)},V.prototype=Object.create(b.prototype),V.prototype.constructor=V,V.prototype.__class__=V,V.__cache__={},z.DracoInt8Array=V,V.prototype.GetValue=V.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Rt(t,e)},V.prototype.size=V.prototype.size=function(){var e=this.ptr;return Nt(e)},V.prototype.GetArray=V.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Ft(r,e,t)},V.prototype.__destroy__=V.prototype.__destroy__=function(){var e=this.ptr;Mt(e)},F.prototype=Object.create(b.prototype),F.prototype.constructor=F,F.prototype.__class__=F,F.__cache__={},z.MetadataQuerier=F,F.prototype.HasEntry=F.prototype.HasEntry=function(e,t){var r=this.ptr;return ii.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:w(t),!!pr(r,e,t)},F.prototype.GetIntEntry=F.prototype.GetIntEntry=function(e,t){var r=this.ptr;return ii.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:w(t),lr(r,e,t)},F.prototype.GetIntEntryArray=F.prototype.GetIntEntryArray=function(e,t,r){var i=this.ptr;ii.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:w(t),r&&"object"==typeof r&&(r=r.ptr),sr(i,e,t,r)},F.prototype.GetDoubleEntry=F.prototype.GetDoubleEntry=function(e,t){var r=this.ptr;return ii.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:w(t),or(r,e,t)},F.prototype.GetStringEntry=F.prototype.GetStringEntry=function(e,t){var r=this.ptr;return ii.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:w(t),o(ur(r,e,t))},F.prototype.NumEntries=F.prototype.NumEntries=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),dr(t,e)},F.prototype.GetEntryName=F.prototype.GetEntryName=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),o(ar(r,e,t))},F.prototype.__destroy__=F.prototype.__destroy__=function(){var e=this.ptr;hr(e)},R.prototype=Object.create(b.prototype),R.prototype.constructor=R,R.prototype.__class__=R,R.__cache__={},z.DracoInt16Array=R,R.prototype.GetValue=R.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Dt(t,e)},R.prototype.size=R.prototype.size=function(){var e=this.ptr;return It(e)},R.prototype.GetArray=R.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!St(r,e,t)},R.prototype.__destroy__=R.prototype.__destroy__=function(){var e=this.ptr;Ct(e)},M.prototype=Object.create(b.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},z.DracoFloat32Array=M,M.prototype.GetValue=M.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),bt(t,e)},M.prototype.size=M.prototype.size=function(){var e=this.ptr;return xt(e)},M.prototype.GetArray=M.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!gt(r,e,t)},M.prototype.__destroy__=M.prototype.__destroy__=function(){var e=this.ptr;vt(e)},N.prototype=Object.create(b.prototype),N.prototype.constructor=N,N.prototype.__class__=N,N.__cache__={},z.GeometryAttribute=N,N.prototype.__destroy__=N.prototype.__destroy__=function(){var e=this.ptr;$t(e)},j.prototype=Object.create(b.prototype),j.prototype.constructor=j,j.prototype.__class__=j,j.__cache__={},z.DecoderBuffer=j,j.prototype.Init=j.prototype.Init=function(e,t){var r=this.ptr;ii.prepare(),"object"==typeof e&&(e=function(e){if("object"==typeof e){var t=ii.alloc(e,ae);return ii.copy(e,ae,t),t}return e}(e)),t&&"object"==typeof t&&(t=t.ptr),Le(r,e,t)},j.prototype.__destroy__=j.prototype.__destroy__=function(){var e=this.ptr;Ue(e)},T.prototype=Object.create(b.prototype),T.prototype.constructor=T,T.prototype.__class__=T,T.__cache__={},z.Decoder=T,T.prototype.GetEncodedGeometryType=T.prototype.GetEncodedGeometryType=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),ut(t,e)},T.prototype.DecodeBufferToPointCloud=T.prototype.DecodeBufferToPointCloud=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(qe(r,e,t),S)},T.prototype.DecodeBufferToMesh=T.prototype.DecodeBufferToMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(Be(r,e,t),S)},T.prototype.GetAttributeId=T.prototype.GetAttributeId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ze(r,e,t)},T.prototype.GetAttributeIdByName=T.prototype.GetAttributeIdByName=function(e,t){var r=this.ptr;return ii.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:w(t),Xe(r,e,t)},T.prototype.GetAttributeIdByMetadataEntry=T.prototype.GetAttributeIdByMetadataEntry=function(e,t,r){var i=this.ptr;return ii.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:w(t),r=r&&"object"==typeof r?r.ptr:w(r),Ye(i,e,t,r)},T.prototype.GetAttribute=T.prototype.GetAttribute=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(lt(r,e,t),G)},T.prototype.GetAttributeByUniqueId=T.prototype.GetAttributeByUniqueId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(ke(r,e,t),G)},T.prototype.GetMetadata=T.prototype.GetMetadata=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),x(ct(t,e),q)},T.prototype.GetAttributeMetadata=T.prototype.GetAttributeMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(tt(r,e,t),q)},T.prototype.GetFaceFromMesh=T.prototype.GetFaceFromMesh=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!pt(i,e,t,r)},T.prototype.GetTriangleStripsFromMesh=T.prototype.GetTriangleStripsFromMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),dt(r,e,t)},T.prototype.GetTrianglesUInt16Array=T.prototype.GetTrianglesUInt16Array=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ht(i,e,t,r)},T.prototype.GetTrianglesUInt32Array=T.prototype.GetTrianglesUInt32Array=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!yt(i,e,t,r)},T.prototype.GetAttributeFloat=T.prototype.GetAttributeFloat=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!We(i,e,t,r)},T.prototype.GetAttributeFloatForAllPoints=T.prototype.GetAttributeFloatForAllPoints=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!He(i,e,t,r)},T.prototype.GetAttributeFloatArrayForAllPoints=T.prototype.GetAttributeFloatArrayForAllPoints=function(e,t,r,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),i&&"object"==typeof i&&(i=i.ptr),!!Qe(n,e,t,r,i)},T.prototype.GetAttributeIntForAllPoints=T.prototype.GetAttributeIntForAllPoints=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!et(i,e,t,r)},T.prototype.GetAttributeInt8ForAllPoints=T.prototype.GetAttributeInt8ForAllPoints=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!$e(i,e,t,r)},T.prototype.GetAttributeUInt8ForAllPoints=T.prototype.GetAttributeUInt8ForAllPoints=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!st(i,e,t,r)},T.prototype.GetAttributeUInt8ArrayForAllPoints=T.prototype.GetAttributeUInt8ArrayForAllPoints=function(e,t,r,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),i&&"object"==typeof i&&(i=i.ptr),!!at(n,e,t,r,i)},T.prototype.GetAttributeInt16ForAllPoints=T.prototype.GetAttributeInt16ForAllPoints=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Je(i,e,t,r)},T.prototype.GetAttributeUInt16ForAllPoints=T.prototype.GetAttributeUInt16ForAllPoints=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!it(i,e,t,r)},T.prototype.GetAttributeUInt16ArrayForAllPoints=T.prototype.GetAttributeUInt16ArrayForAllPoints=function(e,t,r,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),i&&"object"==typeof i&&(i=i.ptr),!!rt(n,e,t,r,i)},T.prototype.GetAttributeInt32ForAllPoints=T.prototype.GetAttributeInt32ForAllPoints=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Ke(i,e,t,r)},T.prototype.GetAttributeUInt32ForAllPoints=T.prototype.GetAttributeUInt32ForAllPoints=function(e,t,r){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ot(i,e,t,r)},T.prototype.GetAttributeUInt32ArrayForAllPoints=T.prototype.GetAttributeUInt32ArrayForAllPoints=function(e,t,r,i){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),i&&"object"==typeof i&&(i=i.ptr),!!nt(n,e,t,r,i)},T.prototype.SkipAttributeTransform=T.prototype.SkipAttributeTransform=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),ft(t,e)},T.prototype.__destroy__=T.prototype.__destroy__=function(){var e=this.ptr;mt(e)},L.prototype=Object.create(b.prototype),L.prototype.constructor=L,L.prototype.__class__=L,L.__cache__={},z.Mesh=L,L.prototype.num_faces=L.prototype.num_faces=function(){var e=this.ptr;return ir(e)},L.prototype.num_attributes=L.prototype.num_attributes=function(){var e=this.ptr;return rr(e)},L.prototype.num_points=L.prototype.num_points=function(){var e=this.ptr;return nr(e)},L.prototype.__destroy__=L.prototype.__destroy__=function(){var e=this.ptr;tr(e)},U.prototype=Object.create(b.prototype),U.prototype.constructor=U,U.prototype.__class__=U,U.__cache__={},z.VoidPtr=U,U.prototype.__destroy__=U.prototype.__destroy__=function(){var e=this.ptr;Mr(e)},B.prototype=Object.create(b.prototype),B.prototype.constructor=B,B.prototype.__class__=B,B.__cache__={},z.DracoInt32Array=B,B.prototype.GetValue=B.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Gt(t,e)},B.prototype.size=B.prototype.size=function(){var e=this.ptr;return Ot(e)},B.prototype.GetArray=B.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Et(r,e,t)},B.prototype.__destroy__=B.prototype.__destroy__=function(){var e=this.ptr;Pt(e)},q.prototype=Object.create(b.prototype),q.prototype.constructor=q,q.prototype.__class__=q,q.__cache__={},z.Metadata=q,q.prototype.__destroy__=q.prototype.__destroy__=function(){var e=this.ptr;fr(e)},function(){function e(){z.OK=Kr(),z.ERROR=Xr(),z.IO_ERROR=Jr(),z.INVALID_PARAMETER=Zr(),z.UNSUPPORTED_VERSION=ei(),z.UNKNOWN_VERSION=$r(),z.INVALID_GEOMETRY_TYPE=Ur(),z.POINT_CLOUD=Br(),z.TRIANGULAR_MESH=qr(),z.ATTRIBUTE_INVALID_TRANSFORM=Nr(),z.ATTRIBUTE_NO_TRANSFORM=jr(),z.ATTRIBUTE_QUANTIZATION_TRANSFORM=Lr(),z.ATTRIBUTE_OCTAHEDRON_TRANSFORM=Tr(),z.INVALID=Qr(),z.POSITION=Wr(),z.NORMAL=Hr(),z.COLOR=zr(),z.TEX_COORD=Yr(),z.GENERIC=kr()}me?e():function(e){ye.unshift(e)}(e)}(),"function"==typeof z.onModuleParsed&&z.onModuleParsed(),i}}();e.exports=i}).call(this,"/")},1544:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(2),r(11),r(13),r(42),r(6),r(14),r(0),r(36),r(1515),r(1416),r(347)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d,h){Object.defineProperty(t,"__esModule",{value:!0});var y=c.default,f=function(e){function t(t){var r=e.call(this)||this;return r._dataQueryEngineInstance=null,r}return i(t,e),Object.defineProperty(t.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new h({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)},t.prototype.executeQueryForIdSet=function(e,t){return o(this,void 0,void 0,function(){return n(this,function(r){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForCount=function(e,t){return o(this,void 0,void 0,function(){return n(this,function(r){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForExtent=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,a;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return r=n.sent(),i=r.count,o=r.extent,a=p.fromJSON(o),[2,{count:i,extent:a}]}})})},t.prototype.executeQueryForIds=function(e,t){return o(this,void 0,void 0,function(){return n(this,function(r){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQuery=function(e,t){return o(this,void 0,void 0,function(){var r,i,o=this;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t)];case 1:return r=n.sent(),(i=d.fromJSON(r)).features.forEach(function(e){e.layer=o.layer,e.sourceLayer=o.layer}),[2,i]}})})},t.prototype._ensureQueryJSON=function(e){return l.isNone(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,r=a.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),i=this.layer.fields.map(function(e){return e.toJSON()}),n=this.layerView.view.resourceController.scheduler,o=this.priority,s=this.spatialReference.toJSON(),l=this.layerView.graphics3d.graphicsCore.featureStore,u=this.layerView,p=u.hasZ,c=u.hasM;return this._dataQueryEngineInstance=new y({hasZ:p,hasM:c,geometryType:r,fields:i,timeInfo:e,spatialReference:s,objectIdField:t,featureStore:l,scheduler:n,priority:o}),this._dataQueryEngineInstance},r([u.property({constructOnly:!0})],t.prototype,"layerView",void 0),r([u.property({constructOnly:!0})],t.prototype,"priority",void 0),r([u.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),r([u.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),r([u.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"queryGeometryType",null),r([u.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),r([u.subclass("esri.views.3d.layers.graphics.QueryEngine")],t)}(u.declared(s));t.QueryEngine=f,t.default=f}.apply(null,i))||(e.exports=n)},1557:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(20),r(29),r(0),r(49),r(579)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u){var p=-.3*l.earthRadius;return function(e){function t(){var t=e.call(this)||this;return t.suspended=!1,t._dirty=!0,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new o,t.layerView=null,t}return r(t,e),Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},set:function(e){e!==this._dirty&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.dirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var r=e.view,i=r.basemapTerrain,n=r.resourceController.scheduler;this.handles.add([r.on("resize",function(){return t.viewChange()}),r.state.watch("camera",function(){return t.viewChange()},!0),n.registerTask(6,function(){return t.update()},function(){return t.dirty}),i.on("elevation-bounds-change",function(){return t.elevationBoundsChange()})]),"local"===r.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(a.init(i,["opacity","wireframe"],function(){return t.isVisibleBelowSurface=!i.isOpaque()}))},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this.dirty=!0},t.prototype.viewChange=function(){this.dirty=!0},t.prototype.elevationBoundsChange=function(){this.dirty=!0,this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this.dirty=!0,this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.updateSuspendFrustumVisible(),this.dirty=!1},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=p;else{var r=t.basemapTerrain.getElevationBounds(),i=r[0],n=r[1];e=i-Math.max(1,(n-i)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.updateSuspendFrustumVisible=function(){if(this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},i([s.property({readOnly:!0})],t.prototype,"suspended",void 0),i([s.property({readOnly:!0})],t.prototype,"updating",null),i([s.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1561:function(e,t){},1562:function(e,t){function r(e,t){for(var r=0,i=e.length-1;i>=0;i--){var n=e[i];"."===n?e.splice(i,1):".."===n?(e.splice(i,1),r++):r&&(e.splice(i,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function i(e,t){if(e.filter)return e.filter(t);for(var r=[],i=0;i<e.length;i++)t(e[i],i,e)&&r.push(e[i]);return r}t.resolve=function(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var o=n>=0?arguments[n]:process.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,t="/"===o.charAt(0))}return e=r(i(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},t.normalize=function(e){var o=t.isAbsolute(e),a="/"===n(e,-1);return(e=r(i(e.split("/"),function(e){return!!e}),!o).join("/"))||o||(e="."),e&&a&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(i(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,r){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var n=i(e.split("/")),o=i(r.split("/")),a=Math.min(n.length,o.length),s=a,l=0;l<a;l++)if(n[l]!==o[l]){s=l;break}var u=[];for(l=s;l<n.length;l++)u.push("..");return(u=u.concat(o.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,i=-1,n=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!n){i=o;break}}else n=!1;return-1===i?r?"/":".":r&&1===i?"/":e.slice(0,i)},t.basename=function(e,t){var r=function(e){"string"!=typeof e&&(e+="");var t,r=0,i=-1,n=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!n){r=t+1;break}}else-1===i&&(n=!1,i=t+1);return-1===i?"":e.slice(r,i)}(e);return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,r=0,i=-1,n=!0,o=0,a=e.length-1;a>=0;--a){var s=e.charCodeAt(a);if(47!==s)-1===i&&(n=!1,i=a+1),46===s?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1);else if(!n){r=a+1;break}}return-1===t||-1===i||0===o||1===o&&t===i-1&&t===r+1?"":e.slice(t,i)};var n="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}},1564:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(45),r(52),r(37),r(20),r(22),r(12),r(86),r(201),r(9),r(29),r(0),r(4),r(3),r(43),r(35),r(95),r(1531),r(1565),r(1566),r(1567),r(1568),r(1569),r(1477),r(1570),r(209),r(38),r(565)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d,h,y,f,m,_,g,b,v,x,w,S,D,C,I,A,E,G,P,O){function V(e,t){return e.length===t.length&&e.every(function(e){return F(t,e.name)>=0})}function F(e,t){for(var r=t.toLowerCase(),i=0;i<e.length;i++)if(e[i].name.toLowerCase()===r)return i;return-1}function R(e){return null!=e&&null!=e.loadedAttributes&&null!=e.attributeData}var M=p.getLogger("esri.layers.graphics.controllers.I3SOnDemandController"),N=function(e){function t(t){var r=e.call(this,t)||this;return r.screenSizeFactor=0,r.featureTarget=5e4,r.fixedFeatureTarget=!1,r.updating=!0,r.updatingPercentage=0,r.leafsReached=!1,r.scaleVisibilityEnabled=!0,r.uncompressedTextureDownsamplingEnabled=!1,r._featureLOD=1,r._stableFeatureLOD=!1,r._isIdle=!1,r._cameraDirty=!0,r._invisibleDirty=!1,r._newLoadingNodes=new c({deallocator:null}),r._loadedNodeScales=new Map,r._abortController=h.createAbortController(),r._downloadingNodes=new Set,r._loadingNodes=new Set,r._updatingNodes=new Set,r._progressMaxNumNodes=1,r._poi=_.vec3f64.create(),r._requiredAttributesDirty=!0,r._updatesDisabled=!1,r.disableIDBCache=!1,r.disableMemCache=!1,r._restartNodeLoading=!1,r._fields=null,r._attributeStorageInfo=null,r._handles=new l,r._idleQueue=new x.PromiseQueue,r._errorCount=0,r}return r(t,e),Object.defineProperty(t.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGraphics3D",{get:function(){return"points"===this.layer.profile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamDataController",{get:function(){var e=this.layerView.view.resourceController.createStreamDataRequester(G.ClientType.SCENE);return new I.default(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsVertex",{get:function(){return A.getVertexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsIndex",{get:function(){return A.getIndexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootNodeVisible",{get:function(){var e=this._index&&this._index.rootNode;return!e||(this._updateViewData(),this._index.isNodeVisible(e.index))},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._lodHandling=new D(this.layerView,function(){return e._evaluateUpdating()});var t=this.layerView.layer;this.layer=t,this._defaultGeometrySchema=t.store.defaultGeometrySchema,this.disableIDBCache=u("disable-feature:idb-cache"),"fields"in t&&(this._fields=t.fields,this._attributeStorageInfo=t.attributeStorageInfo);var r=h.all([this.layer.when(),this.layerView.when()]).then(function(){if(!e.destroyed&&e.layerView&&!e.layerView.destroyed){var r=e.layerView.view;e._setClippingArea(r.clippingArea),e._centerOnSurface=r.pointsOfInterest.centerOnSurfaceFrequent;var i=e.layerView.view.resourceController;e._handles.add([e._centerOnSurface.watch("renderLocation",function(){return e._pointOfInterestChanged()}),i.memoryController.events.on("quality-changed",function(){return e._setCameraDirty()}),y.init(e.layerView,"suspended",function(t){var r=t?function(){return e._updateViewData()}:function(){return e._updateIdleState(!0)},n=t?function(){}:function(){return e._updateIdleState(!1)};e._idleStateCallbacks?(t&&e.cancelNodeLoading(),e.restartNodeLoading(),e._idleStateCallbacks.idleBegin=r,e._idleStateCallbacks.idleEnd=n):e._idleStateCallbacks=i.scheduler.registerIdleStateCallbacks(r,n)}),w.addTask(e.layerView.view.resourceController.scheduler,{update:function(t,r){return e._frame(t,r)},needsUpdate:function(){return e.updating}}),e.watch("uncompressedTextureDownsamplingEnabled",function(){return e.restartNodeLoading()}),e.watch(["featureTarget","fixedFeatureTarget"],function(){e._setCameraDirty(),e._stableFeatureLOD=!1}),r.state.watch("camera",function(){return e._setCameraDirty()}),e.layer.watch("elevationInfo",function(){return e._elevationInfoChanged()}),e.layer.watch(["minScale","maxScale"],function(){return e._scaleBoundsChanged()}),e.layerView.watch("lodFactor",function(){return e._setCameraDirty()}),e.layerView.watch("availableFields?",function(){return e._requiredFieldsChange()})]),e._updateScaleHandles(),e._viewportQueries=new E(e.crsIndex,r.renderCoordsHelper,r.state.camera,e._clippingArea,r.elevationProvider,e.layer,{progressiveLoadFactor:e._getProgressiveLoadFactor(e.layer),screenspaceErrorBias:e.lod,angleDependentLoD:e.lod<.5});var n=t.store.rootNode.split("/").pop();e._index=new S.I3SIndex(e.getBaseUrl(),n,e.layer.nodePages,e.streamDataController,e._viewportQueries,M,function(t){return e.layerView.isNodeLoaded(t)},function(t){return e._shouldLoadNode(t)},function(t){return e._enableFromGPUCache(t,"leaf")},function(t){return e._needsUpdate(t)})}});this._tmpPoint=v.makeDehydratedPoint(0,0,0,this.crsIndex),this.addResolvingPromise(r),this.when(function(){return e._startNodeLoading()})},t.prototype.destroy=function(){this._abortController.abort(),this._abortController=null,this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null),this._handles.destroy(),this._nodeLoader=null,j.prune()},t.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];var e=this._attributeStorageInfo,t=this._fields,r=this.layer.objectIdField;return this.layerView.availableFields.map(function(r){var i=F(e,r),n=F(t,r);return i>=0&&n>=0?{index:i,name:t[n].name,field:t[n],attributeStorageInfo:e[i]}:null}).filter(function(e){return null!=e&&e.name!==r})},t.prototype._requiredFieldsChange=function(){V(this._requiredAttributes,this._getRequiredAttributes())||this.requestUpdate()},t.prototype.requestUpdate=function(){this._requiredAttributesDirty=!0,this.restartNodeLoading()},t.prototype._setClippingArea=function(e){var t=g.create();P.extentToBoundingBox(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null},t.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.setPointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=T.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate())))},t.prototype._calculatePointOfInterest=function(e){var t=this._centerOnSurface.renderLocation,r=_.vec3f64.create();m.vec3.subtract(r,t,this.camPos);var i=this.layerView.view.renderCoordsHelper,n=_.vec3f64.create();i.worldUpAtPosition(t,n);var o=m.vec3.angle(n,r)-.5*Math.PI;return m.vec3.lerp(e,this.camPos,t,Math.max(0,Math.min(1,o/(.5*Math.PI)))),e},t.prototype.updateClippingArea=function(e){this._setClippingArea(e),this._viewportQueries&&this._index&&(this._viewportQueries.updateExtent(this._clippingArea),this._index.invalidateVisibilityCache()),this._setCameraDirty()},t.prototype._setCameraDirty=function(){this._cameraDirty=!0,this.notifyChange("rootNodeVisible"),this._evaluateUpdating()},t.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path},t.prototype.updateElevationChanged=function(e,t){if(null!=this._index){null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new c({deallocator:null}));var r=this._elevationUpdateNodes;r.clear();var i=this._index.rootNode;null!=i&&A.findIntersectingNodes(e,t,i,this.crsIndex,this._index,function(e){return r.push(e.index)});for(var n=0;n<r.length;n++){var o=r.data[n];this._index.invalidateBoundingVolumeCache(o),o===i.index&&this.notifyChange("rootNodeVisible")}r.length&&this.restartNodeLoading()}},t.prototype.getParentIndex=function(e){return this._index.getParentIndex(e)},t.prototype._elevationInfoChanged=function(){this._index.updateElevationInfo(this.layer.elevationInfo),this._setCameraDirty()},t.prototype._updateScaleHandles=function(){var e=this;this._handles.remove("scale-bounds"),this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",function(t){return e._scaleUpdateHandler(t)}),"scale-bounds")},t.prototype._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear(),this._updateScaleHandles(),this._setCameraDirty(),this._lodHandling.setLodGlobalDirty()},t.prototype._scaleUpdateHandler=function(e){this._updateScaleInBoundingRect(e.scale,e.extent,e.spatialReference),this._setCameraDirty(),this._lodHandling.setLodGlobalDirty()},t.prototype._updateScaleInBoundingRect=function(e,t,r){var i=this;null!=this._index.rootNode&&P.boundingRectToBoundingRect(t,r,L,this.crsIndex)&&this._loadedNodeScales.forEach(function(t,r){var n=i._index.getNode(r);b.containsPoint(L,n.mbs)&&i._loadedNodeScales.set(r,e)})},t.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0,this._evaluateUpdating()},t.prototype.schedule=function(e,t){var r=this;return this._idleQueue.push(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw h.createAbortError();return t})},t.prototype.reschedule=function(e,t){var r=this;return this._idleQueue.unshift(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw h.createAbortError();return t})},Object.defineProperty(t.prototype,"isIntegratedMesh",{get:function(){return"integrated-mesh"===this.layer.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"areScaleBoundsActive",{get:function(){var e=O.extractSafeScaleBounds(this.layer),t=e.minScale,r=e.maxScale;return this.scaleVisibilityEnabled&&(t>0||r>0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unloadedMemoryEstimate",{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexDepth",{get:function(){return this._index?this._index.maxLevel:0},enumerable:!0,configurable:!0}),t.prototype._frame=function(e,t){return this.layerView.suspended?(this._updateView(e),-1/0):this.layerView.visible?(this._processLogError(e,t),this._index.getPriority()):-1/0},t.prototype._processLogError=function(e,t){try{this._process(e,t)}catch(e){this._errorCount<50?M.error("Error during processing: "+e):50===this._errorCount&&M.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}},t.prototype._process=function(e,t){var r=this;if(this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading()),null!=this._nodeLoader&&null!=this._index){for(this._updateView(e),this.isIntegratedMesh&&(e.enabled=!1),e.run(function(){return r._processIndex(t,e)}),this._updateFeatureLOD(),e.run(function(){return r._processCache(e,t)}),this.isIntegratedMesh&&(e.enabled=!0),e.run(function(){return r._processNodes(e,t)});!e.done&&this._idleQueue.process();)e.madeProgress();e.run(function(){return r._prefetchIndex(t)}),t.numIndexLoading+=this._index.getIndexLoading(),t.numNodesLoading+=this._downloadingNodes.size,this._evaluateUpdating(),this._lodHandling.lodGlobalHandling(e)}},t.prototype._processIndex=function(e,t){if(this._index.dirty){this._newLoadingNodes.clear(),this._index.update(o.keysOfSet(this._loadingNodes),t),!this.disableMemCache&&this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData&&(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length));var r=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||r===this._get("leafsReached")||this._set("leafsReached",r)}var i=Math.min(10-e.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,e));return this._index.load(i)},t.prototype._prefetchIndex=function(e){if(this._loadingNodes.size>0||this._index.updates.add.length>0)return!1;var t=Math.min(10-e.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,e));return this._index.prefetch(t)},t.prototype._updateFeatureLOD=function(){if(this.isGraphics3D){var e=!this._index.isLoading(),t=this.featureTarget*this.baseLOD,r=this._index.getFeatureEstimate();if(r.estimate=r.estimate||t/2,this._index.getIndexMissing()>500){if(this._featureLOD<=1e-4)return;this._featureLOD/=1.5,this._stableFeatureLOD=!1}else if(e&&r.estimate<t){if(r.leafsReached||this._featureLOD>=1e4||this._stableFeatureLOD)return;var i=Math.min(10,Math.max(t/r.estimate,1.001));this._featureLOD*=i;var n=this.lod,o=this._index.checkFeatureTarget(t,n);o!==n&&(this._featureLOD=o/this.baseLOD,this._stableFeatureLOD=!0)}else{if(!(r.estimate>1.2*t||e&&r.estimate>t))return;if(this._featureLOD<=1e-4)return;this._featureLOD/=1+.25*(r.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(1e4,Math.max(1e-4,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.requestUpdate()}},t.prototype._processCache=function(e,t){for(;this._newLoadingNodes.length>0&&!e.done;)for(var r=this._newLoadingNodes.pop(),i=this._index.getParent(r);i&&!this.layerView.isNodeLoaded(i.index)&&this._isNodeInScaleBounds(i);i=this._index.getParent(i.index))if(this._enableFromGPUCache(i,"hole")){e.madeProgress();break}return e.hasProgressed},t.prototype._processNodes=function(e,t){var r=(this._isIdle?100:2)-this._loadingNodes.size,i=this._index.updates;for(i.cancel.forEach(this._cancelNode,this),i.cancel=[];i.update.length>0&&!e.done;){var n=this._index.getNode(i.update.pop());this._updateLoadedNode(n),e.madeProgress()}for(;i.add.length>0&&!e.done&&r>0;){if(--r,2!==(n=this._index.getNode(i.add.back())).cacheState&&!this._hasNodeLoadToken(t))break;i.add.pop(),this._loadNode(n),e.madeProgress()}return e.hasProgressed},t.prototype._cancelAllNodes=function(){this._loadingNodes.clear(),this._downloadingNodes.clear(),this._updatingNodes.clear(),this._abortController.abort(),this._abortController=new AbortController},t.prototype._cancelNode=function(e){this._loadingNodes.delete(e),this._downloadingNodes.delete(e)},t.prototype._getAvailableLoadTokens=function(e,t){var r=t.numIndexLoading+this._index.getIndexLoading(),i=t.numNodesLoading+this._loadingNodes.size;return Math.floor((12-1*r-2*i)/e)},t.prototype._hasNodeLoadToken=function(e){var t=this._isIdle&&!this._index.isLoading()?5:2;return!(e.numNodesLoading+this._loadingNodes.size>=t)&&this._getAvailableLoadTokens(2,e)>0},t.prototype._evaluateUpdating=function(){var e=!1,t=0;if(this.layerView.suspended)t=(e=this._invisibleDirty||this._cameraDirty)?100:0;else{var r=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.updates.add.length:0)+2*this._loadingNodes.size;e=!!(r>0||this._updatingNodes.size>0||this._restartNodeLoading||this._cameraDirty||this._idleQueue.length>0||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===r&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(r,this._progressMaxNumNodes),t=100*r/this._progressMaxNumNodes}e!==this._get("updating")&&this._set("updating",e),t!==this._get("updatingPercentage")&&this._set("updatingPercentage",t)},t.prototype._updateView=function(e){this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(e)&&(this._invisibleDirty=!1),this._evaluateUpdating()},t.prototype._updateViewData=function(){if(this._cameraDirty&&this._index){var e=this.layerView.view,t=e.state.camera;this.camPos=_.vec3f64.clone(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/(t.perScreenPixelRatio/2),this._poi=this._calculatePointOfInterest(this._poi),this._viewportQueries.updateCamera(t),this._viewportQueries.setPointOfInterest(this._poi),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.invalidateVisibilityCache(),this._index.progressiveLoadPenalty=T.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate(),this._stableFeatureLOD=!1,this._invisibleDirty=!0,this._cameraDirty=!1,this.notifyChange("rootNodeVisible")}},t.prototype._getProgressiveLoadFactor=function(e){return this.layerView.view.resourceController.memoryController.memoryFactor<1?1:this.layerView.progressiveLoadFactor},Object.defineProperty(t.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseLOD",{get:function(){var e=this.layerView.lodFactor,t=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(e>0?e:1)*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodDropFactor",{get:function(){if(this.fixedFeatureTarget)return 1;var e=this.layerView.view.resourceController.memoryController;return(Math.min(e.memoryFactor,.5)-e.minQuality)/(.5-e.minQuality)},enumerable:!0,configurable:!0}),t.prototype.isGeometryVisible=function(e){return this._index.isGeometryVisible(e.index)},t.prototype.updateVisibility=function(e){return this._index.invalidateVisibilityCache(e)},t.prototype._shouldLoadNode=function(e){return!(!this._lodHandling.shouldLoadNode(e)||this._shouldDropNode(e)||!this._isNodeInScaleBounds(e))&&(!e.obb||this._index.isGeometryVisible(e.index))},t.prototype._shouldDropNode=function(e){var t=this.lodDropFactor;return!(t>=1||!this._lodHandling.childrenEmpty(e))&&Math.abs(this._viewportQueries.calcCameraDistanceToCenter(e))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*t},t.prototype._startNodeLoading=function(){var e=this;if(this._restartNodeLoading=!1,!this._updatesDisabled&&null!=this.streamDataController){this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var t=C.TextureFormat.Normal;this.layerView.useCompressedTextures?t=C.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(t=C.TextureFormat.Downsampled);var r={textureFormat:t,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid};this._nodeLoader=new C(this.layer,this.streamDataController,M,this._defaultGeometrySchema,this._requiredAttributes,r);var i=this.layerView.view.renderSpatialReference,n=this.crsIndex.equals(i)||this.crsIndex.isWGS84&&i.equals(P.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!n,this._index.requestUpdate(),this._lodHandling.startNodeLoading(function(t){return e._index.isNodeVisible(t)},function(t){return e._index.isGeometryVisible(t)},function(t){return e._isNodeInScaleBounds(t)},function(t){return e._index.nodeTraversalState(t)},function(t,r){return e._removeNodes(t,r)},this._index,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating()}},t.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index},t.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this.streamDataController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this._evaluateUpdating())},t.prototype._removeInvisibleNodes=function(e){var t=this;j.clear(),this.layerView.getLoadedNodeIndices(j);var r=0===this._viewportQueries.maxDistance,i=r?function(){return!1}:function(e){return t._shouldDropNode(e)};return j.filterInPlace(function(e){var r=t._index.getNode(e);return!t._index.isGeometryVisible(e)||i(r)||!t._isNodeInScaleBounds(r)}),j.length>0&&this._lodHandling.setLodGlobalDirty(),this._removeNodes(j,e),!(r&&this.lodDropFactor<1||0!==j.length&&(j.clear(),1))},t.prototype._removeNodes=function(e,t){e.length>0&&this._index.requestUpdate();var r=e.length;if(this.layerView.removeNodeData(e,t),this._loadedNodeScales.size>0)for(var i=e.length;i<r;i++){var n=e.data[i];this._loadedNodeScales.delete(n)}},t.prototype._needsUpdate=function(e){if(!e.resources.hasFeatureData||this._updatingNodes.has(e.index))return!1;var t=this.layerView.getLoadedAttributes(e.index);return null!=t&&t!==this._requiredAttributes},t.prototype._updateLoadedNode=function(e){var t=this,r=V(this.layerView.getLoadedAttributes(e.index),this._requiredAttributes)?h.resolve(this.layerView.getAttributeData(e.index)):this._nodeLoader.loadAttributes(e,this._requiredAttributes,this._abortController.signal);this._updatingNodes.add(e.index),r.then(function(r){return t.schedule(e.index).then(function(){return t.layerView.setAttributeData(e.index,{loadedAttributes:t._requiredAttributes,attributeData:r})})}).catch(function(r){h.isAbortError(r)||t.layerView.setAttributeData(e.index,{loadedAttributes:t._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){t._updatingNodes.delete(e.index),t._evaluateUpdating()}),this._evaluateUpdating()},t.prototype._loadNode=function(e){var t=this;this._loadingNodes.add(e.index),this._evaluateUpdating(),this._loadAndAddNode(e).catch(function(e){return e}).then(function(){t._loadingNodes.delete(e.index),t._evaluateUpdating()})},t.prototype._loadAndAddNode=function(e){var t=this;return 1===e.cacheState?this._loadUncached(e):this._loadCached(e).then(function(r){r||(e.cacheState=1,t._index.updates.add.push(e.index))}).catch(function(t){h.isAbortError(t)||(e.cacheState=1)})},t.prototype._enableFromGPUCache=function(e,t){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var r=this._loadCachedGPUData(e);return!!r&&(this.layerView.addCachedGPUData(e,r,t),this._nodeAdded(e),!0)},t.prototype._loadCachedGPUData=function(e){var t=this.layerView.loadCachedGPUData(e);return t&&R(t.attributeInfo)&&V(t.attributeInfo.loadedAttributes,this._requiredAttributes)?t:null},t.prototype._nodeAdded=function(e){this._index.requestUpdate(),this._lodHandling.lodSwapNodeLoaded(e)},t.prototype._loadCached=function(e){var t=this;if(this._enableFromGPUCache(e,"leaf"))return h.resolve(!0);var r=this.layerView;return!this.disableIDBCache&&r.loadCachedNodeData&&r.addCachedNodeData?this.schedule(e.index).then(function(){return r.loadCachedNodeData(e,function(r){return t._nodeLoader.loadTextures(e,r,t._abortController.signal)})}).then(function(i){if(null==i)return!1;var n=t._requiredAttributes;return R(i)&&V(i.loadedAttributes,n)?t.reschedule(e.index).then(function(){return r.addCachedNodeData(e,i,i)}).then(function(){return t._nodeAdded(e),!0}):t.reschedule(e.index).then(function(){return t._nodeLoader.loadAttributes(e,n,t._abortController.signal)}).then(function(r){return t.reschedule(e.index,{loadedAttributes:n,attributeData:r})}).then(function(t){return r.addCachedNodeData(e,i,t)}).then(function(){return t._nodeAdded(e),!0})}):h.resolve(!1)},t.prototype._loadUncached=function(e){var t=this;return this._downloadingNodes.add(e.index),a.safeCast(this._nodeLoader.loadNodeData(e,this._abortController.signal)).then(function(r){return t._downloadingNodes.delete(e.index),t.schedule(e.index,r)}).then(function(r){return t.layerView.addNodeData(e,r)}).then(function(){t._nodeAdded(e),e.cacheState=2}).catch(function(r){h.isAbortError(r)||(M.error("Failed to load node '"+e.id+"': "+r),e.failed=!0,t._index.requestUpdate())})},t.prototype._updateIdleState=function(e){e!==this._isIdle&&(this._isIdle=e,this._evaluateUpdating(),e&&this._index&&this._index.resetFailedNodes())},t.prototype._getScale=function(e){if(this._loadedNodeScales.has(e.index))return this._loadedNodeScales.get(e.index);var t=e.mbs;this._tmpPoint.x=t[0],this._tmpPoint.y=t[1],this._tmpPoint.z=t[2];var r=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);return this.layerView.isNodeLoaded(e.index)&&this._loadedNodeScales.set(e.index,r),r},t.prototype._isNodeInScaleBounds=function(e){if(!this.areScaleBoundsActive)return!0;var t=this._getScale(e),r=O.extractSafeScaleBounds(this.layer),i=r.minScale,n=r.maxScale;return O.scaleBoundsPredicate(t,i,n)},t.prototype.updateStats=function(e){e.index=this._index?this._index.size:0,this.isGraphics3D&&(e.detail=this._featureLOD,e.target=this.featureTarget*this.baseLOD),this._index&&this._index.updateStats(e)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{set disableIDBCache(t){e.disableIDBCache=t},set ignoreServiceOBB(t){e._index.ignoreServiceOBB=t}}},enumerable:!0,configurable:!0}),i([f.property({readOnly:!0})],t.prototype,"isMeshPyramid",null),i([f.property({readOnly:!0})],t.prototype,"isGraphics3D",null),i([f.property({readOnly:!0})],t.prototype,"streamDataController",null),i([f.property({readOnly:!0})],t.prototype,"crsVertex",null),i([f.property({readOnly:!0})],t.prototype,"crsIndex",null),i([f.property()],t.prototype,"camPos",void 0),i([f.property()],t.prototype,"screenSizeFactor",void 0),i([f.property()],t.prototype,"featureTarget",void 0),i([f.property()],t.prototype,"fixedFeatureTarget",void 0),i([f.property()],t.prototype,"layerView",void 0),i([f.property()],t.prototype,"layer",void 0),i([f.property({readOnly:!0})],t.prototype,"updating",void 0),i([f.property({readOnly:!0})],t.prototype,"updatingPercentage",void 0),i([f.property({readOnly:!0})],t.prototype,"leafsReached",void 0),i([f.property({constructOnly:!0})],t.prototype,"scaleVisibilityEnabled",void 0),i([f.property({readOnly:!0})],t.prototype,"rootNodeVisible",null),i([f.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],t.prototype,"uncompressedTextureDownsamplingEnabled",void 0),i([f.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],t)}(f.declared(n,d,s)),j=new c({deallocator:null}),T={factorIM:.2,factor3dObject:.05,distancePenalty:10},L=b.create();return N}.apply(null,i))||(e.exports=n)},1565:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(45)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){var t=this;this.referenceCount=0,this.callbacks=[],this.runIndex=0,this.handle=e.registerTask(2,function(e){return t.update(e)},function(){return t.needsUpdate()})}return e.prototype.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)},e.prototype.needsUpdate=function(){for(var e=0,t=this.callbacks;e<t.length;e++)if(t[e].needsUpdate())return!0;return!1},e.prototype.update=function(e){this.sort();for(var t=this.callbacks,r={numIndexLoading:0,numNodesLoading:0},i=0;i<t.length&&!e.done;++i)t[i].priority=t[i].update(e,r),this.runIndex=i},e.prototype.sort=function(){for(var e=this.callbacks,t=e.length,r=this.runIndex;r>0;r--){for(var i=e[r-1],n=r;n<e.length&&i.priority<=e[n].priority&&(n!==t||i.priority<e[n].priority);)e[n-1]=e[n],n++;e[n-1]=i,t=n-1}this.runIndex=0},e.prototype.add=function(e){this.sort(),e.priority=1/0,this.callbacks.unshift(e)},e.prototype.remove=function(e){r.removeUnordered(this.callbacks,e),this.runIndex=this.callbacks.length,this.sort()},e}(),n=new Map;t.addTask=function(e,t){var r=n.get(e);return null==r&&(r=new i(e),n.set(e,r)),r.add(t),{remove:function(){if(null!=r){if(r.remove(t),r.callbacks.length>0)return void(r=null);n.delete(e),r.destroy(),r=null}}}}}.apply(null,i))||(e.exports=n)},1566:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(14),r(86),r(9),r(4),r(33),r(1477),r(1489)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u){function p(e){e.node?(e.node.renderMbs[3]=-1,e.node.renderObb.halfSize[0]=-1):e.ref&&(e.ref.renderMbs[3]=-1,e.ref.renderObb.halfSize[0]=-1)}function c(e){return l.addWraparound(e,-2)}function d(e){return l.addWraparound(e,2)}function h(e,t){return 0===t?0:e/t|0}function y(e,t){return 0===t?e:e%t}function f(e){if(e)for(var t=0;t<e.length;t++)for(var r=0,i=v;r<i.length;r++){var n=i[r];if(n[0]===e[t].metricType)return{lodMetric:n[1],maxError:e[t].maxError}}return{lodMetric:0,maxError:0}}function m(e){return Math.sqrt(e*(4/Math.PI))}Object.defineProperty(t,"__esModule",{value:!0});var _=function(){function e(e,t,r,i,o,a,s,l,u,p){var c=this;this.layerUrl=e,this.streamDataController=i,this.viewportQueries=o,this.logger=a,this._isLoaded=s,this._isSelected=l,this._enable=u,this._needsUpdate=p,this._dirty=!0,this.nodePages=[],this.nodeCount=0,this.nodesPerPage=0,this.rootIndex=0,this.lodMetric=0,this.lodConversion=function(e){return e},this._loading=new Set,this._failedNodes=new Set,this._failedPages=new Set,this._indexMissing=1,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.POSITIVE_INFINITY,this._nodeTraversalState={},this._version=0,this._visibilityCacheGeneration=d(0),this._maxLevel=1,this._featureEstimate={estimate:0,leafsReached:!1},this._unloadedMemoryEstimate=0,this._missing=new n({deallocator:null}),this._prefetch=new n({deallocator:null}),this._updates=new b,this.ignoreServiceOBB=!1,this.progressiveLoadPenalty=0,this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1,this.initNodePages(r).catch(function(){return c.initNodeDocuments(t)})}return e.prototype.initNodePages=function(e){if(!e)return o.reject();switch(this.nodesPerPage=e.nodesPerPage,this.rootIndex=e.rootIndex,e.lodSelectionMetricType){case"maxScreenThreshold":this.lodMetric=1;break;case"maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=m}var t=h(this.rootIndex,this.nodesPerPage);return this.loadPage(t)},e.prototype.initNodeDocuments=function(e){this.nodesPerPage=0,this.rootIndex=0,this.nodePages.push({nodes:[],children:[],parents:[]}),this.makeRefNode({id:e,mbs:null},-1)},e.prototype.loadPage=function(e){var t=this;this._loading.add(e);var r=this.layerUrl+"/nodepages/"+e;return this.streamDataController.request(r,"json").then(function(r){t._loading.delete(e),t.addPage(e,r)}).catch(function(r){return t._loading.delete(e),t._failedPages.add(e),o.reject(r)})},e.prototype.addPage=function(e,t){for(var r=this,i=this.nodePages.length;i<e;i++)this.nodePages[i]=null;var n=[],o=[],l=t.nodes.map(function(t,i){var l=n.length,p=t.children?t.children.length:0;o.push(-1);for(var d=0;d<p;d++)n.push(t.children[d]);var h=""+t.index,y=u.clone(t.obb),f=s.vec4f64.fromArray([y.center[0],y.center[1],y.center[2],a.vec3.length(y.halfSize)]),m=t.mesh&&t.mesh.attribute,_=t.mesh&&t.mesh.geometry,g=t.mesh&&t.mesh.material,b={hasSharedResource:!1,hasFeatureData:!!_,attributes:m&&null!=m.resource?""+m.resource:null,geometry:_&&null!=_.resource?""+_.resource:null,texture:g&&null!=g.resource&&g.texelCountHint>0?""+g.resource:null,geometryDefinition:_?_.definition:-1,materialDefinition:g?g.definition:-1},v={id:h,index:e*r.nodesPerPage+i,childCount:p,failed:!1,cacheState:0,obb:y,mbs:f,level:0,resources:b,lodMetric:r.lodMetric,maxError:r.lodConversion(t.lodThreshold),renderMbs:s.vec4f64.fromArray([0,0,0,-1]),renderObb:u.create([0,0,0],[-1,-1,-1],[0,0,0,1]),numFeatures:_?_.featureCount:null,vertexCount:_?_.vertexCount:null};return{childOffset:l,childCount:p,visibilityCache:c(r._visibilityCacheGeneration),ref:null,node:v}});this.nodePages[e]={nodes:l,children:n,parents:o},this.nodeCount+=l.length,this.updateParentsAndLevel()},e.prototype.updateParentsAndLevel=function(){var e=this,t=[],r=function(r,n,o){var a=e.getPage(r);if(i.isSome(a)){var s=y(r,e.nodesPerPage);a.parents[s]=n;var l=a.nodes[s].node;l&&(l.level=o,t.push(r))}};for(r(this.rootIndex,-1,0);t.length;)for(var n=t.pop(),o=this.getNode(n),a=0;a<o.childCount;a++){r(this.getChildIndex(o,a),n,o.level+1)}},e.prototype.getPage=function(e){return this.nodePages[h(e,this.nodesPerPage)]},e.prototype.getNodeInternal=function(e){var t=this.getPage(e);return i.isNone(t)?null:t.nodes[y(e,this.nodesPerPage)]},e.prototype.addNode=function(e,t){null!=e.children&&this.populateChildren(t,e.children);var r=this.getParent(t),n=r?r.level+1:1;this._maxLevel=Math.max(this._maxLevel,n);var o=f(e.lodSelection),a=o.lodMetric,l=o.maxError,p=i.expect(this.getNodeInternal(t));return p.node={id:e.id,index:t,mbs:s.vec4f64.fromArray(e.mbs),obb:e.obb&&u.clone(e.obb),childCount:p.childCount,level:n,resources:e.resources,version:e.version,lodMetric:a,maxError:l,memory:null,numFeatures:e.numFeatures,failed:!1,cacheState:0},null==p.ref.mbs&&(p.ref.mbs=e.mbs),p.node.renderMbs=p.ref.renderMbs,p.node.renderObb=p.ref.renderObb,p.node},e.prototype.makeRefNode=function(e,t){var r=this.nodePages[0],i=r.nodes.length;return r.nodes.push({childOffset:0,childCount:0,node:null,ref:e,visibilityCache:c(this._visibilityCacheGeneration)}),this.nodeCount++,r.parents.push(t),e.renderMbs=s.vec4f64.fromArray([0,0,0,-1]),e.renderObb=u.create([0,0,0],[-1,-1,-1],[0,0,0,1]),i},e.prototype.populateChildren=function(e,t){var r=i.expect(this.getNodeInternal(e)),n=i.expect(this.getPage(e));r.childOffset=n.children.length,r.childCount=t.length;for(var o=0;o<t.length;o++){var a=this.makeRefNode(t[o],e);n.children.push(a)}},e.prototype.getNode=function(e){var t=this.getNodeInternal(e);return i.isSome(t)&&t.node},e.prototype.getIndexById=function(e){var t;return this.forAllNodes(function(r,i){(r.node?r.node.id:r.ref.id)===e&&(t=i)}),t},e.prototype.getNodeById=function(e){var t=this.getIndexById(e),r=null!=t?this.getNodeInternal(t):null;return i.isSome(r)?r.node:null},e.prototype.getChildIndex=function(e,t){var r=this.getPage(e.index);if(i.isNone(r))return-1;var n=r.nodes[y(e.index,this.nodesPerPage)];return r.children[n.childOffset+t]},e.prototype.getParentIndex=function(e){var t=this.getPage(e);return i.isSome(t)?t.parents[y(e,this.nodesPerPage)]:-1},e.prototype.getParent=function(e){return(e=this.getParentIndex(e))>=0?this.getNode(e):null},Object.defineProperty(e.prototype,"rootNode",{get:function(){var e=this.getNodeInternal(this.rootIndex);return i.isSome(e)?e.node:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.nodeCount},enumerable:!0,configurable:!0}),e.prototype.invalidateVisibilityCache=function(e){if(null!=e){var t=this.getNodeInternal(e);i.isSome(t)&&(t.visibilityCache=c(this._visibilityCacheGeneration))}else this._visibilityCacheGeneration=d(this._visibilityCacheGeneration)},e.prototype.isNodeVisible=function(e){var t=this.getNodeInternal(e);if(i.isNone(t)||t.ref&&!t.ref.mbs)return!0;if(!function(e,t){return(-2&e)===t}(t.visibilityCache,this._visibilityCacheGeneration)){var r=this.viewportQueries.isNodeVisible(t.ref||t.node);return t.visibilityCache=function(e,t){return t+(e?1:0)}(r,this._visibilityCacheGeneration),r}return function(e){return 1==(1&e)}(t.visibilityCache)},e.prototype.isGeometryVisible=function(e){if(!this.isNodeVisible(e))return!1;var t=this.getNodeInternal(e);return!!i.isNone(t)||!(t.node&&t.ref&&!t.ref.obb)||this.viewportQueries.isGeometryVisible(t.node)},Object.defineProperty(e.prototype,"maxLevel",{get:function(){return this._maxLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._updates.add.prune(),this._updates.update.prune()},e.prototype.requestUpdate=function(){this._dirty=!0,this._indexMissing=1,++this._version},e.prototype.update=function(e,t){var r=this;if(this._dirty){this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(e,this._missing),g.clear();var n=!0,o=new x,a=new x;this.traverseVisible(function(s,l){if(!l){var u=r.entryPriority(s),p=h(s,r.nodesPerPage);return g.set(p,Math.max(u,g.get(p)||0)),r._loading.has(p)||r._failedPages.has(p)||r._missing.push(p),void(r._maxProcessingPrio=Math.max(r._maxProcessingPrio,u))}var c=l.node;if(r._updateNodeFeatureEstimate(c,a),!c){var d=r.entryPriority(s);return r._loading.has(s)||r._failedNodes.has(s)||(r._missing.push(s),g.set(s,d)),void(r._maxProcessingPrio=Math.max(r._maxProcessingPrio,d))}var y=i.expect(r.getPage(s));if(0===r._missing.length&&0===r.nodesPerPage)for(var f=0;f<l.childCount;f++){var m=y.children[l.childOffset+f],_=r.getNodeInternal(m);!i.isSome(_)||_.node||r._loading.has(m)||(g.set(m,r.entryPriority(m)),r._prefetch.push(m))}if(!c.failed&&c.resources.hasFeatureData)if(r._isLoaded(s)){if(o.known+=c.memory,++o.knownNodes,r._isSelected(c)?l.childCount>0&&(n=!1):(o.unremoved+=c.memory,n=!1),r._needsUpdate(c)){var b=r.entryPriority(s);g.set(s,b),r._maxProcessingPrio=Math.max(r._maxProcessingPrio,b),r._updates.update.push(s)}}else if(c.memory&&(o.known+=c.memory,++o.knownNodes),r._isSelected(c)){if(l.childCount>0&&(n=!1),c.memory?(o.missing+=c.memory,o.known+=c.memory,++o.knownNodes):++o.missingNodes,e.indexOf(c.index)>=0)return r._maxProcessingPrio=Math.max(r._maxProcessingPrio,r.entryPriority(s)),void(r._updates.cancel=r._updates.cancel.filter(function(e){return e!==c.index}));if(!t.done&&r._enable(c))return void t.madeProgress();var v=r.entryPriority(s);g.set(s,v),r._maxProcessingPrio=Math.max(r._maxProcessingPrio,v),r._updates.add.push(s)}}),this._unloadedMemoryEstimate=o.missing-o.unremoved,o.knownNodes>3&&o.missingNodes>0&&(this._unloadedMemoryEstimate+=o.known/o.knownNodes*o.missingNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=this._computeFeatureEstimate(a),this._featureEstimate.leafsReached=n,this._missing.sort(function(e,t){return e-t}),this._missing.filterInPlace(function(e,t){return t<1||r._missing.data[t-1]!==e}),this._missing.sort(function(e,t){return g.get(e)-g.get(t)}),this._missing.length>0?(this._maxUnloadedPrio=g.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort(function(e,t){return g.get(e)-g.get(t)}),this._updates.add.filterInPlace(function(e){return g.get(e)>=r._maxUnloadedPrio}).sort(function(e,t){return g.get(e)-g.get(t)}),this._updates.update.sort(function(e,t){return g.get(e)-g.get(t)}),this._indexMissing=this._loading.size+this._missing.length,this._dirty=this._indexMissing>0,g.clear()}},e.prototype.checkFeatureTarget=function(e,t){for(var r=this.viewportQueries.updateScreenSpaceErrorBias(t),i=t,n=t,o=r,a=10;a--;){var s=new x;if(this._updateFeatureEstimate(i,s),this._computeFeatureEstimate(s)<=e){if(i>=t||s.missingNodes>0||0===a)break;o=i,i=.5*(i+n)}else n=i,i=.5*(i+o)}return++this._version,this.viewportQueries.updateScreenSpaceErrorBias(r),Math.min(t,i)},e.prototype._updateFeatureEstimate=function(e,t){var r=this;++this._version,this.viewportQueries.updateScreenSpaceErrorBias(e),this.traverseVisible(function(e,i){return r._updateNodeFeatureEstimate(i&&i.node,t)})},e.prototype._updateNodeFeatureEstimate=function(e,t){if(e&&!e.failed&&null!=e.numFeatures)return this._isLoaded(e.index)?(t.known+=e.numFeatures,++t.knownNodes,void(this._isSelected(e)||(t.unremoved+=e.numFeatures))):void(this._isSelected(e)&&(e.numFeatures?(t.missing+=e.numFeatures,t.known+=e.numFeatures,++t.knownNodes):++t.missingNodes))},e.prototype._computeFeatureEstimate=function(e){var t=e.known-e.unremoved;return e.knownNodes>3&&e.missingNodes>0&&(t+=e.known/e.knownNodes*e.missingNodes),Math.max(0,t)},e.prototype.load=function(e){if(0===this._missing.length)return!1;e=Math.min(e,this._missing.length);for(var t=0;t<e;++t)0===this.nodesPerPage?this._loadNode(this._missing.pop()):this.loadPage(this._missing.pop());return!0},e.prototype.prefetch=function(e){if(0===this._prefetch.length)return!1;e=Math.min(e,this._prefetch.length);for(var t=0;t<e;++t)this._loadNode(this._prefetch.pop());return!0},e.prototype.isLoading=function(){return this._indexMissing>0},e.prototype.getIndexLoading=function(){return this._loading.size},e.prototype.getIndexMissing=function(){return this._indexMissing},e.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),e.prototype.getFeatureEstimate=function(){return this._featureEstimate},e.prototype.nodeTraversalState=function(e){if(!e)return null;var t=this._nodeTraversalState[e.index];if(t&&t.version===this._version)return t;var r=this.viewportQueries.getLodLevel(e),i=this.viewportQueries.hasLOD(e),n=!0;if(i){var o=this.getParentIndex(e.index);if(o>=0){var a=this._nodeTraversalState[o];n=a&&r>a.lodLevel}else n=r>0}return t?(t.lodLevel=r,t.isChosen=n,t.version=this._version,t):(this._nodeTraversalState[e.index]={nodeHasLOD:i,lodLevel:r,isChosen:n,version:this._version},this._nodeTraversalState[e.index])},e.prototype._loadNode=function(e){var t=this;this._loading.add(e);var r=i.expect(this.getNodeInternal(e)).ref.id,n=this.layerUrl+"/nodes/"+r,a=function(){t._loading.delete(e),0===t._missing.length&&0===t._loading.size&&t.requestUpdate()};this.streamDataController.request(n,"json").then(function(i){var n=t._validateNode(r,i);if(null!=n){n.obb&&t.invalidateVisibilityCache(e);var o=t.addNode(n,e);t.nodeTraversalState(o),a()}else a()},function(r){o.isAbortError(r)||(t.logger.error("Error loading node: "+n),t._failedNodes.add(e)),a()})},e.prototype._validateNode=function(e,t){var r=this;if(null==t||"object"!=typeof t||t.id!==e)return this.logger.error('Invalid node. Wrong type or wrong id "'+e+'"'),null;t.sharedResource&&"./shared"!==t.sharedResource.href&&"./shared/"!==t.sharedResource.href&&this.logger.warn('Invalid shared resource href on node "'+e+'"'),null==t.geometryData||Array.isArray(t.geometryData)&&1===t.geometryData.length&&"./geometries/0"===t.geometryData[0].href||this.logger.warn('Invalid geometry data on node "'+e+'"'),null==t.attributeData||Array.isArray(t.attributeData)&&!t.attributeData.some(function(e,t){return e.href!=="./attributes/f_"+t+"/0"})||this.logger.warn('Invalid attribute data on node "'+e+'"'),t.featureData&&t.featureData.length>1&&this.logger.warn("Node "+e+" has "+t.featureData.length+" bundles. Only the first bundle will be loaded.");var i=t.hasOwnProperty("obb")&&!this.ignoreServiceOBB?t.obb:null,n=t.featureData&&1===t.featureData.length&&t.featureData[0].featureRange?t.featureData[0].featureRange[1]-t.featureData[0].featureRange[0]+1:null,o=Array.isArray(t.children)?t.children.map(function(t){if(null==t)return null;var i=function(t){return r.logger.error("Invalid node reference on node "+e+": "+t)};if("number"==typeof t.id)i("id "+t.id+" is a number instead of a string.");else if("string"!=typeof t.id||!Array.isArray(t.mbs))return i("Missing or invalid id."),null;if(!Array.isArray(t.mbs))return i("Invalid bounding volume on reference "+t.id+"."),null;t.href&&t.href!=="../"+t.id&&r.logger.error('Invalid node href on node "'+e+'"');var n=t.hasOwnProperty("obb")&&!r.ignoreServiceOBB?t.obb:null;return{id:""+t.id,mbs:t.mbs,obb:n}}).filter(function(e){return null!=e}):null;return{id:e,mbs:t.mbs,obb:i,children:o,resources:{hasFeatureData:t.featureData&&t.featureData.length>0,hasSharedResource:null!=t.sharedResource,attributes:t.attributeData?e:null,texture:t.textureData&&t.textureData.length>0?e:null,geometry:null!=t.geometryData?e:null},version:"string"==typeof t.version?t.version:null,lodSelection:Array.isArray(t.lodSelection)?t.lodSelection:null,numFeatures:n}},e.prototype.resetFailedNodes=function(){this._failedNodes.clear(),this._failedPages.clear(),this.forAllNodes(function(e){e.node&&(e.node.failed=!1)})},e.prototype.entryPriority=function(e){var t=this.getNodeInternal(e),r=this.getParentIndex(e);if(i.isNone(t)||r<0&&null==t.node)return r<0?1/0:this.entryPriority(r);var n=0;if(t.node&&r>=0){var o=this._nodeTraversalState[r];null!=o&&(n=o.lodLevel)}for(var a=this.progressiveLoadPenalty,s=e;s>=0;s=this.getParentIndex(s))if(this._isLoaded(s)){a=0;break}var l=this.viewportQueries.distToPOI(t.ref||t.node);return-l-n*(l+this.progressiveLoadPenalty)+a},e.prototype.traverseVisible=function(e){var t=this.getNodeInternal(this.rootIndex);i.isSome(t)?this._traverse(this.rootIndex,t,e):e(this.rootIndex,null)},e.prototype._traverse=function(e,t,r){if(t.node&&0===t.childCount)this.isGeometryVisible(e)&&r(e,t);else if(this.isNodeVisible(e)&&(r(e,t),null!=t.node)){var n=this.nodeTraversalState(t.node);if(!n.nodeHasLOD||n.lodLevel!==this._maxLodLevel)for(var o=i.expect(this.getPage(e)),a=0;a<t.childCount;a++){var s=o.children[t.childOffset+a],l=this.getNodeInternal(s);i.isSome(l)?this._traverse(s,l,r):r(s,null)}}},e.prototype.traverse=function(e,t){t(e)&&this.traverseChildren(e,t)},e.prototype.traverseChildren=function(e,t){var r=e.index,n=this.getNodeInternal(r);i.isSome(n)&&this._traverseChildren(r,n,t)},e.prototype._traverseChildren=function(e,t,r){var n=this.getPage(e);if(!i.isNone(n))for(var o=0;o<t.childCount;++o){var a=n.children[t.childOffset+o],s=this.getNodeInternal(a);i.isSome(s)&&s.node&&r(s.node)&&this._traverseChildren(a,s,r)}},e.prototype.updateStats=function(e){if(this._updates.add.length>0&&(e.nodes+=" + "+this._updates.add.length),(this._indexMissing||this._prefetch.length>0)&&(e.index+=" + "+this._indexMissing||!1),e.prio=this._maxProcessingPrio,this._featureEstimate.estimate){var t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}},e.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)},e.prototype.updateElevationInfo=function(e){this.forAllNodes(p),this.viewportQueries.updateElevationInfo(e)},e.prototype.invalidateBoundingVolumeCache=function(e){var t=this.getNodeInternal(e);i.isSome(t)&&p(t)},e.prototype.forAllNodes=function(e){for(var t=0;t<this.nodePages.length;t++){var r=this.nodePages[t];if(r)for(var i=t*this.nodesPerPage,n=0;n<r.nodes.length;n++)e(r.nodes[n],i+n)}},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{addNode:function(t,r){return e.addNode(t,r)}}},enumerable:!0,configurable:!0}),e}();t.I3SIndex=_;var g=new Map,b=function(){function e(){this.update=new n({deallocator:null}),this.add=new n({deallocator:null}),this.cancel=[]}return e.prototype.reset=function(e,t){this.add.clear(),this.update.clear(),this.cancel=e,this.missing=t},e}(),v=[["maxScreenThreshold",1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];t.selectErrorMetric=f;var x=function(){return function(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}()}.apply(null,i))||(e.exports=n)},1567:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(86)],void 0===(n=function(e,t,r){var i=function(){function e(e,t){this.layerView=e,this.lodGlobalDirtyChanged=t}return e.prototype.startNodeLoading=function(e,t,r,i,n,o,a){this._lodGlobalDirty=!1,this._maxLodLevel=a.maxLodLevel,this._index=o,this._nodeTraversalState=i,this._isNodeVisible=e,this._isGeometryVisible=t,this._isNodeInScaleBounds=r,this._removeNodes=n,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.shouldLoadNode=function(e){var t=this._nodeTraversalState(e);return!!this.isChosenMaxLOD(t)||!!t.isChosen&&this._childrenRequireLoading(e)},e.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.lodSwapNodeLoaded=function(e){this.setLodGlobalDirty()},Object.defineProperty(e.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._index&&!0===this._lodGlobalDirty},enumerable:!0,configurable:!0}),e.prototype.lodGlobalHandling=function(e){if(this.requiresLODGlobalHandling){var t=this.layerView.view.resourceController.memoryController.usedMemory,r=Math.max(0,Math.floor(10*(t-1)));n.clear(),this._lodGlobalHandlingRecursion(this._index.rootNode,r),this._removeNodes(n,e),0===n.length&&(this._lodGlobalDirty=!1,this.lodGlobalDirtyChanged(this._lodGlobalDirty)),n.clear()}},e.prototype._lodGlobalHandlingRecursion=function(e,t){if(null==e)return!1;var r=this._nodeTraversalState(e),i=this.isChosenMaxLOD(r),o=this.layerView.isNodeLoaded(e.index);if(o&&null!=this.layerView.updateNodeStatus&&this.layerView.updateNodeStatus(e.index,i?"leaf":"hole"),i&&o)return this._removeChildrenRecursive(e),!0;var a=!1;if(e.childCount>0){a=!0;for(var s=0;s<e.childCount;s++){var l=this._index.getChildIndex(e,s),u=this._index.getNode(l);u?this._isGeometryVisible(l)&&!this._lodGlobalHandlingRecursion(u,t)&&this._isNodeInScaleBounds(u)&&(a=!1):this._isNodeVisible(l)&&(a=!1)}}o&&!i&&(a||n.length<t)&&(n.push(e.index),o=!1);var p=!e.resources.hasFeatureData;return a||o||p},e.prototype._removeChildrenRecursive=function(e){this._index.traverseChildren(e,function(e){return n.push(e.index),!0})},e.prototype.childrenEmpty=function(e){var t=this,r=!0;return this._index.traverseChildren(e,function(e){return!(!r||!t._isNodeVisible(e.index)||t.layerView.isNodeLoaded(e.index)&&(r=!1,1))}),r},e.prototype._childrenRequireLoading=function(e){var t=this,r=!1,i=!0;return this._index.traverseChildren(e,function(e){if(!i||!t._isNodeVisible(e.index))return!1;var n=t._nodeTraversalState(e);return t.isChosenMaxLOD(n)&&t._isGeometryVisible(e.index)&&(r=!0),!t.layerView.isNodeLoaded(e.index)||(i=!1,!1)}),i&&r},e.prototype.isChosenMaxLOD=function(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)},e}(),n=new r({deallocator:null});return i}.apply(null,i))||(e.exports=n)},1568:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(22),r(10),r(14),r(9),r(31),r(1540),r(1495),r(1477),r(18)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d){function h(e,t){if(!e||!t||!t.materialDefinitions)return e;var r=Object.keys(t.materialDefinitions)[0];return!t.materialDefinitions[r].params.vertexRegions&&e.vertexAttributes.region&&delete(e=o.clone(e)).vertexAttributes.region,e}function y(e,t){var r={bufferDefinition:null,bufferIndex:0};if(null==e||t.resources.geometryDefinition<0)return r;var i=t.resources.geometryDefinition>=0?e[t.resources.geometryDefinition].geometryBuffers:null;if(null==i)return r;for(var o=0;o<i.length;o++)if(null==i[o].compressedAttributes)r.bufferIndex=o,r.bufferDefinition=i[o];else if("draco"===i[o].compressedAttributes.encoding&&u.isSupported()&&!n("disable-feature:i3s-draco"))return r.bufferIndex=o,r.bufferDefinition=i[o],r;return r}function f(e,t){var r=[];return t&&t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture&&function(t){var i=a.isSome(e)&&e[t]&&e[t].formats;i&&r.push({id:""+t,encodings:i.map(function(e){var t=e.name,r=e.format;return{name:t,encoding:b[r]}})})}(t.pbrMetallicRoughness.baseColorTexture.textureSetDefinitionId),r}function m(e,t){var r,i=f(e,t),n=i[0]&&i[0].id,o=a.isSome(e)&&e[n]&&e[n].atlas,s="opaque"!==t.alphaMode,l=n?((r={})[n]={encoding:i[0].encodings.map(function(e){return e.encoding}),wrap:["none","none"],atlas:o,channels:s?"rgba":"rgb",images:[{id:n,size:0,href:i[0].encodings.map(function(e){return"../textures/"+e.name}),byteOffset:0,length:0}]},r):{},u=t.pbrMetallicRoughness,p=u&&u.baseColorFactor;return{textureDefinitions:l,materialDefinitions:{mat:{type:"standard",params:{diffuse:p?p.slice(0,3):[1,1,1],specular:[1,1,1,1],vertexRegions:o,doubleSided:t.doubleSided,cullFace:t.cullFace,transparency:p?1-p[3]:0,useVertexColorAlpha:s}}}}}function _(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];v[n]&&(t[v[n]]={valueType:null})}return{header:null,byteOffset:0,byteCount:0,vertexAttributes:t}}var g=function(){function e(e,t,r,i,n,o){if(this.streamDataController=t,this.logger=r,this.defaultGeometrySchema=i,this.requiredAttributes=n,this.options=o,this.layerUrl=e.parsedUrl.path,this.geometryDefinitions=e.geometryDefinitions,e.materialDefinitions){var a=e.textureSetDefinitions;this.materialTextures=e.materialDefinitions.map(function(e){return f(a,e)}),this.materialShared=e.materialDefinitions.map(function(e){return m(a,e)})}}return e.prototype.load=function(e,t,r){return this.streamDataController.request(e,t,{signal:r})},e.prototype.loadAttribute=function(e,t,r){var i=this.layerUrl+"/nodes/"+e.resources.attributes+"/attributes/"+t.key+"/0";return this.load(i,"binary",r).then(function(e){return p.readBinaryAttribute(t,e)})},e.prototype.loadAttributes=function(e,t,r){var i=this;return s.eachAlways(t.map(function(t){return i.loadAttribute(e,t.attributeStorageInfo,r)})).then(function(r){for(var n={},o=0;o<t.length;++o)r[o].value?n[t[o].name]=r[o].value:s.isAbortError(r[o].error)||i.logger.error("Failed to load attributeData for '"+t[o].name+"' on node '"+e.id+"'");return n})},e.prototype.loadNodeData=function(e,t){return i(this,void 0,void 0,function(){var i,n,o,a,l,u,c,d,f,m,g,b,v,x,w,S,D,C,I;return r(this,function(r){switch(r.label){case 0:return i=null!=this.requiredAttributes&&e.resources.attributes?this.loadAttributes(e,this.requiredAttributes,t):s.resolve({}),n=y(this.geometryDefinitions,e),o=n.bufferDefinition,a=n.bufferIndex,l=e.resources.geometry?this.loadGeometry(e,a,t):null,e.resources.hasSharedResource?[4,this.loadShared(e,t)]:[3,2];case 1:return c=r.sent(),[3,3];case 2:c=this.materialShared&&e.resources.materialDefinition>=0?this.materialShared[e.resources.materialDefinition]:null,r.label=3;case 3:return u=c,this.options.loadFeatureData?[4,this.loadFeatureData(e,t)]:[3,5];case 4:return f=r.sent(),[3,6];case 5:f=null,r.label=6;case 6:return d=f,m=this.options.loadFeatureData?this.collectGeometries(d):this.meshPyramidGeometryData(e,u),g=this.materialTextures&&e.resources.materialDefinition>=0?this.materialTextures[e.resources.materialDefinition]:this.getRequiredTexturesFromShared(m,u),b=this.options.loadTextureData?this.loadTextures(e,g,t):null,v=null,x=null,l?[4,l]:[3,8];case 7:v=r.sent(),w=h(this.defaultGeometrySchema,u),S=!(!o||!o.compressedAttributes||"draco"!==o.compressedAttributes.encoding),x=S?_(o.compressedAttributes.attributes):o?p.createGeometryIndexFromDefinition(o,e.vertexCount,e.numFeatures):p.createGeometryIndexFromSchema(v,w),r.label=8;case 8:return[4,b];case 9:return D=r.sent(),[4,i];case 10:return C=r.sent(),I=null,C&&(I={attributeData:C,loadedAttributes:this.requiredAttributes}),[2,{allGeometryData:m,attributeDataInfo:I,geometryBuffer:v,geometryIndex:x,sharedResource:u,requiredTextures:g,textureData:D}]}})})},e.addAbsoluteHrefTexture=function(e,t){var r=e.textureDefinitions;if(null!=r)for(var i=0,n=Object.keys(r);i<n.length;i++)for(var o=0,a=r[n[i]].images;o<a.length;o++){var s=a[o];Array.isArray(s.href)?s.hrefConcat=s.href.map(function(e){return l.makeAbsolute(e,t)}):s.hrefConcat=l.makeAbsolute(s.href,t)}},e.fixTextureEncodings=function(e){var t=e.textureDefinitions;if(null!=t)for(var r in t){var i=t[r];if(Array.isArray(i.encoding))for(var n=0;n<i.encoding.length;n++){var o;"data:"===(o=i.encoding[n]).substring(0,5)&&(i.encoding[n]=o.substring(5))}else"data:"===(o=i.encoding).substring(0,5)&&(i.encoding=o.substring(5))}},e.prototype.loadShared=function(t,r){var i=this.layerUrl+"/nodes/"+t.resources.geometry+"/shared";return this.load(i,"json",r).then(function(t){return e.fixTextureEncodings(t),e.addAbsoluteHrefTexture(t,i),t})},e.prototype.loadTexture=function(e,t,r,i,n){return i===c.DDS_ENCODING_STRING?this.load(e,"binary",n).then(function(e){return{i3sTexId:t,data:e,encoding:i}}):this.load(e,"image",n).then(function(e){var n=e;if(r&&e.width*e.height>=4096){var o=Math.ceil(e.width/2),a=Math.ceil(e.height/2),s=document.createElement("canvas");s.width=o,s.height=a,s.getContext("2d").drawImage(e,0,0,o,a),n=s}return{i3sTexId:t,data:n,encoding:i}})},e.prototype.loadTextures=function(t,r,i){var n=this,o=this.options.textureFormat===e.TextureFormat.Compressed,a=this.options.textureFormat===e.TextureFormat.Downsampled;return s.all(r.map(function(e){var r=c.selectEncoding(e.encodings,o);if(null==r)return n.logger.error("No known encoding for texture found on node "+t.id),s.reject();var l=t.resources.texture||t.id,u=n.layerUrl+"/nodes/"+l+"/textures/"+r.name;return n.loadTexture(u,e.id,a,r.encoding,i)}))},e.prototype.getRequiredTexturesFromShared=function(e,t){for(var r=[],i=0;i<e.length;i++){var n=e[i].geometries;if(null!=n)for(var o=this,a=0,s=n;a<s.length;a++){!function(e){var i=e.params.textureID||"none";if("none"!==i){null!=t.textureDefinitions&&null!=t.textureDefinitions[i]||o.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+i);var n=t.textureDefinitions[i];if(d.assert(void 0!==n,"geometry wants unknown texture "+i),0===n.images.length)return"continue";var a=n.images.length-1,s=n.images[a],l=function(e){return e&&e.split("/").pop()},u=Array.isArray(n.encoding)?n.encoding.map(function(e,t){return{name:l(s.href[t]),encoding:e}}):[{name:l(s.href),encoding:n.encoding}];r.push({id:i,encodings:u})}}(s[a])}}return r},e.prototype.meshPyramidGeometryData=function(e,t){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:t&&t.materialDefinitions?Object.keys(t.materialDefinitions)[0]:null,textureID:t&&t.textureDefinitions?Object.keys(t.textureDefinitions)[0]:null}}],featureDataPosition:[0,0,0]}]},e.prototype.collectGeometries=function(e){for(var t=new Array,r=0,i=e.featureData;r<i.length;r++){var n=i[r],o=n.geometries;if(null!=o)for(var a=0,s=o;a<s.length;a++){var l=s[a];t.push({featureIds:[n.id],featureDataPosition:n.position,geometries:[l]})}else null!=n.position&&t.push({featureIds:[n.id],featureDataPosition:n.position,geometries:null})}return t},e.prototype.loadFeatureData=function(e,t){var r=this.layerUrl+"/nodes/"+e.id+"/features/0";return this.load(r,"json",t)},e.prototype.loadGeometry=function(e,t,r){var i=this.layerUrl+"/nodes/"+e.resources.geometry+"/geometries/"+t;return this.load(i,"binary",r)},e}(),b={jpg:"image/jpeg",png:"image/png",dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"},v={position:"position",normal:"normal",uv0:"uv0",uv1:"uv1",color:"color","uv-region":"region"};return function(e){!function(e){e[e.Compressed=0]="Compressed",e[e.Normal=1]="Normal",e[e.Downsampled=2]="Downsampled"}(e.TextureFormat||(e.TextureFormat={}))}(g||(g={})),g}.apply(null,i))||(e.exports=n)},1569:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(9)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.requester=e,this.activeRequests=new Set}return e.prototype.request=function(e,t,n){var o=this,a=i.createAbortController();i.onAbortOrThrow(n,function(){return a.abort()}),n=r({},n,{signal:a.signal});var s=this.requester(e,t,n),l={response:s,abortController:a};return this.activeRequests.add(l),i.always(s,function(){return o.activeRequests.delete(l)}),s},e.prototype.cancelAll=function(){this.activeRequests.forEach(function(e){return e.abortController.abort()}),this.activeRequests.clear()},e}();t.I3SStreamDataController=n,t.default=n}.apply(null,i))||(e.exports=n)},1570:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(3),r(55),r(33),r(95),r(373),r(172),r(90),r(1477),r(30),r(1489),r(38)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d,h){return function(){function e(e,t,r,n,o,s,l){void 0===l&&(l={}),this.indexSR=e,this._renderCoordsHelper=t,this.extent=n,this.elevationProvider=o,this.options=l,this.fp=c.frustum.create(),this._poi=i.vec3f64.create(),this.minDistance=1/0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=i.vec3f64.create(),this._tmp2=i.vec3f64.create(),this._tmp3=i.vec3f64.create(),this._tmp0=i.vec3f64.create(),this.screenspaceErrorBias=l.screenspaceErrorBias||1,this.progressiveLoadFactor=l.progressiveLoadFactor||1,this.updateCamera(r),this.engineSR=this._renderCoordsHelper.spatialReference,this.updateElevationInfo(s.elevationInfo),this.tmpPoint=a.makeDehydratedPoint(0,0,0,e)}return e.prototype.updateElevationInfo=function(e){null!=e?(this._elevationContext=new s,this._elevationContext.featureExpressionInfoContext=l.createContext(l.extractExpressionInfo(e,!1)),this._elevationContext.mixinApi(e)):this._elevationContext=null},e.prototype.updateCamera=function(e){c.frustum.fromMatrix(e.viewMatrix,e.projectionMatrix,this.fp),this._screenSizeFactor=1/(e.perScreenPixelRatio/2),this._camPos=e.eye,this.minDistance=1/0,this.maxDistance=0},e.prototype.setPointOfInterest=function(e){r.vec3.copy(this._poi,e)},e.prototype.updateScreenSpaceErrorBias=function(e){var t=this.screenspaceErrorBias;return this.screenspaceErrorBias=e,t},e.prototype.updateExtent=function(e){this.extent=e},e.prototype.getRenderMbs=function(e){var t=e.renderMbs;return t||(t=o.vec4f64.fromValues(e.mbs[0],e.mbs[1],e.mbs[2],-1),e.renderMbs=t),t[3]<0&&(n.vec4.copy(t,e.mbs),this._elevationContext&&t[3]<1e5&&(this.tmpPoint.x=t[0],this.tmpPoint.y=t[1],this.tmpPoint.z=t[2],t[2]=u.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),h.mbsToMbs(t,this.indexSR,t,this.engineSR)),t},e.prototype.getRenderObb=function(e){if(e.obb&&!(e.obb.halfSize[0]<0)&&e.renderObb){var t=e.renderObb;return t.halfSize[0]<0&&(d.set(e.obb,t),this._elevationContext&&e.mbs[3]<1e5&&(this.tmpPoint.x=e.obb.center[0],this.tmpPoint.y=e.obb.center[1],this.tmpPoint.z=e.obb.center[2],t.center[2]=u.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),h.bufferToBuffer(t.center,this.indexSR,0,t.center,this.engineSR,0,1)),t}},e.prototype.isNodeVisible=function(e){var t=this.getRenderMbs(e);if(!this.isMBSinExtent(t))return!1;if(e.obb){var r=this.getRenderObb(e);return d.isVisible(r,this.fp)}return this.isMBSVisible(t)},e.prototype.isGeometryVisible=function(e){var t=this.getRenderObb(e);return!t||d.isVisible(t,this.fp)},e.prototype.isMBSinExtent=function(e){return!this.extent||0!==p.intersectBoundingBoxWithMbs(this.extent,e)},e.prototype.isMBSVisible=function(e){return c.frustum.intersectsSphere(this.fp.planes,c.sphere.wrap(e[3],e))},e.prototype.screenSpaceDiameterMbs=function(e,t){var i=this.getRenderMbs(e),n=Math.sqrt(r.vec3.squaredDistance(i,this._camPos)),o=n-i[3];return this._updateMinMaxDistance(n),o<0?.5*Number.MAX_VALUE:t/o*this._screenSizeFactor},e.prototype.calcCameraDistance=function(e){return this.calcCameraDistanceToCenter(e)-this.getRenderMbs(e)[3]},e.prototype.calcCameraDistanceToCenter=function(e){var t=this.getRenderMbs(e),i=r.vec3.distance(t,this._camPos);return this._updateMinMaxDistance(i),i},e.prototype.calcAngleDependentLoD=function(e){var t=this.getRenderMbs(e),i=t[3],n=(Math.abs(t[0]*(t[0]-this._camPos[0])+t[1]*(t[1]-this._camPos[1])+t[2]*(t[2]-this._camPos[2]))/r.vec3.length(t)+i)/r.vec3.distance(t,this._camPos);return Math.min(1,n)},e.prototype.hasLOD=function(e){return 0!==e.lodMetric},e.prototype.getDistancePlanarMode=function(e,t){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],o=r*r+i*i,a=t[3];if(o<=a*a)return Math.abs(n);var s=Math.sqrt(o)-a;return Math.sqrt(n*n+s*s)},e.prototype.getDistanceGlobeMode=function(e,t){var i=r.vec3.length(t),n=r.vec3.length(e)-i;r.vec3.scale(this._tmp0,e,r.vec3.dot(e,t)/r.vec3.squaredLength(e));var o=r.vec3.squaredDistance(t,this._tmp0),a=t[3];if(o<=a*a)return Math.abs(n);var s=r.vec3.scale(this._tmp0,t,1/i),l=i,u=a*a/2/l,p=r.vec3.scale(this._tmp1,s,l-u),c=e,d=r.vec3.subtract(this._tmp2,c,p),h=r.vec3.subtract(this._tmp2,d,r.vec3.scale(this._tmp3,s,r.vec3.dot(s,d))),y=r.vec3.add(this._tmp2,p,r.vec3.scale(this._tmp2,h,a/r.vec3.length(h))),f=r.vec3.distance(c,y);if(n>=2e5){var m=r.vec3.subtract(this._tmp1,c,y),_=r.vec3.dot(m,s)/r.vec3.length(m);_<.08&&(_=1e-4),f/=_}return f},e.prototype.getDistance=function(e,t){return this.engineSR===h.SphericalECEFSpatialReference?this.getDistanceGlobeMode(e,t):this.getDistancePlanarMode(e,t)},e.prototype._updateMinMaxDistance=function(e){e>0?(this.minDistance=Math.min(this.minDistance,e),this.maxDistance=Math.max(this.maxDistance,e)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-e))},e.prototype.getLodLevel=function(e){if(0===e.lodMetric||!e.resources.hasFeatureData)return 0;if(0===e.childCount)return this.maxLodLevel;if(this.progressiveLoadFactor<1){var t=this.progressiveLoadFactor*this.screenspaceErrorBias,r=this.screenspaceErrorBias;return this.evaluateLODmetric(e,t)?this.evaluateLODmetric(e,r)?2:1:0}return this.evaluateLODmetric(e,this.screenspaceErrorBias)?this.maxLodLevel:0},e.prototype.evaluateLODmetric=function(e,t){switch(e.lodMetric){case 2:var r=this.getRenderMbs(e),i=this.getDistance(this._camPos,r),n=2*i/this._screenSizeFactor,o=i+r[3];return this._updateMinMaxDistance(o),e.maxError*t<=n;case 1:var a=this.screenSpaceDiameterMbs(e,e.mbs[3]*t);return this.options.angleDependentLoD&&(a*=this.calcAngleDependentLoD(e)),a<e.maxError;case 3:return this.screenSpaceDiameterMbs(e,e.maxError)*t<10;case 4:return this.calcCameraDistance(e)>e.maxError*t}return!1},e.prototype.distToPOI=function(e){var t=this.getRenderMbs(e);return r.vec3.distance(t,this._poi)-t[3]},e.prototype.distCameraToPOI=function(){return r.vec3.distance(this._camPos,this._poi)},e}()}.apply(null,i))||(e.exports=n)},1576:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(13),r(42),r(564),r(66),r(6),r(45),r(25),r(15),r(20),r(207),r(12),r(24),r(14),r(85),r(86),r(9),r(29),r(0),r(3),r(43),r(35),r(118),r(95),r(573),r(1691),r(354),r(576),r(600),r(172),r(1692),r(597),r(1693),r(1694),r(598),r(78),r(1696),r(180),r(38),r(142),r(79),r(387),r(365),r(599)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d,h,y,f,m,_,g,b,v,x,w,S,D,C,I,A,E,G,P,O,V,F,R,M,N,j,T,L,U,B,q,z,k,Q,H,W){var Y=new a.Point,X=S.vec3f64.create(),Z=D.create(),J=f.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),K=function(e){function t(t){var r=e.call(this)||this;return r.propertiesPool=new z.PropertiesPool({computedExtent:a.Extent},r),r.computedExtent=null,r.currentRenderer=null,r.rendererHasGeometryOperations=!1,r.symbolCreationContext=new N.Graphics3DSymbolCreationContext,r.graphics3DGraphics=new Map,r.stageLayer=null,r.stage=null,r.graphicsDrapedUids=new Set,r.graphicsBySymbol=new Map,r.symbolConversionCache=new Map,r.symbols=new Map,r.graphicsWithoutSymbol={},r.graphicsWaitingForSymbol=new Set,r.handles=new h,r.suspendSymbolCleanup=!1,r._spatialReference=null,r.elevationAlignment=null,r.scaleVisibility=null,r.filterVisibility=null,r._spatialIndex=null,r.featureStore=null,r.deconflictor=null,r.labeler=null,r.highlights=null,r.viewElevationProvider=null,r.sharedSymbolResourcesOwnerHandle=null,r.whenGraphics3DGraphicRequests={},r.pendingUpdates=new Map,r.pendingAdds=0,r.pendingRemoves=0,r.pendingUpdatesPool=new b({allocator:function(e){return e||{add:null,remove:null}},deallocator:function(e){return e.add=null,e.remove=null,e}}),r.symbolWarningLogged=!1,r.geometryWarningLogged=!1,r.objectIdInvisibleSet=new Set,r._whenSymbolRemoved=new b,r.asyncUpdates=!1,r.elevationFeatureExpressionEnabled=!0,r.owner=null,r.layer=null,r.hasDraped=!1,r.graphicSymbolSupported=!0,r.hasZ=null,r.hasM=null,r._usedMemory=0,r.numberOfGraphics=0,r._visible=void 0,r._startCreateGraphics=!1,r.maxPendingUpdates=0,r}var u;return r(t,e),u=t,Object.defineProperty(t.prototype,"spatialIndex",{get:function(){return this._spatialIndex||(this._spatialIndex=new U.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM}),ee.clear(),this.graphics3DGraphics.forEach(function(e){return ee.push(e),!1}),this._spatialIndex.addMany(ee.data,ee.length)),this._spatialIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsWaitingForSymbol.size>0||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayFeatureLimit",{get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,r=e?e.graphics3D.maxTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfPrimitives:0,n=this.maxSymbolComplexity,o=Math.max(t,Math.min(r,Math.ceil(i/Math.max(1,n?n.primitivesPerFeature:1)))),a=this._get("displayFeatureLimit");return a&&a.minimumTotalNumberOfFeatures===t&&a.maximumTotalNumberOfFeatures===r&&a.maximumTotalNumberOfPrimitives===i&&a.maximumSymbolComplexity===n&&a.maximumNumberOfFeatures===o?a:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:r,maximumTotalNumberOfPrimitives:i,maximumSymbolComplexity:n,maximumNumberOfFeatures:o}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSymbolComplexity",{get:function(){for(var e=null,t=this.symbolComplexities,r=this._get("maxSymbolComplexity"),i=!1,n=0,o=t;n<o.length;n++){var a=o[n];(!e||0===e.primitivesPerCoordinate&&a.primitivesPerFeature>e.primitivesPerFeature||0!==e.primitivesPerCoordinate&&a.primitivesPerCoordinate>e.primitivesPerCoordinate)&&(e=a),i=i||a.estimated}return!e||i&&r&&(r.primitivesPerFeature>=e.primitivesPerFeature||r.primitivesPerCoordinate>=e.primitivesPerCoordinate)||r&&r.primitivesPerFeature===e.primitivesPerFeature&&r.primitivesPerCoordinate===e.primitivesPerCoordinate?r:e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this._spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolComplexities",{get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},enumerable:!0,configurable:!0}),t.prototype.getConvertedSymbol=function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var r=O.to3D(e,!0,!1,this.hasLabelingContext(e)),i=r.symbol||null;return i||r.error&&J.error(r.error.message),this.symbolConversionCache.set(e.id,i),i},t.prototype.getSymbolComplexitiesUsedOrRenderer=function(e){var t=e.getSymbols();if(!t||!t.length)return[];for(var r=[],i=0,n=t;i<n.length;i++){var o=n[i],a=this.symbols.get(o.id);if(a)r.push(a.complexity);else{var s=this.getConvertedSymbol(o);s&&r.push(B.defaultSymbolComplexity(s))}}return r},t.prototype.getSymbolComplexitiesUsed=function(){var e=[];return this.symbols.forEach(function(t){t&&e.push(t.complexity)}),e},t.prototype.initialize=function(){var e=this;this._spatialReference=this.owner.view.spatialReference,this._set("featureStore",new R.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return e.spatialIndex},forAllGraphics:function(t){return e.graphics3DGraphics.forEach(t)}}))},t.prototype.setup=function(e){return o(this,void 0,void 0,function(){var t,r,i,o,a=this;return n(this,function(n){return this._set("elevationAlignment",e.elevationAlignment),this._set("scaleVisibility",e.scaleVisibility),this._set("filterVisibility",e.filterVisibility),this._set("deconflictor",e.deconflictor),this._set("labeler",e.labeler),this._set("highlights",e.highlights),t=this.owner.view,this.viewElevationProvider=new V.ViewElevationProvider(this._spatialReference,t),this.initializeStage(t,this.layer.uid),this.symbolCreationContext.sharedResources=t.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=t.sharedSymbolResources.addGraphicsOwner(this.owner),this.symbolCreationContext.renderer=this.currentRenderer,this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=t.sharedSymbolResources.streamDataRequester,this.symbolCreationContext.renderSpatialReference=t.renderSpatialReference,this.symbolCreationContext.renderCoordsHelper=t.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.layerOrder=0,this.symbolCreationContext.localOriginFactory=new Q,this.symbolCreationContext.elevationProvider=t.elevationProvider,r=F.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),this.symbolCreationContext.featureExpressionInfoContext=F.createContext(r,this._spatialReference,J),this.symbolCreationContext.screenSizePerspectiveEnabled=t.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.handles.add(this.owner.watch("suspended",function(){return a.updateLayerVisibility()})),i="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",this.handles.add([this.owner.watch(i,function(){var e=t.screenSizePerspectiveEnabled&&a.layer.screenSizePerspectiveEnabled;e!==a.symbolCreationContext.screenSizePerspectiveEnabled&&(a.symbolCreationContext.screenSizePerspectiveEnabled=e,a.recreateAllGraphics())}),x.init(this,"asyncUpdates",function(e){return a.modeChange(e)},!0),this.owner.watch("slicePlaneEnabled",function(e){return a.slicePlaneEnabledChange(!!e)}),this.owner.view.watch("pixelRatio",function(e){return a.pixelRatioChange(e)}),x.when(t.basemapTerrain,"tilingScheme",function(e){e.spatialReference.equals(a.symbolCreationContext.overlaySR)||(a.symbolCreationContext.overlaySR=t.basemapTerrain.spatialReference),a.handles.has("loaded-graphics")?a.recreateAllGraphics():a.handles.add(x.on(a.owner,"loadedGraphics","change",function(e){return a.graphicsCollectionChanged(e)},function(){return a.recreateAllGraphics()}),"loaded-graphics")}),t.resourceController.scheduler.registerTask(3,function(e){return a.update(e)},function(){return a.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",function(){return a.deconflictor.featureReductionChange()})),o=this.rendererChange(this.layer.renderer),this.notifyChange("maxSymbolComplexity"),[2,o]})})},t.prototype.destroy=function(){for(var e in this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this.clear(),this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(k.ModelContentType.LAYER,this.stageLayer.id),this.stageLayer=null,this.stage=null),this.handles.destroy(),this.handles=null,this._spatialReference=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new d("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear(),this._spatialIndex&&(this._spatialIndex.destroy(),this._spatialIndex=null),this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))},t.prototype.clear=function(){this.graphics3DGraphics.forEach(function(e){return e.destroy()}),this._spatialIndex&&this._spatialIndex.clear(),this.graphics3DGraphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach(function(e){e&&e.destroy()}),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol={},this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this.pendingAdds=0,this.pendingRemoves=0,this._set("hasDraped",!1),this.notifyChange("updating"),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.featureStore.events.emit("changed")},t.prototype.initializeStage=function(e,t){this.stage=e._stage,this.stageLayer=new H(t,{isPickable:!this.owner.suspended},t),this.stage.add(k.ModelContentType.LAYER,this.stageLayer),this.stage.addToViewContent([this.stageLayer.id])},t.prototype.setDrawingOrder=function(e){this.symbolCreationContext.layerOrder=e;var t=new Set;this.symbols.forEach(function(r){r&&r.setDrawOrder(e,t)}),t.size>0&&this.stage.renderView.getDrapedRenderer().updateRenderOrder(t)},t.prototype.updateLayerVisibility=function(){var e=!!this.owner.suspended,t=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*re,r=!e&&!t;r!==this._visible&&(this._visible=r,r?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())},t.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)},t.prototype.getGraphics3DGraphicById=function(e){return this.graphics3DGraphics.get(e)},t.prototype._getGraphicObjectID=function(e,t){return void 0===t&&(t=this.owner.layer&&this.owner.layer.objectIdField),A.getObjectId(e,t)},Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){var e=this,t=this.owner.layer&&this.owner.layer.objectIdField;if(!t)return null;var r=new Map;return this.graphics3DGraphics.forEach(function(i){if(i){var n=i.graphic,o=e._getGraphicObjectID(n,t);_.isSome(o)&&r.set(o,i)}}),r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsEnabled",{get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())},enumerable:!0,configurable:!0}),t.prototype.updateLabelingInfo=function(e){return o(this,void 0,void 0,function(){var t,r;return n(this,function(i){switch(i.label){case 0:return t=this.deconflictor&&this.deconflictor.labelingInfoChange(e),r=this.labeler&&this.labeler.labelingInfoChange(e),[4,v.eachAlways([t,r])];case 1:return i.sent(),[2]}})})},t.prototype.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange(),this.labeler&&this.labeler.visibilityInfoChange()},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,r=0;return y.everyMap(this.symbols,function(i,n){if(i){var o=i.getFastUpdateStatus();if(o.loading>0)return!1;e.graphicsBySymbol.has(n)&&(r+=o.fast,t+=o.slow)}})?r>=0&&0===t?"fast":t>=0&&0===r?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0}),t.prototype.needsUpdate=function(){return this.pendingUpdates.size>0},t.prototype.update=function(e){this._applyPendingUpdates(e),this.needsUpdate()||this.notifyChange("updating")},t.prototype.setObjectIdVisibility=function(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);var r=this._findGraphics3DGraphicByObjectId(e);_.isSome(r)&&this._updateUserVisibility(r)},t.prototype._findGraphics3DGraphicByObjectId=function(e){var t,r=this;return y.everyMap(this.graphics3DGraphics,function(i){return r._getGraphicObjectID(i.graphic)!==e||(t=i,!1)}),t},t.prototype._updateUserVisibility=function(e){if(_.isNone(e))return!1;var t=e.graphic,r=this._getGraphicObjectID(t),i=t.visible&&!this.owner.suspended&&(_.isNone(r)||!this.objectIdInvisibleSet.has(r));return e.setVisibilityFlag(0,i,0)},t.prototype.whenGraphics3DGraphic=function(e){var t=this.graphics3DGraphics.get(e.uid);if(t)return v.resolve(t);var r=this.whenGraphics3DGraphicRequests[e.uid];if(r)return r.promise;var i=v.createDeferred();return this.whenGraphics3DGraphicRequests[e.uid]=i,i.promise},t.prototype.boundsForGraphics3DGraphic=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,a,s,l,u,p,c,d;return n(this,function(n){switch(n.label){case 0:return r=this._spatialReference,i=this.owner.view.renderSpatialReference,o=this.owner.view.basemapTerrain.spatialReference,a=function(e,t,n){return q.bufferToBuffer(e,i,t,e,r,t,n)},s=function(e,t,i){return q.bufferToBuffer(e,o,t,e,r,t,i)},l=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:_.isSome(t)&&t.useViewElevation,minDemResolution:_.isSome(t)&&t.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,e.getProjectedBoundingBox(a,s,l,_.get(t,"signal"))];case 1:return(u=n.sent())?(p=u.boundingBox,u.requiresDrapedElevation&&(c=this.symbolCreationContext.elevationProvider)&&(D.center(p,X),Y.x=X[0],Y.y=X[1],Y.z=void 0,Y.spatialReference=r,d=c.getElevation(Y)||0,p[2]=Math.min(p[2],d),p[5]=Math.max(p[5],d)),[2,{boundingBox:p,screenSpaceObjects:u.screenSpaceObjects}]):[2,null]}})})},t.prototype.whenGraphicBounds=function(e,t){var r=this;return x.whenOnce(this.owner,"loadedGraphics").then(function(){var t=r.owner.layer&&r.owner.layer.objectIdField,i=r.owner.loadedGraphics.find(function(r){return r===e||t&&r.attributes&&e.attributes&&r.attributes[t]===e.attributes[t]});if(i)return r.whenGraphics3DGraphic(i);throw new d("internal:graphic-not-part-of-view","Graphic is not part of this view")}).then(function(e){return r.boundsForGraphics3DGraphic(e,t)})},t.prototype.whenSymbolLayerSize=function(e,t){return o(this,void 0,void 0,function(){var r,i,o;return n(this,function(n){switch(n.label){case 0:if(null==(r=this.symbols.get(e.id)))throw new d("internal:symbol-not-part-of-view","Symbol is not part of this view");if(-1===(i=e.symbolLayers.indexOf(t)))throw new d("internal:missing-symbol-layer","Symbol layer is not in symbol");return[4,r.whenSymbolLayerSize(i)];case 1:if(null==(o=n.sent()))throw new d("internal:missing-size","Symbol layer has no valid size");return[2,o]}})})},t.prototype.graphicsCollectionChanged=function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))},t.prototype.graphicUpdateHandler=function(e){var t=e.graphic.uid,r=this.graphics3DGraphics.get(t),i=this.graphicsWithoutSymbol[t];if(r||i)switch(e.property){case"visible":this.graphicUpdateVisibleHandler(r,e);break;case"geometry":this.graphicUpdateGeometryHandler(r,e);break;case"symbol":this.graphicUpdateSymbolHandler(r,e);break;case"attributes":break;default:c.neverReached(e)}},t.prototype.graphicUpdateGeometryHandler=function(e,t){var r=t.graphic.geometry;if(_.isNone(r))this.recreateGraphic(t.graphic);else if(_.isNone(e)){var i=t.graphic.symbol&&t.graphic.symbol.id;if(i){var n=this.symbols.get(i);if(n&&0===n.loadStatus)return}this.recreateGraphic(t.graphic)}else e.graphics3DSymbol.updateGeometry(e,t.newValue)||this.recreateGraphic(e.graphic),this.expandComputedExtent(r)},t.prototype.graphicUpdateSymbolHandler=function(e,t){var r=t.graphic,i=_.isSome(e)?e.graphics3DSymbol:t.oldValue&&this.symbols.get(t.oldValue.id);if(i){var n=i.symbol,o=this.getConvertedSymbol(t.newValue);if(o.type===n.type&&"web-style"!==o.type&&"web-style"!==n.type){var a=this.graphicsBySymbol.get(n.id);if(a&&1!==a.size)this.recreateGraphic(r);else{var s=E.diff(n,o);if(_.isNone(s))this.updateSymbolMapping(n.id,o);else{var l={diff:s,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(i.prepareSymbolPatch(l),E.isEmpty(l.diff)){for(var u=0,p=l.symbolStatePatches;u<p.length;u++){(0,p[u])()}var c=this._getRenderingInfo(r);if(_.isSome(e))for(var d=0,h=l.graphics3DGraphicPatches;d<h.length;d++){(0,h[d])(e,c)}this.updateSymbolMapping(n.id,o)}else this.recreateGraphic(r)}}}else this.recreateGraphic(r)}else this.recreateGraphic(r)},t.prototype.graphicUpdateVisibleHandler=function(e,t){var r=this._updateUserVisibility(e);r&&this.labeler&&this.owner.view.labeler.setDirty(),r&&this.owner.view.deconflictor.setDirty()},t.prototype.recreateGraphic=function(e){var t=[e];this.suspendSymbolCleanup=!0,this.remove(t),this.add(t),this.suspendSymbolCleanup=!1,this.asyncUpdates||this._cleanupSymbols()},t.prototype._beginGraphicUpdate=function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"),this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)},t.prototype._endGraphicUpdate=function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))},t.prototype.expandComputedExtent=function(e){var t=Z,r=e.spatialReference;A.computeAABB(e,t);var i=this._spatialReference,n=u.tmpVec;if(r.equals(i)||q.xyzToVector(t[0],t[1],0,r,n,i)&&(t[0]=n[0],t[1]=n[1],q.xyzToVector(t[3],t[4],0,r,n,i),t[3]=n[0],t[4]=n[1]),m.isFinite(t[0])&&m.isFinite(t[3])&&m.isFinite(t[1])&&m.isFinite(t[4])){var o=this.computedExtent,a=null,s=m.isFinite(t[2])&&m.isFinite(t[5]),l=s&&(!o||null==o.zmin||t[2]<o.zmin),p=s&&(!o||null==o.zmax||t[5]>o.zmax);o?(t[0]<o.xmin||t[1]<o.ymin||t[3]>o.xmax||t[4]>o.ymax||l||p)&&((a=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],o.xmin),a.ymin=Math.min(t[1],o.ymin),a.xmax=Math.max(t[3],o.xmax),a.ymax=Math.max(t[4],o.ymax),a.spatialReference=i):((a=this.propertiesPool.get("computedExtent")).xmin=t[0],a.ymin=t[1],a.xmax=t[3],a.ymax=t[4],a.spatialReference=i),a&&(l&&(a.zmin=t[2]),p&&(a.zmax=t[5]),this._set("computedExtent",a))}},t.prototype.updateHasDraped=function(){var e=this.graphicsDrapedUids.size>0;this._set("hasDraped",e)},t.prototype.elevationInfoChange=function(){var e=this,t=F.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=F.createContext(t,this._spatialReference,J),this.labeler&&this.labeler.elevationInfoChange(),this.forEachGraphics3DSymbol(function(t,r,i){t.globalPropertyChanged("elevationInfo",r)?r.forEach(function(e){for(var t=e.graphic,r=e._labelGraphics,i=0;i<r.length;i++){var n=r[i];n.graphics3DSymbolLayer.updateGraphicElevationContext(t,n)}}):e._recreateSymbol(i)}),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()},t.prototype.clearSymbolsAndGraphics=function(){this.clear(),this.filterVisibility&&this.filterVisibility.clear(),this.labeler&&this.labeler.reset(),this.deconflictor&&this.deconflictor.clear(),this.elevationAlignment&&this.elevationAlignment.clear(),this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()},t.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0,this.recreateAllGraphics()},t.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))},t.prototype._recreateSymbol=function(e){var t=this,r=[];this.graphicsBySymbol.get(e).forEach(function(e,i){var n=e.usedMemory;t._conditionalRemove(e,i),t._spatialIndex&&t._spatialIndex.remove(e),r.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(i,n),t.updateLayerVisibility(),t.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(e,new Map);var i=this.symbols.get(e);i&&i.destroy(),this.symbols.delete(e),this.updateHasDraped(),this.add(r)},t.prototype._conditionalRemove=function(e,t){e.isDraped()&&this.graphicsDrapedUids.delete(t),this.highlights&&this.highlights.removeGraphic(e),this.labeler&&this.labeler.removeGraphic(e),this.deconflictor&&this.deconflictor.removeGraphic(e)},t.prototype.add=function(e){if(e&&0!==e.length){if(!this.owner.view.basemapTerrain||!this.owner.view.basemapTerrain.tilingScheme)return void J.error("#add()","Cannot add graphics before terrain surface has been initialized");this.asyncUpdates?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")}},t.prototype._addImmediate=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,$.clear();for(var r=0,i=e;r<i.length;r++){var n=i[r];this._startAddGraphic(n,$)}$.forEach(function(e){return t._finishAddGraphics(e)}),$.clear(),this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty(),this._cleanupSymbols()},t.prototype._addDelayed=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=i.uid,o=this.pendingUpdates.get(n);if(o)o.add||this.pendingAdds++,o.add=i;else{var a=this.pendingUpdatesPool.pushNew();a.add=i,this.pendingAdds++,this.pendingUpdates.set(n,a)}}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype.remove=function(e){this.asyncUpdates?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")},t.prototype._removeImmediate=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._removeGraphic(i)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype._removeDelayed=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=i.uid,o=this.pendingUpdates.get(n);if(o)o.add&&(o.remove?o.add=null:this.pendingUpdates.delete(n),this.pendingAdds--);else{var a=this.pendingUpdatesPool.pushNew();a.remove=i,this.pendingUpdates.set(n,a),this.pendingRemoves++}}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining")},t.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear(),this.maxPendingUpdates=0,this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&J.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0},t.prototype._applyPendingUpdates=function(e){var t=this;this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var r=e.idleFrame?1e3:100,i=0;$.clear(),y.everyMap(this.pendingUpdates,function(n,o){if(n.remove&&(t.pendingRemoves--,t._removeGraphic(n.remove)),n.add&&(t.pendingAdds--,t._startAddGraphic(n.add,$)&&i++),t.pendingUpdates.delete(o),i>r&&($.forEach(function(e){return t._finishAddGraphics(e)}),$.clear(),i=0),e.madeProgress(),e.done)return!1}),$.forEach(function(e){return t._finishAddGraphics(e)}),$.clear(),0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("updatingTotal"),this.notifyChange("updatingRemaining"),this.updateHasDraped()},t.prototype._startAddGraphic=function(e,t){this.graphicsWithoutSymbol[e.uid]=e;var r=this._getRenderingInfo(e,J);if(!r||_.isNone(r.symbol))return!1;if(!A.hasGeometry(e))return!1;var i=r.symbol,n=this.getOrCreateGraphics3DSymbol(i,r.renderer);if(!n)return!1;this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var o={graphic:e,renderingInfo:r,layer:this.layer},a=n.symbol.id,s=t.get(a);if(s)s.graphics.push(o);else{var l=te.acquire();l.clear(),l.push(o),t.set(a,{asyncSymbol:n,graphics:l})}return!0},t.prototype._finishAddGraphics=function(e){var t=this,r=!1,i=function(t){t===e.asyncSymbol.symbol.id&&(r=!0)};this._whenSymbolRemoved.push(i),e.asyncSymbol.load().then(function(){t._whenSymbolRemoved.removeUnordered(i),ee.clear();for(var n=0;n<e.graphics.length;n++){var o=e.graphics.data[n],a=o.graphic;if(!(r||e.asyncSymbol.destroyed||t.graphicSymbolSupported&&a.symbol&&a.symbol.id!==e.asyncSymbol.symbol.id)){if(t.graphicsWaitingForSymbol.has(a.uid)){var s=t.createGraphics3DGraphic(e.asyncSymbol,o);t._spatialIndex&&s&&ee.push(s)}t._endGraphicUpdate(a)}--e.asyncSymbol.referenced}ee.length>0&&(t._spatialIndex.addMany(ee.data,ee.length),ee.clear()),t.featureStore.events.emit("changed"),e.graphics.clear(),te.release(e.graphics),t.labeler&&t.owner.view.labeler.setDirty()},function(){if(t._whenSymbolRemoved.removeUnordered(i),!r&&!e.asyncSymbol.destroyed)for(var n=0;n<e.graphics.length;n++)t._endGraphicUpdate(e.graphics.data[n].graphic);e.graphics.clear(),te.release(e.graphics)})},t.prototype._removeGraphic=function(e){var t=e.uid,r=this.graphics3DGraphics.get(t);if(r){var i=r.usedMemory;this._conditionalRemove(r,t),this._spatialIndex&&this._spatialIndex.remove(r);var n=r.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(n).delete(t),delete this.graphicsWithoutSymbol[t],this.removeGraphics3DGraphic(t,i),r.destroy(),this.featureStore.events.emit("changed")}else delete this.graphicsWithoutSymbol[t],this.graphicsWaitingForSymbol.delete(t)},t.prototype.hasLabelingContext=function(e){if(e instanceof l.LabelSymbol3D||e instanceof l.TextSymbol){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(function(t){return t.symbol===e})}return!1},t.prototype.hasValidSymbolCreationContext=function(e){return!(e instanceof l.LabelSymbol3D&&!this.hasLabelingContext(e)&&(J.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),1))},t.prototype._getRenderingInfo=function(e,t){var r=e.geometry;if(_.isNone(r))return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&_.isSome(e.symbol))return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;var i=this.rendererHasGeometryOperations?A.hydrateGraphic(e,this.layer):e,n=this.owner.getRenderingInfo(i,this.currentRenderer);return!n||_.isNone(n.symbol)?(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null):n},t.prototype.createGraphics3DSymbol=function(e,t){var r=this;if(!this.hasValidSymbolCreationContext(e))return null;var i,n=this.getConvertedSymbol(e);if(!n)return null;if(t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var o=O.to3D(t.backgroundFillSymbol,!1,!0);o.symbol&&"web-style"!==o.symbol.type&&(i=o.symbol.symbolLayers)}var a=j.make(n,this.symbolCreationContext,i);return a.load().then(function(){return r.notifyChange("maxSymbolComplexity")}),a},t.prototype.getOrCreateGraphics3DSymbol=function(e,t){var r=this,i=this.symbols.get(e.id);return void 0===i&&(i=e instanceof l.WebStyleSymbol?new T(e,function(e){return r.createGraphics3DSymbol(e,t)}):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,i)),i&&++i.referenced,i},t.prototype.addGraphics3DGraphic=function(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this.numberOfGraphics++,this.updateLayerVisibility()},t.prototype.removeGraphics3DGraphic=function(e,t){this._usedMemory-=t,this.graphics3DGraphics.delete(e),this.numberOfGraphics--,this.updateLayerVisibility()},t.prototype.createGraphics3DGraphic=function(e,t){var r=t.graphic;if(delete this.graphicsWithoutSymbol[r.uid],this.symbols.has(e.symbol.id)){if(!this.graphics3DGraphics.has(r.uid)){var i=e.createGraphics3DGraphic(t),n=e.symbol.id;this.addGraphics3DGraphic(i),this.graphicsBySymbol.has(n)||this.graphicsBySymbol.set(n,new Map),this.graphicsBySymbol.get(n).set(r.uid,i),i.initialize(this.stageLayer,this.stage),i.isDraped()&&(this.graphicsDrapedUids.add(r.uid),this._set("hasDraped",!0)),i.centroid=null,_.isSome(r.geometry)&&"point"!==r.geometry.type&&i instanceof M&&(i.centroid=L.computeCentroid(r.geometry,this._spatialReference)),this._updateUserVisibility(i),this.deconflictor&&this.deconflictor.addGraphic(i),this.labeler&&this.labeler.addGraphic(i),this.scaleVisibility&&this.scaleVisibility.updateVisibility(i),this.filterVisibility&&this.filterVisibility.updateVisibility(i),this.highlights&&this.highlights.addGraphic(i),this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,i);var o=this.whenGraphics3DGraphicRequests[r.uid];return o&&(delete this.whenGraphics3DGraphicRequests[r.uid],o.resolve(i)),i}}else this.add([r])},t.prototype.rendererChange=function(e){return o(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return e===this.currentRenderer?[2]:(this.validateRenderer(e),P.hasGeometryOperations(e)?[4,P.enableGeometryOperations()]:[3,2]);case 1:return t.sent(),this.layer.renderer===e&&this.currentRendererChange(e,!0),[3,3];case 2:this.currentRendererChange(e,!1),t.label=3;case 3:return[2]}})})},t.prototype.currentRendererChange=function(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t;var r=this.symbolCreationContext.renderer;if(e!==r){this.symbolConversionCache.clear();var i=E.diff(r,e);this.updateUnchangedSymbolMappings(i,e,r),this.symbolCreationContext.renderer=e,_.isNone(i)||("complete"===i.type?this.recreateAllGraphics():"partial"===i.type&&(this.applyRendererDiff(i,e,r)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}},t.prototype.diffHasSymbolChange=function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1},t.prototype.applySymbolSetDiff=function(e,t,r,i){var n=this;e=e||[];for(var o=[],a=this,s=0,l=t=t||[];s<l.length;s++){!function(t){var i=a.graphicsBySymbol.get(t.id);i&&i.forEach(function(a,s){var l=a.graphic,u=n.layer instanceof I?n.layer:null;if(t!==r.defaultSymbol||r.getSymbol(A.hydrateGraphic(l,u),{arcadeUtils:P})!==r.defaultSymbol){var p=a.usedMemory;e.length||r.defaultSymbol?o.push(l):n.graphicsWithoutSymbol[s]=l;var c=n.graphics3DGraphics.get(s);n._conditionalRemove(c,s),a.destroy(),i.delete(s),n.removeGraphics3DGraphic(s,p),n.updateLayerVisibility()}}),a._whenSymbolRemoved.forEach(function(e){return e(t.id)})}(l[s])}if(e.length||o.length){for(var u in this.graphicsWithoutSymbol)o.push(this.graphicsWithoutSymbol[u]);this.graphicsWithoutSymbol={},this.add(o)}this.updateHasDraped(),this._cleanupSymbols(),this.owner.view.labeler.setDirty()},t.prototype.applyUniqueValueRendererDiff=function(e,t,r){var i=e.diff.defaultSymbol,n=e.diff.uniqueValueInfos;if(i||n){var o=n?n.added.map(function(e){return e.symbol}):[],a=n?n.removed.map(function(e){return e.symbol}):[];if(n)for(var s=0;s<n.changed.length;s++)o.push(n.changed[s].newValue.symbol),a.push(n.changed[s].oldValue.symbol);return i?(r.defaultSymbol&&a.push(r.defaultSymbol),t.defaultSymbol&&o.push(t.defaultSymbol)):r.defaultSymbol&&o.length&&a.push(t.defaultSymbol),this.applySymbolSetDiff(o,a,t,r),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1},t.prototype.calculateUnchangedSymbolMapping=function(e,t,r){var i=function(e){return _.isSome(e)?e.id:null};if(t instanceof s.UniqueValueRenderer&&r instanceof s.UniqueValueRenderer&&(_.isNone(e)||"partial"===e.type)){var n=e&&e.diff,o=n&&n.defaultSymbol,a=n&&n.uniqueValueInfos,l=void 0;return l=a?a.unchanged.map(function(e){return{oldId:i(e.oldValue.symbol),newId:i(e.newValue.symbol)}}):r.uniqueValueInfos.map(function(e,r){return{oldId:i(e.symbol),newId:i(t.uniqueValueInfos[r].symbol)}}),!o&&r.defaultSymbol&&l.push({oldId:i(r.defaultSymbol),newId:i(t.defaultSymbol)}),l}return[]},t.prototype.updateSymbolMapping=function(e,t){var r=t?"string"==typeof t?t:t.id:null,i="string"==typeof t?null:t;if(e&&e!==r){var n=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==n&&this.graphicsBySymbol.set(r,n);var o=this.symbols.get(e);this.symbols.delete(e),void 0!==o&&(this.symbols.set(r,o),i?o.symbol=i:o.symbol.id=r)}},t.prototype.updateUnchangedSymbolMappings=function(e,t,r){for(var i=0,n=this.calculateUnchangedSymbolMapping(e,t,r);i<n.length;i++){var o=n[i],a=o.oldId,s=o.newId;this.updateSymbolMapping(a,s)}},t.prototype.applyRendererDiff=function(e,t,r){var i=this;return!this.diffHasSymbolChange(e)&&(!!(t instanceof s.UniqueValueRenderer&&r instanceof s.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(e,t,r)&&0===Object.keys(e.diff).length)||y.everyMap(this.graphicsBySymbol,function(r,n){var o=i.symbols.get(n);if(o&&!o.applyRendererDiff(e,t))return!1}))},t.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(e){return e.globalPropertyChanged("opacity")}),this.updateStageLayerVisibility()},t.prototype.modeChange=function(e){this.symbolCreationContext.isAsync=e,e||this.update(W.noBudget)},t.prototype.slicePlaneEnabledChange=function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol(function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)}),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())},t.prototype.pixelRatioChange=function(e){var t=this;this.forEachGraphics3DSymbol(function(e,r,i){e.globalPropertyChanged("pixelRatio",r)||t._recreateSymbol(i)})},t.prototype.setClippingExtent=function(e,t){var r=this.symbolCreationContext.clippingExtent,i=C.create();return q.extentToBoundingRect(e,i,t)?this.symbolCreationContext.clippingExtent=[i[0],i[1],-1/0,i[2],i[3],1/0]:this.symbolCreationContext.clippingExtent=null,!p.equals(this.symbolCreationContext.clippingExtent,r)},t.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty()},t.prototype.modifyGraphics3DGraphicVisibilities=function(e){var t=!1;this.graphics3DGraphics.forEach(function(r){e(r)&&(t=!0)}),t&&this.notifyVisibilityChanged()},t.prototype.forEachGraphics3DSymbol=function(e){var t=this;this.graphicsBySymbol.forEach(function(r,i){var n=t.symbols.get(i);n&&e(n,r,i)})},t.prototype.updateAllGraphicsVisibility=function(){var e=this;this.filterVisibility&&(this.filterVisibility.dirty=!0),this.modifyGraphics3DGraphicVisibilities(function(t){var r=e._updateUserVisibility(t),i=e.scaleVisibility&&e.scaleVisibility.updateVisibility(t);return r||i})},t.prototype.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(function(e){return e.setVisibilityFlag(0,!1,0)})},t.prototype.validateRenderer=function(e){var t=G.validateTo3D(e);if(t){var r="Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView";J.warn(r,t.message)}},t.prototype.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset(),this.stageLayer.invalidateSpatialQueryAccelerator(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")},t.prototype._cleanupSymbols=function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0||this.suspendSymbolCleanup)){var t=!1;this.symbols.forEach(function(r,i){if(r&&!(r.referenced>0)){var n=e.graphicsBySymbol.get(i);n&&0!==n.size||(e.graphicsBySymbol.delete(i),e.symbols.delete(i),r&&r.destroy(),t=!0)}}),t&&this.notifyChange("maxSymbolComplexity")}},t.prototype.snapshotInternals=function(){var e=this;return{graphics:p.keysOfMap(this.graphics3DGraphics).sort(),symbols:p.keysOfMap(this.symbols).sort(),graphicsBySymbol:p.keysOfMap(this.graphicsBySymbol).sort().map(function(t){return{symbolId:t,graphics:p.keysOfMap(e.graphicsBySymbol.get(t)).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:p.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}},Object.defineProperty(t.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size}},enumerable:!0,configurable:!0}),t.prototype.getStats=function(){return{"core.visible":this.graphics3DGraphics.size,"core.missing":Object.keys(this.graphicsWithoutSymbol).length,"core.pending":this.pendingUpdates.size}},t.tmpVec=S.vec3f64.create(),i([w.property({readOnly:!0})],t.prototype,"computedExtent",void 0),i([w.property()],t.prototype,"currentRenderer",void 0),i([w.property()],t.prototype,"rendererHasGeometryOperations",void 0),i([w.property({readOnly:!0})],t.prototype,"elevationAlignment",void 0),i([w.property({readOnly:!0})],t.prototype,"scaleVisibility",void 0),i([w.property({readOnly:!0})],t.prototype,"filterVisibility",void 0),i([w.property({readOnly:!0})],t.prototype,"featureStore",void 0),i([w.property({readOnly:!0})],t.prototype,"deconflictor",void 0),i([w.property({readOnly:!0})],t.prototype,"labeler",void 0),i([w.property({readOnly:!0})],t.prototype,"highlights",void 0),i([w.property()],t.prototype,"asyncUpdates",void 0),i([w.property({constructOnly:!0})],t.prototype,"elevationFeatureExpressionEnabled",void 0),i([w.property({constructOnly:!0})],t.prototype,"owner",void 0),i([w.property({constructOnly:!0})],t.prototype,"layer",void 0),i([w.property({readOnly:!0})],t.prototype,"hasDraped",void 0),i([w.property({readOnly:!0})],t.prototype,"symbolsUpdating",void 0),i([w.property({constructOnly:!0})],t.prototype,"graphicSymbolSupported",void 0),i([w.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating","filterVisibility.updating"]})],t.prototype,"updating",null),i([w.property({readOnly:!0})],t.prototype,"updatingRemaining",null),i([w.property({readOnly:!0})],t.prototype,"updatingTotal",null),i([w.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],t.prototype,"displayFeatureLimit",null),i([w.property({readOnly:!0})],t.prototype,"maxSymbolComplexity",null),i([w.property({constructOnly:!0})],t.prototype,"hasZ",void 0),i([w.property({constructOnly:!0})],t.prototype,"hasM",void 0),u=i([w.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],t)}(w.declared(u)),$=new Map,ee=new b,te=new g(b),re=10;return K}.apply(null,i))||(e.exports=n)},1577:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(37),r(20),r(86),r(0),r(35)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u){var p=function(){function e(){this.extents=new s({allocator:function(e){return e||u.create()}}),this.tempExtent=u.create(),this.dirty=!1}return Object.defineProperty(e.prototype,"length",{get:function(){return this.extents.length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.extents.clear()},e.prototype.add=function(e){this.contains(e)||(this.removeContained(e),u.set(this.extents.pushNew(),e),this.dirty=!0)},e.prototype.pop=function(){return this.dirty&&(this.mergeTight(),this.dirty=!1),this.extents.pop()},e.prototype.mergeTight=function(){for(var e=this.extents,t=this.tempExtent,r=!1;!r;){r=!0;for(var i=0;i<e.length;++i)if(function(r){for(var i=e.data[r],n=u.area(i),o=!1,a=e.length-1;a>r;--a){var s=e.data[a],l=u.area(s);u.expand(i,s,t);var p=n+l;(u.area(t)-p)/p<.05&&(u.set(i,t),n=u.area(i),e.swapElements(a,e.length-1),e.pop(),o=!0)}return o}(i)){r=!1;break}}},e.prototype.contains=function(e){return this.extents.some(function(t){return u.contains(t,e)})},e.prototype.removeContained=function(e){for(var t=this.extents.length-1;t>=0;--t)u.contains(e,this.extents.data[t])&&this.extents.removeUnorderedIndex(t)},e}();return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dirtyExtents=new p,t.globalDirty=!1,t.dirtyGraphicsQueue=new s({deallocator:null}),t.dirtyGraphicsSet=new Set,t.handles=new a,t.updateElevation=!1,t.layerView=null,t.graphicsCore=null,t.events=new o,t}return r(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i){var n=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=r,this.elevationProvider=i;var o=this.layerView.view.resourceController.scheduler;this.handles.add([i.on("elevation-change",function(e){return n.elevationUpdateHandler(e)}),this.layerView.watch("suspended",function(){return n.suspendedChange()}),o.registerTask(12,function(e){return n.update(e)},function(){return n.needsUpdate()})])},t.prototype.destroy=function(){this.dirtyGraphicsQueue=null,this.dirtyGraphicsSet=null,this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null},t.prototype.clear=function(){this.dirtyGraphicsQueue.clear(),this.dirtyGraphicsSet.clear(),this.notifyChange("updating")},t.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))},t.prototype.elevationInfoChange=function(){this.globalDirty=!0,this.notifyChange("updating")},t.prototype.needsUpdate=function(){return this.dirtyGraphicsQueue.length>0||this.dirtyExtents.length>0||this.globalDirty},t.prototype.update=function(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress());this.needsUpdate()&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")},t.prototype._updateDirtyGraphics=function(e){for(var t=this.layerView.view,r=this.graphicsCore.stageLayer.id,i=this.layerView.labeling;this.dirtyGraphicsQueue.length>0&&!e.done;){for(var n=Math.min(this.dirtyGraphicsQueue.length,100);n--&&!e.done;){var o=this.dirtyGraphicsQueue.pop(),a=this.graphicsCore.getGraphics3DGraphicById(o);this.dirtyGraphicsSet.delete(o),a&&a.alignWithElevation(this.elevationProvider,t.renderCoordsHelper),e.madeProgress()}t._stage.processDirtyLayer(r),i&&i.processStageDirty()}},t.prototype._updateDirtyExtents=function(e){for(var t=this;this.dirtyExtents.length>0&&this.dirtyGraphicsQueue.length<100&&!e.done;){var r=this.dirtyExtents.pop();this.events.hasEventListener("invalidate-elevation")&&this.events.emit("invalidate-elevation",{extent:r,spatialReference:this.spatialReference}),this.queryGraphicUIDsInExtent(r,this.spatialReference,function(e){var r=t.graphicsCore.getGraphics3DGraphicById(e);!t.dirtyGraphicsSet.has(e)&&r&&r.needsElevationUpdates()&&(t.dirtyGraphicsQueue.push(e),t.dirtyGraphicsSet.add(e))}),e.madeProgress()}},t.prototype.markAllGraphicsElevationDirty=function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsQueue.clear(),this.graphicsCore.graphics3DGraphics.forEach(function(t,r){e.dirtyGraphicsQueue.push(r),e.dirtyGraphicsSet.add(r)})},t.prototype.elevationUpdateHandler=function(e){var t=e.extent;if(this.layerView.suspended){if(!this.updateElevation){var r=this.graphicsCore.computedExtent;r&&t[2]>r.xmin&&t[0]<r.xmax&&t[3]>r.ymin&&t[1]<r.ymax&&(this.updateElevation=!0)}}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.spatialReference=e.spatialReference,this.notifyChange("updating")},i([l.property({readOnly:!0})],t.prototype,"updating",null),i([l.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],t)}(l.declared(n))}.apply(null,i))||(e.exports=n)},1578:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1697)],void 0===(n=function(e,t,r){return function(){function e(){this.graphicsCore=null,this.highlights=[]}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.setup=function(e){this.graphicsCore=e},e.prototype.acquireSet=function(e,t){var i=this,n=new r(e,t);return this.highlights.push(n),{set:n,handle:{remove:function(){return i.releaseSet(n)},pause:function(){n.highlightSet.removeAll(),n.paused=!0},resume:function(){n.paused=!1,i.initializeSet(n)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setUids=function(e,t){for(var r=this.graphicsCore.graphics3DGraphics,i=0,n=t;i<n.length;i++){var o=n[i];e.ids.add(o);var a=r.get(o);a&&a.addHighlight(e.highlightSet,e.options)}},e.prototype.setObjectIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.initializeSet(e)},e.prototype.addGraphic=function(e){this.highlights.forEach(function(t){!t.paused&&t.hasGraphic(e)&&e.addHighlight(t.highlightSet,t.options)})},e.prototype.removeGraphic=function(e){this.highlights.forEach(function(t){t.hasGraphic(e)&&e.removeHighlight(t.highlightSet)})},e.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e.prototype.initializeSet=function(e){var t=this.graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(function(t){t&&e.hasGraphic(t)&&t.addHighlight(e.highlightSet,e.options)}):e.ids.forEach(function(r){var i=t.get(r);i&&i.addHighlight(e.highlightSet,e.options)})},e}()}.apply(null,i))||(e.exports=n)},1579:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(20),r(14),r(0),r(565)],void 0===(n=function(e,t,r,i,n,o,a,s,l){function u(e,t){return null!==e&&e>0&&e<8e7||t>50}return function(e){function t(){var t=e.call(this)||this;return t._scaleRangeActive=!1,t._layerScaleRangeVisibilityDirty=!0,t.layerScaleRangeVisibilityQuery=!1,t.scaleChangeEventHandle=null,t.handles=new o,t.layerView=null,t.layer=null,t.queryGraphicUIDsInExtent=null,t.extent=null,t.graphicsCore=null,t.basemapTerrain=null,t.suspended=!1,t}return r(t,e),Object.defineProperty(t.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},set:function(e){this._layerScaleRangeVisibilityDirty!==e&&(this._layerScaleRangeVisibilityDirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t,r,i,n){var o=this;this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=r,this.graphicsCore=i,this.basemapTerrain=n,this.updateScaleRangeActive();var a=this.layerView.view.resourceController.scheduler;this.handles.add(a.registerTask(6,function(){return o.update()},function(){return o.needsUpdate()}))},t.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),this.handles.destroy(),this.handles=null,this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null},t.prototype.needsUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},t.prototype.setExtent=function(e){this.extent=e,this.layerScaleRangeVisibilityDirty=!0},t.prototype.update=function(){this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1},t.prototype.scaleRangeActive=function(){return this._scaleRangeActive},t.prototype.updateScaleRangeActive=function(){var e=this,t=this.layer,r=u(t.minScale,t.maxScale);t.labelingInfo&&!r&&(r=t.labelingInfo.some(function(e){return e&&u(e.minScale,e.maxScale)}));var i=this._scaleRangeActive!==r;return this._scaleRangeActive=r,r&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(t){return e.scaleUpdateHandler(t)}):!r&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null),i},t.prototype.updateSuspendScaleVisibleFinish=function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e)},t.prototype.updateSuspendScaleVisible=function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(t){return e.updateSuspendScaleVisibleFinish(t)})):this.updateSuspendScaleVisibleFinish(!0)},t.prototype.visibleAtLayerScale=function(e){return l.scaleBoundsPredicate(e,this.layer.minScale||0,this.layer.maxScale||0)},t.prototype.visibleAtLabelScale=function(e,t){return l.scaleBoundsPredicate(e,t.minScale||0,t.maxScale||0)},t.prototype.graphicScale=function(e){var t;return a.isSome(e.centroid)?t=e.centroid:a.isSome(e.graphic.geometry)&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null},t.prototype.graphicVisible=function(e){var t=this.graphicScale(e);return this.visibleAtLayerScale(t)},t.prototype.updateVisibility=function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t,0)}return!1},t.prototype.updateGraphicLabelScaleVisibility=function(e){if(!this._scaleRangeActive)return!1;if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var t=this.graphicScale(e),r=this.updateLabelScaleVisibility(e,t);return r&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),r},t.prototype.updateLabelScaleVisibility=function(e,t){if(!e._labelGraphics||0===e._labelGraphics.length)return!1;var r=e._labelGraphics[0]._labelClass;if(r&&null!=r.minScale&&null!=r.maxScale){var i=this.visibleAtLabelScale(t,r);if(e.setVisibilityFlag(1,i,1))return!0}return!1},t.prototype.scaleUpdateHandler=function(e){var t=this;if(!this.layerView.suspended){var r=e.extent,i=e.scale,n=this.visibleAtLayerScale(i),o=!1;this.queryGraphicUIDsInExtent(r,e.spatialReference,function(e){var s=t.graphicsCore.getGraphics3DGraphicById(e);if(s){var l=s.centroid;if(a.isSome(l)&&(r[0]>l.x||r[1]>l.y||r[2]<l.x||r[3]<l.y))return;var u=!1;s.setVisibilityFlag(1,n,0)&&(u=!0),t.updateLabelScaleVisibility(s,i)&&(u=!0),u&&(o=!0)}}),o&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=!0},t.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.modifyGraphics3DGraphicVisibilities(function(e){return e.clearVisibilityFlag(1)})),this.layerScaleRangeVisibilityDirty=!0},i([s.property({readOnly:!0})],t.prototype,"suspended",void 0),i([s.property({readOnly:!0})],t.prototype,"updating",null),i([s.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1600:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(86),r(1497)],void 0===(n=function(e,t,r,i){function n(e,t,r){if(!r)return t.indexOf(e);for(var i=0;i<t.length;i++)if(r(e,t[i]))return i;return-1}function o(e,t){a(e,0,e.children.length,t,e)}function a(e,t,r,i,n){n||(n=m(null,!0)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var o=t,a=void 0;o<r;o++)a=e.children[o],s(n,e.leaf?i(a):a);return n}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function c(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function h(e,t){var r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),n=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,n-r)*Math.max(0,o-i)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e,t){return{children:e,height:1,leaf:t,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _(e,t,r,n,o){for(var a=[t,r];a.length;)if(!((r=a.pop())-(t=a.pop())<=n)){var s=t+Math.ceil((r-t)/n/2)*n;i(e,s,t,r,o),a.push(t,s,s,r)}}Object.defineProperty(t,"__esModule",{value:!0});var g=function(){function e(e,t){void 0===e&&(e=9),this.compareMinX=l,this.compareMinY=u,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}return e.prototype.destroy=function(){this.clear(),b.prune(),v.prune(),x.prune(),w.prune()},e.prototype.all=function(e){this._all(this.data,e)},e.prototype.search=function(e,t){var r=this.data,i=this.toBBox;if(f(e,r))for(b.clear();r;){for(var n=0,o=r.children.length;n<o;n++){var a=r.children[n],s=r.leaf?i(a):a;f(e,s)&&(r.leaf?t(a):y(e,s)?this._all(a,t):b.push(a))}r=b.pop()}},e.prototype.collides=function(e){var t=this.data,r=this.toBBox;if(!f(e,t))return!1;for(b.clear();t;){for(var i=0,n=t.children.length;i<n;i++){var o=t.children[i],a=t.leaf?r(o):o;if(f(e,a)){if(t.leaf||y(e,a))return!0;b.push(o)}}t=b.pop()}return!1},e.prototype.load=function(e,t){if(void 0===t&&(t=e.length),!t)return this;if(t<this._minEntries){for(var r=0,i=t;r<i;r++)this.insert(e[r]);return this}var n=this._build(e.slice(0,t),0,t-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data=m([],!0),this},e.prototype.remove=function(e,t){if(!e)return this;var r,i,o,a,s=this.data,l=this.toBBox(e);for(x.clear(),w.clear();s||x.length;){if(s||(s=x.pop(),r=x.data[x.length-1],i=w.pop(),o=!0),s.leaf&&-1!==(a=n(e,s.children,t)))return s.children.splice(a,1),x.push(s),this._condense(x),this;o||s.leaf||!y(s,l)?r?(i++,s=r.children[i],o=!1):s=null:(x.push(s),w.push(i),i=0,r=s,s=s.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return this.data=e,this},e.prototype._all=function(e,t){for(v.clear();e;){if(!0===e.leaf)for(var r=0,i=e.children;r<i.length;r++){t(i[r])}else v.pushArray(e.children);e=v.pop()}},e.prototype._build=function(e,t,r,i){var n,a=r-t+1,s=this._maxEntries;if(a<=s)return o(n=m(e.slice(t,r+1),!0),this.toBBox),n;i||(i=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,i-1))),(n=m([],!1)).height=i;var l=Math.ceil(a/s),u=l*Math.ceil(Math.sqrt(s));_(e,t,r,u,this.compareMinX);for(var p=t;p<=r;p+=u){var c=Math.min(p+u-1,r);_(e,p,c,l,this.compareMinY);for(var d=p;d<=c;d+=l){var h=Math.min(d+l-1,c);n.children.push(this._build(e,d,h,i-1))}}return o(n,this.toBBox),n},e.prototype._chooseSubtree=function(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){for(var n=1/0,o=1/0,a=void 0,s=0,l=t.children.length;s<l;s++){var u=t.children[s],c=p(u),h=d(e,u)-c;h<o?(o=h,n=c<n?c:n,a=u):h===o&&c<n&&(n=c,a=u)}t=a||t.children[0]}return t},e.prototype._insert=function(e,t,r){var i=this.toBBox,n=r?e:i(e);x.clear();var o=this._chooseSubtree(n,this.data,t,x);for(o.children.push(e),s(o,n);t>=0&&x.data[t].children.length>this._maxEntries;)this._split(x,t),t--;this._adjustParentBBoxes(n,x,t)},e.prototype._split=function(e,t){var r=e.data[t],i=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,i);var a=this._chooseSplitIndex(r,n,i),s=m(r.children.splice(a,r.children.length-a),r.leaf);s.height=r.height,o(r,this.toBBox),o(s,this.toBBox),t?e.data[t-1].children.push(s):this._splitRoot(r,s)},e.prototype._splitRoot=function(e,t){this.data=m([e,t],!1),this.data.height=e.height+1,o(this.data,this.toBBox)},e.prototype._chooseSplitIndex=function(e,t,r){var i,n,o;i=n=1/0;for(var s=t;s<=r-t;s++){var l=a(e,0,s,this.toBBox),u=a(e,s,r,this.toBBox),c=h(l,u),d=p(l)+p(u);c<i?(i=c,o=s,n=d<n?d:n):c===i&&d<n&&(n=d,o=s)}return o},e.prototype._chooseSplitAxis=function(e,t,r){var i=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,n)&&e.children.sort(i)},e.prototype._allDistMargin=function(e,t,r,i){e.children.sort(i);for(var n=this.toBBox,o=a(e,0,t,n),l=a(e,r-t,r,n),u=c(o)+c(l),p=t;p<r-t;p++){var d=e.children[p];s(o,e.leaf?n(d):d),u+=c(o)}for(p=r-t-1;p>=t;p--){d=e.children[p];s(l,e.leaf?n(d):d),u+=c(l)}return u},e.prototype._adjustParentBBoxes=function(e,t,r){for(var i=r;i>=0;i--)s(t.data[i],e)},e.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e.data[t].children.length?t>0?(r=e.data[t-1].children).splice(r.indexOf(e.data[t]),1):this.clear():o(e.data[t],this.toBBox)},e.prototype._initFormat=function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")},e}();t.PooledRBush=g;var b=new r,v=new r,x=new r,w=new r({deallocator:null});t.default=g}.apply(null,i))||(e.exports=n)},1618:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(14),r(1493),r(354)],void 0===(n=function(e,t,r,i,n,o){function a(e,t){if(!e||e.symbol)return null;var r=t.renderer;return e&&r&&r.getObservationRenderer?r.getObservationRenderer(e):r}function s(e,t){if(i.isSome(e.symbol))return e.symbol;var n=a(e,t);return n&&n.getSymbol(e,r({},t,{arcadeUtils:o}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderer=a,t.getSymbol=s,t.getRenderingInfo=function(e,t){var r=a(e,t),i=s(e,t);if(!i)return null;var o={renderer:r,symbol:i};if(!(r&&"visualVariables"in r&&r.visualVariables))return o;for(var l=["proportional","proportional","proportional"],u=0,p=n.getVisualVariableValues(r,e,t);u<p.length;u++){var c=p[u],d=c.variable,h=c.value;if("color"===d.type)o.color=h.toRgba();else if("size"===d.type)if("outline"===d.target)o.outlineSize=h;else{var y=d.axis,f=d.useSymbolValue?"symbolValue":h;"width"===y?l[0]=f:"depth"===y?l[1]=f:"height"===y?l[2]=f:l[0]=l[1]="width-and-depth"===y?f:l[2]=f}else"opacity"===d.type?o.opacity=h:"rotation"===d.type&&"tilt"===d.axis?o.tilt=h:"rotation"===d.type&&"roll"===d.axis?o.roll=h:"rotation"===d.type&&(o.heading=h)}return(isFinite(l[0])||isFinite(l[1])||isFinite(l[2]))&&(o.size=l),o}}.apply(null,i))||(e.exports=n)},1619:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(13),r(84),r(6),r(52),r(25),r(20),r(29),r(0),r(56),r(573),r(347),r(367),r(1576),r(1577),r(1620),r(1557),r(1578),r(1579),r(78),r(1518)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d,h,y,f,m,_,g,b,v,x,w,S,D){var C=function(e){function t(t){var r=e.call(this)||this;return r._handles=new p,r.highlights=new x,r.suspendResumeExtentMode="computed",r.dataExtent=null,r.suspendResumeExtent=null,r}return r(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=e.frustumVisibilityEnabled?new v:null,r=e.scaleVisibilityEnabled?new w:null,i=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new b.Graphics3DFilterVisibility:null,n=e.elevationAlignmentEnabled?new g:null;return{graphicsCore:new _({owner:e.owner,layer:e.layer,asyncUpdates:e.asyncGraphicsUpdates,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:r,filterVisibility:i,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&this._handles.add(this.owner.watch(["filter","timeExtent"],function(){return e.filterVisibility.filterChanged()})),this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(t,r){y.diff(t,r)&&e.graphicsCore.elevationInfoChange()})),this._handles.add(this.layer.watch("labelsVisible",function(){return e.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(t,r){y.diff(t,r)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){return o(this,void 0,void 0,function(){var e,t,r,i,o=this;return n(this,function(n){switch(n.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),e=this.owner,t=this.owner.view.basemapTerrain,r=function(e,t,r){return o.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,r)},this.scaleVisibility&&this.scaleVisibility.setup(e,this.layer,r,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment&&(i=e.view.elevationProvider,this.elevationAlignment.setup(e,r,this.graphicsCore,i)),this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,l.result(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,highlights:this.highlights}))];case 1:return n.sent(),this._handles.add([this.layer.watch("renderer",function(e){return o.graphicsCore.rendererChange(e)}),e.watch("fullOpacity",function(){return o.graphicsCore.opacityChange()})]),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this._handles.add(e.view.watch("clippingArea",function(){return o._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,l.result(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","highlights","graphicsCore"];e<t.length;e++){var r=t[e],i=this[r];i&&(i.destroy(),this._set(r,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t,r){var i=this;if(e instanceof f){var n=this.highlights.acquireSet(t,r),o=n.set,s=n.handle;return this.owner.queryObjectIds(e).then(function(e){return i.highlights.setObjectIds(o,e)}),s}if("number"==typeof e)return this.highlight([e],t,r);if(e instanceof a)return this.highlight([e],t,r);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof a){var l=e;if(!r||!l[0].attributes||null===D.attributeLookup(l[0].attributes,r)){var u=l.map(function(e){return e.uid}),p=this.highlights.acquireSet(t,null),c=p.set;s=p.handle;return this.highlights.setUids(c,u),s}e=l.map(function(e){return D.attributeLookup(e.attributes,r)})}if("number"==typeof e[0]){var d=e,h=this.highlights.acquireSet(t,r);c=h.set,s=h.handle;return this.highlights.setObjectIds(c,d),s}}return A},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(c.init(this,"suspendResumeExtentMode",function(){switch(e._handles.remove(I),e.suspendResumeExtentMode){case"computed":e._handles.add(c.init(e.graphicsCore,"computedExtent",function(t){return e.updateSuspendResumeExtent(t)}),I);break;case"data":e._handles.add(c.init(e,"dataExtent",function(t){return e.updateSuspendResumeExtent(t)}),I);break;default:u.neverReached(e.suspendResumeExtentMode)}}))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var r=this.owner.view.spatialReference;if(!e.spatialReference.equals(r)){if(!h.canProject(e,r))return;e=h.project(e,r)}return S.enlargeExtent(e,t,m.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},i([d.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),i([d.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),i([d.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),i([d.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),i([d.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),i([d.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),i([d.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),i([d.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),i([d.property({readOnly:!0})],t.prototype,"deconfliction",void 0),i([d.property({readOnly:!0})],t.prototype,"labeling",void 0),i([d.property({readOnly:!0})],t.prototype,"highlights",void 0),i([d.property()],t.prototype,"suspendResumeExtentMode",void 0),i([d.property()],t.prototype,"dataExtent",void 0),i([d.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),i([d.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating"]})],t.prototype,"updating",null),i([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(d.declared(s)),I="suspendResumeExtentMode",A={remove:function(){},pause:function(){},resume:function(){}};return C}.apply(null,i))||(e.exports=n)},1620:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(20),r(12),r(14),r(29),r(0),r(1544),r(562)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c){Object.defineProperty(t,"__esModule",{value:!0});var d=a.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),h=function(e){function t(){var t=e.call(this)||this;return t.filter=null,t._dirty=!1,t._querying=!1,t._handles=new o,t}return r(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var r=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new p.default({layerView:this._layerView,priority:4});var i=this._layerView.view.resourceController.scheduler;this._handles.add(i.registerTask(4,function(e){return r._update(e)},function(){return r._needsUpdate()})),this._handles.add(l.on(t.owner,"loadedGraphics","change",function(e){return r._graphicsChanged(e)},function(){return r.dirty=!0}))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(function(e){return e.clearVisibilityFlag(2)}),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){(!this._queryEngine||e.added&&e.added.length>0)&&(this.dirty=!0)},t.prototype.updateVisibility=function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){this.filter=this.recomputeFilter(),this.dirty=!0},Object.defineProperty(t.prototype,"active",{get:function(){return this.filter&&this._core.graphics3DGraphics.size>0},enumerable:!0,configurable:!0}),t.prototype.recomputeFilter=function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!t)return e;var r=s.isSome(e)?e.clone():new c;return r.timeExtent=r.timeExtent?r.timeExtent.intersection(t):t,r},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(function(e){t._queryResult=e,t._querying=!1}).catch(function(e){d.warn("FeatureFilter query failed: "+e),t._queryResult=new Set,t._core.graphics3DGraphics.forEach(function(e){return t._queryResult.add(t._getFeatureId(e.graphic))}),t._querying=!1}),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities(function(r){if(e.done)return!1;var i=t._queryResult.has(t._getFeatureId(r.graphic));return!!r.setVisibilityFlag(2,i,0)&&(e.madeProgress(),!0)}),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),i([u.property({readOnly:!0})],t.prototype,"updating",null),i([u.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(u.declared(n));t.Graphics3DFilterVisibility=h}.apply(null,i))||(e.exports=n)},1632:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(12),r(0),r(557),r(1477)],void 0===(n=function(e,t,r,i,n,o,a,s,l){Object.defineProperty(t,"__esModule",{value:!0});var u=o.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._definitionExpressionErrors=0,t._maxDefinitionExpressionErrors=20,t.logError=function(e){t._definitionExpressionErrors<t._maxDefinitionExpressionErrors&&u.error("Error while evaluating definitionExpression: "+e),++t._definitionExpressionErrors===t._maxDefinitionExpressionErrors&&u.error("Further errors are ignored")},t}return r(t,e),Object.defineProperty(t.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer.definitionExpression)try{var e=s.WhereClause.create(this.layer.definitionExpression,this.layer.fieldsIndex);if(!e.isStandardized)return u.error("definitionExpression is using non standard function"),null;var t=[],r=e.fieldNames;return l.findFieldsCaseInsensitive(r,this.layer.fields,{missingFields:t}),t.length>0?(u.error("definitionExpression references unknown fields: "+t.join(", ")),null):(this._definitionExpressionErrors=0,e)}catch(e){return u.error("Failed to parse definitionExpression: "+e),null}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null},enumerable:!0,configurable:!0}),t.prototype._evaluateClause=function(e,t){try{return e.testFeature(t)}catch(e){return this.logError(e),!1}},t.prototype._addDefinitionExpressionToQuery=function(e){if(!this.parsedDefinitionExpression)return e;var t=this.layer.definitionExpression,r=e.clone();return r.where?r.where="("+t+") AND ("+r.where+")":r.where=t,r},i([a.property()],t.prototype,"layer",void 0),i([a.property({readOnly:!0,dependsOn:["layer.definitionExpression","layer.fieldsIndex"]})],t.prototype,"parsedDefinitionExpression",null),i([a.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],t.prototype,"definitionExpressionFields",null),i([a.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t)}(a.declared(n));t.DefinitionExpressionSceneLayerView=p,t.default=p}.apply(null,i))||(e.exports=n)},1633:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(106)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields","layer.outFields","requiredFields"],get:function(){var e=this,t=e.layer,i=e.layer.fields,n=e.requiredFields;return t.outFields?r.fixFields(i,r.unpackFieldNames(i,t.outFields).concat(n)):r.fixFields(i,n)}}}}}.apply(null,i))||(e.exports=n)},1691:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(15),r(576)],void 0===(n=function(e,t,r,i){function n(e,t){if(!t)return null;var i;if((i=Array.isArray(t)?t:[t]).length>0){var n=i.map(function(e){return e.details.symbol.type||e.details.symbol.declaredClass}).filter(function(e){return!!e});n.sort();var o=[];return n.forEach(function(e,t){0!==t&&e===n[t-1]||o.push(e)}),new r("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+o.join(", ")+") which are not supported in 3D",{renderer:e,symbolErrors:i})}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.validateTo3D=function(e){return e?function(e){return"simple"===e.type}(e)?function(e){return n(e,i.to3D(e.symbol).error)}(e):function(e){return"unique-value"===e.type}(e)?function(e){var t=e.uniqueValueInfos.map(function(e){return i.to3D(e.symbol).error}).filter(function(e){return!!e}),r=i.to3D(e.defaultSymbol);return r.error&&t.unshift(r.error),n(e,t)}(e):function(e){return"class-breaks"===e.type}(e)?function(e){var t=e.classBreakInfos.map(function(e){return i.to3D(e.symbol).error}).filter(function(e){return!!e}),r=i.to3D(e.defaultSymbol);return r.error&&t.unshift(r.error),n(e,t)}(e):new r("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(e.type||e.declaredClass)+"'",{renderer:e}):null}}.apply(null,i))||(e.exports=n)},1692:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(37),r(14),r(0),r(95),r(554),r(552),r(1492),r(38)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(t){var r=e.call(this)||this;return r.events=new o,r.hasZ=null,r.hasM=null,r.objectIdField=null,r.spatialReference=null,r.featureAdapter={getAttribute:function(e,t){return"graphic"in e?e.graphic.attributes[t]:c.default.getAttribute(e,t)},getAttributes:function(e){return"graphic"in e?e.graphic.attributes:c.default.getAttributes(e)},getObjectId:function(e){return"graphic"in e?l.getObjectId(e.graphic,r.objectIdField):c.default.getObjectId(e)},getGeometry:function(e){return"graphic"in e?e.getAsOptimizedGeometry(r.hasZ,r.hasM):c.default.getGeometry(e)},getCentroid:function(e,t){if("graphic"in e){var i=null;a.isSome(e.centroid)?i=e.centroid:"point"===e.graphic.geometry.type&&d.pointToPoint(e.graphic.geometry,y,r.spatialReference)&&(i=y);var n=new Array(2+(t.hasZ?1:0)+(t.hasM?1:0));return a.isNone(i)?(n[0]=0,n[1]=0,n[2]=0,n[3]=0):(n[0]=i.x,n[1]=i.y,t.hasZ&&(n[2]=i.hasZ?i.z:0),t.hasM&&(n[t.hasZ?3:2]=i.hasM?i.m:0)),new p.default([],n)}return c.default.getCentroid(e,t)},cloneWithGeometry:function(e,t){return"graphic"in e?new u.default(t,r.featureAdapter.getAttributes(e),null,r.featureAdapter.getObjectId(e)):c.default.cloneWithGeometry(e,t)}},r}return r(t,e),t.prototype.forEach=function(e){this.forAllGraphics(function(t){e(t)})},t.prototype.forEachInBounds=function(e,t){this.getSpatialIndex().forEachInBounds(e,t)},t.prototype.forEachBounds=function(e,t,r){for(var i=this.getSpatialIndex(),n=0,o=e;n<o.length;n++){var s=o[n],l=this.featureAdapter.getObjectId(s);a.isSome(i.getBounds(l,r))&&t(r)}},i([s.property({constructOnly:!0})],t.prototype,"getSpatialIndex",void 0),i([s.property({constructOnly:!0})],t.prototype,"forAllGraphics",void 0),i([s.property({constructOnly:!0})],t.prototype,"hasZ",void 0),i([s.property({constructOnly:!0})],t.prototype,"hasM",void 0),i([s.property({constructOnly:!0})],t.prototype,"objectIdField",void 0),i([s.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),i([s.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],t)}(s.declared(n));t.Graphics3DFeatureStore=h;var y={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};t.default=h}.apply(null,i))||(e.exports=n)},1693:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.layerOrder=null,this.layerOrderDelta=null,this.clippingExtent=null,this.renderSpatialReference=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.isAsync=!1}}();t.Graphics3DSymbolCreationContext=r}.apply(null,i))||(e.exports=n)},1694:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1695),r(578)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0}),t.make=function(e,t,n){var o;switch(e.type){case"point-3d":o=r;break;default:o=i}return new o(e,t,n)}}.apply(null,i))||(e.exports=n)},1695:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(11),r(13),r(9),r(596),r(578)],void 0===(n=function(e,t,r,i,n,o,a,s){return function(e){function t(t,r,i){var n=e.call(this,t,r,i)||this;return n.calloutSymbolLayer=null,n.symbol.hasVisibleCallout()&&(n.calloutSymbolLayer=a.make(n.symbol,r)),n}return r(t,e),t.prototype.doLoad=function(t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return[4,e.prototype.doLoad.call(this,t)];case 1:return r.sent(),this.calloutSymbolLayer?[4,this.calloutSymbolLayer.load()]:[3,3];case 2:r.sent(),r.label=3;case 3:if(o.isAborted(t))throw o.createAbortError();return[2]}})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()},t.prototype.createGraphics3DGraphic=function(t,r,i){var n=e.prototype.createGraphics3DGraphic.call(this,t,i);if(this.calloutSymbolLayer){var o=this.createCalloutGraphic(t);o&&n.addAuxiliaryGraphic(o)}return n},t.prototype.globalPropertyChanged=function(t,r){var i=this;if(!e.prototype.globalPropertyChanged.call(this,t,r))return!1;if(this.calloutSymbolLayer){return this.calloutSymbolLayer.globalPropertyChanged(t,r,function(e){for(var t=0,r=e._auxiliaryGraphics;t<r.length;t++){var n=r[t];if(n.graphics3DSymbolLayer===i.calloutSymbolLayer)return n}})}return!0},t.prototype.createCalloutGraphic=function(e){var t=e.renderingInfo,r={renderer:t.renderer,symbol:t.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return e.renderingInfo=r,this.calloutSymbolLayer.createGraphics3DGraphic(e)},t}(s)}.apply(null,i))||(e.exports=n)},1696:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(22),r(0),r(1600),r(43),r(95)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u){Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(t){var r=e.call(this)||this;return r.index=new s.default(9,o("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),r.boundsByFeature=new Map,r.spatialReference=null,r.hasZ=null,r.hasM=null,r.objectIdField=null,r}return r(t,e),t.prototype.destroy=function(){this.index.destroy(),this.index=null,this.boundsByFeature.clear(),this.boundsByFeature=null},t.prototype.queryGraphicUIDsInExtent=function(e,t,r){t.equals(this.spatialReference)&&(c.minX=e[0],c.minY=e[1],c.maxX=e[2],c.maxY=e[3],this.index.search(c,function(e){return r(e.graphic.uid)}))},t.prototype.add=function(e){e.computeExtent(this.spatialReference),this.index.insert(e);var t=u.getObjectId(e.graphic,this._get("objectIdField"));null!=t&&this.boundsByFeature.set(t,e.extent)},t.prototype.addMany=function(e,t){void 0===t&&(t=e.length);for(var r=this._get("objectIdField"),i=0;i<t;i++){var n=e[i];n.computeExtent(this.spatialReference);var o=u.getObjectId(n.graphic,r);null!=o&&this.boundsByFeature.set(o,n.extent)}this.index.load(e,t)},t.prototype.remove=function(e){this.index.remove(e);var t=u.getObjectId(e.graphic,this._get("objectIdField"));null!=t&&this.boundsByFeature.delete(t)},t.prototype.clear=function(){this.index.clear(),this.boundsByFeature.clear()},t.prototype.forEachInBounds=function(e,t){c.minX=e[0],c.minY=e[1],c.maxX=e[2],c.maxY=e[3],this.index.search(c,function(e){t(e)})},t.prototype.getBounds=function(e,t){var r=this.boundsByFeature.get(e);return r?l.fromRect(t,r):null},i([a.property({constructOnly:!0})],t.prototype,"spatialReference",void 0),i([a.property({constructOnly:!0})],t.prototype,"hasZ",void 0),i([a.property({constructOnly:!0})],t.prototype,"hasM",void 0),i([a.property({constructOnly:!0})],t.prototype,"objectIdField",void 0),i([a.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],t)}(a.declared(n));t.SpatialIndex2D=p;var c={minX:0,minY:0,maxX:0,maxY:0};t.default=p}.apply(null,i))||(e.exports=n)},1697:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1529)],void 0===(n=function(e,t,r){return function(){function e(e,t){this.highlightSet=new r,this.ids=new Set,this.paused=!1,this.options=e,this.objectIdField=t}return e.prototype.hasGraphic=function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)},e}()}.apply(null,i))||(e.exports=n)},1730:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(14),r(69)],void 0===(n=function(e,t,r,i){return function(){function e(e){this.sourceSpatialReference=e.sourceSpatialReference,this.destSpatialReference=e.destSpatialReference}return e.prototype.adjust=function(e){var t=this._getVerticalUnitScale();1!==t&&this._scaleVerticalUnits(e,t)},e.prototype._getVerticalUnitScale=function(){return this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)?i.getMetersPerVerticalUnitForSR(this.sourceSpatialReference)/i.getMetersPerVerticalUnitForSR(this.destSpatialReference):1},e.prototype._vertexListsScaleZ=function(e,t){for(var r=0;r<e.length;++r)for(var i=e[r],n=0;n<i.length;++n){i[n][2]*=t}},e.prototype._scaleVerticalUnits=function(e,t){for(var i=0;i<e.length;++i){var n=e[i].geometry;!r.isNone(n)&&n.hasZ&&(this._geometryIsPoint(n)?null!==n.z&&(n.z*=t):this._geometryIsPolyline(n)?this._vertexListsScaleZ(n.paths,t):this._geometryIsPolygon(n)&&this._vertexListsScaleZ(n.rings,t))}},e.prototype._geometryIsPoint=function(e){return"point"===e.type},e.prototype._geometryIsPolygon=function(e){return"polygon"===e.type},e.prototype._geometryIsPolyline=function(e){return"polyline"===e.type},e}()}.apply(null,i))||(e.exports=n)},1736:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(13),r(15),r(14),r(9),r(0),r(106),r(1476),r(1517)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._validateFetchPopupFeatures=function(e){var t=this.layer;return t.popupEnabled?d.getFetchPopupTemplate(t,e)?void 0:new a("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new a("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})},t.prototype.fetchPopupFeatures=function(e,t){return o(this,void 0,void 0,function(){var e,r,i,o,a,u,c,h,y,f;return n(this,function(n){switch(n.label){case 0:return(e=this._validateFetchPopupFeatures(t))?[2,l.reject(e)]:(r=s.isSome(t)?t.clientGraphics:null)&&0!==r.length?(i=[],o=[],u=p.unpackFieldNames,c=[this.layer.fields],[4,d.getRequiredFields(this.layer,d.getFetchPopupTemplate(this.layer,t))]):[2,l.resolve([])];case 1:for(a=u.apply(void 0,c.concat([n.sent()])),h=0,y=r;h<y.length;h++)f=y[h],p.featureHasFields(a,f)?i.push(f):o.push(f);return 0===o.length?[2,l.resolve(i)]:[2,this.whenGraphicAttributes(o,a).catch(function(){return o}).then(function(e){return i.concat(e)})]}})})},i([u.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],t)}(u.declared(c));t.PopupSceneLayerView=h,t.default=h}.apply(null,i))||(e.exports=n)},2437:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(13),r(151),r(133),r(84),r(45),r(52),r(12),r(14),r(9),r(29),r(0),r(3),r(43),r(35),r(157),r(95),r(1564),r(106),r(1618),r(347),r(1476),r(1619),r(1730),r(1544),r(1477),r(1632),r(1633),r(1482),r(1736),r(2438),r(1489),r(38),r(562)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,p,c,d,h,y,f,m,_,g,b,v,x,w,S,D,C,I,A,E,G,P,O,V,F,R,M,N,j){function T(e,t){for(var r=0;r<e.length;r++)for(var i=0,n=e[r].graphics;i<n.length;i++){var o=n[i];if(o.attributes||(o.attributes={}),t&&t.loadedAttributes)for(var a=0,s=t.loadedAttributes;a<s.length;a++){var l=s[a].name;t.attributeData[l]&&(o.attributes[l]=G.getCachedAttributeValue(t.attributeData[l],r))}}}var L=c.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),U=O.defineFieldProperties(),B=function(e){function t(t){var r=e.call(this)||this;return r._nodesAddedToStage=new Map,r.overlayUpdating=!1,r.supportsDraping=!0,r._queryEngine=null,r._memCache=null,r.loadedGraphics=new R.GraphicsMap,r.progressiveLoadFactor=1,r.supportsHeightUnitConversion=!0,r._coordinatesOutsideExtentErrors=0,r._maxCoordinatesOutsideExtentErrors=20,r}return r(t,e),t.prototype.initialize=function(){var e=this;G.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode),this.handles.add([y.init(this,["layer.renderer","layer.labelingInfo","layer.labelsVisible","definitionExpressionFields","filter"],function(){return e._updateRequiredFields()}),y.init(this.layer,"rangeInfos",function(t){return e._rangeInfosChanged(t)}),this.layer.watch("renderer",function(t,r){return e._rendererChange(t,r)}),this.watch(["layer.objectIdFilter","parsedDefinitionExpression"],function(){return e._filterChange()})]),this._set("graphics3d",new I({owner:this,layer:this.layer,asyncGraphicsUpdates:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(t){return e._updateClippingExtent(t)}})),this.graphics3d.elevationAlignment&&this.graphics3d.elevationAlignment.events.on("invalidate-elevation",function(t){return e._invalidateElevation(t.extent,t.spatialReference)}),this.supportsHeightUnitConversion&&(this._verticalScale=new A({sourceSpatialReference:this.layer.spatialReference,destSpatialReference:this.view.spatialReference})),this.addResolvingPromise(this.graphics3d.setup()),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid),this._controller=new x({layerView:this,scaleVisibilityEnabled:!1}),this.when(function(){e._queryEngine=new E.default({layerView:e,priority:4}),e.handles.add([y.init(e,"maximumNumberOfFeatures",function(t){return e._controller.featureTarget=t}),y.whenTrue(e,"suspended",function(){return e._removeAllNodeData()})])})},t.prototype.destroy=function(){this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this._controller&&(this._controller.destroy(),this._controller=null),this._queryEngine&&(this._queryEngine.destroy(),this._queryEngine=null),this._memCache.destroy(),this._memCache=null,this._nodesAddedToStage=null},Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){var e=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return e?e.maximumNumberOfFeatures:0},set:function(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!this.suspended&&!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasM",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.whenGraphicAttributes=function(e,t){var r=this;return G.whenGraphicAttributes(this.layer,e,this._getObjectIdField(),t,function(e){for(var t=new Map,i=[],n=0,o=e;n<o.length;n++){var a=o[n],s=r._findGraphicNodeAndIndex(a),l=t.get(s.node);l||(l={node:s.node,indices:[],graphics:[]},i.push(l)),l.indices.push(s.index),l.graphics.push(a)}return i},{ignoreUnavailableFields:!0,populateObjectId:!0})},t.prototype.getGraphicFromGraphicUid=function(e){if(!this.loadedGraphics)return null;var t=v.hydrateGraphic(this.loadedGraphics.find(function(t){return t.uid===e}),this.layer),r=this._getObjectIdField();return t&&t.attributes&&t.attributes[r]?(t.layer=this.layer,t.sourceLayer=this.layer,t):null},t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d.graphicsCore.whenGraphicBounds(e,t)},t.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},t.prototype.isUpdating=function(){return this.overlayUpdating||this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating},t.prototype.getRenderingInfo=function(e,t){var r=S.getRenderingInfo(e,{renderer:t});if(r&&r.color){var i=r.color;i[0]=i[0]/255,i[1]=i[1]/255,i[2]=i[2]/255}return r},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0}),t.prototype._findGraphicNodeAndIndex=function(e){for(var t=e.attributes[this.layer.objectIdField],r=0,i=u.keysOfMap(this._nodesAddedToStage);r<i.length;r++){var n=i[r],o=this._nodesAddedToStage.get(n),a=this._findGraphicIndex(o.bundle,t);if(a>=0)return{node:o.node,index:a}}return null},t.prototype._findGraphicIndex=function(e,t){for(var r=0;r<e.length;r++)for(var i=0,n=e[r].featureIds;i<n.length;i++){if(n[i]===t)return r}return-1},t.prototype.highlight=function(e,t){return void 0===t&&(t={}),this.graphics3d.highlight(e,t,this.layer.objectIdField)},t.prototype.addNodeData=function(e,t){if(!this._nodesAddedToStage.has(e.index)){for(var r=t.allGeometryData,i=t.attributeDataInfo,n=this._controller.crsIndex,o=this.view.spatialReference,a=[0,0,0],s=this._getObjectIdField(),u=[],p=this.layer.fullExtent&&function(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}(this.layer.fullExtent.clone(),.5),c=[],d=[],y=0;y<r.length;y++){var f=r[y],m=f.featureDataPosition,_=m.length,g=f.geometries||[q[_]],x=f.featureIds;p&&!b.extentContainsCoords3D(p,m)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&L.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&L.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);for(var w=0;w<g.length;w++){var S=g[w];if("points"===S.params.type){var D=[],C=x[w<x.length?w:0],I={};null!=C&&(I[s]=C);var A=null==C?l.generateUID():C,E=void 0;"Embedded"===S.type&&(E=S.params.vertexAttributes.position);for(var G=0;G<E.length;G+=_){for(var P=0;P<_;P++)a[P]=m[P]+E[G+P];N.bufferToBuffer(a,n,0,z,o,0,1);var O=v.makeDehydratedPoint(z[0],z[1],z[2],o);_<3&&(O.z=void 0),D.push({uid:A,geometry:O,attributes:I,visible:!0}),e.obb||d.push(O.x,O.y,O.z?O.z:0)}c.push.apply(c,D),u.push({featureIds:f.featureIds,graphics:D})}}}e.numFeatures=c.length,this._updateNodeMemory(e);var V={bundle:u,attributeInfo:i,node:e};if(T(V.bundle,V.attributeInfo),d.length>0){var F=this.view.renderSpatialReference,R=this._controller.crsVertex;N.bufferToBuffer(d,o,0,d,F,0,d.length/3);var j={data:d,size:3,offsetIdx:0,strideIdx:3};e.obb=M.compute(j),N.vectorToVector(e.obb.center,F,e.obb.center,R),this._controller.updateVisibility(e.index)}return this._controller.isGeometryVisible(e)?(this._verticalScale&&this._verticalScale.adjust(c),this._nodesAddedToStage.set(e.index,V),this.loadedGraphics.addMany(c),this._filterNode(V),h.resolve()):(this._cacheNodeData(V),h.resolve())}L.error("I3S node "+e.id+" already added")},t.prototype.isNodeLoaded=function(e){return this._nodesAddedToStage.has(e)},t.prototype._updateNodeMemory=function(e){e.memory=4096+e.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic},t.prototype._cacheNodeData=function(e){var t=e.bundle.reduce(function(e,t){return t.graphics.reduce(function(e,t){return v.estimateSize(t)+e},512+8*t.featureIds.length+e)},1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)},t.prototype._getMemCacheKey=function(e){return""+e.index},t.prototype._removeAllNodeData=function(){var e=this;this._nodesAddedToStage.forEach(function(t){if(t){var r=t.node;e._updateNodeMemory(r),e._cacheNodeData(t)}}),this._nodesAddedToStage.clear(),this.loadedGraphics.clear()},t.prototype.removeNodeData=function(e,t){for(;e.length>0&&!t.done;){var r=e.pop(),i=this._removeNodeStageData(r);i&&(this._updateNodeMemory(i.node),this._cacheNodeData(i)),t.madeProgress()}},t.prototype._removeNodeStageData=function(e){var t=this._nodesAddedToStage.get(e);if(!t)return null;for(var r=0,i=t.bundle;r<i.length;r++){var n=i[r];this.loadedGraphics.removeMany(n.graphics)}return this._nodesAddedToStage.delete(e),t},t.prototype.loadCachedNodeData=function(e){return h.resolve(this._memCache.pop(this._getMemCacheKey(e)))},t.prototype.addCachedNodeData=function(e,t,r){if(!this._nodesAddedToStage.has(e.index)){for(var i=0,n=t.bundle;i<n.length;i++){var o=n[i];this.loadedGraphics.addMany(o.graphics)}return this._nodesAddedToStage.set(e.index,t),this._updateNodeMemory(e),this.setAttributeData(e.index,r),this._filterNode(t),h.resolve()}L.error("I3S node "+e.id+" already added")},t.prototype.getLoadedNodeIds=function(){var e=[];return this._nodesAddedToStage.forEach(function(t){return e.push(t.node.id)}),e.sort()},t.prototype.getLoadedNodeIndices=function(e){this._nodesAddedToStage.forEach(function(t,r){return e.push(r)})},t.prototype.getLoadedAttributes=function(e){var t=this._nodesAddedToStage.get(e);if(t&&t.attributeInfo)return t.attributeInfo.loadedAttributes},t.prototype.getAttributeData=function(e){var t=this._nodesAddedToStage.get(e);if(t&&t.attributeInfo)return t.attributeInfo.attributeData},t.prototype.setAttributeData=function(e,t){var r=this._nodesAddedToStage.get(e);if(r&&(r.attributeInfo=t,T(r.bundle,t),this._filterNode(r),this.graphics3d.graphicsCore.labelsEnabled)){var i=r.bundle.map(function(e){return e.graphics.length&&e.graphics[0].uid});this.graphics3d.graphicsCore.updateLabelingInfo(i)}},t.prototype._updateClippingExtent=function(e){return this._controller&&this._controller.updateClippingArea(e),!1},t.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},t.prototype._rendererChange=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,l;return n(this,function(n){switch(n.label){case 0:return r=this.layer.fields,i=new s.default,e?[4,e.collectRequiredFields(i,r)]:[3,2];case 1:return n.sent(),o=a.from(i).sort(),[3,3];case 2:o=[],n.label=3;case 3:return i.clear(),t?[4,t.collectRequiredFields(i,r)]:[3,5];case 4:return n.sent(),l=a.from(i).sort(),[3,6];case 5:l=[],n.label=6;case 6:return o.length===l.length&&o.every(function(e,t){return o[t]===l[t]})?[2]:(this._reloadAllNodes(),[2])}})})},t.prototype._rangeInfosChanged=function(e){null!=e&&e.length>0&&L.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")},t.prototype._filterChange=function(){var e=this;this._nodesAddedToStage.forEach(function(t){return e._filterNode(t)})},t.prototype._reloadAllNodes=function(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()},t.prototype._filterNode=function(e){var t=this._getObjectIdField(),r=null;if(this.layer.objectIdFilter){var i=this.layer.objectIdFilter.ids,n="include"===this.layer.objectIdFilter.method;r=function(e){return i.indexOf(e)>=0===n}}for(var o=this.parsedDefinitionExpression,a=0,s=e.bundle;a<s.length;a++)for(var l=0,u=s[a].graphics;l<u.length;l++){var p=u[l],c=p.visible;r&&!r(p.attributes[t])?p.visible=!1:p.visible=!o||this._evaluateClause(o,p),c!==p.visible&&(k.graphic=p,k.property="visible",k.oldValue=c,k.newValue=p.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(k))}},t.prototype._updateRequiredFields=function(){return o(this,void 0,void 0,function(){var e,t,r,i,o,l,u,p,c;return n(this,function(n){switch(n.label){case 0:return t=(e=this).layer,r=e.layer,i=r.fields,o=r.renderer,l=r.labelsVisible,u=e.filter,p=e.definitionExpressionFields,c=new s.default,o?[4,o.collectRequiredFields(c,i)]:[3,2];case 1:n.sent(),n.label=2;case 2:return l?[4,w.collectLabelingFields(c,t)]:[3,4];case 3:n.sent(),n.label=4;case 4:return d.isSome(u)?[4,w.collectFilterFields(c,t,u)]:[3,6];case 5:n.sent(),n.label=6;case 6:return w.collectFields(c,i,p),this._set("requiredFields",a.from(c).sort()),[2]}})})},t.prototype._invalidateElevation=function(e,t){var r=this._controller.crsIndex;N.boundingRectToBoundingRect(e,t,H,r);var i=Q;_.fromRect(i,H),i[2]=-1/0,i[5]=1/0,this._controller.updateElevationChanged(i,r)},t.prototype.createQuery=function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return d.isSome(this.filter)?this.filter.createQuery(e):new D(e)},t.prototype.queryFeatures=function(e,t){return p.safeCast(this._queryEngine.executeQuery(this._ensureQuery(e),t&&t.signal))},t.prototype.queryObjectIds=function(e,t){return p.safeCast(this._queryEngine.executeQueryForIds(this._ensureQuery(e),t&&t.signal))},t.prototype.queryFeatureCount=function(e,t){return p.safeCast(this._queryEngine.executeQueryForCount(this._ensureQuery(e),t&&t.signal))},t.prototype.queryExtent=function(e,t){return p.safeCast(this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t&&t.signal))},t.prototype._ensureQuery=function(e){return this._addDefinitionExpressionToQuery(d.isNone(e)?this.createQuery():D.from(e))},t.prototype.getUsedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return e?e.usedMemory:0},t.prototype.getUnloadedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(e?e.unprocessedMemoryEstimate:0))},t.prototype.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget},t.prototype.getNumberOfNodes=function(){return this._nodesAddedToStage.size},t.prototype.getNumberOfFeatures=function(){return this.loadedGraphics.length},t.prototype.getStats=function(){var e=this.graphics3d.graphicsCore.getStats();return e.nodes=this.getNumberOfNodes(),e.features=this.loadedGraphics.length,this._controller&&this._controller.updateStats(e),e},i([f.property()],t.prototype,"graphics3d",void 0),i([f.property()],t.prototype,"drawingOrder",void 0),i([f.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),i([f.property({type:Boolean})],t.prototype,"overlayUpdating",void 0),i([f.property({type:Boolean})],t.prototype,"supportsDraping",void 0),i([f.property({type:j})],t.prototype,"filter",void 0),i([f.property()],t.prototype,"loadedGraphics",void 0),i([f.property()],t.prototype,"layer",void 0),i([f.property()],t.prototype,"_controller",void 0),i([f.property({dependsOn:["_controller.updating","graphics3d.updating","overlayUpdating"]})],t.prototype,"updating",void 0),i([f.property({dependsOn:["_controller.rootNodeVisible"]})],t.prototype,"suspended",void 0),i([f.property(V.updatingPercentage)],t.prototype,"updatingPercentage",void 0),i([f.property({aliasOf:"_controller.updatingPercentage"})],t.prototype,"updatingPercentageValue",void 0),i([f.property(U.requiredFields)],t.prototype,"requiredFields",void 0),i([f.property(U.availableFields)],t.prototype,"availableFields",void 0),i([f.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),i([f.property({readOnly:!0,dependsOn:["suspended","_controller.leafsReached"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([f.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],t.prototype,"lodFactor",void 0),i([f.property({readOnly:!0})],t.prototype,"hasM",null),i([f.property({readOnly:!0})],t.prototype,"hasZ",null),i([f.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],t)}(f.declared(C,F.PopupSceneLayerView,P.DefinitionExpressionSceneLayerView)),q={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},z=m.vec3f64.create(),k={graphic:null,property:null,oldValue:null,newValue:null},Q=_.create(),H=g.create();return B}.apply(null,i))||(e.exports=n)},2438:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(553),r(37)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._map=new i.default,t}return r(t,e),t.prototype.clear=function(){if(this._map.size>0){var e=this.toArray();this._map.clear(),this.emit("change",{added:[],removed:e})}},Object.defineProperty(t.prototype,"length",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.addMany=function(e){if(0!==e.length){for(var t=new Set,r=0,i=e;r<i.length;r++){var n=i[r],o=n.uid;this._map.has(o)?(t.add(o),++this._map.get(o).refCount):(n.refCount=1,this._map.set(o,n))}var a=t.size>0?e.filter(function(e){return!t.has(e.uid)}):e;this.emit("change",{added:a,removed:[]})}},t.prototype.removeMany=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var n=i[r],o=n.uid,a=this._map.get(o);null!=a&&--a.refCount<=0&&this._map.delete(o)&&t.push(n)}t.length>0&&this.emit("change",{added:[],removed:t})},t.prototype.toArray=function(){var e=new Array(this._map.size),t=0;return this._map.forEach(function(r){return e[t++]=r}),e},t.prototype.find=function(e){for(var t=this._map.entries(),r=t.next();!r.done;r=t.next())if(e(r.value[1]))return r.value[1]},t.prototype.forEach=function(e){this._map.forEach(function(t){return e(t)})},t}(n);t.GraphicsMap=o}.apply(null,i))||(e.exports=n)}}]);