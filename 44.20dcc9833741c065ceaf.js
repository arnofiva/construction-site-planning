(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/SceneLayerWorker":1422,"esri/views/layers/LayerView":1471,"esri/views/3d/layers/LayerView3D":1476,"esri/views/3d/layers/support/layerViewUpdatingProperties":1482,"esri/renderers/visualVariables/support/visualVariableUtils":1493,"esri/layers/graphics/data/QueryEngineCapabilities":1516,"esri/views/layers/support/popupUtils":1517,"esri/views/3d/layers/support/attributeUtils":1518,"esri/views/3d/webgl-engine/lib/HighlightSet":1529,"esri/libs/draco/DracoDecoder":1540,"esri/views/3d/webgl-engine/materials/component/Parameters":1545,"esri/views/3d/webgl-engine/materials/component/VertexBufferLayout":1546,"esri/layers/graphics/controllers/I3SOnDemandController":1564,"esri/views/3d/layers/i3s/I3SFrameTask":1565,"esri/views/3d/layers/i3s/I3SIndex":1566,"esri/views/3d/layers/i3s/I3SLodHandling":1567,"esri/views/3d/layers/i3s/I3SNodeLoader":1568,"esri/views/3d/layers/i3s/I3SStreamDataController":1569,"esri/views/3d/layers/i3s/I3SViewportQueries":1570,"esri/views/3d/layers/i3s/I3SProjectionUtil":1583,"esri/views/3d/layers/I3SMeshView3D":1623,"esri/views/3d/layers/i3s/Highlights":1624,"esri/views/3d/layers/i3s/I3SElevationProvider":1625,"esri/views/3d/layers/i3s/IDBCache":1626,"esri/views/3d/webgl-engine/materials/component/index":1627,"esri/views/3d/webgl-engine/materials/component/ComponentMaterial":1628,"esri/views/3d/webgl-engine/materials/component/ComponentGLMaterial":1629,"esri/views/3d/webgl-engine/materials/internal/TextureBinding":1630,"esri/views/3d/webgl-engine/materials/renderers/PreinterleavedRenderer":1631,"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":1632,"esri/views/3d/layers/support/fieldProperties":1633,"esri/views/3d/layers/i3s/I3SGeometryUtil":1650,"esri/views/3d/layers/support/PopupSceneLayerView":1736,"esri/views/3d/layers/SceneLayerView3D":2433,"esri/views/3d/layers/i3s/I3SQueryEngine":2434,"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":2435,"esri/views/3d/layers/i3s/I3SQueryFeatureStore":2436})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[44,14],{1422:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(13),r(151),r(15),r(9),r(21),r(19),r(366),r(1559),r(4),r(3),r(39),r(372),r(1540),r(1495),r(1650),r(1583),r(1477),r(1489),r(38),r(572),r(18)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p,h,f,y,_,m,g,v,b,x,I,w){function A(e){return null==e.geometryIndex.header}function S(e,t){var r=new Array,n=e.layouts[0],a=e.geometryBuffer,u=new F.DecoderBuffer;u.Init(new Int8Array(a),a.byteLength);var l=new F.Decoder,c=new F.Mesh,d=l.DecodeBufferToMesh(u,c);if(!d.ok())throw F.destroy(c),F.destroy(l),F.destroy(u),new o("draco:decode_error","Error while decoding draco geometry",{message:d.error_msg()});var p=new F.DracoInt32Array,f=new F.MetadataQuerier,y=l.GetAttributeIdByMetadataEntry(c,"i3s-attribute-type","feature-index"),_=l.GetAttributeMetadata(c,y);f.GetIntEntryArray(_,"i3s-feature-ids",p);var v=p.size(),b=F._malloc(4*v);if(!p.GetArray(b,v))throw"GetArray failed";var x=new Uint32Array(F.HEAPU8.buffer,b,v).slice();F._free(b);var A=c.num_points(),S=3*c.num_faces(),D=A<65536;if(b=F._malloc(S*(D?2:4)),!(D?l.GetTrianglesUInt16Array(c,b,S):l.GetTrianglesUInt32Array(c,b,S)))throw"GetTrianglesArray failed";var E=D?new Uint16Array(F.HEAPU8.buffer,b,S).slice():new Uint32Array(F.HEAPU8.buffer,b,S).slice();F._free(b);var P=function(e,t){for(var r=new Array,n=0;n<e.length;++n){for(var i=e[n],o=t[i];r.length<=o;)r.push(new Array);r[o].push(i)}for(var a=0,s=new Uint32Array(r.length+1),n=0;n<r.length;++n){var u=r[n];s[n]=a;for(var l=0,c=u;l<c.length;l++){var i=c[l];e[a++]=i}}return s[r.length]=a,s}(E,function(e,t,r,n){var i=4*e,a=F._malloc(i),s=t.GetAttribute(r,n);if(!t.GetAttributeUInt32ArrayForAllPoints(r,s,a,e))throw new o("draco:decode_error","Error while getting attribute values",{attributeId:n});var u=new Uint32Array(F.HEAPU8.buffer,a,e).slice();return F._free(a),u}(A,l,c,y)),M=n[0].stride/Float32Array.BYTES_PER_ELEMENT,N=new Float32Array(M*A),T=new I(N,n,null,P,E),j=l.GetAttributeId(c,F.POSITION),V=C(3*A,l,c,j),G=T.getAttribute(w.VertexAttrConstants.POSITION),L=l.GetAttributeMetadata(c,j),U=f.GetDoubleEntry(L,"i3s-scale_x"),B=f.GetDoubleEntry(L,"i3s-scale_y");U=U<=0?1:U,B=B<=0?1:B;for(var k=T.getAttribute(w.VertexAttrConstants.COLOR),z=l.GetAttributeId(c,F.COLOR),q=-1!==z,Q=q?function(e,t,r,n){var i=e,a=F._malloc(i),s=t.GetAttribute(r,n);if(!t.GetAttributeUInt8ArrayForAllPoints(r,s,a,e))throw new o("draco:decode_error","Error while getting attribute values",{attributeId:n});var u=new Uint8Array(F.HEAPU8.buffer,a,e).slice();return F._free(a),u}(4*A,l,c,z):i.fill(new Array(4*A),255),H=0;H<A;H++){var W=H*G.strideIdx+G.offsetIdx;G.data[W]=V[3*H]*U,G.data[W+1]=V[3*H+1]*B,G.data[W+2]=V[3*H+2];var J=H*k.strideIdx+k.offsetIdx;k.data[J]=Q[4*H],k.data[J+1]=Q[4*H+1],k.data[J+2]=Q[4*H+2],k.data[J+3]=Q[4*H+3]}var Y=l.GetAttributeId(c,F.NORMAL),K=T.getAttribute(w.VertexAttrConstants.NORMAL);if(-1!==Y&&K){var X=C(3*A,l,c,Y);for(H=0;H<A;H++){var Z=H*K.strideIdx+K.offsetIdx;K.data[Z]=X[3*H],K.data[Z+1]=X[3*H+1],K.data[Z+2]=X[3*H+2]}}else e.needNormals&&K&&m.computeCompressedNormals({normals:T.getAttribute(w.VertexAttrConstants.NORMALCOMPRESSED),positions:T.getAttribute(w.VertexAttrConstants.POSITION),normalInd:T.getIndices(w.VertexAttrConstants.NORMALCOMPRESSED),positionInd:T.getIndices(w.VertexAttrConstants.POSITION)});var $=l.GetAttributeId(c,F.TEX_COORD),ee=T.getAttribute(w.VertexAttrConstants.UV0);if(-1!==$&&ee){var te=C(2*A,l,c,$);for(H=0;H<A;H++){Z=H*ee.strideIdx+ee.offsetIdx;ee.data[Z]=te[2*H],ee.data[Z+1]=te[2*H+1]}}var re=l.GetAttributeIdByMetadataEntry(c,"i3s-attribute-type","uv-region"),ne=T.getAttribute(w.VertexAttrConstants.REGION);if(-1!==re&&ne){var ie=function(e,t,r,n){var i=2*e,a=F._malloc(i),s=t.GetAttribute(r,n);if(!t.GetAttributeUInt16ArrayForAllPoints(r,s,a,e))throw new o("draco:decode_error","Error while getting attribute values",{attributeId:n});var u=new Uint16Array(F.HEAPU8.buffer,a,e).slice();return F._free(a),u}(4*A,l,c,re);for(H=0;H<A;H++){Z=H*ne.strideIdx+ne.offsetIdx;ne.data[Z]=ie[4*H],ne.data[Z+1]=ie[4*H+1],ne.data[Z+2]=ie[4*H+2],ne.data[Z+3]=ie[4*H+3]}}var oe=T.getAttribute(w.VertexAttrConstants.COMPONENTINDEX);oe&&O(oe,P),F.destroy(f),F.destroy(p),F.destroy(c),F.destroy(l),F.destroy(u);var ae=e.mbs,se=e.elevationOffset,ue=h.fromJSON(e.indexSR),le=h.fromJSON(e.vertexSR),ce=h.fromJSON(e.renderSR),de=g.computeGlobalTransformation(ae,se,ue,ce);s.mat4.invert(R,de);var pe=T.getAttribute(w.VertexAttrConstants.POSITION),he={globalTrafo:de},fe=N.buffer;g.reprojectPoints(pe,ae,R,se,ue,le,ce);var ye=m.extractPositionData(fe,n,E);return r.push({layout:n,interleavedVertexData:fe,indices:E,corMatrices:he,hasColors:q,positionData:ye}),t&&(t.push(fe),t.push(E.buffer)),{geometryBuffer:a,componentOffsets:P,featureIds:x,transformedGeometries:r,obb:null}}function C(e,t,r,n){var i=4*e,a=F._malloc(i),s=t.GetAttribute(r,n);if(!t.GetAttributeFloatArrayForAllPoints(r,s,a,e))throw new o("draco:decode_error","Error while getting attribute values",{attributeId:n});var u=new Float32Array(F.HEAPU8.buffer,a,e).slice();return F._free(a),u}function D(e,t,r){if(e.halfSize[0]>0){d.vec3.subtract(j,e.center,e.halfSize),d.vec3.add(V,e.center,e.halfSize);for(var n=t.offsetIdx;n<t.data.length;n+=t.strideIdx)j[0]=Math.min(j[0],t.data[n]),j[1]=Math.min(j[1],t.data[n+1]),j[2]=Math.min(j[2],t.data[n+2]),V[0]=Math.max(V[0],t.data[n]),V[1]=Math.max(V[1],t.data[n+1]),V[2]=Math.max(V[2],t.data[n+2]);d.vec3.subtract(e.halfSize,V,j),d.vec3.scale(e.halfSize,e.halfSize,.5),d.vec3.add(e.center,j,V),d.vec3.scale(e.center,e.center,.5)}else{b.compute(t,e);var i=2*Math.sqrt(1+r[0]+r[5]+r[10]);G[0]=(r[9]-r[6])/i,G[1]=(r[2]-r[8])/i,G[2]=(r[4]-r[1])/i,G[3]=.25*i,l.quat.conjugate(G,G),l.quat.multiply(e.quaternion,G,e.quaternion)}}function E(e){for(var t=e.data,r=e.size,n=e.offsetIdx,i=e.strideIdx,o=n;o<t.length;o+=i)for(var a=0;a<r;a++)if(255!==t[o+a])return!0;return!1}function O(e,t){for(var r=e.data,n=e.offsetIdx,i=e.strideIdx,o=r.length/i,a=0,s=n,u=0;u<o;u++)u>=t[a+1]&&a++,r[s]=a,s+=i}function P(e,t,r){e.geometries[0].params.vertexAttributes=r.vertexAttributes;var n,i,o=r.featureAttributes;if(o){if(o.faceRange){var a=_.createTypedView(t,o.faceRange),s=o.faceRange.valuesPerElement,u=o.faceRange.count;n=v.convertFlatRangesToOffsets(a,u,s)}var l=o.id;if(l){i=new Uint32Array(l.count);var c=1,d=_.valueType2TypedArrayClassMap[l.valueType];"UInt64"===l.valueType&&(d=Uint32Array,c=2);for(var p=new d(t,l.byteOffset,l.count*l.valuesPerElement*c),h=0;h<l.count;h++){var f=h*l.valuesPerElement*c;if(i[h]=p[f],2===c&&0!==p[f+1])throw new Error("ID exceeded maximum range supported (2^32))")}}}return{componentOffsets:n,featureIds:i}}var M=65536,N=function(){function e(){}return e.prototype.process=function(t){return n(this,void 0,void 0,function(){var n;return r(this,function(r){switch(r.label){case 0:return[4,e.ensureDracoDecoder(t)];case 1:return r.sent(),n=[t.geometryBuffer],[2,{result:this.transform(t,n),transferList:n}]}})})},e.prototype.transform=function(e,t){return A(e)?S(e,t):function(e,t){var r=e.geometryData,n=e.geometryIndex,i=e.layouts,o=e.mbs,a=e.elevationOffset,u=h.fromJSON(e.indexSR),l=h.fromJSON(e.renderSR),c=g.computeGlobalTransformation(o,a,u,l);s.mat4.invert(R,c);var p=e.geometryBuffer,y=P(r,p,n),_=y.componentOffsets,v=y.featureIds;t&&(v&&t.push(v.buffer),_&&t.push(_.buffer));var A=e.obb?null:b.create([0,0,0],[-1,-1,-1],[0,0,0,1]);d.vec3.copy(j,o),j[2]+=a,d.vec3.copy(V,j);for(var S=!1,C=0,N=new Array,T=0,F=r.geometries;T<F.length;T++){var G=F[T],L=i[C];++C;var U=e.geometryBuffer,B=[{name:w.VertexAttrConstants.COLOR,byteValue:255}],k=[w.VertexAttrConstants.NORMAL,w.VertexAttrConstants.NORMALCOMPRESSED,w.VertexAttrConstants.SYMBOLCOLOR,w.VertexAttrConstants.COMPONENTINDEX],z=m.interleaveGeometryBuffer(G,U,L,B,k),q=new I(new Float32Array(z),L),Q=q.getAttribute(w.VertexAttrConstants.POSITION),H=e.mbs,W=e.elevationOffset,J=h.fromJSON(e.indexSR),Y=h.fromJSON(e.vertexSR),K=h.fromJSON(e.renderSR);if(g.reprojectPoints(Q,H,R,W,J,Y,K),A&&D(A,Q,c),e.needNormals){var X={normals:q.getAttribute(w.VertexAttrConstants.NORMALCOMPRESSED),positions:Q,normalInd:q.getIndices(w.VertexAttrConstants.NORMALCOMPRESSED),positionInd:q.getIndices(w.VertexAttrConstants.POSITION)},Z=e.normalReferenceFrame;m.processAndInterleaveNormals(Z,G,U,c,X)}var $=q.getAttribute(w.VertexAttrConstants.COMPONENTINDEX);$&&O($,_);var ee=q.getAttribute(w.VertexAttrConstants.COLOR);ee&&!S&&(S=E(ee));var te={globalTrafo:c},re=L[0].stride,ne=1-.8*re/(re+4),ie=f.default(z,re/4,null,ne);if(null!=ie){var oe=ie.uniqueCount<M?new Uint16Array(ie.indices):ie.indices,ae=m.extractPositionData(ie.buffer,L,oe);N.push({layout:L,interleavedVertexData:ie.buffer,indices:oe,corMatrices:te,hasColors:S,positionData:ae}),t&&(t.push(ie.buffer),t.push(oe.buffer),t.push(ae.data.buffer),t.push(ae.indices.buffer))}else ae=m.extractPositionData(z,L),N.push({layout:L,interleavedVertexData:z,corMatrices:te,hasColors:S,positionData:ae}),t&&(t.push(z),t.push(ae.data.buffer),t.push(ae.indices.buffer));A&&(d.vec3.transformMat4(A.center,A.center,c),x.vectorToVector(A.center,K,A.center,J),A.center[2]-=e.elevationOffset)}return{geometryBuffer:p,componentOffsets:_,featureIds:v,transformedGeometries:N,obb:A}}(e,t)},e}();!function(e){(N||(N={})).ensureDracoDecoder=function(e){return F&&F.DecoderBuffer||e&&!A(e)?a.resolve():(T||(T=y.getDecoderModule().then(function(e){return T=null,F=e})),T.then(function(){}))}}();var T,F,R=u.mat4f64.create(),j=p.vec3f64.create(),V=p.vec3f64.create(),G=c.quatf32.create();return N}.apply(null,n))||(e.exports=i)},1471:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(37),r(348),r(255),r(12),r(201),r(9),r(0)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";return s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+n+"', id: '"+r+"')",t),l.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},n([c.property()],t.prototype,"layer",void 0),n([c.property()],t.prototype,"parent",void 0),n([c.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),n([c.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),n([c.property()],t.prototype,"view",void 0),n([c.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),n([c.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),n([c.subclass("esri.views.layers.LayerView")],t)}(c.declared(o,i,a.Identifiable,u))}.apply(null,n))||(e.exports=i)},1476:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(9),r(29),r(0),r(356),r(1471)],void 0===(i=function(e,t,r,n,i,o,a,s,u){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return i.create(function(t,r){o.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var n=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);n?r(n):t()})})},n([a.property()],t.prototype,"view",void 0),n([a.property()],t.prototype,"slicePlaneEnabled",void 0),n([a.subclass("esri.views.3d.layers.LayerView3D")],t)}(a.declared(u))}.apply(null,n))||(e.exports=i)},1482:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,n))||(e.exports=i)},1493:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(23),r(84),r(12),r(360),r(361),r(354)],void 0===(i=function(e,t,r,n,i,o,a,s){function u(e,t,n){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"color"===e.type})[0]:e;if(i){if("esri.renderers.visualVariables.ColorVariable"!==i.declaredClass)return void _.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");var o="number"==typeof t,a=o?null:t,u=a&&a.attributes,l=o?t:null,c=i.field,d=i.cache,p=d.ipData,h=d.hasExpression,f=i.cache.compiledFunc;if(!c&&!h){var m=i.stops;return m&&m[0]&&m[0].color}if("number"!=typeof l)if(h){var g=n&&{viewingMode:n.viewingMode,scale:n.scale,spatialReference:n.spatialReference},v=s.getViewInfo(g),b=s.createExecContext(a,v);if(!f){var x=s.createSyntaxTree(i.valueExpression);f=s.createFunction(x),i.cache.compiledFunc=f}l=s.executeFunction(f,b)}else u&&(l=u[c]);var I=i.normalizationField,w=u?parseFloat(u[I]):void 0;if(null!=l&&(!I||o||!isNaN(w)&&0!==w)){isNaN(w)||o||(l/=w);var A=y(l,p);if(A){var S=A[0],C=A[1],D=S===C?i.stops[S].color:r.blendColors(i.stops[S].color,i.stops[C].color,A[2],n&&n.color);return new r(D)}}}}function l(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"opacity"===e.type})[0]:e;if(n){if("esri.renderers.visualVariables.OpacityVariable"!==n.declaredClass)return void _.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");var i="number"==typeof t,o=i?null:t,a=o&&o.attributes,u=i?t:null,l=n.field,c=n.cache,d=c.ipData,p=c.hasExpression,h=n.cache.compiledFunc;if(!l&&!p){var f=n.stops;return f&&f[0]&&f[0].opacity}if("number"!=typeof u)if(p){var m=r&&{viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=s.getViewInfo(m),v=s.createExecContext(o,g);if(!h){var b=s.createSyntaxTree(n.valueExpression);h=s.createFunction(b),n.cache.compiledFunc=h}u=s.executeFunction(h,v)}else a&&(u=a[l]);var x=n.normalizationField,I=a?parseFloat(a[x]):void 0;if(null!=u&&(!x||i||!isNaN(I)&&0!==I)){isNaN(I)||i||(u/=I);var w=y(u,d);if(w){var A=w[0],S=w[1];if(A===S)return n.stops[A].opacity;var C=n.stops[A].opacity;return C+(n.stops[S].opacity-C)*w[2]}}}}function c(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"rotation"===e.type})[0]:e;if(n){if("esri.renderers.visualVariables.RotationVariable"!==n.declaredClass)return void _.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");var i=n.axis||"heading",o="heading"===i&&"arithmetic"===n.rotationType?90:0,a="heading"===i&&"arithmetic"===n.rotationType?-1:1,u="number"==typeof t?null:t,l=u&&u.attributes,c=n.field,d=n.cache.hasExpression,p=n.cache.compiledFunc,h=0;if(!c&&!d)return h;if(d){var f=r&&{viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=s.getViewInfo(f),m=s.createExecContext(u,y);if(!p){var g=s.createSyntaxTree(n.valueExpression);p=s.createFunction(g),n.cache.compiledFunc=p}h=s.executeFunction(p,m)}else l&&(h=l[c]||0);return"number"!=typeof h||isNaN(h)?null:o+a*h}}function d(e,t,r){var n="visualVariables"in e&&e.visualVariables?e.visualVariables.filter(function(e){return"size"===e.type})[0]:e;if(n){if("esri.renderers.visualVariables.SizeVariable"!==n.declaredClass)return void _.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");var i=f(function(e,t,r){var n="number"==typeof t,i=n?null:t,o=i&&i.attributes,u=n?t:null,l=e.cache.isScaleDriven,c=e.cache.compiledFunc;if(l){var d=r&&r.scale,p=r&&r.view;u=null==d||p&&"3d"===p.type?function(e){var t=null,r=null,n=e.stops;return n?(t=n[0].value,r=n[n.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):d}else if(!n)switch(e.inputValueType){case"expression":var h=r&&{viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},f=s.getViewInfo(h),y=s.createExecContext(i,f);if(!c){var _=s.createSyntaxTree(e.valueExpression);c=s.createFunction(_),e.cache.compiledFunc=c}u=s.executeFunction(c,y);break;case"field":o&&(u=o[e.field]);break;case"unknown":u=null}if(!a.isValidNumber(u))return null;if(n||!e.normalizationField)return u;var m=o?parseFloat(o[e.normalizationField]):null;return a.isValidNumber(m)&&0!==m?u/m:null}(n,t,r),n,t,r,n.cache.ipData);return null===i||void 0===i||isNaN(i)?0:i}}function p(e,t,r){return null==e?null:a.isSizeVariable(e)?d(e,t,r):a.isValidNumber(e)?e:null}function h(e,t,r){return a.isValidNumber(r)&&e>r?r:a.isValidNumber(t)&&e<t?t:e}function f(e,t,r,n,i){switch(t.transformationType){case"additive":return function(e,t,r,n){return e+(p(t.minSize,r,n)||t.minDataValue)}(e,t,r,n);case"constant":return function(e,t,r){var n=e.stops,i=n&&n.length&&n[0].size;return null==i&&(i=e.minSize),p(i,t,r)}(t,r,n);case"clamped-linear":return function(e,t,r,n){var i=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),o=p(t.minSize,r,n),a=p(t.maxSize,r,n),s=n&&n.shape;if(e<=t.minDataValue)return o;if(e>=t.maxDataValue)return a;if("area"===t.scaleBy&&s){var u="circle"===s,l=u?g*Math.pow(o/2,2):o*o,c=l+i*((u?g*Math.pow(a/2,2):a*a)-l);return u?2*Math.sqrt(c/g):Math.sqrt(c)}return o+i*(a-o)}(e,t,r,n);case"proportional":return function(e,t,r,n){var i=n&&n.shape,o=e/t.minDataValue,a=p(t.minSize,r,n),s=p(t.maxSize,r,n);return h("circle"===i?2*Math.sqrt(o*Math.pow(a/2,2)):"square"===i||"diamond"===i||"image"===i?Math.sqrt(o*Math.pow(a,2)):o*a,a,s)}(e,t,r,n);case"stops":return function(e,t,r,n,i){var o=y(e,i),a=o[0],s=o[1],u=o[2];if(a===s)return p(t.stops[a].size,r,n);var l=p(t.stops[a].size,r,n);return l+(p(t.stops[s].size,r,n)-l)*u}(e,t,r,n,i);case"real-world-size":return function(e,t,r,n){var i=(n&&n.resolution?n.resolution:1)*o.meterIn[t.valueUnit],a=p(t.minSize,r,n),s=p(t.maxSize,r,n),u=t.valueRepresentation;return h("area"===u?2*Math.sqrt(e/g)/i:"radius"===u||"distance"===u?2*e/i:e/i,a,s)}(e,t,r,n);case"identity":return function(e){return e}(e);case"unknown":return null}}function y(e,t){if(t){var r=0,n=t.length-1;return t.some(function(t,i){return e<t?(n=i,!0):(r=i,!1)}),[r,n,(e-t[r])/(t[n]-t[r])]}}Object.defineProperty(t,"__esModule",{value:!0});var _=i.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),m=new n,g=Math.PI;t.getColor=u,t.getOpacity=l,t.getRotationAngle=c,t.getSize=d,t.getSizeFromNumberOrVariable=p,t.getSizeForValue=f,t.getSizeRangeAtScale=function(e,t,r){var n=e.cache.isScaleDriven,i=r&&"3d"===r.type;if(!(n&&i||t))return null;var o={scale:t,view:r},a=p(e.minSize,m,o),s=p(e.maxSize,m,o);if(null!=a||null!=s){if(a>s){var u=s;s=a,a=u}return{minSize:a,maxSize:s}}},t.getVisualVariableValues=function(e,t,r){if(e.visualVariables){for(var n=[],i=[],o=[],a=[],s=[],p=0,h=e.visualVariables;p<h.length;p++){var f=h[p];switch(f.type){case"color":i.push(f);break;case"opacity":o.push(f);break;case"rotation":s.push(f);break;case"size":a.push(f)}}return i.forEach(function(e){var i=u(e,t,r);n.push({variable:e,value:i})}),o.forEach(function(e){var i=l(e,t,r);n.push({variable:e,value:i})}),s.forEach(function(e){var i=c(e,t,r);n.push({variable:e,value:i})}),a.forEach(function(e){var i=d(e,t,r);n.push({variable:e,value:i})}),n.filter(function(e){return null!=e.value})}}}.apply(null,n))||(e.exports=i)},1516:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,n))||(e.exports=i)},1517:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(13),r(151),r(14),r(106)],void 0===(i=function(e,t,r,n,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),n(this,void 0,void 0,function(){var n,s,u,l,c,d,p,h,f,y,_;return r(this,function(r){switch(r.label){case 0:return o.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return n=r.sent(),s=t.lastEditInfoEnabled,u=e.objectIdField,l=e.typeIdField,i.includes(n,"*")?[2,["*"]]:(d=a.fixFields,p=[e.fields],f=(h=n).concat,y=[[l]],(_=s)?[4,a.getFeatureEditFields(e)]:[3,3]);case 2:_=r.sent(),r.label=3;case 3:return(c=d.apply(void 0,p.concat([f.apply(h,y.concat([_||null]))])))&&u&&a.hasField(e.fields,u)&&-1===c.indexOf(u)&&c.push(u),[2,c]}})})},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:o.isSome(t)&&t.defaultPopupTemplateEnabled&&o.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,n))||(e.exports=i)},1518:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var r=t.toLowerCase(),n=0,i=Object.keys(e);n<i.length;n++){var o=i[n];if(o.toLowerCase()===r)return e[o]}return null}}.apply(null,n))||(e.exports=i)},1529:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){return function(){function e(){this.items=[]}return e.prototype.addObject=function(e,t){this.items.push({type:"object",highlightId:t,object:e})},e.prototype.addRenderGeometry=function(e,t,r){this.items.push({type:"renderGeometry",highlightId:t,renderGeometry:e,owner:r})},e.prototype.addExternal=function(e,t){this.items.push({type:"external",highlightId:t,remove:e})},e.prototype.remove=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];r.highlightId===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeObject=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"object"===r.type&&r.object===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeRenderGeometry=function(e){for(var t=this.items.length-1;t>=0;--t){var r=this.items[t];"renderGeometry"===r.type&&r.renderGeometry===e&&(this.removeHighlight(r),this.items.splice(t,1))}},e.prototype.removeAll=function(){var e=this;this.items.forEach(function(t){e.removeHighlight(t)}),this.items=[]},e.prototype.removeHighlight=function(e){switch(e.type){case"object":e.object.removeHighlights(e.highlightId);break;case"renderGeometry":e.owner.removeRenderGeometryHighlight(e.renderGeometry,e.highlightId);break;case"external":e.remove(e.highlightId)}},e}()}.apply(null,n))||(e.exports=i)},1540:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(22),r(9),r(1541)],void 0===(i=function(e,t,n,i,o){function a(){return!!n("esri-wasm")}function s(){return e.toUrl("./draco_decoder.wasm")}var u,l;Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(o),t.isSupported=a,t.getDecoderModule=function(){return a()?(u||(u=i.create(function(e,t){return Promise.resolve().then(function(){var t=[r(1541)];(function(t){l=t({locateFile:s}),e(l)}).apply(null,t)}).catch(r.oe)}).catch(function(e){return i.reject(e)})),u):i.reject(new Error("Draco decompression not available, missing WebAssembly support"))}}.apply(null,n))||(e.exports=i)},1541:function(e,t,r){(function(t){var n=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(n){function i(e,t){e||g("Assertion failed: "+t)}function o(e,t){return e?function(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&ce)return ce.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var u=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var l=a-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}(se,e,t):""}function a(e,t){return e%t>0&&(e+=t-e%t),e}function s(){z.HEAP8=ae=new Int8Array(oe),z.HEAP16=new Int16Array(oe),z.HEAP32=ue=new Int32Array(oe),z.HEAPU8=se=new Uint8Array(oe),z.HEAPU16=new Uint16Array(oe),z.HEAPU32=new Uint32Array(oe),z.HEAPF32=new Float32Array(oe),z.HEAPF64=new Float64Array(oe)}function u(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?z.dynCall_v(r):z.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}function l(e){pe.unshift(e)}function c(e){ye.unshift(e)}function d(e){return String.prototype.startsWith?e.startsWith(be):0===e.indexOf(be)}function p(){try{if(z.wasmBinary)return new Uint8Array(z.wasmBinary);if(z.readBinary)return z.readBinary(xe);throw"both async and sync fetching of the wasm failed"}catch(e){g(e)}}function h(e){function t(e,t){var r=e.exports;z.asm=r,function(e){if(me--,z.monitorRunDependencies&&z.monitorRunDependencies(me),0==me&&(null!==ge&&(clearInterval(ge),ge=null),ve)){var t=ve;ve=null,t()}}()}function r(e){t(e.instance)}function n(e){(z.wasmBinary||!K&&!X||"function"!=typeof fetch?new Promise(function(e,t){e(p())}):fetch(xe,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+xe+"'";return e.arrayBuffer()}).catch(function(){return p()})).then(function(e){return WebAssembly.instantiate(e,i)}).then(e,function(e){re("failed to asynchronously prepare wasm: "+e),g(e)})}var i={env:e,global:{NaN:NaN,Infinity:1/0},"global.Math":Math,asm2wasm:ne};if(me++,z.monitorRunDependencies&&z.monitorRunDependencies(me),z.instantiateWasm)try{return z.instantiateWasm(i,t)}catch(e){return re("Module.instantiateWasm callback failed with error: "+e),!1}return z.wasmBinary||"function"!=typeof WebAssembly.instantiateStreaming||d(xe)||"function"!=typeof fetch?n(r):WebAssembly.instantiateStreaming(fetch(xe,{credentials:"same-origin"}),i).then(r,function(e){re("wasm streaming compile failed: "+e),re("falling back to ArrayBuffer instantiation"),n(r)}),{}}function f(){return!!f.uncaught_exception}function y(){return ae.length}function _(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function m(e){function t(){z.calledRun||(z.calledRun=!0,le||(_e||(_e=!0,u(he)),u(fe),z.onRuntimeInitialized&&z.onRuntimeInitialized(),function(){if(z.postRun)for("function"==typeof z.postRun&&(z.postRun=[z.postRun]);z.postRun.length;)c(z.postRun.shift());u(ye)}()))}e=e||z.arguments,me>0||(function(){if(z.preRun)for("function"==typeof z.preRun&&(z.preRun=[z.preRun]);z.preRun.length;)l(z.preRun.shift());u(pe)}(),me>0||z.calledRun||(z.setStatus?(z.setStatus("Running..."),setTimeout(function(){setTimeout(function(){z.setStatus("")},1),t()},1)):t()))}function g(e){throw z.onAbort&&z.onAbort(e),void 0!==e?(te(e),re(e),e=JSON.stringify(e)):e="",le=!0,1,"abort("+e+"). Build with -s ASSERTIONS=1 for more info."}function v(){}function b(e){return(e||v).__cache__}function x(e,t){var r=b(t),n=r[e];return n||((n=Object.create((t||v).prototype)).ptr=e,r[e]=n)}function I(e){if("string"==typeof e){var t=function(e,t,r){var n=r>0?r:function(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++r)),n<=127?++t:t+=n<=2047?2:n<=65535?3:4}return t}(e)+1,i=new Array(n),o=function(e,t,r,n){if(!(n>0))return 0;for(var i=r,o=r+n-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(r>=o)break;t[r++]=s}else if(s<=2047){if(r+1>=o)break;t[r++]=192|s>>6,t[r++]=128|63&s}else if(s<=65535){if(r+2>=o)break;t[r++]=224|s>>12,t[r++]=128|s>>6&63,t[r++]=128|63&s}else{if(r+3>=o)break;t[r++]=240|s>>18,t[r++]=128|s>>12&63,t[r++]=128|s>>6&63,t[r++]=128|63&s}}return t[r]=0,r-i}(e,i,0,i.length);return t&&(i.length=o),i}(e),r=nn.alloc(t,ae);return nn.copy(t,ae,r),r}return e}function w(){throw"cannot construct a Status, no constructor in IDL"}function A(){this.ptr=Vt(),b(A)[this.ptr]=this}function S(){this.ptr=Dr(),b(S)[this.ptr]=this}function C(){this.ptr=Wt(),b(C)[this.ptr]=this}function D(){this.ptr=kt(),b(D)[this.ptr]=this}function E(){this.ptr=Se(),b(E)[this.ptr]=this}function O(){this.ptr=mr(),b(O)[this.ptr]=this}function P(){this.ptr=Re(),b(P)[this.ptr]=this}function M(){this.ptr=Oe(),b(M)[this.ptr]=this}function N(){this.ptr=Nt(),b(N)[this.ptr]=this}function T(){this.ptr=dr(),b(T)[this.ptr]=this}function F(){this.ptr=It(),b(F)[this.ptr]=this}function R(){this.ptr=mt(),b(R)[this.ptr]=this}function j(){this.ptr=Zt(),b(j)[this.ptr]=this}function V(){this.ptr=Ge(),b(V)[this.ptr]=this}function G(){this.ptr=ze(),b(G)[this.ptr]=this}function L(){this.ptr=er(),b(L)[this.ptr]=this}function U(){throw"cannot construct a VoidPtr, no constructor in IDL"}function B(){this.ptr=Dt(),b(B)[this.ptr]=this}function k(){this.ptr=fr(),b(k)[this.ptr]=this}var z=void 0!==(n=n||{})?n:{},q=!1,Q=!1;z.onRuntimeInitialized=function(){q=!0,Q&&"function"==typeof z.onModuleLoaded&&z.onModuleLoaded(z)},z.onModuleParsed=function(){Q=!0,q&&"function"==typeof z.onModuleLoaded&&z.onModuleLoaded(z)},z.isVersionSupported=function(e){if("string"!=typeof e)return!1;var t=e.split(".");return!(t.length<2||t.length>3)&&(1==t[0]&&t[1]>=0&&t[1]<=3||!(0!=t[0]||t[1]>10))};var H,W={};for(H in z)z.hasOwnProperty(H)&&(W[H]=z[H]);z.arguments=[],z.thisProgram="./this.program",z.quit=function(e,t){throw t},z.preRun=[],z.postRun=[];var J,Y,K=!1,X=!1;K="object"==typeof window,X="function"==typeof importScripts,J="object"==typeof process&&!K&&!X,Y=!K&&!J&&!X;var Z,$,ee="";J?(ee=t+"/",z.read=function(e,t){var n;return Z||(Z=r(1561)),$||($=r(1562)),e=$.normalize(e),n=Z.readFileSync(e),t?n:n.toString()},z.readBinary=function(e){var t=z.read(e,!0);return t.buffer||(t=new Uint8Array(t)),i(t.buffer),t},process.argv.length>1&&(z.thisProgram=process.argv[1].replace(/\\/g,"/")),z.arguments=process.argv.slice(2),process.on("uncaughtException",function(e){if(!(e instanceof _))throw e}),process.on("unhandledRejection",g),z.quit=function(e){process.exit(e)},z.inspect=function(){return"[Emscripten Module object]"}):Y?("undefined"!=typeof read&&(z.read=function(e){return read(e)}),z.readBinary=function(e){var t;return"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(i("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs?z.arguments=scriptArgs:void 0!==arguments&&(z.arguments=arguments),"function"==typeof quit&&(z.quit=function(e){quit(e)})):(K||X)&&(X?ee=self.location.href:document.currentScript&&(ee=document.currentScript.src),e&&(ee=e),ee=0!==ee.indexOf("blob:")?ee.substr(0,ee.lastIndexOf("/")+1):"",z.read=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},X&&(z.readBinary=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),z.readAsync=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)},z.setWindowTitle=function(e){document.title=e});var te=z.print||("undefined"!=typeof console?console.log.bind(console):"undefined"!=typeof print?print:null),re=z.printErr||("undefined"!=typeof printErr?printErr:"undefined"!=typeof console&&console.warn.bind(console)||te);for(H in W)W.hasOwnProperty(H)&&(z[H]=W[H]);W=void 0;var ne={"f64-rem":function(e,t){return e%t},debugger:function(){}};new Array(0),"object"!=typeof WebAssembly&&re("no native wasm support detected");var ie,oe,ae,se,ue,le=!1,ce="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,de=("undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le"),z.TOTAL_MEMORY||16777216);de<5242880&&re("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+de+"! (TOTAL_STACK=5242880)"),z.buffer?oe=z.buffer:"object"==typeof WebAssembly&&"function"==typeof WebAssembly.Memory?(ie=new WebAssembly.Memory({initial:de/65536}),oe=ie.buffer):oe=new ArrayBuffer(de),s(),ue[4088]=5259264;var pe=[],he=[],fe=[],ye=[],_e=!1,me=0,ge=null,ve=null;z.preloadedImages={},z.preloadedAudios={};var be="data:application/octet-stream;base64,",xe="draco_decoder.wasm";d(xe)||(xe=function(e){return z.locateFile?z.locateFile(e,ee):ee+e}(xe)),z.asm=function(e,t,r){return t.memory=ie,t.table=new WebAssembly.Table({initial:490,maximum:490,element:"anyfunc"}),t.__memory_base=1024,t.__table_base=0,h(t)};var Ie={last:0,caught:[],infos:{},deAdjust:function(e){if(!e||Ie.infos[e])return e;for(var t in Ie.infos)for(var r=+t,n=Ie.infos[r].adjusted,i=n.length,o=0;o<i;o++)if(n[o]===e)return r;return e},addRef:function(e){e&&Ie.infos[e].refcount++},decRef:function(e){if(e){var t=Ie.infos[e];i(t.refcount>0),t.refcount--,0!==t.refcount||t.rethrown||(t.destructor&&z.dynCall_vi(t.destructor,e),delete Ie.infos[e],function(e){try{tn(e)}catch(e){}}(e))}},clearRef:function(e){e&&(Ie.infos[e].refcount=0)}},we={e:g,d:function(e){return rn(e)},k:function(){throw le=!0,"Pure virtual function called!"},c:function(e,t,r){throw Ie.infos[e]={ptr:e,adjusted:[e],type:t,destructor:r,refcount:0,caught:!1,rethrown:!1},Ie.last=e,"uncaught_exception"in f?f.uncaught_exception++:f.uncaught_exception=1,e},f:function(e){return z.___errno_location&&(ue[z.___errno_location()>>2]=e),e},b:function(){z.abort()},j:y,i:function(e,t,r){se.set(se.subarray(t,t+r),e)},h:function(e){var t=y();if(e>2147418112)return!1;for(var r=Math.max(t,16777216);r<e;)r=r<=536870912?a(2*r,65536):Math.min(a((3*r+2147483648)/4,65536),2147418112);return!!function(e){e=a(e,65536);var t=oe.byteLength;try{return-1!==ie.grow((e-t)/65536)&&(oe=ie.buffer,!0)}catch(e){return!1}}(r)&&(s(),!0)},g:function(){g("trap!")},l:function(e){g("OOM")},a:16352},Ae=z.asm({},we,oe);z.asm=Ae;var Se=z._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=function(){return z.asm.m.apply(null,arguments)},Ce=z._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=function(){return z.asm.n.apply(null,arguments)},De=z._emscripten_bind_AttributeOctahedronTransform___destroy___0=function(){return z.asm.o.apply(null,arguments)},Ee=z._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=function(){return z.asm.p.apply(null,arguments)},Oe=z._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=function(){return z.asm.q.apply(null,arguments)},Pe=z._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=function(){return z.asm.r.apply(null,arguments)},Me=z._emscripten_bind_AttributeQuantizationTransform___destroy___0=function(){return z.asm.s.apply(null,arguments)},Ne=z._emscripten_bind_AttributeQuantizationTransform_min_value_1=function(){return z.asm.t.apply(null,arguments)},Te=z._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=function(){return z.asm.u.apply(null,arguments)},Fe=z._emscripten_bind_AttributeQuantizationTransform_range_0=function(){return z.asm.v.apply(null,arguments)},Re=z._emscripten_bind_AttributeTransformData_AttributeTransformData_0=function(){return z.asm.w.apply(null,arguments)},je=z._emscripten_bind_AttributeTransformData___destroy___0=function(){return z.asm.x.apply(null,arguments)},Ve=z._emscripten_bind_AttributeTransformData_transform_type_0=function(){return z.asm.y.apply(null,arguments)},Ge=z._emscripten_bind_DecoderBuffer_DecoderBuffer_0=function(){return z.asm.z.apply(null,arguments)},Le=z._emscripten_bind_DecoderBuffer_Init_2=function(){return z.asm.A.apply(null,arguments)},Ue=z._emscripten_bind_DecoderBuffer___destroy___0=function(){return z.asm.B.apply(null,arguments)},Be=z._emscripten_bind_Decoder_DecodeBufferToMesh_2=function(){return z.asm.C.apply(null,arguments)},ke=z._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=function(){return z.asm.D.apply(null,arguments)},ze=z._emscripten_bind_Decoder_Decoder_0=function(){return z.asm.E.apply(null,arguments)},qe=z._emscripten_bind_Decoder_GetAttributeByUniqueId_2=function(){return z.asm.F.apply(null,arguments)},Qe=z._emscripten_bind_Decoder_GetAttributeFloatArrayForAllPoints_4=function(){return z.asm.G.apply(null,arguments)},He=z._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=function(){return z.asm.H.apply(null,arguments)},We=z._emscripten_bind_Decoder_GetAttributeFloat_3=function(){return z.asm.I.apply(null,arguments)},Je=z._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=function(){return z.asm.J.apply(null,arguments)},Ye=z._emscripten_bind_Decoder_GetAttributeIdByName_2=function(){return z.asm.K.apply(null,arguments)},Ke=z._emscripten_bind_Decoder_GetAttributeId_2=function(){return z.asm.L.apply(null,arguments)},Xe=z._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=function(){return z.asm.M.apply(null,arguments)},Ze=z._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=function(){return z.asm.N.apply(null,arguments)},$e=z._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=function(){return z.asm.O.apply(null,arguments)},et=z._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=function(){return z.asm.P.apply(null,arguments)},tt=z._emscripten_bind_Decoder_GetAttributeMetadata_2=function(){return z.asm.Q.apply(null,arguments)},rt=z._emscripten_bind_Decoder_GetAttributeUInt16ArrayForAllPoints_4=function(){return z.asm.R.apply(null,arguments)},nt=z._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=function(){return z.asm.S.apply(null,arguments)},it=z._emscripten_bind_Decoder_GetAttributeUInt32ArrayForAllPoints_4=function(){return z.asm.T.apply(null,arguments)},ot=z._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=function(){return z.asm.U.apply(null,arguments)},at=z._emscripten_bind_Decoder_GetAttributeUInt8ArrayForAllPoints_4=function(){return z.asm.V.apply(null,arguments)},st=z._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=function(){return z.asm.W.apply(null,arguments)},ut=z._emscripten_bind_Decoder_GetAttribute_2=function(){return z.asm.X.apply(null,arguments)},lt=z._emscripten_bind_Decoder_GetEncodedGeometryType_1=function(){return z.asm.Y.apply(null,arguments)},ct=z._emscripten_bind_Decoder_GetFaceFromMesh_3=function(){return z.asm.Z.apply(null,arguments)},dt=z._emscripten_bind_Decoder_GetMetadata_1=function(){return z.asm._.apply(null,arguments)},pt=z._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=function(){return z.asm.$.apply(null,arguments)},ht=z._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=function(){return z.asm.aa.apply(null,arguments)},ft=z._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=function(){return z.asm.ba.apply(null,arguments)},yt=z._emscripten_bind_Decoder_SkipAttributeTransform_1=function(){return z.asm.ca.apply(null,arguments)},_t=z._emscripten_bind_Decoder___destroy___0=function(){return z.asm.da.apply(null,arguments)},mt=z._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=function(){return z.asm.ea.apply(null,arguments)},gt=z._emscripten_bind_DracoFloat32Array_GetArray_2=function(){return z.asm.fa.apply(null,arguments)},vt=z._emscripten_bind_DracoFloat32Array_GetValue_1=function(){return z.asm.ga.apply(null,arguments)},bt=z._emscripten_bind_DracoFloat32Array___destroy___0=function(){return z.asm.ha.apply(null,arguments)},xt=z._emscripten_bind_DracoFloat32Array_size_0=function(){return z.asm.ia.apply(null,arguments)},It=z._emscripten_bind_DracoInt16Array_DracoInt16Array_0=function(){return z.asm.ja.apply(null,arguments)},wt=z._emscripten_bind_DracoInt16Array_GetArray_2=function(){return z.asm.ka.apply(null,arguments)},At=z._emscripten_bind_DracoInt16Array_GetValue_1=function(){return z.asm.la.apply(null,arguments)},St=z._emscripten_bind_DracoInt16Array___destroy___0=function(){return z.asm.ma.apply(null,arguments)},Ct=z._emscripten_bind_DracoInt16Array_size_0=function(){return z.asm.na.apply(null,arguments)},Dt=z._emscripten_bind_DracoInt32Array_DracoInt32Array_0=function(){return z.asm.oa.apply(null,arguments)},Et=z._emscripten_bind_DracoInt32Array_GetArray_2=function(){return z.asm.pa.apply(null,arguments)},Ot=z._emscripten_bind_DracoInt32Array_GetValue_1=function(){return z.asm.qa.apply(null,arguments)},Pt=z._emscripten_bind_DracoInt32Array___destroy___0=function(){return z.asm.ra.apply(null,arguments)},Mt=z._emscripten_bind_DracoInt32Array_size_0=function(){return z.asm.sa.apply(null,arguments)},Nt=z._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return z.asm.ta.apply(null,arguments)},Tt=z._emscripten_bind_DracoInt8Array_GetArray_2=function(){return z.asm.ua.apply(null,arguments)},Ft=z._emscripten_bind_DracoInt8Array_GetValue_1=function(){return z.asm.va.apply(null,arguments)},Rt=z._emscripten_bind_DracoInt8Array___destroy___0=function(){return z.asm.wa.apply(null,arguments)},jt=z._emscripten_bind_DracoInt8Array_size_0=function(){return z.asm.xa.apply(null,arguments)},Vt=z._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=function(){return z.asm.ya.apply(null,arguments)},Gt=z._emscripten_bind_DracoUInt16Array_GetArray_2=function(){return z.asm.za.apply(null,arguments)},Lt=z._emscripten_bind_DracoUInt16Array_GetValue_1=function(){return z.asm.Aa.apply(null,arguments)},Ut=z._emscripten_bind_DracoUInt16Array___destroy___0=function(){return z.asm.Ba.apply(null,arguments)},Bt=z._emscripten_bind_DracoUInt16Array_size_0=function(){return z.asm.Ca.apply(null,arguments)},kt=z._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=function(){return z.asm.Da.apply(null,arguments)},zt=z._emscripten_bind_DracoUInt32Array_GetArray_2=function(){return z.asm.Ea.apply(null,arguments)},qt=z._emscripten_bind_DracoUInt32Array_GetValue_1=function(){return z.asm.Fa.apply(null,arguments)},Qt=z._emscripten_bind_DracoUInt32Array___destroy___0=function(){return z.asm.Ga.apply(null,arguments)},Ht=z._emscripten_bind_DracoUInt32Array_size_0=function(){return z.asm.Ha.apply(null,arguments)},Wt=z._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=function(){return z.asm.Ia.apply(null,arguments)},Jt=z._emscripten_bind_DracoUInt8Array_GetArray_2=function(){return z.asm.Ja.apply(null,arguments)},Yt=z._emscripten_bind_DracoUInt8Array_GetValue_1=function(){return z.asm.Ka.apply(null,arguments)},Kt=z._emscripten_bind_DracoUInt8Array___destroy___0=function(){return z.asm.La.apply(null,arguments)},Xt=z._emscripten_bind_DracoUInt8Array_size_0=function(){return z.asm.Ma.apply(null,arguments)},Zt=z._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return z.asm.Na.apply(null,arguments)},$t=z._emscripten_bind_GeometryAttribute___destroy___0=function(){return z.asm.Oa.apply(null,arguments)},er=z._emscripten_bind_Mesh_Mesh_0=function(){return z.asm.Pa.apply(null,arguments)},tr=z._emscripten_bind_Mesh___destroy___0=function(){return z.asm.Qa.apply(null,arguments)},rr=z._emscripten_bind_Mesh_num_attributes_0=function(){return z.asm.Ra.apply(null,arguments)},nr=z._emscripten_bind_Mesh_num_faces_0=function(){return z.asm.Sa.apply(null,arguments)},ir=z._emscripten_bind_Mesh_num_points_0=function(){return z.asm.Ta.apply(null,arguments)},or=z._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=function(){return z.asm.Ua.apply(null,arguments)},ar=z._emscripten_bind_MetadataQuerier_GetEntryName_2=function(){return z.asm.Va.apply(null,arguments)},sr=z._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=function(){return z.asm.Wa.apply(null,arguments)},ur=z._emscripten_bind_MetadataQuerier_GetIntEntry_2=function(){return z.asm.Xa.apply(null,arguments)},lr=z._emscripten_bind_MetadataQuerier_GetStringEntry_2=function(){return z.asm.Ya.apply(null,arguments)},cr=z._emscripten_bind_MetadataQuerier_HasEntry_2=function(){return z.asm.Za.apply(null,arguments)},dr=z._emscripten_bind_MetadataQuerier_MetadataQuerier_0=function(){return z.asm._a.apply(null,arguments)},pr=z._emscripten_bind_MetadataQuerier_NumEntries_1=function(){return z.asm.$a.apply(null,arguments)},hr=z._emscripten_bind_MetadataQuerier___destroy___0=function(){return z.asm.ab.apply(null,arguments)},fr=z._emscripten_bind_Metadata_Metadata_0=function(){return z.asm.bb.apply(null,arguments)},yr=z._emscripten_bind_Metadata___destroy___0=function(){return z.asm.cb.apply(null,arguments)},_r=z._emscripten_bind_PointAttribute_GetAttributeTransformData_0=function(){return z.asm.db.apply(null,arguments)},mr=z._emscripten_bind_PointAttribute_PointAttribute_0=function(){return z.asm.eb.apply(null,arguments)},gr=z._emscripten_bind_PointAttribute___destroy___0=function(){return z.asm.fb.apply(null,arguments)},vr=z._emscripten_bind_PointAttribute_attribute_type_0=function(){return z.asm.gb.apply(null,arguments)},br=z._emscripten_bind_PointAttribute_byte_offset_0=function(){return z.asm.hb.apply(null,arguments)},xr=z._emscripten_bind_PointAttribute_byte_stride_0=function(){return z.asm.ib.apply(null,arguments)},Ir=z._emscripten_bind_PointAttribute_data_type_0=function(){return z.asm.jb.apply(null,arguments)},wr=z._emscripten_bind_PointAttribute_normalized_0=function(){return z.asm.kb.apply(null,arguments)},Ar=z._emscripten_bind_PointAttribute_num_components_0=function(){return z.asm.lb.apply(null,arguments)},Sr=z._emscripten_bind_PointAttribute_size_0=function(){return z.asm.mb.apply(null,arguments)},Cr=z._emscripten_bind_PointAttribute_unique_id_0=function(){return z.asm.nb.apply(null,arguments)},Dr=z._emscripten_bind_PointCloud_PointCloud_0=function(){return z.asm.ob.apply(null,arguments)},Er=z._emscripten_bind_PointCloud___destroy___0=function(){return z.asm.pb.apply(null,arguments)},Or=z._emscripten_bind_PointCloud_num_attributes_0=function(){return z.asm.qb.apply(null,arguments)},Pr=z._emscripten_bind_PointCloud_num_points_0=function(){return z.asm.rb.apply(null,arguments)},Mr=z._emscripten_bind_Status___destroy___0=function(){return z.asm.sb.apply(null,arguments)},Nr=z._emscripten_bind_Status_code_0=function(){return z.asm.tb.apply(null,arguments)},Tr=z._emscripten_bind_Status_error_msg_0=function(){return z.asm.ub.apply(null,arguments)},Fr=z._emscripten_bind_Status_ok_0=function(){return z.asm.vb.apply(null,arguments)},Rr=z._emscripten_bind_VoidPtr___destroy___0=function(){return z.asm.wb.apply(null,arguments)},jr=z._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=function(){return z.asm.xb.apply(null,arguments)},Vr=z._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=function(){return z.asm.yb.apply(null,arguments)},Gr=z._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=function(){return z.asm.zb.apply(null,arguments)},Lr=z._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=function(){return z.asm.Ab.apply(null,arguments)},Ur=z._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return z.asm.Bb.apply(null,arguments)},Br=z._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return z.asm.Cb.apply(null,arguments)},kr=z._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return z.asm.Db.apply(null,arguments)},zr=z._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return z.asm.Eb.apply(null,arguments)},qr=z._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return z.asm.Fb.apply(null,arguments)},Qr=z._emscripten_enum_draco_GeometryAttribute_Type_INVALID=function(){return z.asm.Gb.apply(null,arguments)},Hr=z._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return z.asm.Hb.apply(null,arguments)},Wr=z._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return z.asm.Ib.apply(null,arguments)},Jr=z._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return z.asm.Jb.apply(null,arguments)},Yr=z._emscripten_enum_draco_StatusCode_ERROR=function(){return z.asm.Kb.apply(null,arguments)},Kr=z._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=function(){return z.asm.Lb.apply(null,arguments)},Xr=z._emscripten_enum_draco_StatusCode_IO_ERROR=function(){return z.asm.Mb.apply(null,arguments)},Zr=z._emscripten_enum_draco_StatusCode_OK=function(){return z.asm.Nb.apply(null,arguments)},$r=z._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=function(){return z.asm.Ob.apply(null,arguments)},en=z._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=function(){return z.asm.Pb.apply(null,arguments)},tn=z._free=function(){return z.asm.Qb.apply(null,arguments)},rn=z._malloc=function(){return z.asm.Rb.apply(null,arguments)};if(z.dynCall_v=function(){return z.asm.Sb.apply(null,arguments)},z.dynCall_vi=function(){return z.asm.Tb.apply(null,arguments)},z.asm=Ae,z.then=function(e){if(z.calledRun)e(z);else{var t=z.onRuntimeInitialized;z.onRuntimeInitialized=function(){t&&t(),e(z)}}return z},_.prototype=new Error,_.prototype.constructor=_,ve=function e(){z.calledRun||m(),z.calledRun||(ve=e)},z.run=m,z.abort=g,z.preInit)for("function"==typeof z.preInit&&(z.preInit=[z.preInit]);z.preInit.length>0;)z.preInit.pop()();z.noExitRuntime=!0,m(),v.prototype=Object.create(v.prototype),v.prototype.constructor=v,v.prototype.__class__=v,v.__cache__={},z.WrapperObject=v,z.getCache=b,z.wrapPointer=x,z.castObject=function(e,t){return x(e.ptr,t)},z.NULL=x(0),z.destroy=function(e){if(!e.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";e.__destroy__(),delete b(e.__class__)[e.ptr]},z.compare=function(e,t){return e.ptr===t.ptr},z.getPointer=function(e){return e.ptr},z.getClass=function(e){return e.__class__};var nn={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(nn.needed){for(var e=0;e<nn.temps.length;e++)z._free(nn.temps[e]);nn.temps.length=0,z._free(nn.buffer),nn.buffer=0,nn.size+=nn.needed,nn.needed=0}nn.buffer||(nn.size+=128,nn.buffer=z._malloc(nn.size),i(nn.buffer)),nn.pos=0},alloc:function(e,t){i(nn.buffer);var r,n=t.BYTES_PER_ELEMENT,o=e.length*n;return o=o+7&-8,nn.pos+o>=nn.size?(i(o>0),nn.needed+=o,r=z._malloc(o),nn.temps.push(r)):(r=nn.buffer+nn.pos,nn.pos+=o),r},copy:function(e,t,r){var n=r;switch(t.BYTES_PER_ELEMENT){case 2:n>>=1;break;case 4:n>>=2;break;case 8:n>>=3}for(var i=0;i<e.length;i++)t[n+i]=e[i]}};return w.prototype=Object.create(v.prototype),w.prototype.constructor=w,w.prototype.__class__=w,w.__cache__={},z.Status=w,w.prototype.code=w.prototype.code=function(){var e=this.ptr;return Nr(e)},w.prototype.ok=w.prototype.ok=function(){var e=this.ptr;return!!Fr(e)},w.prototype.error_msg=w.prototype.error_msg=function(){var e=this.ptr;return o(Tr(e))},w.prototype.__destroy__=w.prototype.__destroy__=function(){var e=this.ptr;Mr(e)},A.prototype=Object.create(v.prototype),A.prototype.constructor=A,A.prototype.__class__=A,A.__cache__={},z.DracoUInt16Array=A,A.prototype.GetValue=A.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Lt(t,e)},A.prototype.size=A.prototype.size=function(){var e=this.ptr;return Bt(e)},A.prototype.GetArray=A.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Gt(r,e,t)},A.prototype.__destroy__=A.prototype.__destroy__=function(){var e=this.ptr;Ut(e)},S.prototype=Object.create(v.prototype),S.prototype.constructor=S,S.prototype.__class__=S,S.__cache__={},z.PointCloud=S,S.prototype.num_attributes=S.prototype.num_attributes=function(){var e=this.ptr;return Or(e)},S.prototype.num_points=S.prototype.num_points=function(){var e=this.ptr;return Pr(e)},S.prototype.__destroy__=S.prototype.__destroy__=function(){var e=this.ptr;Er(e)},C.prototype=Object.create(v.prototype),C.prototype.constructor=C,C.prototype.__class__=C,C.__cache__={},z.DracoUInt8Array=C,C.prototype.GetValue=C.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Yt(t,e)},C.prototype.size=C.prototype.size=function(){var e=this.ptr;return Xt(e)},C.prototype.GetArray=C.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Jt(r,e,t)},C.prototype.__destroy__=C.prototype.__destroy__=function(){var e=this.ptr;Kt(e)},D.prototype=Object.create(v.prototype),D.prototype.constructor=D,D.prototype.__class__=D,D.__cache__={},z.DracoUInt32Array=D,D.prototype.GetValue=D.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),qt(t,e)},D.prototype.size=D.prototype.size=function(){var e=this.ptr;return Ht(e)},D.prototype.GetArray=D.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!zt(r,e,t)},D.prototype.__destroy__=D.prototype.__destroy__=function(){var e=this.ptr;Qt(e)},E.prototype=Object.create(v.prototype),E.prototype.constructor=E,E.prototype.__class__=E,E.__cache__={},z.AttributeOctahedronTransform=E,E.prototype.InitFromAttribute=E.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Ce(t,e)},E.prototype.quantization_bits=E.prototype.quantization_bits=function(){var e=this.ptr;return Ee(e)},E.prototype.__destroy__=E.prototype.__destroy__=function(){var e=this.ptr;De(e)},O.prototype=Object.create(v.prototype),O.prototype.constructor=O,O.prototype.__class__=O,O.__cache__={},z.PointAttribute=O,O.prototype.size=O.prototype.size=function(){var e=this.ptr;return Sr(e)},O.prototype.GetAttributeTransformData=O.prototype.GetAttributeTransformData=function(){var e=this.ptr;return x(_r(e),P)},O.prototype.attribute_type=O.prototype.attribute_type=function(){var e=this.ptr;return vr(e)},O.prototype.data_type=O.prototype.data_type=function(){var e=this.ptr;return Ir(e)},O.prototype.num_components=O.prototype.num_components=function(){var e=this.ptr;return Ar(e)},O.prototype.normalized=O.prototype.normalized=function(){var e=this.ptr;return!!wr(e)},O.prototype.byte_stride=O.prototype.byte_stride=function(){var e=this.ptr;return xr(e)},O.prototype.byte_offset=O.prototype.byte_offset=function(){var e=this.ptr;return br(e)},O.prototype.unique_id=O.prototype.unique_id=function(){var e=this.ptr;return Cr(e)},O.prototype.__destroy__=O.prototype.__destroy__=function(){var e=this.ptr;gr(e)},P.prototype=Object.create(v.prototype),P.prototype.constructor=P,P.prototype.__class__=P,P.__cache__={},z.AttributeTransformData=P,P.prototype.transform_type=P.prototype.transform_type=function(){var e=this.ptr;return Ve(e)},P.prototype.__destroy__=P.prototype.__destroy__=function(){var e=this.ptr;je(e)},M.prototype=Object.create(v.prototype),M.prototype.constructor=M,M.prototype.__class__=M,M.__cache__={},z.AttributeQuantizationTransform=M,M.prototype.InitFromAttribute=M.prototype.InitFromAttribute=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),!!Pe(t,e)},M.prototype.quantization_bits=M.prototype.quantization_bits=function(){var e=this.ptr;return Te(e)},M.prototype.min_value=M.prototype.min_value=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ne(t,e)},M.prototype.range=M.prototype.range=function(){var e=this.ptr;return Fe(e)},M.prototype.__destroy__=M.prototype.__destroy__=function(){var e=this.ptr;Me(e)},N.prototype=Object.create(v.prototype),N.prototype.constructor=N,N.prototype.__class__=N,N.__cache__={},z.DracoInt8Array=N,N.prototype.GetValue=N.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ft(t,e)},N.prototype.size=N.prototype.size=function(){var e=this.ptr;return jt(e)},N.prototype.GetArray=N.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Tt(r,e,t)},N.prototype.__destroy__=N.prototype.__destroy__=function(){var e=this.ptr;Rt(e)},T.prototype=Object.create(v.prototype),T.prototype.constructor=T,T.prototype.__class__=T,T.__cache__={},z.MetadataQuerier=T,T.prototype.HasEntry=T.prototype.HasEntry=function(e,t){var r=this.ptr;return nn.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:I(t),!!cr(r,e,t)},T.prototype.GetIntEntry=T.prototype.GetIntEntry=function(e,t){var r=this.ptr;return nn.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:I(t),ur(r,e,t)},T.prototype.GetIntEntryArray=T.prototype.GetIntEntryArray=function(e,t,r){var n=this.ptr;nn.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:I(t),r&&"object"==typeof r&&(r=r.ptr),sr(n,e,t,r)},T.prototype.GetDoubleEntry=T.prototype.GetDoubleEntry=function(e,t){var r=this.ptr;return nn.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:I(t),or(r,e,t)},T.prototype.GetStringEntry=T.prototype.GetStringEntry=function(e,t){var r=this.ptr;return nn.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:I(t),o(lr(r,e,t))},T.prototype.NumEntries=T.prototype.NumEntries=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),pr(t,e)},T.prototype.GetEntryName=T.prototype.GetEntryName=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),o(ar(r,e,t))},T.prototype.__destroy__=T.prototype.__destroy__=function(){var e=this.ptr;hr(e)},F.prototype=Object.create(v.prototype),F.prototype.constructor=F,F.prototype.__class__=F,F.__cache__={},z.DracoInt16Array=F,F.prototype.GetValue=F.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),At(t,e)},F.prototype.size=F.prototype.size=function(){var e=this.ptr;return Ct(e)},F.prototype.GetArray=F.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!wt(r,e,t)},F.prototype.__destroy__=F.prototype.__destroy__=function(){var e=this.ptr;St(e)},R.prototype=Object.create(v.prototype),R.prototype.constructor=R,R.prototype.__class__=R,R.__cache__={},z.DracoFloat32Array=R,R.prototype.GetValue=R.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),vt(t,e)},R.prototype.size=R.prototype.size=function(){var e=this.ptr;return xt(e)},R.prototype.GetArray=R.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!gt(r,e,t)},R.prototype.__destroy__=R.prototype.__destroy__=function(){var e=this.ptr;bt(e)},j.prototype=Object.create(v.prototype),j.prototype.constructor=j,j.prototype.__class__=j,j.__cache__={},z.GeometryAttribute=j,j.prototype.__destroy__=j.prototype.__destroy__=function(){var e=this.ptr;$t(e)},V.prototype=Object.create(v.prototype),V.prototype.constructor=V,V.prototype.__class__=V,V.__cache__={},z.DecoderBuffer=V,V.prototype.Init=V.prototype.Init=function(e,t){var r=this.ptr;nn.prepare(),"object"==typeof e&&(e=function(e){if("object"==typeof e){var t=nn.alloc(e,ae);return nn.copy(e,ae,t),t}return e}(e)),t&&"object"==typeof t&&(t=t.ptr),Le(r,e,t)},V.prototype.__destroy__=V.prototype.__destroy__=function(){var e=this.ptr;Ue(e)},G.prototype=Object.create(v.prototype),G.prototype.constructor=G,G.prototype.__class__=G,G.__cache__={},z.Decoder=G,G.prototype.GetEncodedGeometryType=G.prototype.GetEncodedGeometryType=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),lt(t,e)},G.prototype.DecodeBufferToPointCloud=G.prototype.DecodeBufferToPointCloud=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(ke(r,e,t),w)},G.prototype.DecodeBufferToMesh=G.prototype.DecodeBufferToMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(Be(r,e,t),w)},G.prototype.GetAttributeId=G.prototype.GetAttributeId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),Ke(r,e,t)},G.prototype.GetAttributeIdByName=G.prototype.GetAttributeIdByName=function(e,t){var r=this.ptr;return nn.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:I(t),Ye(r,e,t)},G.prototype.GetAttributeIdByMetadataEntry=G.prototype.GetAttributeIdByMetadataEntry=function(e,t,r){var n=this.ptr;return nn.prepare(),e&&"object"==typeof e&&(e=e.ptr),t=t&&"object"==typeof t?t.ptr:I(t),r=r&&"object"==typeof r?r.ptr:I(r),Je(n,e,t,r)},G.prototype.GetAttribute=G.prototype.GetAttribute=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(ut(r,e,t),O)},G.prototype.GetAttributeByUniqueId=G.prototype.GetAttributeByUniqueId=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(qe(r,e,t),O)},G.prototype.GetMetadata=G.prototype.GetMetadata=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),x(dt(t,e),k)},G.prototype.GetAttributeMetadata=G.prototype.GetAttributeMetadata=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),x(tt(r,e,t),k)},G.prototype.GetFaceFromMesh=G.prototype.GetFaceFromMesh=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ct(n,e,t,r)},G.prototype.GetTriangleStripsFromMesh=G.prototype.GetTriangleStripsFromMesh=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),pt(r,e,t)},G.prototype.GetTrianglesUInt16Array=G.prototype.GetTrianglesUInt16Array=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ht(n,e,t,r)},G.prototype.GetTrianglesUInt32Array=G.prototype.GetTrianglesUInt32Array=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ft(n,e,t,r)},G.prototype.GetAttributeFloat=G.prototype.GetAttributeFloat=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!We(n,e,t,r)},G.prototype.GetAttributeFloatForAllPoints=G.prototype.GetAttributeFloatForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!He(n,e,t,r)},G.prototype.GetAttributeFloatArrayForAllPoints=G.prototype.GetAttributeFloatArrayForAllPoints=function(e,t,r,n){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),!!Qe(i,e,t,r,n)},G.prototype.GetAttributeIntForAllPoints=G.prototype.GetAttributeIntForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!et(n,e,t,r)},G.prototype.GetAttributeInt8ForAllPoints=G.prototype.GetAttributeInt8ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!$e(n,e,t,r)},G.prototype.GetAttributeUInt8ForAllPoints=G.prototype.GetAttributeUInt8ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!st(n,e,t,r)},G.prototype.GetAttributeUInt8ArrayForAllPoints=G.prototype.GetAttributeUInt8ArrayForAllPoints=function(e,t,r,n){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),!!at(i,e,t,r,n)},G.prototype.GetAttributeInt16ForAllPoints=G.prototype.GetAttributeInt16ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Xe(n,e,t,r)},G.prototype.GetAttributeUInt16ForAllPoints=G.prototype.GetAttributeUInt16ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!nt(n,e,t,r)},G.prototype.GetAttributeUInt16ArrayForAllPoints=G.prototype.GetAttributeUInt16ArrayForAllPoints=function(e,t,r,n){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),!!rt(i,e,t,r,n)},G.prototype.GetAttributeInt32ForAllPoints=G.prototype.GetAttributeInt32ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!Ze(n,e,t,r)},G.prototype.GetAttributeUInt32ForAllPoints=G.prototype.GetAttributeUInt32ForAllPoints=function(e,t,r){var n=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),!!ot(n,e,t,r)},G.prototype.GetAttributeUInt32ArrayForAllPoints=G.prototype.GetAttributeUInt32ArrayForAllPoints=function(e,t,r,n){var i=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),r&&"object"==typeof r&&(r=r.ptr),n&&"object"==typeof n&&(n=n.ptr),!!it(i,e,t,r,n)},G.prototype.SkipAttributeTransform=G.prototype.SkipAttributeTransform=function(e){var t=this.ptr;e&&"object"==typeof e&&(e=e.ptr),yt(t,e)},G.prototype.__destroy__=G.prototype.__destroy__=function(){var e=this.ptr;_t(e)},L.prototype=Object.create(v.prototype),L.prototype.constructor=L,L.prototype.__class__=L,L.__cache__={},z.Mesh=L,L.prototype.num_faces=L.prototype.num_faces=function(){var e=this.ptr;return nr(e)},L.prototype.num_attributes=L.prototype.num_attributes=function(){var e=this.ptr;return rr(e)},L.prototype.num_points=L.prototype.num_points=function(){var e=this.ptr;return ir(e)},L.prototype.__destroy__=L.prototype.__destroy__=function(){var e=this.ptr;tr(e)},U.prototype=Object.create(v.prototype),U.prototype.constructor=U,U.prototype.__class__=U,U.__cache__={},z.VoidPtr=U,U.prototype.__destroy__=U.prototype.__destroy__=function(){var e=this.ptr;Rr(e)},B.prototype=Object.create(v.prototype),B.prototype.constructor=B,B.prototype.__class__=B,B.__cache__={},z.DracoInt32Array=B,B.prototype.GetValue=B.prototype.GetValue=function(e){var t=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),Ot(t,e)},B.prototype.size=B.prototype.size=function(){var e=this.ptr;return Mt(e)},B.prototype.GetArray=B.prototype.GetArray=function(e,t){var r=this.ptr;return e&&"object"==typeof e&&(e=e.ptr),t&&"object"==typeof t&&(t=t.ptr),!!Et(r,e,t)},B.prototype.__destroy__=B.prototype.__destroy__=function(){var e=this.ptr;Pt(e)},k.prototype=Object.create(v.prototype),k.prototype.constructor=k,k.prototype.__class__=k,k.__cache__={},z.Metadata=k,k.prototype.__destroy__=k.prototype.__destroy__=function(){var e=this.ptr;yr(e)},function(){function e(){z.OK=Zr(),z.ERROR=Yr(),z.IO_ERROR=Xr(),z.INVALID_PARAMETER=Kr(),z.UNSUPPORTED_VERSION=en(),z.UNKNOWN_VERSION=$r(),z.INVALID_GEOMETRY_TYPE=Ur(),z.POINT_CLOUD=Br(),z.TRIANGULAR_MESH=kr(),z.ATTRIBUTE_INVALID_TRANSFORM=jr(),z.ATTRIBUTE_NO_TRANSFORM=Vr(),z.ATTRIBUTE_QUANTIZATION_TRANSFORM=Lr(),z.ATTRIBUTE_OCTAHEDRON_TRANSFORM=Gr(),z.INVALID=Qr(),z.POSITION=Wr(),z.NORMAL=Hr(),z.COLOR=zr(),z.TEX_COORD=Jr(),z.GENERIC=qr()}_e?e():function(e){fe.unshift(e)}(e)}(),"function"==typeof z.onModuleParsed&&z.onModuleParsed(),n}}();e.exports=n}).call(this,"/")},1545:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(588)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.isUniformComponentData=function(e){return!(e instanceof n.TextureBackedBuffer)},t.fillDefaults=function(e){return r({baseColor:i,baseColorOpacity:1,baseColorTexture:null,doubleSidedShading:!1,normals:"screen-space",cullFace:"back",componentData:o,receiveSSAO:!0,forceTransparency:null,slicePlaneEnabled:!1,polygonOffsetEnabled:!1,writeStencil:!1,readStencil:!1,layerOpacity:1},e)};var i=[1,1,1],o={externalColor:[1,1,1,1],externalColorMixMode:"multiply",castShadows:!0}}.apply(null,n))||(e.exports=i)},1546:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(68)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.createVertexBufferLayout=function(e){var t=r.newLayout().vec3f("position");return"compressed"===e.normals?t.vec2i16("normalCompressed",{glNormalized:!0}):"default"===e.normals&&t.vec3f("normal"),e.textureCoordinates&&t.vec2f("uv0"),e.textureCoordinateRegions&&t.vec4u16("region",{glNormalized:!0}),e.colors&&t.vec4u8("color"),e.componentData&&t.u16("componentIndex"),t.alignTo(4)}}.apply(null,n))||(e.exports=i)},1561:function(e,t){},1562:function(e,t){function r(e,t){for(var r=0,n=e.length-1;n>=0;n--){var i=e[n];"."===i?e.splice(n,1):".."===i?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r--;r)e.unshift("..");return e}function n(e,t){if(e.filter)return e.filter(t);for(var r=[],n=0;n<e.length;n++)t(e[n],n,e)&&r.push(e[n]);return r}t.resolve=function(){for(var e="",t=!1,i=arguments.length-1;i>=-1&&!t;i--){var o=i>=0?arguments[i]:process.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,t="/"===o.charAt(0))}return e=r(n(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},t.normalize=function(e){var o=t.isAbsolute(e),a="/"===i(e,-1);return(e=r(n(e.split("/"),function(e){return!!e}),!o).join("/"))||o||(e="."),e&&a&&(e+="/"),(o?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(n(e,function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e}).join("/"))},t.relative=function(e,r){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var r=e.length-1;r>=0&&""===e[r];r--);return t>r?[]:e.slice(t,r-t+1)}e=t.resolve(e).substr(1),r=t.resolve(r).substr(1);for(var i=n(e.split("/")),o=n(r.split("/")),a=Math.min(i.length,o.length),s=a,u=0;u<a;u++)if(i[u]!==o[u]){s=u;break}var l=[];for(u=s;u<i.length;u++)l.push("..");return(l=l.concat(o.slice(s))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),r=47===t,n=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){n=o;break}}else i=!1;return-1===n?r?"/":".":r&&1===n?"/":e.slice(0,n)},t.basename=function(e,t){var r=function(e){"string"!=typeof e&&(e+="");var t,r=0,n=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){r=t+1;break}}else-1===n&&(i=!1,n=t+1);return-1===n?"":e.slice(r,n)}(e);return t&&r.substr(-1*t.length)===t&&(r=r.substr(0,r.length-t.length)),r},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,r=0,n=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var s=e.charCodeAt(a);if(47!==s)-1===n&&(i=!1,n=a+1),46===s?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){r=a+1;break}}return-1===t||-1===n||0===o||1===o&&t===n-1&&t===r+1?"":e.slice(t,n)};var i="b"==="ab".substr(-1)?function(e,t,r){return e.substr(t,r)}:function(e,t,r){return t<0&&(t=e.length+t),e.substr(t,r)}},1564:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(45),r(52),r(37),r(20),r(22),r(12),r(86),r(201),r(9),r(29),r(0),r(4),r(3),r(43),r(35),r(95),r(1531),r(1565),r(1566),r(1567),r(1568),r(1569),r(1477),r(1570),r(209),r(38),r(565)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p,h,f,y,_,m,g,v,b,x,I,w,A,S,C,D,E,O,P,M){function N(e,t){return e.length===t.length&&e.every(function(e){return T(t,e.name)>=0})}function T(e,t){for(var r=t.toLowerCase(),n=0;n<e.length;n++)if(e[n].name.toLowerCase()===r)return n;return-1}function F(e){return null!=e&&null!=e.loadedAttributes&&null!=e.attributeData}var R=c.getLogger("esri.layers.graphics.controllers.I3SOnDemandController"),j=function(e){function t(t){var r=e.call(this,t)||this;return r.screenSizeFactor=0,r.featureTarget=5e4,r.fixedFeatureTarget=!1,r.updating=!0,r.updatingPercentage=0,r.leafsReached=!1,r.scaleVisibilityEnabled=!0,r.uncompressedTextureDownsamplingEnabled=!1,r._featureLOD=1,r._stableFeatureLOD=!1,r._isIdle=!1,r._cameraDirty=!0,r._invisibleDirty=!1,r._newLoadingNodes=new d({deallocator:null}),r._loadedNodeScales=new Map,r._abortController=h.createAbortController(),r._downloadingNodes=new Set,r._loadingNodes=new Set,r._updatingNodes=new Set,r._progressMaxNumNodes=1,r._poi=m.vec3f64.create(),r._requiredAttributesDirty=!0,r._updatesDisabled=!1,r.disableIDBCache=!1,r.disableMemCache=!1,r._restartNodeLoading=!1,r._fields=null,r._attributeStorageInfo=null,r._handles=new u,r._idleQueue=new x.PromiseQueue,r._errorCount=0,r}return r(t,e),Object.defineProperty(t.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGraphics3D",{get:function(){return"points"===this.layer.profile},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"streamDataController",{get:function(){var e=this.layerView.view.resourceController.createStreamDataRequester(O.ClientType.SCENE);return new C.default(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsVertex",{get:function(){return D.getVertexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"crsIndex",{get:function(){return D.getIndexCrs(this.layer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rootNodeVisible",{get:function(){var e=this._index&&this._index.rootNode;return!e||(this._updateViewData(),this._index.isNodeVisible(e.index))},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._lodHandling=new A(this.layerView,function(){return e._evaluateUpdating()});var t=this.layerView.layer;this.layer=t,this._defaultGeometrySchema=t.store.defaultGeometrySchema,this.disableIDBCache=l("disable-feature:idb-cache"),"fields"in t&&(this._fields=t.fields,this._attributeStorageInfo=t.attributeStorageInfo);var r=h.all([this.layer.when(),this.layerView.when()]).then(function(){if(!e.destroyed&&e.layerView&&!e.layerView.destroyed){var r=e.layerView.view;e._setClippingArea(r.clippingArea),e._centerOnSurface=r.pointsOfInterest.centerOnSurfaceFrequent;var n=e.layerView.view.resourceController;e._handles.add([e._centerOnSurface.watch("renderLocation",function(){return e._pointOfInterestChanged()}),n.memoryController.events.on("quality-changed",function(){return e._setCameraDirty()}),f.init(e.layerView,"suspended",function(t){var r=t?function(){return e._updateViewData()}:function(){return e._updateIdleState(!0)},i=t?function(){}:function(){return e._updateIdleState(!1)};e._idleStateCallbacks?(t&&e.cancelNodeLoading(),e.restartNodeLoading(),e._idleStateCallbacks.idleBegin=r,e._idleStateCallbacks.idleEnd=i):e._idleStateCallbacks=n.scheduler.registerIdleStateCallbacks(r,i)}),I.addTask(e.layerView.view.resourceController.scheduler,{update:function(t,r){return e._frame(t,r)},needsUpdate:function(){return e.updating}}),e.watch("uncompressedTextureDownsamplingEnabled",function(){return e.restartNodeLoading()}),e.watch(["featureTarget","fixedFeatureTarget"],function(){e._setCameraDirty(),e._stableFeatureLOD=!1}),r.state.watch("camera",function(){return e._setCameraDirty()}),e.layer.watch("elevationInfo",function(){return e._elevationInfoChanged()}),e.layer.watch(["minScale","maxScale"],function(){return e._scaleBoundsChanged()}),e.layerView.watch("lodFactor",function(){return e._setCameraDirty()}),e.layerView.watch("availableFields?",function(){return e._requiredFieldsChange()})]),e._updateScaleHandles(),e._viewportQueries=new E(e.crsIndex,r.renderCoordsHelper,r.state.camera,e._clippingArea,r.elevationProvider,e.layer,{progressiveLoadFactor:e._getProgressiveLoadFactor(e.layer),screenspaceErrorBias:e.lod,angleDependentLoD:e.lod<.5});var i=t.store.rootNode.split("/").pop();e._index=new w.I3SIndex(e.getBaseUrl(),i,e.layer.nodePages,e.streamDataController,e._viewportQueries,R,function(t){return e.layerView.isNodeLoaded(t)},function(t){return e._shouldLoadNode(t)},function(t){return e._enableFromGPUCache(t,"leaf")},function(t){return e._needsUpdate(t)})}});this._tmpPoint=b.makeDehydratedPoint(0,0,0,this.crsIndex),this.addResolvingPromise(r),this.when(function(){return e._startNodeLoading()})},t.prototype.destroy=function(){this._abortController.abort(),this._abortController=null,this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null),this._handles.destroy(),this._nodeLoader=null,V.prune()},t.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];var e=this._attributeStorageInfo,t=this._fields,r=this.layer.objectIdField;return this.layerView.availableFields.map(function(r){var n=T(e,r),i=T(t,r);return n>=0&&i>=0?{index:n,name:t[i].name,field:t[i],attributeStorageInfo:e[n]}:null}).filter(function(e){return null!=e&&e.name!==r})},t.prototype._requiredFieldsChange=function(){N(this._requiredAttributes,this._getRequiredAttributes())||this.requestUpdate()},t.prototype.requestUpdate=function(){this._requiredAttributesDirty=!0,this.restartNodeLoading()},t.prototype._setClippingArea=function(e){var t=g.create();P.extentToBoundingBox(e,t,this.layerView.view.renderSpatialReference)?this._clippingArea=t:this._clippingArea=null},t.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.setPointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=G.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate())))},t.prototype._calculatePointOfInterest=function(e){var t=this._centerOnSurface.renderLocation,r=m.vec3f64.create();_.vec3.subtract(r,t,this.camPos);var n=this.layerView.view.renderCoordsHelper,i=m.vec3f64.create();n.worldUpAtPosition(t,i);var o=_.vec3.angle(i,r)-.5*Math.PI;return _.vec3.lerp(e,this.camPos,t,Math.max(0,Math.min(1,o/(.5*Math.PI)))),e},t.prototype.updateClippingArea=function(e){this._setClippingArea(e),this._viewportQueries&&this._index&&(this._viewportQueries.updateExtent(this._clippingArea),this._index.invalidateVisibilityCache()),this._setCameraDirty()},t.prototype._setCameraDirty=function(){this._cameraDirty=!0,this.notifyChange("rootNodeVisible"),this._evaluateUpdating()},t.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path},t.prototype.updateElevationChanged=function(e,t){if(null!=this._index){null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new d({deallocator:null}));var r=this._elevationUpdateNodes;r.clear();var n=this._index.rootNode;null!=n&&D.findIntersectingNodes(e,t,n,this.crsIndex,this._index,function(e){return r.push(e.index)});for(var i=0;i<r.length;i++){var o=r.data[i];this._index.invalidateBoundingVolumeCache(o),o===n.index&&this.notifyChange("rootNodeVisible")}r.length&&this.restartNodeLoading()}},t.prototype.getParentIndex=function(e){return this._index.getParentIndex(e)},t.prototype._elevationInfoChanged=function(){this._index.updateElevationInfo(this.layer.elevationInfo),this._setCameraDirty()},t.prototype._updateScaleHandles=function(){var e=this;this._handles.remove("scale-bounds"),this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",function(t){return e._scaleUpdateHandler(t)}),"scale-bounds")},t.prototype._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear(),this._updateScaleHandles(),this._setCameraDirty(),this._lodHandling.setLodGlobalDirty()},t.prototype._scaleUpdateHandler=function(e){this._updateScaleInBoundingRect(e.scale,e.extent,e.spatialReference),this._setCameraDirty(),this._lodHandling.setLodGlobalDirty()},t.prototype._updateScaleInBoundingRect=function(e,t,r){var n=this;null!=this._index.rootNode&&P.boundingRectToBoundingRect(t,r,L,this.crsIndex)&&this._loadedNodeScales.forEach(function(t,r){var i=n._index.getNode(r);v.containsPoint(L,i.mbs)&&n._loadedNodeScales.set(r,e)})},t.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0,this._evaluateUpdating()},t.prototype.schedule=function(e,t){var r=this;return this._idleQueue.push(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw h.createAbortError();return t})},t.prototype.reschedule=function(e,t){var r=this;return this._idleQueue.unshift(t).then(function(t){if(!r._loadingNodes.has(e)&&!r._updatingNodes.has(e))throw h.createAbortError();return t})},Object.defineProperty(t.prototype,"isIntegratedMesh",{get:function(){return"integrated-mesh"===this.layer.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"areScaleBoundsActive",{get:function(){var e=M.extractSafeScaleBounds(this.layer),t=e.minScale,r=e.maxScale;return this.scaleVisibilityEnabled&&(t>0||r>0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unloadedMemoryEstimate",{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexDepth",{get:function(){return this._index?this._index.maxLevel:0},enumerable:!0,configurable:!0}),t.prototype._frame=function(e,t){return this.layerView.suspended?(this._updateView(e),-1/0):this.layerView.visible?(this._processLogError(e,t),this._index.getPriority()):-1/0},t.prototype._processLogError=function(e,t){try{this._process(e,t)}catch(e){this._errorCount<50?R.error("Error during processing: "+e):50===this._errorCount&&R.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}},t.prototype._process=function(e,t){var r=this;if(this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading()),null!=this._nodeLoader&&null!=this._index){for(this._updateView(e),this.isIntegratedMesh&&(e.enabled=!1),e.run(function(){return r._processIndex(t,e)}),this._updateFeatureLOD(),e.run(function(){return r._processCache(e,t)}),this.isIntegratedMesh&&(e.enabled=!0),e.run(function(){return r._processNodes(e,t)});!e.done&&this._idleQueue.process();)e.madeProgress();e.run(function(){return r._prefetchIndex(t)}),t.numIndexLoading+=this._index.getIndexLoading(),t.numNodesLoading+=this._downloadingNodes.size,this._evaluateUpdating(),this._lodHandling.lodGlobalHandling(e)}},t.prototype._processIndex=function(e,t){if(this._index.dirty){this._newLoadingNodes.clear(),this._index.update(o.keysOfSet(this._loadingNodes),t),!this.disableMemCache&&this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData&&(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length));var r=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||r===this._get("leafsReached")||this._set("leafsReached",r)}var n=Math.min(10-e.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,e));return this._index.load(n)},t.prototype._prefetchIndex=function(e){if(this._loadingNodes.size>0||this._index.updates.add.length>0)return!1;var t=Math.min(10-e.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,e));return this._index.prefetch(t)},t.prototype._updateFeatureLOD=function(){if(this.isGraphics3D){var e=!this._index.isLoading(),t=this.featureTarget*this.baseLOD,r=this._index.getFeatureEstimate();if(r.estimate=r.estimate||t/2,this._index.getIndexMissing()>500){if(this._featureLOD<=1e-4)return;this._featureLOD/=1.5,this._stableFeatureLOD=!1}else if(e&&r.estimate<t){if(r.leafsReached||this._featureLOD>=1e4||this._stableFeatureLOD)return;var n=Math.min(10,Math.max(t/r.estimate,1.001));this._featureLOD*=n;var i=this.lod,o=this._index.checkFeatureTarget(t,i);o!==i&&(this._featureLOD=o/this.baseLOD,this._stableFeatureLOD=!0)}else{if(!(r.estimate>1.2*t||e&&r.estimate>t))return;if(this._featureLOD<=1e-4)return;this._featureLOD/=1+.25*(r.estimate/t-1),this._stableFeatureLOD=!1}this._featureLOD=Math.min(1e4,Math.max(1e-4,this._featureLOD)),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.requestUpdate()}},t.prototype._processCache=function(e,t){for(;this._newLoadingNodes.length>0&&!e.done;)for(var r=this._newLoadingNodes.pop(),n=this._index.getParent(r);n&&!this.layerView.isNodeLoaded(n.index)&&this._isNodeInScaleBounds(n);n=this._index.getParent(n.index))if(this._enableFromGPUCache(n,"hole")){e.madeProgress();break}return e.hasProgressed},t.prototype._processNodes=function(e,t){var r=(this._isIdle?100:2)-this._loadingNodes.size,n=this._index.updates;for(n.cancel.forEach(this._cancelNode,this),n.cancel=[];n.update.length>0&&!e.done;){var i=this._index.getNode(n.update.pop());this._updateLoadedNode(i),e.madeProgress()}for(;n.add.length>0&&!e.done&&r>0;){if(--r,2!==(i=this._index.getNode(n.add.back())).cacheState&&!this._hasNodeLoadToken(t))break;n.add.pop(),this._loadNode(i),e.madeProgress()}return e.hasProgressed},t.prototype._cancelAllNodes=function(){this._loadingNodes.clear(),this._downloadingNodes.clear(),this._updatingNodes.clear(),this._abortController.abort(),this._abortController=new AbortController},t.prototype._cancelNode=function(e){this._loadingNodes.delete(e),this._downloadingNodes.delete(e)},t.prototype._getAvailableLoadTokens=function(e,t){var r=t.numIndexLoading+this._index.getIndexLoading(),n=t.numNodesLoading+this._loadingNodes.size;return Math.floor((12-1*r-2*n)/e)},t.prototype._hasNodeLoadToken=function(e){var t=this._isIdle&&!this._index.isLoading()?5:2;return!(e.numNodesLoading+this._loadingNodes.size>=t)&&this._getAvailableLoadTokens(2,e)>0},t.prototype._evaluateUpdating=function(){var e=!1,t=0;if(this.layerView.suspended)t=(e=this._invisibleDirty||this._cameraDirty)?100:0;else{var r=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.updates.add.length:0)+2*this._loadingNodes.size;e=!!(r>0||this._updatingNodes.size>0||this._restartNodeLoading||this._cameraDirty||this._idleQueue.length>0||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===r&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(r,this._progressMaxNumNodes),t=100*r/this._progressMaxNumNodes}e!==this._get("updating")&&this._set("updating",e),t!==this._get("updatingPercentage")&&this._set("updatingPercentage",t)},t.prototype._updateView=function(e){this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(e)&&(this._invisibleDirty=!1),this._evaluateUpdating()},t.prototype._updateViewData=function(){if(this._cameraDirty&&this._index){var e=this.layerView.view,t=e.state.camera;this.camPos=m.vec3f64.clone(e.pointsOfInterest.renderPointOfView),this.screenSizeFactor=1/(t.perScreenPixelRatio/2),this._poi=this._calculatePointOfInterest(this._poi),this._viewportQueries.updateCamera(t),this._viewportQueries.setPointOfInterest(this._poi),this._viewportQueries.updateScreenSpaceErrorBias(this.lod),this._index.invalidateVisibilityCache(),this._index.progressiveLoadPenalty=G.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate(),this._stableFeatureLOD=!1,this._invisibleDirty=!0,this._cameraDirty=!1,this.notifyChange("rootNodeVisible")}},t.prototype._getProgressiveLoadFactor=function(e){return this.layerView.view.resourceController.memoryController.memoryFactor<1?1:this.layerView.progressiveLoadFactor},Object.defineProperty(t.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"baseLOD",{get:function(){var e=this.layerView.lodFactor,t=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(e>0?e:1)*t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lodDropFactor",{get:function(){if(this.fixedFeatureTarget)return 1;var e=this.layerView.view.resourceController.memoryController;return(Math.min(e.memoryFactor,.5)-e.minQuality)/(.5-e.minQuality)},enumerable:!0,configurable:!0}),t.prototype.isGeometryVisible=function(e){return this._index.isGeometryVisible(e.index)},t.prototype.updateVisibility=function(e){return this._index.invalidateVisibilityCache(e)},t.prototype._shouldLoadNode=function(e){return!(!this._lodHandling.shouldLoadNode(e)||this._shouldDropNode(e)||!this._isNodeInScaleBounds(e))&&(!e.obb||this._index.isGeometryVisible(e.index))},t.prototype._shouldDropNode=function(e){var t=this.lodDropFactor;return!(t>=1||!this._lodHandling.childrenEmpty(e))&&Math.abs(this._viewportQueries.calcCameraDistanceToCenter(e))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*t},t.prototype._startNodeLoading=function(){var e=this;if(this._restartNodeLoading=!1,!this._updatesDisabled&&null!=this.streamDataController){this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var t=S.TextureFormat.Normal;this.layerView.useCompressedTextures?t=S.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(t=S.TextureFormat.Downsampled);var r={textureFormat:t,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid};this._nodeLoader=new S(this.layer,this.streamDataController,R,this._defaultGeometrySchema,this._requiredAttributes,r);var n=this.layerView.view.renderSpatialReference,i=this.crsIndex.equals(n)||this.crsIndex.isWGS84&&n.equals(P.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!i,this._index.requestUpdate(),this._lodHandling.startNodeLoading(function(t){return e._index.isNodeVisible(t)},function(t){return e._index.isGeometryVisible(t)},function(t){return e._isNodeInScaleBounds(t)},function(t){return e._index.nodeTraversalState(t)},function(t,r){return e._removeNodes(t,r)},this._index,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating()}},t.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index},t.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this.streamDataController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this._evaluateUpdating())},t.prototype._removeInvisibleNodes=function(e){var t=this;V.clear(),this.layerView.getLoadedNodeIndices(V);var r=0===this._viewportQueries.maxDistance,n=r?function(){return!1}:function(e){return t._shouldDropNode(e)};return V.filterInPlace(function(e){var r=t._index.getNode(e);return!t._index.isGeometryVisible(e)||n(r)||!t._isNodeInScaleBounds(r)}),V.length>0&&this._lodHandling.setLodGlobalDirty(),this._removeNodes(V,e),!(r&&this.lodDropFactor<1||0!==V.length&&(V.clear(),1))},t.prototype._removeNodes=function(e,t){e.length>0&&this._index.requestUpdate();var r=e.length;if(this.layerView.removeNodeData(e,t),this._loadedNodeScales.size>0)for(var n=e.length;n<r;n++){var i=e.data[n];this._loadedNodeScales.delete(i)}},t.prototype._needsUpdate=function(e){if(!e.resources.hasFeatureData||this._updatingNodes.has(e.index))return!1;var t=this.layerView.getLoadedAttributes(e.index);return null!=t&&t!==this._requiredAttributes},t.prototype._updateLoadedNode=function(e){var t=this,r=N(this.layerView.getLoadedAttributes(e.index),this._requiredAttributes)?h.resolve(this.layerView.getAttributeData(e.index)):this._nodeLoader.loadAttributes(e,this._requiredAttributes,this._abortController.signal);this._updatingNodes.add(e.index),r.then(function(r){return t.schedule(e.index).then(function(){return t.layerView.setAttributeData(e.index,{loadedAttributes:t._requiredAttributes,attributeData:r})})}).catch(function(r){h.isAbortError(r)||t.layerView.setAttributeData(e.index,{loadedAttributes:t._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){t._updatingNodes.delete(e.index),t._evaluateUpdating()}),this._evaluateUpdating()},t.prototype._loadNode=function(e){var t=this;this._loadingNodes.add(e.index),this._evaluateUpdating(),this._loadAndAddNode(e).catch(function(e){return e}).then(function(){t._loadingNodes.delete(e.index),t._evaluateUpdating()})},t.prototype._loadAndAddNode=function(e){var t=this;return 1===e.cacheState?this._loadUncached(e):this._loadCached(e).then(function(r){r||(e.cacheState=1,t._index.updates.add.push(e.index))}).catch(function(t){h.isAbortError(t)||(e.cacheState=1)})},t.prototype._enableFromGPUCache=function(e,t){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var r=this._loadCachedGPUData(e);return!!r&&(this.layerView.addCachedGPUData(e,r,t),this._nodeAdded(e),!0)},t.prototype._loadCachedGPUData=function(e){var t=this.layerView.loadCachedGPUData(e);return t&&F(t.attributeInfo)&&N(t.attributeInfo.loadedAttributes,this._requiredAttributes)?t:null},t.prototype._nodeAdded=function(e){this._index.requestUpdate(),this._lodHandling.lodSwapNodeLoaded(e)},t.prototype._loadCached=function(e){var t=this;if(this._enableFromGPUCache(e,"leaf"))return h.resolve(!0);var r=this.layerView;return!this.disableIDBCache&&r.loadCachedNodeData&&r.addCachedNodeData?this.schedule(e.index).then(function(){return r.loadCachedNodeData(e,function(r){return t._nodeLoader.loadTextures(e,r,t._abortController.signal)})}).then(function(n){if(null==n)return!1;var i=t._requiredAttributes;return F(n)&&N(n.loadedAttributes,i)?t.reschedule(e.index).then(function(){return r.addCachedNodeData(e,n,n)}).then(function(){return t._nodeAdded(e),!0}):t.reschedule(e.index).then(function(){return t._nodeLoader.loadAttributes(e,i,t._abortController.signal)}).then(function(r){return t.reschedule(e.index,{loadedAttributes:i,attributeData:r})}).then(function(t){return r.addCachedNodeData(e,n,t)}).then(function(){return t._nodeAdded(e),!0})}):h.resolve(!1)},t.prototype._loadUncached=function(e){var t=this;return this._downloadingNodes.add(e.index),a.safeCast(this._nodeLoader.loadNodeData(e,this._abortController.signal)).then(function(r){return t._downloadingNodes.delete(e.index),t.schedule(e.index,r)}).then(function(r){return t.layerView.addNodeData(e,r)}).then(function(){t._nodeAdded(e),e.cacheState=2}).catch(function(r){h.isAbortError(r)||(R.error("Failed to load node '"+e.id+"': "+r),e.failed=!0,t._index.requestUpdate())})},t.prototype._updateIdleState=function(e){e!==this._isIdle&&(this._isIdle=e,this._evaluateUpdating(),e&&this._index&&this._index.resetFailedNodes())},t.prototype._getScale=function(e){if(this._loadedNodeScales.has(e.index))return this._loadedNodeScales.get(e.index);var t=e.mbs;this._tmpPoint.x=t[0],this._tmpPoint.y=t[1],this._tmpPoint.z=t[2];var r=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);return this.layerView.isNodeLoaded(e.index)&&this._loadedNodeScales.set(e.index,r),r},t.prototype._isNodeInScaleBounds=function(e){if(!this.areScaleBoundsActive)return!0;var t=this._getScale(e),r=M.extractSafeScaleBounds(this.layer),n=r.minScale,i=r.maxScale;return M.scaleBoundsPredicate(t,n,i)},t.prototype.updateStats=function(e){e.index=this._index?this._index.size:0,this.isGraphics3D&&(e.detail=this._featureLOD,e.target=this.featureTarget*this.baseLOD),this._index&&this._index.updateStats(e)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{set disableIDBCache(t){e.disableIDBCache=t},set ignoreServiceOBB(t){e._index.ignoreServiceOBB=t}}},enumerable:!0,configurable:!0}),n([y.property({readOnly:!0})],t.prototype,"isMeshPyramid",null),n([y.property({readOnly:!0})],t.prototype,"isGraphics3D",null),n([y.property({readOnly:!0})],t.prototype,"streamDataController",null),n([y.property({readOnly:!0})],t.prototype,"crsVertex",null),n([y.property({readOnly:!0})],t.prototype,"crsIndex",null),n([y.property()],t.prototype,"camPos",void 0),n([y.property()],t.prototype,"screenSizeFactor",void 0),n([y.property()],t.prototype,"featureTarget",void 0),n([y.property()],t.prototype,"fixedFeatureTarget",void 0),n([y.property()],t.prototype,"layerView",void 0),n([y.property()],t.prototype,"layer",void 0),n([y.property({readOnly:!0})],t.prototype,"updating",void 0),n([y.property({readOnly:!0})],t.prototype,"updatingPercentage",void 0),n([y.property({readOnly:!0})],t.prototype,"leafsReached",void 0),n([y.property({constructOnly:!0})],t.prototype,"scaleVisibilityEnabled",void 0),n([y.property({readOnly:!0})],t.prototype,"rootNodeVisible",null),n([y.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],t.prototype,"uncompressedTextureDownsamplingEnabled",void 0),n([y.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],t)}(y.declared(i,p,s)),V=new d({deallocator:null}),G={factorIM:.2,factor3dObject:.05,distancePenalty:10},L=v.create();return j}.apply(null,n))||(e.exports=i)},1565:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(45)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){var t=this;this.referenceCount=0,this.callbacks=[],this.runIndex=0,this.handle=e.registerTask(2,function(e){return t.update(e)},function(){return t.needsUpdate()})}return e.prototype.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)},e.prototype.needsUpdate=function(){for(var e=0,t=this.callbacks;e<t.length;e++)if(t[e].needsUpdate())return!0;return!1},e.prototype.update=function(e){this.sort();for(var t=this.callbacks,r={numIndexLoading:0,numNodesLoading:0},n=0;n<t.length&&!e.done;++n)t[n].priority=t[n].update(e,r),this.runIndex=n},e.prototype.sort=function(){for(var e=this.callbacks,t=e.length,r=this.runIndex;r>0;r--){for(var n=e[r-1],i=r;i<e.length&&n.priority<=e[i].priority&&(i!==t||n.priority<e[i].priority);)e[i-1]=e[i],i++;e[i-1]=n,t=i-1}this.runIndex=0},e.prototype.add=function(e){this.sort(),e.priority=1/0,this.callbacks.unshift(e)},e.prototype.remove=function(e){r.removeUnordered(this.callbacks,e),this.runIndex=this.callbacks.length,this.sort()},e}(),i=new Map;t.addTask=function(e,t){var r=i.get(e);return null==r&&(r=new n(e),i.set(e,r)),r.add(t),{remove:function(){if(null!=r){if(r.remove(t),r.callbacks.length>0)return void(r=null);i.delete(e),r.destroy(),r=null}}}}}.apply(null,n))||(e.exports=i)},1566:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(14),r(86),r(9),r(4),r(33),r(1477),r(1489)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l){function c(e){e.node?(e.node.renderMbs[3]=-1,e.node.renderObb.halfSize[0]=-1):e.ref&&(e.ref.renderMbs[3]=-1,e.ref.renderObb.halfSize[0]=-1)}function d(e){return u.addWraparound(e,-2)}function p(e){return u.addWraparound(e,2)}function h(e,t){return 0===t?0:e/t|0}function f(e,t){return 0===t?e:e%t}function y(e){if(e)for(var t=0;t<e.length;t++)for(var r=0,n=b;r<n.length;r++){var i=n[r];if(i[0]===e[t].metricType)return{lodMetric:i[1],maxError:e[t].maxError}}return{lodMetric:0,maxError:0}}function _(e){return Math.sqrt(e*(4/Math.PI))}Object.defineProperty(t,"__esModule",{value:!0});var m=function(){function e(e,t,r,n,o,a,s,u,l,c){var d=this;this.layerUrl=e,this.streamDataController=n,this.viewportQueries=o,this.logger=a,this._isLoaded=s,this._isSelected=u,this._enable=l,this._needsUpdate=c,this._dirty=!0,this.nodePages=[],this.nodeCount=0,this.nodesPerPage=0,this.rootIndex=0,this.lodMetric=0,this.lodConversion=function(e){return e},this._loading=new Set,this._failedNodes=new Set,this._failedPages=new Set,this._indexMissing=1,this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.POSITIVE_INFINITY,this._nodeTraversalState={},this._version=0,this._visibilityCacheGeneration=p(0),this._maxLevel=1,this._featureEstimate={estimate:0,leafsReached:!1},this._unloadedMemoryEstimate=0,this._missing=new i({deallocator:null}),this._prefetch=new i({deallocator:null}),this._updates=new v,this.ignoreServiceOBB=!1,this.progressiveLoadPenalty=0,this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1,this.initNodePages(r).catch(function(){return d.initNodeDocuments(t)})}return e.prototype.initNodePages=function(e){if(!e)return o.reject();switch(this.nodesPerPage=e.nodesPerPage,this.rootIndex=e.rootIndex,e.lodSelectionMetricType){case"maxScreenThreshold":this.lodMetric=1;break;case"maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=_}var t=h(this.rootIndex,this.nodesPerPage);return this.loadPage(t)},e.prototype.initNodeDocuments=function(e){this.nodesPerPage=0,this.rootIndex=0,this.nodePages.push({nodes:[],children:[],parents:[]}),this.makeRefNode({id:e,mbs:null},-1)},e.prototype.loadPage=function(e){var t=this;this._loading.add(e);var r=this.layerUrl+"/nodepages/"+e;return this.streamDataController.request(r,"json").then(function(r){t._loading.delete(e),t.addPage(e,r)}).catch(function(r){return t._loading.delete(e),t._failedPages.add(e),o.reject(r)})},e.prototype.addPage=function(e,t){for(var r=this,n=this.nodePages.length;n<e;n++)this.nodePages[n]=null;var i=[],o=[],u=t.nodes.map(function(t,n){var u=i.length,c=t.children?t.children.length:0;o.push(-1);for(var p=0;p<c;p++)i.push(t.children[p]);var h=""+t.index,f=l.clone(t.obb),y=s.vec4f64.fromArray([f.center[0],f.center[1],f.center[2],a.vec3.length(f.halfSize)]),_=t.mesh&&t.mesh.attribute,m=t.mesh&&t.mesh.geometry,g=t.mesh&&t.mesh.material,v={hasSharedResource:!1,hasFeatureData:!!m,attributes:_&&null!=_.resource?""+_.resource:null,geometry:m&&null!=m.resource?""+m.resource:null,texture:g&&null!=g.resource&&g.texelCountHint>0?""+g.resource:null,geometryDefinition:m?m.definition:-1,materialDefinition:g?g.definition:-1},b={id:h,index:e*r.nodesPerPage+n,childCount:c,failed:!1,cacheState:0,obb:f,mbs:y,level:0,resources:v,lodMetric:r.lodMetric,maxError:r.lodConversion(t.lodThreshold),renderMbs:s.vec4f64.fromArray([0,0,0,-1]),renderObb:l.create([0,0,0],[-1,-1,-1],[0,0,0,1]),numFeatures:m?m.featureCount:null,vertexCount:m?m.vertexCount:null};return{childOffset:u,childCount:c,visibilityCache:d(r._visibilityCacheGeneration),ref:null,node:b}});this.nodePages[e]={nodes:u,children:i,parents:o},this.nodeCount+=u.length,this.updateParentsAndLevel()},e.prototype.updateParentsAndLevel=function(){var e=this,t=[],r=function(r,i,o){var a=e.getPage(r);if(n.isSome(a)){var s=f(r,e.nodesPerPage);a.parents[s]=i;var u=a.nodes[s].node;u&&(u.level=o,t.push(r))}};for(r(this.rootIndex,-1,0);t.length;)for(var i=t.pop(),o=this.getNode(i),a=0;a<o.childCount;a++){r(this.getChildIndex(o,a),i,o.level+1)}},e.prototype.getPage=function(e){return this.nodePages[h(e,this.nodesPerPage)]},e.prototype.getNodeInternal=function(e){var t=this.getPage(e);return n.isNone(t)?null:t.nodes[f(e,this.nodesPerPage)]},e.prototype.addNode=function(e,t){null!=e.children&&this.populateChildren(t,e.children);var r=this.getParent(t),i=r?r.level+1:1;this._maxLevel=Math.max(this._maxLevel,i);var o=y(e.lodSelection),a=o.lodMetric,u=o.maxError,c=n.expect(this.getNodeInternal(t));return c.node={id:e.id,index:t,mbs:s.vec4f64.fromArray(e.mbs),obb:e.obb&&l.clone(e.obb),childCount:c.childCount,level:i,resources:e.resources,version:e.version,lodMetric:a,maxError:u,memory:null,numFeatures:e.numFeatures,failed:!1,cacheState:0},null==c.ref.mbs&&(c.ref.mbs=e.mbs),c.node.renderMbs=c.ref.renderMbs,c.node.renderObb=c.ref.renderObb,c.node},e.prototype.makeRefNode=function(e,t){var r=this.nodePages[0],n=r.nodes.length;return r.nodes.push({childOffset:0,childCount:0,node:null,ref:e,visibilityCache:d(this._visibilityCacheGeneration)}),this.nodeCount++,r.parents.push(t),e.renderMbs=s.vec4f64.fromArray([0,0,0,-1]),e.renderObb=l.create([0,0,0],[-1,-1,-1],[0,0,0,1]),n},e.prototype.populateChildren=function(e,t){var r=n.expect(this.getNodeInternal(e)),i=n.expect(this.getPage(e));r.childOffset=i.children.length,r.childCount=t.length;for(var o=0;o<t.length;o++){var a=this.makeRefNode(t[o],e);i.children.push(a)}},e.prototype.getNode=function(e){var t=this.getNodeInternal(e);return n.isSome(t)&&t.node},e.prototype.getIndexById=function(e){var t;return this.forAllNodes(function(r,n){(r.node?r.node.id:r.ref.id)===e&&(t=n)}),t},e.prototype.getNodeById=function(e){var t=this.getIndexById(e),r=null!=t?this.getNodeInternal(t):null;return n.isSome(r)?r.node:null},e.prototype.getChildIndex=function(e,t){var r=this.getPage(e.index);if(n.isNone(r))return-1;var i=r.nodes[f(e.index,this.nodesPerPage)];return r.children[i.childOffset+t]},e.prototype.getParentIndex=function(e){var t=this.getPage(e);return n.isSome(t)?t.parents[f(e,this.nodesPerPage)]:-1},e.prototype.getParent=function(e){return(e=this.getParentIndex(e))>=0?this.getNode(e):null},Object.defineProperty(e.prototype,"rootNode",{get:function(){var e=this.getNodeInternal(this.rootIndex);return n.isSome(e)?e.node:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.nodeCount},enumerable:!0,configurable:!0}),e.prototype.invalidateVisibilityCache=function(e){if(null!=e){var t=this.getNodeInternal(e);n.isSome(t)&&(t.visibilityCache=d(this._visibilityCacheGeneration))}else this._visibilityCacheGeneration=p(this._visibilityCacheGeneration)},e.prototype.isNodeVisible=function(e){var t=this.getNodeInternal(e);if(n.isNone(t)||t.ref&&!t.ref.mbs)return!0;if(!function(e,t){return(-2&e)===t}(t.visibilityCache,this._visibilityCacheGeneration)){var r=this.viewportQueries.isNodeVisible(t.ref||t.node);return t.visibilityCache=function(e,t){return t+(e?1:0)}(r,this._visibilityCacheGeneration),r}return function(e){return 1==(1&e)}(t.visibilityCache)},e.prototype.isGeometryVisible=function(e){if(!this.isNodeVisible(e))return!1;var t=this.getNodeInternal(e);return!!n.isNone(t)||!(t.node&&t.ref&&!t.ref.obb)||this.viewportQueries.isGeometryVisible(t.node)},Object.defineProperty(e.prototype,"maxLevel",{get:function(){return this._maxLevel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this._updates.add.prune(),this._updates.update.prune()},e.prototype.requestUpdate=function(){this._dirty=!0,this._indexMissing=1,++this._version},e.prototype.update=function(e,t){var r=this;if(this._dirty){this._maxUnloadedPrio=Number.NEGATIVE_INFINITY,this._maxProcessingPrio=Number.NEGATIVE_INFINITY,this._missing.clear(),this._prefetch.clear(),this._updates.reset(e,this._missing),g.clear();var i=!0,o=new x,a=new x;this.traverseVisible(function(s,u){if(!u){var l=r.entryPriority(s),c=h(s,r.nodesPerPage);return g.set(c,Math.max(l,g.get(c)||0)),r._loading.has(c)||r._failedPages.has(c)||r._missing.push(c),void(r._maxProcessingPrio=Math.max(r._maxProcessingPrio,l))}var d=u.node;if(r._updateNodeFeatureEstimate(d,a),!d){var p=r.entryPriority(s);return r._loading.has(s)||r._failedNodes.has(s)||(r._missing.push(s),g.set(s,p)),void(r._maxProcessingPrio=Math.max(r._maxProcessingPrio,p))}var f=n.expect(r.getPage(s));if(0===r._missing.length&&0===r.nodesPerPage)for(var y=0;y<u.childCount;y++){var _=f.children[u.childOffset+y],m=r.getNodeInternal(_);!n.isSome(m)||m.node||r._loading.has(_)||(g.set(_,r.entryPriority(_)),r._prefetch.push(_))}if(!d.failed&&d.resources.hasFeatureData)if(r._isLoaded(s)){if(o.known+=d.memory,++o.knownNodes,r._isSelected(d)?u.childCount>0&&(i=!1):(o.unremoved+=d.memory,i=!1),r._needsUpdate(d)){var v=r.entryPriority(s);g.set(s,v),r._maxProcessingPrio=Math.max(r._maxProcessingPrio,v),r._updates.update.push(s)}}else if(d.memory&&(o.known+=d.memory,++o.knownNodes),r._isSelected(d)){if(u.childCount>0&&(i=!1),d.memory?(o.missing+=d.memory,o.known+=d.memory,++o.knownNodes):++o.missingNodes,e.indexOf(d.index)>=0)return r._maxProcessingPrio=Math.max(r._maxProcessingPrio,r.entryPriority(s)),void(r._updates.cancel=r._updates.cancel.filter(function(e){return e!==d.index}));if(!t.done&&r._enable(d))return void t.madeProgress();var b=r.entryPriority(s);g.set(s,b),r._maxProcessingPrio=Math.max(r._maxProcessingPrio,b),r._updates.add.push(s)}}),this._unloadedMemoryEstimate=o.missing-o.unremoved,o.knownNodes>3&&o.missingNodes>0&&(this._unloadedMemoryEstimate+=o.known/o.knownNodes*o.missingNodes),this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate),this._featureEstimate.estimate=this._computeFeatureEstimate(a),this._featureEstimate.leafsReached=i,this._missing.sort(function(e,t){return e-t}),this._missing.filterInPlace(function(e,t){return t<1||r._missing.data[t-1]!==e}),this._missing.sort(function(e,t){return g.get(e)-g.get(t)}),this._missing.length>0?(this._maxUnloadedPrio=g.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort(function(e,t){return g.get(e)-g.get(t)}),this._updates.add.filterInPlace(function(e){return g.get(e)>=r._maxUnloadedPrio}).sort(function(e,t){return g.get(e)-g.get(t)}),this._updates.update.sort(function(e,t){return g.get(e)-g.get(t)}),this._indexMissing=this._loading.size+this._missing.length,this._dirty=this._indexMissing>0,g.clear()}},e.prototype.checkFeatureTarget=function(e,t){for(var r=this.viewportQueries.updateScreenSpaceErrorBias(t),n=t,i=t,o=r,a=10;a--;){var s=new x;if(this._updateFeatureEstimate(n,s),this._computeFeatureEstimate(s)<=e){if(n>=t||s.missingNodes>0||0===a)break;o=n,n=.5*(n+i)}else i=n,n=.5*(n+o)}return++this._version,this.viewportQueries.updateScreenSpaceErrorBias(r),Math.min(t,n)},e.prototype._updateFeatureEstimate=function(e,t){var r=this;++this._version,this.viewportQueries.updateScreenSpaceErrorBias(e),this.traverseVisible(function(e,n){return r._updateNodeFeatureEstimate(n&&n.node,t)})},e.prototype._updateNodeFeatureEstimate=function(e,t){if(e&&!e.failed&&null!=e.numFeatures)return this._isLoaded(e.index)?(t.known+=e.numFeatures,++t.knownNodes,void(this._isSelected(e)||(t.unremoved+=e.numFeatures))):void(this._isSelected(e)&&(e.numFeatures?(t.missing+=e.numFeatures,t.known+=e.numFeatures,++t.knownNodes):++t.missingNodes))},e.prototype._computeFeatureEstimate=function(e){var t=e.known-e.unremoved;return e.knownNodes>3&&e.missingNodes>0&&(t+=e.known/e.knownNodes*e.missingNodes),Math.max(0,t)},e.prototype.load=function(e){if(0===this._missing.length)return!1;e=Math.min(e,this._missing.length);for(var t=0;t<e;++t)0===this.nodesPerPage?this._loadNode(this._missing.pop()):this.loadPage(this._missing.pop());return!0},e.prototype.prefetch=function(e){if(0===this._prefetch.length)return!1;e=Math.min(e,this._prefetch.length);for(var t=0;t<e;++t)this._loadNode(this._prefetch.pop());return!0},e.prototype.isLoading=function(){return this._indexMissing>0},e.prototype.getIndexLoading=function(){return this._loading.size},e.prototype.getIndexMissing=function(){return this._indexMissing},e.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),e.prototype.getFeatureEstimate=function(){return this._featureEstimate},e.prototype.nodeTraversalState=function(e){if(!e)return null;var t=this._nodeTraversalState[e.index];if(t&&t.version===this._version)return t;var r=this.viewportQueries.getLodLevel(e),n=this.viewportQueries.hasLOD(e),i=!0;if(n){var o=this.getParentIndex(e.index);if(o>=0){var a=this._nodeTraversalState[o];i=a&&r>a.lodLevel}else i=r>0}return t?(t.lodLevel=r,t.isChosen=i,t.version=this._version,t):(this._nodeTraversalState[e.index]={nodeHasLOD:n,lodLevel:r,isChosen:i,version:this._version},this._nodeTraversalState[e.index])},e.prototype._loadNode=function(e){var t=this;this._loading.add(e);var r=n.expect(this.getNodeInternal(e)).ref.id,i=this.layerUrl+"/nodes/"+r,a=function(){t._loading.delete(e),0===t._missing.length&&0===t._loading.size&&t.requestUpdate()};this.streamDataController.request(i,"json").then(function(n){var i=t._validateNode(r,n);if(null!=i){i.obb&&t.invalidateVisibilityCache(e);var o=t.addNode(i,e);t.nodeTraversalState(o),a()}else a()},function(r){o.isAbortError(r)||(t.logger.error("Error loading node: "+i),t._failedNodes.add(e)),a()})},e.prototype._validateNode=function(e,t){var r=this;if(null==t||"object"!=typeof t||t.id!==e)return this.logger.error('Invalid node. Wrong type or wrong id "'+e+'"'),null;t.sharedResource&&"./shared"!==t.sharedResource.href&&"./shared/"!==t.sharedResource.href&&this.logger.warn('Invalid shared resource href on node "'+e+'"'),null==t.geometryData||Array.isArray(t.geometryData)&&1===t.geometryData.length&&"./geometries/0"===t.geometryData[0].href||this.logger.warn('Invalid geometry data on node "'+e+'"'),null==t.attributeData||Array.isArray(t.attributeData)&&!t.attributeData.some(function(e,t){return e.href!=="./attributes/f_"+t+"/0"})||this.logger.warn('Invalid attribute data on node "'+e+'"'),t.featureData&&t.featureData.length>1&&this.logger.warn("Node "+e+" has "+t.featureData.length+" bundles. Only the first bundle will be loaded.");var n=t.hasOwnProperty("obb")&&!this.ignoreServiceOBB?t.obb:null,i=t.featureData&&1===t.featureData.length&&t.featureData[0].featureRange?t.featureData[0].featureRange[1]-t.featureData[0].featureRange[0]+1:null,o=Array.isArray(t.children)?t.children.map(function(t){if(null==t)return null;var n=function(t){return r.logger.error("Invalid node reference on node "+e+": "+t)};if("number"==typeof t.id)n("id "+t.id+" is a number instead of a string.");else if("string"!=typeof t.id||!Array.isArray(t.mbs))return n("Missing or invalid id."),null;if(!Array.isArray(t.mbs))return n("Invalid bounding volume on reference "+t.id+"."),null;t.href&&t.href!=="../"+t.id&&r.logger.error('Invalid node href on node "'+e+'"');var i=t.hasOwnProperty("obb")&&!r.ignoreServiceOBB?t.obb:null;return{id:""+t.id,mbs:t.mbs,obb:i}}).filter(function(e){return null!=e}):null;return{id:e,mbs:t.mbs,obb:n,children:o,resources:{hasFeatureData:t.featureData&&t.featureData.length>0,hasSharedResource:null!=t.sharedResource,attributes:t.attributeData?e:null,texture:t.textureData&&t.textureData.length>0?e:null,geometry:null!=t.geometryData?e:null},version:"string"==typeof t.version?t.version:null,lodSelection:Array.isArray(t.lodSelection)?t.lodSelection:null,numFeatures:i}},e.prototype.resetFailedNodes=function(){this._failedNodes.clear(),this._failedPages.clear(),this.forAllNodes(function(e){e.node&&(e.node.failed=!1)})},e.prototype.entryPriority=function(e){var t=this.getNodeInternal(e),r=this.getParentIndex(e);if(n.isNone(t)||r<0&&null==t.node)return r<0?1/0:this.entryPriority(r);var i=0;if(t.node&&r>=0){var o=this._nodeTraversalState[r];null!=o&&(i=o.lodLevel)}for(var a=this.progressiveLoadPenalty,s=e;s>=0;s=this.getParentIndex(s))if(this._isLoaded(s)){a=0;break}var u=this.viewportQueries.distToPOI(t.ref||t.node);return-u-i*(u+this.progressiveLoadPenalty)+a},e.prototype.traverseVisible=function(e){var t=this.getNodeInternal(this.rootIndex);n.isSome(t)?this._traverse(this.rootIndex,t,e):e(this.rootIndex,null)},e.prototype._traverse=function(e,t,r){if(t.node&&0===t.childCount)this.isGeometryVisible(e)&&r(e,t);else if(this.isNodeVisible(e)&&(r(e,t),null!=t.node)){var i=this.nodeTraversalState(t.node);if(!i.nodeHasLOD||i.lodLevel!==this._maxLodLevel)for(var o=n.expect(this.getPage(e)),a=0;a<t.childCount;a++){var s=o.children[t.childOffset+a],u=this.getNodeInternal(s);n.isSome(u)?this._traverse(s,u,r):r(s,null)}}},e.prototype.traverse=function(e,t){t(e)&&this.traverseChildren(e,t)},e.prototype.traverseChildren=function(e,t){var r=e.index,i=this.getNodeInternal(r);n.isSome(i)&&this._traverseChildren(r,i,t)},e.prototype._traverseChildren=function(e,t,r){var i=this.getPage(e);if(!n.isNone(i))for(var o=0;o<t.childCount;++o){var a=i.children[t.childOffset+o],s=this.getNodeInternal(a);n.isSome(s)&&s.node&&r(s.node)&&this._traverseChildren(a,s,r)}},e.prototype.updateStats=function(e){if(this._updates.add.length>0&&(e.nodes+=" + "+this._updates.add.length),(this._indexMissing||this._prefetch.length>0)&&(e.index+=" + "+this._indexMissing||!1),e.prio=this._maxProcessingPrio,this._featureEstimate.estimate){var t=this._featureEstimate.estimate-e.features;t>0?e.features+=" + "+t:t<0&&(e.features+=" - "+-t)}},e.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)},e.prototype.updateElevationInfo=function(e){this.forAllNodes(c),this.viewportQueries.updateElevationInfo(e)},e.prototype.invalidateBoundingVolumeCache=function(e){var t=this.getNodeInternal(e);n.isSome(t)&&c(t)},e.prototype.forAllNodes=function(e){for(var t=0;t<this.nodePages.length;t++){var r=this.nodePages[t];if(r)for(var n=t*this.nodesPerPage,i=0;i<r.nodes.length;i++)e(r.nodes[i],n+i)}},Object.defineProperty(e.prototype,"test",{get:function(){var e=this;return{addNode:function(t,r){return e.addNode(t,r)}}},enumerable:!0,configurable:!0}),e}();t.I3SIndex=m;var g=new Map,v=function(){function e(){this.update=new i({deallocator:null}),this.add=new i({deallocator:null}),this.cancel=[]}return e.prototype.reset=function(e,t){this.add.clear(),this.update.clear(),this.cancel=e,this.missing=t},e}(),b=[["maxScreenThreshold",1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];t.selectErrorMetric=y;var x=function(){return function(){this.known=0,this.knownNodes=0,this.missing=0,this.missingNodes=0,this.unremoved=0}}()}.apply(null,n))||(e.exports=i)},1567:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(86)],void 0===(i=function(e,t,r){var n=function(){function e(e,t){this.layerView=e,this.lodGlobalDirtyChanged=t}return e.prototype.startNodeLoading=function(e,t,r,n,i,o,a){this._lodGlobalDirty=!1,this._maxLodLevel=a.maxLodLevel,this._index=o,this._nodeTraversalState=n,this._isNodeVisible=e,this._isGeometryVisible=t,this._isNodeInScaleBounds=r,this._removeNodes=i,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.shouldLoadNode=function(e){var t=this._nodeTraversalState(e);return!!this.isChosenMaxLOD(t)||!!t.isChosen&&this._childrenRequireLoading(e)},e.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0,this.lodGlobalDirtyChanged(this._lodGlobalDirty)},e.prototype.lodSwapNodeLoaded=function(e){this.setLodGlobalDirty()},Object.defineProperty(e.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._index&&!0===this._lodGlobalDirty},enumerable:!0,configurable:!0}),e.prototype.lodGlobalHandling=function(e){if(this.requiresLODGlobalHandling){var t=this.layerView.view.resourceController.memoryController.usedMemory,r=Math.max(0,Math.floor(10*(t-1)));i.clear(),this._lodGlobalHandlingRecursion(this._index.rootNode,r),this._removeNodes(i,e),0===i.length&&(this._lodGlobalDirty=!1,this.lodGlobalDirtyChanged(this._lodGlobalDirty)),i.clear()}},e.prototype._lodGlobalHandlingRecursion=function(e,t){if(null==e)return!1;var r=this._nodeTraversalState(e),n=this.isChosenMaxLOD(r),o=this.layerView.isNodeLoaded(e.index);if(o&&null!=this.layerView.updateNodeStatus&&this.layerView.updateNodeStatus(e.index,n?"leaf":"hole"),n&&o)return this._removeChildrenRecursive(e),!0;var a=!1;if(e.childCount>0){a=!0;for(var s=0;s<e.childCount;s++){var u=this._index.getChildIndex(e,s),l=this._index.getNode(u);l?this._isGeometryVisible(u)&&!this._lodGlobalHandlingRecursion(l,t)&&this._isNodeInScaleBounds(l)&&(a=!1):this._isNodeVisible(u)&&(a=!1)}}o&&!n&&(a||i.length<t)&&(i.push(e.index),o=!1);var c=!e.resources.hasFeatureData;return a||o||c},e.prototype._removeChildrenRecursive=function(e){this._index.traverseChildren(e,function(e){return i.push(e.index),!0})},e.prototype.childrenEmpty=function(e){var t=this,r=!0;return this._index.traverseChildren(e,function(e){return!(!r||!t._isNodeVisible(e.index)||t.layerView.isNodeLoaded(e.index)&&(r=!1,1))}),r},e.prototype._childrenRequireLoading=function(e){var t=this,r=!1,n=!0;return this._index.traverseChildren(e,function(e){if(!n||!t._isNodeVisible(e.index))return!1;var i=t._nodeTraversalState(e);return t.isChosenMaxLOD(i)&&t._isGeometryVisible(e.index)&&(r=!0),!t.layerView.isNodeLoaded(e.index)||(n=!1,!1)}),n&&r},e.prototype.isChosenMaxLOD=function(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)},e}(),i=new r({deallocator:null});return n}.apply(null,n))||(e.exports=i)},1568:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(13),r(22),r(10),r(14),r(9),r(31),r(1540),r(1495),r(1477),r(18)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p){function h(e,t){if(!e||!t||!t.materialDefinitions)return e;var r=Object.keys(t.materialDefinitions)[0];return!t.materialDefinitions[r].params.vertexRegions&&e.vertexAttributes.region&&delete(e=o.clone(e)).vertexAttributes.region,e}function f(e,t){var r={bufferDefinition:null,bufferIndex:0};if(null==e||t.resources.geometryDefinition<0)return r;var n=t.resources.geometryDefinition>=0?e[t.resources.geometryDefinition].geometryBuffers:null;if(null==n)return r;for(var o=0;o<n.length;o++)if(null==n[o].compressedAttributes)r.bufferIndex=o,r.bufferDefinition=n[o];else if("draco"===n[o].compressedAttributes.encoding&&l.isSupported()&&!i("disable-feature:i3s-draco"))return r.bufferIndex=o,r.bufferDefinition=n[o],r;return r}function y(e,t){var r=[];return t&&t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture&&function(t){var n=a.isSome(e)&&e[t]&&e[t].formats;n&&r.push({id:""+t,encodings:n.map(function(e){var t=e.name,r=e.format;return{name:t,encoding:v[r]}})})}(t.pbrMetallicRoughness.baseColorTexture.textureSetDefinitionId),r}function _(e,t){var r,n=y(e,t),i=n[0]&&n[0].id,o=a.isSome(e)&&e[i]&&e[i].atlas,s="opaque"!==t.alphaMode,u=i?((r={})[i]={encoding:n[0].encodings.map(function(e){return e.encoding}),wrap:["none","none"],atlas:o,channels:s?"rgba":"rgb",images:[{id:i,size:0,href:n[0].encodings.map(function(e){return"../textures/"+e.name}),byteOffset:0,length:0}]},r):{},l=t.pbrMetallicRoughness,c=l&&l.baseColorFactor;return{textureDefinitions:u,materialDefinitions:{mat:{type:"standard",params:{diffuse:c?c.slice(0,3):[1,1,1],specular:[1,1,1,1],vertexRegions:o,doubleSided:t.doubleSided,cullFace:t.cullFace,transparency:c?1-c[3]:0,useVertexColorAlpha:s}}}}}function m(e){for(var t={},r=0,n=e;r<n.length;r++){var i=n[r];b[i]&&(t[b[i]]={valueType:null})}return{header:null,byteOffset:0,byteCount:0,vertexAttributes:t}}var g=function(){function e(e,t,r,n,i,o){if(this.streamDataController=t,this.logger=r,this.defaultGeometrySchema=n,this.requiredAttributes=i,this.options=o,this.layerUrl=e.parsedUrl.path,this.geometryDefinitions=e.geometryDefinitions,e.materialDefinitions){var a=e.textureSetDefinitions;this.materialTextures=e.materialDefinitions.map(function(e){return y(a,e)}),this.materialShared=e.materialDefinitions.map(function(e){return _(a,e)})}}return e.prototype.load=function(e,t,r){return this.streamDataController.request(e,t,{signal:r})},e.prototype.loadAttribute=function(e,t,r){var n=this.layerUrl+"/nodes/"+e.resources.attributes+"/attributes/"+t.key+"/0";return this.load(n,"binary",r).then(function(e){return c.readBinaryAttribute(t,e)})},e.prototype.loadAttributes=function(e,t,r){var n=this;return s.eachAlways(t.map(function(t){return n.loadAttribute(e,t.attributeStorageInfo,r)})).then(function(r){for(var i={},o=0;o<t.length;++o)r[o].value?i[t[o].name]=r[o].value:s.isAbortError(r[o].error)||n.logger.error("Failed to load attributeData for '"+t[o].name+"' on node '"+e.id+"'");return i})},e.prototype.loadNodeData=function(e,t){return n(this,void 0,void 0,function(){var n,i,o,a,u,l,d,p,y,_,g,v,b,x,I,w,A,S,C;return r(this,function(r){switch(r.label){case 0:return n=null!=this.requiredAttributes&&e.resources.attributes?this.loadAttributes(e,this.requiredAttributes,t):s.resolve({}),i=f(this.geometryDefinitions,e),o=i.bufferDefinition,a=i.bufferIndex,u=e.resources.geometry?this.loadGeometry(e,a,t):null,e.resources.hasSharedResource?[4,this.loadShared(e,t)]:[3,2];case 1:return d=r.sent(),[3,3];case 2:d=this.materialShared&&e.resources.materialDefinition>=0?this.materialShared[e.resources.materialDefinition]:null,r.label=3;case 3:return l=d,this.options.loadFeatureData?[4,this.loadFeatureData(e,t)]:[3,5];case 4:return y=r.sent(),[3,6];case 5:y=null,r.label=6;case 6:return p=y,_=this.options.loadFeatureData?this.collectGeometries(p):this.meshPyramidGeometryData(e,l),g=this.materialTextures&&e.resources.materialDefinition>=0?this.materialTextures[e.resources.materialDefinition]:this.getRequiredTexturesFromShared(_,l),v=this.options.loadTextureData?this.loadTextures(e,g,t):null,b=null,x=null,u?[4,u]:[3,8];case 7:b=r.sent(),I=h(this.defaultGeometrySchema,l),w=!(!o||!o.compressedAttributes||"draco"!==o.compressedAttributes.encoding),x=w?m(o.compressedAttributes.attributes):o?c.createGeometryIndexFromDefinition(o,e.vertexCount,e.numFeatures):c.createGeometryIndexFromSchema(b,I),r.label=8;case 8:return[4,v];case 9:return A=r.sent(),[4,n];case 10:return S=r.sent(),C=null,S&&(C={attributeData:S,loadedAttributes:this.requiredAttributes}),[2,{allGeometryData:_,attributeDataInfo:C,geometryBuffer:b,geometryIndex:x,sharedResource:l,requiredTextures:g,textureData:A}]}})})},e.addAbsoluteHrefTexture=function(e,t){var r=e.textureDefinitions;if(null!=r)for(var n=0,i=Object.keys(r);n<i.length;n++)for(var o=0,a=r[i[n]].images;o<a.length;o++){var s=a[o];Array.isArray(s.href)?s.hrefConcat=s.href.map(function(e){return u.makeAbsolute(e,t)}):s.hrefConcat=u.makeAbsolute(s.href,t)}},e.fixTextureEncodings=function(e){var t=e.textureDefinitions;if(null!=t)for(var r in t){var n=t[r];if(Array.isArray(n.encoding))for(var i=0;i<n.encoding.length;i++){var o;"data:"===(o=n.encoding[i]).substring(0,5)&&(n.encoding[i]=o.substring(5))}else"data:"===(o=n.encoding).substring(0,5)&&(n.encoding=o.substring(5))}},e.prototype.loadShared=function(t,r){var n=this.layerUrl+"/nodes/"+t.resources.geometry+"/shared";return this.load(n,"json",r).then(function(t){return e.fixTextureEncodings(t),e.addAbsoluteHrefTexture(t,n),t})},e.prototype.loadTexture=function(e,t,r,n,i){return n===d.DDS_ENCODING_STRING?this.load(e,"binary",i).then(function(e){return{i3sTexId:t,data:e,encoding:n}}):this.load(e,"image",i).then(function(e){var i=e;if(r&&e.width*e.height>=4096){var o=Math.ceil(e.width/2),a=Math.ceil(e.height/2),s=document.createElement("canvas");s.width=o,s.height=a,s.getContext("2d").drawImage(e,0,0,o,a),i=s}return{i3sTexId:t,data:i,encoding:n}})},e.prototype.loadTextures=function(t,r,n){var i=this,o=this.options.textureFormat===e.TextureFormat.Compressed,a=this.options.textureFormat===e.TextureFormat.Downsampled;return s.all(r.map(function(e){var r=d.selectEncoding(e.encodings,o);if(null==r)return i.logger.error("No known encoding for texture found on node "+t.id),s.reject();var u=t.resources.texture||t.id,l=i.layerUrl+"/nodes/"+u+"/textures/"+r.name;return i.loadTexture(l,e.id,a,r.encoding,n)}))},e.prototype.getRequiredTexturesFromShared=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n].geometries;if(null!=i)for(var o=this,a=0,s=i;a<s.length;a++){!function(e){var n=e.params.textureID||"none";if("none"!==n){null!=t.textureDefinitions&&null!=t.textureDefinitions[n]||o.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+n);var i=t.textureDefinitions[n];if(p.assert(void 0!==i,"geometry wants unknown texture "+n),0===i.images.length)return"continue";var a=i.images.length-1,s=i.images[a],u=function(e){return e&&e.split("/").pop()},l=Array.isArray(i.encoding)?i.encoding.map(function(e,t){return{name:u(s.href[t]),encoding:e}}):[{name:u(s.href),encoding:i.encoding}];r.push({id:n,encodings:l})}}(s[a])}}return r},e.prototype.meshPyramidGeometryData=function(e,t){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:t&&t.materialDefinitions?Object.keys(t.materialDefinitions)[0]:null,textureID:t&&t.textureDefinitions?Object.keys(t.textureDefinitions)[0]:null}}],featureDataPosition:[0,0,0]}]},e.prototype.collectGeometries=function(e){for(var t=new Array,r=0,n=e.featureData;r<n.length;r++){var i=n[r],o=i.geometries;if(null!=o)for(var a=0,s=o;a<s.length;a++){var u=s[a];t.push({featureIds:[i.id],featureDataPosition:i.position,geometries:[u]})}else null!=i.position&&t.push({featureIds:[i.id],featureDataPosition:i.position,geometries:null})}return t},e.prototype.loadFeatureData=function(e,t){var r=this.layerUrl+"/nodes/"+e.id+"/features/0";return this.load(r,"json",t)},e.prototype.loadGeometry=function(e,t,r){var n=this.layerUrl+"/nodes/"+e.resources.geometry+"/geometries/"+t;return this.load(n,"binary",r)},e}(),v={jpg:"image/jpeg",png:"image/png",dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"},b={position:"position",normal:"normal",uv0:"uv0",uv1:"uv1",color:"color","uv-region":"region"};return function(e){!function(e){e[e.Compressed=0]="Compressed",e[e.Normal=1]="Normal",e[e.Downsampled=2]="Downsampled"}(e.TextureFormat||(e.TextureFormat={}))}(g||(g={})),g}.apply(null,n))||(e.exports=i)},1569:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(9)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.requester=e,this.activeRequests=new Set}return e.prototype.request=function(e,t,i){var o=this,a=n.createAbortController();n.onAbortOrThrow(i,function(){return a.abort()}),i=r({},i,{signal:a.signal});var s=this.requester(e,t,i),u={response:s,abortController:a};return this.activeRequests.add(u),n.always(s,function(){return o.activeRequests.delete(u)}),s},e.prototype.cancelAll=function(){this.activeRequests.forEach(function(e){return e.abortController.abort()}),this.activeRequests.clear()},e}();t.I3SStreamDataController=i,t.default=i}.apply(null,n))||(e.exports=i)},1570:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(4),r(3),r(55),r(33),r(95),r(373),r(172),r(90),r(1477),r(30),r(1489),r(38)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p,h){return function(){function e(e,t,r,i,o,s,u){void 0===u&&(u={}),this.indexSR=e,this._renderCoordsHelper=t,this.extent=i,this.elevationProvider=o,this.options=u,this.fp=d.frustum.create(),this._poi=n.vec3f64.create(),this.minDistance=1/0,this.maxDistance=0,this.maxLodLevel=2,this._tmp1=n.vec3f64.create(),this._tmp2=n.vec3f64.create(),this._tmp3=n.vec3f64.create(),this._tmp0=n.vec3f64.create(),this.screenspaceErrorBias=u.screenspaceErrorBias||1,this.progressiveLoadFactor=u.progressiveLoadFactor||1,this.updateCamera(r),this.engineSR=this._renderCoordsHelper.spatialReference,this.updateElevationInfo(s.elevationInfo),this.tmpPoint=a.makeDehydratedPoint(0,0,0,e)}return e.prototype.updateElevationInfo=function(e){null!=e?(this._elevationContext=new s,this._elevationContext.featureExpressionInfoContext=u.createContext(u.extractExpressionInfo(e,!1)),this._elevationContext.mixinApi(e)):this._elevationContext=null},e.prototype.updateCamera=function(e){d.frustum.fromMatrix(e.viewMatrix,e.projectionMatrix,this.fp),this._screenSizeFactor=1/(e.perScreenPixelRatio/2),this._camPos=e.eye,this.minDistance=1/0,this.maxDistance=0},e.prototype.setPointOfInterest=function(e){r.vec3.copy(this._poi,e)},e.prototype.updateScreenSpaceErrorBias=function(e){var t=this.screenspaceErrorBias;return this.screenspaceErrorBias=e,t},e.prototype.updateExtent=function(e){this.extent=e},e.prototype.getRenderMbs=function(e){var t=e.renderMbs;return t||(t=o.vec4f64.fromValues(e.mbs[0],e.mbs[1],e.mbs[2],-1),e.renderMbs=t),t[3]<0&&(i.vec4.copy(t,e.mbs),this._elevationContext&&t[3]<1e5&&(this.tmpPoint.x=t[0],this.tmpPoint.y=t[1],this.tmpPoint.z=t[2],t[2]=l.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),h.mbsToMbs(t,this.indexSR,t,this.engineSR)),t},e.prototype.getRenderObb=function(e){if(e.obb&&!(e.obb.halfSize[0]<0)&&e.renderObb){var t=e.renderObb;return t.halfSize[0]<0&&(p.set(e.obb,t),this._elevationContext&&e.mbs[3]<1e5&&(this.tmpPoint.x=e.obb.center[0],this.tmpPoint.y=e.obb.center[1],this.tmpPoint.z=e.obb.center[2],t.center[2]=l.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),h.bufferToBuffer(t.center,this.indexSR,0,t.center,this.engineSR,0,1)),t}},e.prototype.isNodeVisible=function(e){var t=this.getRenderMbs(e);if(!this.isMBSinExtent(t))return!1;if(e.obb){var r=this.getRenderObb(e);return p.isVisible(r,this.fp)}return this.isMBSVisible(t)},e.prototype.isGeometryVisible=function(e){var t=this.getRenderObb(e);return!t||p.isVisible(t,this.fp)},e.prototype.isMBSinExtent=function(e){return!this.extent||0!==c.intersectBoundingBoxWithMbs(this.extent,e)},e.prototype.isMBSVisible=function(e){return d.frustum.intersectsSphere(this.fp.planes,d.sphere.wrap(e[3],e))},e.prototype.screenSpaceDiameterMbs=function(e,t){var n=this.getRenderMbs(e),i=Math.sqrt(r.vec3.squaredDistance(n,this._camPos)),o=i-n[3];return this._updateMinMaxDistance(i),o<0?.5*Number.MAX_VALUE:t/o*this._screenSizeFactor},e.prototype.calcCameraDistance=function(e){return this.calcCameraDistanceToCenter(e)-this.getRenderMbs(e)[3]},e.prototype.calcCameraDistanceToCenter=function(e){var t=this.getRenderMbs(e),n=r.vec3.distance(t,this._camPos);return this._updateMinMaxDistance(n),n},e.prototype.calcAngleDependentLoD=function(e){var t=this.getRenderMbs(e),n=t[3],i=(Math.abs(t[0]*(t[0]-this._camPos[0])+t[1]*(t[1]-this._camPos[1])+t[2]*(t[2]-this._camPos[2]))/r.vec3.length(t)+n)/r.vec3.distance(t,this._camPos);return Math.min(1,i)},e.prototype.hasLOD=function(e){return 0!==e.lodMetric},e.prototype.getDistancePlanarMode=function(e,t){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=r*r+n*n,a=t[3];if(o<=a*a)return Math.abs(i);var s=Math.sqrt(o)-a;return Math.sqrt(i*i+s*s)},e.prototype.getDistanceGlobeMode=function(e,t){var n=r.vec3.length(t),i=r.vec3.length(e)-n;r.vec3.scale(this._tmp0,e,r.vec3.dot(e,t)/r.vec3.squaredLength(e));var o=r.vec3.squaredDistance(t,this._tmp0),a=t[3];if(o<=a*a)return Math.abs(i);var s=r.vec3.scale(this._tmp0,t,1/n),u=n,l=a*a/2/u,c=r.vec3.scale(this._tmp1,s,u-l),d=e,p=r.vec3.subtract(this._tmp2,d,c),h=r.vec3.subtract(this._tmp2,p,r.vec3.scale(this._tmp3,s,r.vec3.dot(s,p))),f=r.vec3.add(this._tmp2,c,r.vec3.scale(this._tmp2,h,a/r.vec3.length(h))),y=r.vec3.distance(d,f);if(i>=2e5){var _=r.vec3.subtract(this._tmp1,d,f),m=r.vec3.dot(_,s)/r.vec3.length(_);m<.08&&(m=1e-4),y/=m}return y},e.prototype.getDistance=function(e,t){return this.engineSR===h.SphericalECEFSpatialReference?this.getDistanceGlobeMode(e,t):this.getDistancePlanarMode(e,t)},e.prototype._updateMinMaxDistance=function(e){e>0?(this.minDistance=Math.min(this.minDistance,e),this.maxDistance=Math.max(this.maxDistance,e)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-e))},e.prototype.getLodLevel=function(e){if(0===e.lodMetric||!e.resources.hasFeatureData)return 0;if(0===e.childCount)return this.maxLodLevel;if(this.progressiveLoadFactor<1){var t=this.progressiveLoadFactor*this.screenspaceErrorBias,r=this.screenspaceErrorBias;return this.evaluateLODmetric(e,t)?this.evaluateLODmetric(e,r)?2:1:0}return this.evaluateLODmetric(e,this.screenspaceErrorBias)?this.maxLodLevel:0},e.prototype.evaluateLODmetric=function(e,t){switch(e.lodMetric){case 2:var r=this.getRenderMbs(e),n=this.getDistance(this._camPos,r),i=2*n/this._screenSizeFactor,o=n+r[3];return this._updateMinMaxDistance(o),e.maxError*t<=i;case 1:var a=this.screenSpaceDiameterMbs(e,e.mbs[3]*t);return this.options.angleDependentLoD&&(a*=this.calcAngleDependentLoD(e)),a<e.maxError;case 3:return this.screenSpaceDiameterMbs(e,e.maxError)*t<10;case 4:return this.calcCameraDistance(e)>e.maxError*t}return!1},e.prototype.distToPOI=function(e){var t=this.getRenderMbs(e);return r.vec3.distance(t,this._poi)-t[3]},e.prototype.distCameraToPOI=function(){return r.vec3.distance(this._camPos,this._poi)},e}()}.apply(null,n))||(e.exports=i)},1583:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(19),r(4),r(3),r(49),r(38),r(271)],void 0===(i=function(e,t,r,n,i,o,a,s){function u(e,t,r){var n,a,s,u=i.vec3f64.create(),l=e[3],c=Math.ceil(Math.log(l)*Math.LOG2E/h),d=Math.pow(2,c*h+p);if(r.isGeographic){var f=d/o.earthRadius*180/Math.PI;a=Math.round(e[1]/f);var y=Math.max(-90,Math.min(90,a*f)),_=f/Math.cos((Math.abs(y)-f/2)/180*Math.PI),m=(n=Math.round(e[0]/_))*_;u[0]=m,u[1]=y}else n=Math.round(e[0]/d),a=Math.round(e[1]/d),u[0]=n*d,u[1]=a*d;var g=e[2]+t;return s=Math.round(g/d),u[2]=s*d,{center:u,id:c+"_"+n+"_"+a+"_"+s}}Object.defineProperty(t,"__esModule",{value:!0});var l=1e3,c=new Float64Array(3*l),d=i.vec3f64.create();t.computeGlobalTransformation=function(e,t,n,i){var o=u(e,t,n).center,s=r.mat4f64.create();return a.computeLinearTransformation(n,o,s,i),s},t.reprojectPoints=function(e,t,r,i,o,s,u){var p=e.data,h=e.offsetIdx,f=e.strideIdx;n.vec3.copy(d,t),d[2]+=i;var y=[0,0,0],_=p.length/f;a.vectorToVector(d,o,y,s);for(var m=0;m<_;m+=l){for(var g=Math.min(l,_-m),v=0;v<g;v++){var b=h+f*(m+v);c[3*v+0]=p[b+0]+y[0],c[3*v+1]=p[b+1]+y[1],c[3*v+2]=p[b+2]+y[2]}for(a.bufferToBuffer(c,s,0,c,u,0,g),v=0;v<g;v++){var x=c[3*v+0],I=c[3*v+1],w=c[3*v+2],A=h+f*(m+v);p[A+0]=r[0]*x+r[4]*I+r[8]*w+r[12],p[A+1]=r[1]*x+r[5]*I+r[9]*w+r[13],p[A+2]=r[2]*x+r[6]*I+r[10]*w+r[14]}}},t.createOrigin=function(e,t,r,n){var i=u(e,t,r),o=i.center,l=i.id;return a.vectorToVector(o,r,o,n),s.fromVector(o,l)};var p=1,h=5-p}.apply(null,n))||(e.exports=i)},1623:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(2),r(1),r(11),r(13),r(23),r(84),r(52),r(28),r(37),r(348),r(22),r(207),r(12),r(24),r(14),r(201),r(9),r(353),r(59),r(108),r(111),r(69),r(29),r(352),r(0),r(19),r(4),r(3),r(43),r(1564),r(1493),r(354),r(138),r(370),r(1422),r(78),r(1624),r(1625),r(1583),r(1477),r(1626),r(1518),r(379),r(1482),r(591),r(16),r(1489),r(38),r(98),r(79),r(80),r(365),r(112),r(572),r(136),r(18),r(587),r(1627),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p,h,f,y,_,m,g,v,b,x,I,w,A,S,C,D,E,O,P,M,N,T,F,R,j,V,G,L,U,B,k,z,q,Q,H,W,J,Y,K,X,Z,$,ee,te,re,ne,ie,oe,ae,se){function ue(e){return m.isSome(e)&&w.isArrayBuffer(e.data)}function le(e,t){for(var r=1024,n=0,i=e;n<i.length;n++){var o=i[n];r+=o.interleavedVertexData.byteLength+(o.indices?o.indices.byteLength:0),r+=o.positionData.data.byteLength+o.positionData.indices.byteLength}if(m.isSome(t))for(var a=0,s=t;a<s.length;a++){var u=s[a];m.isSome(u)&&w.isArrayBuffer(u.data)&&(r+=u.data.byteLength)}return r}function ce(e,t){return t.byteSize>_e?(pe.warn("Node is too big to store in IndexedDB cache: "+e.id+" ("+t.byteSize+" bytes)"),!1):t.byteSize>0}Object.defineProperty(t,"__esModule",{value:!0});var de=Z.ModelContentType,pe=y.getLogger("esri.views.3d.layers.SceneLayerView3D"),he=[1,1,1,1],fe=[.8,.8,.8],ye=function(){return function(){}}(),_e=104857600,me=function(t){function s(){var e=null!==t&&t.apply(this,arguments)||this;return e._layerUid="",e._highlights=new L(e),e._elevationProvider=null,e._worker=new V,e._workerThread=null,e._nodeId2Meta=new Map,e._addTasks=new Map,e._rendererVersion=0,e._rendererFields=null,e._colorVariable=null,e._opacityVariable=null,e._symbolInfos=new Map,e._idbCache=new z.IDBCache("esri-scenelayer-cache","geometries"),e._cancelCount=0,e._hasColors=!1,e._hasTextures=!1,e._hasData=!1,e.slicePlaneEnabled=!1,e._layerUrl="",e._cacheKeySuffix=null,e._tmpAttributeOnlyGraphic=new u(null,null,{}),e}return n(s,t),Object.defineProperty(s.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"rendererNeedsTextures",{get:function(){return k.rendererNeedsTextures(this._currentRenderer)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"elevationOffset",{get:function(){var e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"absolute-height"===e.mode){var t=A.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=j.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"useCompressedTextures",{get:function(){var e=this.layer.version,t=!h("trident")||e.major>1||1===e.major&&e.minor>3;return this.view._stage.renderView.has("s3tc")&&t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.renderView.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0}),s.prototype.initialize=function(){var t=this;if(C.open(b.getAbsMid("./SceneLayerWorker",e,se)).then(function(e){t.destroyed?e.close():t._workerThread=e}),k.checkSceneLayerValid(this.layer),k.checkSceneLayerCompatibleWithView(this.layer,this.view),this._layerUid=this.layer.uid,this._layerUrl=this.layer.parsedUrl.path,this._controller=new N({layerView:this}),this.gpuMemoryEstimate=0,this.texMemoryEstimate=0,this.geoMemoryEstimate=0,this._stage=this.view._stage,this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var r=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(r&&r.faceRange&&r.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color),this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView()),this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid,function(e){return t._deleteNodeStageData(e)}),this._addThisLayerToStage(),this._elevationProvider=new U({layerView:this,stageLayer:this._stageLayer}),this.handles.add([S.init(this.view,"clippingArea",function(){return t._clippingAreaChanged()}),S.watch(this,"fullOpacity",function(e){return t._opacityChange(e)}),S.watch(this,"slicePlaneEnabled",function(e){return t._slicePlaneEnabledChange(e)}),S.watch(this,"elevationOffset",function(e,r){return t._reloadAll(r)}),S.init(this,"filter",function(){return t._filterChange()}),S.watch(this,["rendererNeedsTextures","uncompressedTextureDownsamplingEnabled"],function(){t._reloadAll(),t._memCache.clear()}),S.init(this,"suspended",function(e){return t._suspendedChange(e)})],"sceneLayerHandles"),this._cacheKeySuffix=k.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference),this._idbCache.init().catch(function(e){return pe.warn("Failed to initialize IndexedDB cache: "+e)}),this._componentColorManager=this._hasSymbolColors?new oe.BufferManager(this._stage.renderView.renderingContext):null},s.prototype.destroy=function(){this.handles.remove("sceneLayerHandles"),this._workerThread&&(this._workerThread.close(),this._workerThread=null),this._removeAllNodeDataFromStage(),this._memCache.destroy(),this._memCache=null,this._removeThisLayerFromStage(),this._stage=null,this._idbCache&&(this._idbCache.destroy(),this._idbCache=null),null!=this._controller&&(this._controller.destroy(),this._controller=null),this._highlights.destroy(),this._nodeId2Meta=null,this.emit("visible-geometry-changed"),this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)},s.prototype.memEstimateTextureAdded=function(e){var t=e.getEstimatedTexMemRequired();return this.gpuMemoryEstimate+=t,this.texMemoryEstimate+=t,t},s.prototype.memEstimateTextureRemoved=function(e){var t=e.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=t,this.texMemoryEstimate-=t},s.prototype.memEstimateGeometryAdded=function(e){var t=e.estimateGpuMemoryUsage();return this.gpuMemoryEstimate+=t,this.geoMemoryEstimate+=t,t},s.prototype.memEstimateGeometryRemoved=function(e){var t=e.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=t,this.geoMemoryEstimate-=t},s.prototype.isNodeLoaded=function(e){return this._nodeId2Meta.has(e)},s.prototype.getUsedMemory=function(){var e=0;return this._nodeId2Meta.forEach(function(t){return e+=t.node.memory}),e},s.prototype.getUnloadedMemory=function(){return this._controller?this._controller.unloadedMemoryEstimate:0},s.prototype.ignoresMemoryFactor=function(){return!1},s.prototype._suspendedChange=function(e){e?(this._removeAllNodeDataFromStage(),this.view.elevationProvider.unregister(this._elevationProvider)):this.view.elevationProvider.register(this._elevationContext,this._elevationProvider)},s.prototype.getStats=function(){var e={index:0,nodes:this._nodeId2Meta.size.toString(),"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};return this._controller&&(this._cachingEnabled()&&(e.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(e)),e},s.prototype._addThisLayerToStage=function(){for(var e=this._stage,t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;var n=""+this.layer.uid,i=new ee(n,{},n);this._stageLayer=i,e.add(de.LAYER,i),this._stage.addToViewContent([i.id])},s.prototype._removeThisLayerFromStage=function(){if(null!=this._stageLayer){var e=this._stage;this._removeAllNodeDataFromStage(),ie.verify(0===this._nodeId2Meta.size),e.remove(de.LAYER,this._stageLayer.id),this._stageLayer=void 0,this.gpuMemoryEstimate=0}},s.prototype.getLoadedAttributes=function(e){var t=this._nodeId2Meta.get(e);if(t&&t.attributeInfo)return t.attributeInfo.loadedAttributes},s.prototype.getAttributeData=function(e){var t=this._nodeId2Meta.get(e);if(t&&t.attributeInfo)return t.attributeInfo.attributeData},s.prototype.setAttributeData=function(e,t){var r=this._nodeId2Meta.get(e);r&&(r.attributeInfo=t,r.cachedRendererVersion=this._getInvalidRendererVersion(),r.filteredIds=null,this._updateEngineObject(r))},s.prototype.getLoadedNodeIds=function(){var e=[];return this._nodeId2Meta.forEach(function(t){return e.push(t.node.id)}),e.sort()},s.prototype.getLoadedNodeIndices=function(e){this._nodeId2Meta.forEach(function(t,r){return e.push(r)})},s.prototype._calcEngineMaterialTransparencyParams=function(e,t,r){if(this._isIntegratedMesh)return{forceTransparency:!1};var n=this.fullOpacity,i=1-_.clamp(ie.fallbackIfUndefined(t.transparency,0),0,1);return{baseColorOpacity:i,layerOpacity:n,forceTransparency:!!(i<1||n<1||e&&I.endsWith(e.channels,"a")||!0===t.useVertexColorAlpha||r)}},s.prototype._calcEngineMaterialDoubleSidedParams=function(e){return null==e.doubleSided||e.doubleSided},s.prototype._calcEngineMaterialCullFaceParams=function(e){return e.cullFace?e.cullFace:null!=e.doubleSided?e.doubleSided?"none":"back":"none"},s.prototype._getMaterialParameters=function(e,t,n){var i=t.params,o=ie.fallbackIfUndefined(i.diffuse,fe);"standard"!==t.type&&pe.warn("Unknown material type '"+t.type+"', must be 'standard'");var a=this._isIntegratedMesh,s=this._calcEngineMaterialTransparencyParams(e,i);return r({baseColor:o,baseColorTexture:n,doubleSidedShading:this._calcEngineMaterialDoubleSidedParams(i),cullFace:this._calcEngineMaterialCullFaceParams(i),writeStencil:a,receiveSSAO:!a,normals:a?"ground":"vertex"},s)},s.prototype._getGeometryParameters=function(e){return{textureCoordinates:e.hasTexture,textureCoordinateRegions:e.hasTexture&&e.hasRegions,colors:this._hasVertexColors,componentData:this._hasSymbolColors,normals:this._isIntegratedMesh?"none":e.hasNormals?"compressed":"screen-space"}},s.prototype._createTexture=function(e,t,r,n,i){if(null==t||m.isNone(n))return null;var o=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(m.isSome(i)&&i.i3sTexId===t)return i}return null}(n,r),a=o.data,s=o.encoding;if(null==a)return null;var u,l="none"!==t.wrap[0]||"none"!==t.wrap[1],c="rgba"===t.channels,d=!0;if(s===k.DDS_ENCODING_STRING)u=ne.DDS_ENCODING;else{var p=a;d=J.isPowerOfTwo(p.width)&&J.isPowerOfTwo(p.height)}var h=i||!0===t.atlas,f=(h?this._enableAtlasMipMaps:this._enableMipMaps)&&d,y=h||!l,_=h&&f&&this._disableAtlasAnisotropy,g=new ne(a,r,{mipmap:f,wrap:y?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:_,encoding:u,noUnpackFlip:!0,components:c?4:3});return this._stage.add(de.TEXTURE,g),e.memory+=this.memEstimateTextureAdded(g),g},s.prototype._getVertexBufferLayout=function(e,t,r){var n=e.params.textureID||"none",i={hasTexture:"none"!==n&&null!=t.textureDefinitions[n],hasNormals:null!=r.vertexAttributes.normal,hasRegions:null!=r.vertexAttributes.region};return X.glLayout(ae.ComponentMaterial.vertexBufferLayout(this._getGeometryParameters(i)))},s.prototype._createEngineMaterial=function(e,t,r,n,i){var o=t.params.materialID,a=r.materialDefinitions[o];ie.assert(void 0!==a,"geometry wants unknown material "+o);var s,u=t.params.textureID||"none";"none"!==u&&(null!=r.textureDefinitions&&null!=r.textureDefinitions[u]||pe.warn("textureDefinitions missing in shared resource"),s=r.textureDefinitions[u]);var l=a.params.vertexRegions,c=null!=s?this._createTexture(e,s,u,n,l):null,d=this._getMaterialParameters(s,a,c&&c.id),p=this._getGeometryParameters({hasTexture:null!=s,hasRegions:i.some(function(e){return"region"===e.name}),hasNormals:i.some(function(e){return"normal"===e.name||"normalCompressed"===e.name})}),h=ae.ComponentMaterial.create(d,p,o);return h.metadata={i3sTex:s,i3sMatParams:a.params,engineTex:c},h},s.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},s.prototype._findGraphicNodeAndIndex=function(e){var t=q.attributeLookup(e.attributes,this._getObjectIdField()),r=null;return f.everyMap(this._nodeId2Meta,function(e,n){var i=e.featureIds.indexOf(t);return-1===i||(r={node:e.node,index:i},!1)}),r},s.prototype._getGraphicIndices=function(e,t){var r=this._nodeId2Meta.get(e.index);if(!r)return[];for(var n=[],i=this._getObjectIdField(),o=0,a=t;o<a.length;o++){var s=a[o],u=q.attributeLookup(s.attributes,i),l=r.featureIds.indexOf(u);-1!==l&&n.push(l)}return n},s.prototype.whenGraphicBounds=function(e){var t=this._findGraphicNodeAndIndex(e);if(!t)return v.reject();var r=this._nodeId2Meta.get(t.node.index).engineObject,n=this._boundingBoxCornerPoints(t.index,r,new Float64Array(24));if(K.bufferToBuffer(n,this.view.renderSpatialReference,0,n,this.view.spatialReference,0,8)){var i=M.empty();return M.expandWithBuffer(i,n,0,8),v.resolve({boundingBox:i,screenSpaceObjects:[]})}},s.prototype.whenGraphicAttributes=function(e,t){var r=this;return k.whenGraphicAttributes(this.layer,e,this._getObjectIdField(),t,function(e){for(var t=new Map,n=[],i=0,o=e;i<o.length;i++){var a=o[i],s=r._findGraphicNodeAndIndex(a),u=t.get(s.node);u||(u={node:s.node,indices:[],graphics:[]},n.push(u)),u.indices.push(s.index),u.graphics.push(a)}return n},{ignoreUnavailableFields:!0,populateObjectId:!0})},s.prototype.getGraphicFromStageObject=function(e,t){if(this._isIntegratedMesh)return null;var r=this._getMetadata(e),n=e.getComponentFromTriangleNr(0,t);return null!=n&&null!=r.featureIds&&n<r.featureIds.length?this._createGraphic(n,r):null},s.prototype.hasStageObject=function(e){var t=e.getMetadata(),r=this._nodeId2Meta.get(t.nodeIndex);return r&&r.engineObject===e},s.prototype._getMetadata=function(e){var t=e.getMetadata();return this._nodeId2Meta.get(t.nodeIndex)},s.prototype._getCacheKey=function(e){return this._layerUrl+"/v2/"+e.id+this._cacheKeySuffix},s.prototype._getMemCacheKey=function(e,t){return void 0===t&&(t=this.elevationOffset),e+"#"+t},s.prototype._cachingEnabled=function(){return!this._controller.disableIDBCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix},s.prototype.additionalCancelNodeLoadingHandler=function(){this._cancelCount=k.addWraparound(this._cancelCount,1)},s.prototype._handleCancelled=function(e){if(k.addWraparound(this._cancelCount,-e)>0)throw v.createAbortError()},s.prototype.loadCachedGPUData=function(e){return this._memCache.pop(this._getMemCacheKey(e.index))},s.prototype.loadCachedNodeData=function(e,t){var r=this,n=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(e)).then(function(i){return null==i?null:(r._handleCancelled(n),i.nodeVersion!==e.version?(r._idbCache.remove(r._getCacheKey(e)),null):(e.obb||(e.obb=Y.clone(i.nodeObb),r._controller.updateVisibility(e.index)),r.rendererNeedsTextures&&function(e,t){for(var n=0;n<e.length;n++){if(m.isNone(t))return!0;var i=k.selectEncoding(e[n].encodings,r.useCompressedTextures),o=t[n];if(m.isNone(o)||null==o.data||i&&o.encoding!==i.encoding)return!0}return!1}(i.requiredTextures,i.textureData)?t(i.requiredTextures).then(function(t){return i.textureData=t,i.byteSize=le(i.transformedGeometries,i.textureData),t.every(ue)&&ce(e,i)&&r._idbCache.initialized&&r._idbCache.put(r._getCacheKey(e),i).catch(function(t){return pe.warn("Failed to update node with textures in IndexedDB cache: "+e.id+": "+t)}),r._handleCancelled(n),i}):i))}):v.resolve(null)},s.prototype.addNodeData=function(e,t){var n=this;return 0===t.allGeometryData.length||0===t.allGeometryData[0].geometries.length?v.resolve():(1!==t.allGeometryData.length&&console.warn("Node with",t.allGeometryData.length,"geometries is unsupported"),this._addData(e,t.attributeDataInfo,function(){return n._transformNode(e,t).then(function(t){return n._controller.reschedule(e.index,t)}).then(function(i){e.obb||(e.obb=i.obb,n._controller.updateVisibility(e.index)),t.allGeometryData[0].componentOffsets=i.componentOffsets,i.featureIds&&(t.allGeometryData[0].featureIds=Array.prototype.slice.call(i.featureIds));var o={geometryData:t.allGeometryData[0],transformedGeometries:i.transformedGeometries,requiredTextures:t.requiredTextures,textureData:t.textureData,sharedResource:t.sharedResource,nodeVersion:e.version,nodeObb:e.obb,byteSize:n._cachingEnabled()?le(i.transformedGeometries,t.textureData):0};if(ce(e,o)&&n._idbCache.initialized){var a=m.isSome(o.textureData)?o.textureData.map(function(e){return ue(e)?e:null}):null;n._idbCache.put(n._getCacheKey(e),r({},o,{textureData:a})).catch(function(t){return pe.warn("Failed to store node in IndexedDB cache: "+e.id+": "+t)})}return n._addCachedNodeData(e,o)})}))},s.prototype._transformNode=function(e,t){for(var r=this,n=t.allGeometryData[0].geometries,i=new Array(n.length),o=0;o<n.length;++o)i[o]=this._getVertexBufferLayout(n[o],t.sharedResource,t.geometryIndex);var a={geometryBuffer:t.geometryBuffer,geometryData:t.allGeometryData[0],geometryIndex:t.geometryIndex,layouts:i,mbs:e.mbs,obb:e.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",a,{transferList:[t.geometryBuffer]}):V.ensureDracoDecoder(a).then(function(){return r._controller.reschedule(e.index,a).then(function(e){return r._worker.transform(e)})})},s.prototype.addCachedGPUData=function(e,t,r){if(this._controller.isGeometryVisible(e)){this._nodeId2Meta.set(e.index,t),this.updateNodeStatus(e.index,r),t.engineObject.setHidden(t.engineObject.geometryRecords[0],!1);for(var n=0,i=t.engineObject.getGeometryRecords();n<i.length;n++)i[n].material.updateParameters({slicePlaneEnabled:this.slicePlaneEnabled});this._updateEngineObject(t),this._highlights.objectCreated(t.engineObject)}else{var o=this._controller.indexDepth-e.level+1;this._memCache.put(this._getMemCacheKey(e.index),t,e.memory,o)}},s.prototype.addCachedNodeData=function(e,t,r){var n=this;return this._addData(e,r,function(){return n._addCachedNodeData(e,t)})},s.prototype._addCachedNodeData=function(e,t){var r=this;if(this.suspended||!this._controller.isGeometryVisible(e))return v.resolve();var n=t.geometryData,i=t.transformedGeometries,o=t.sharedResource,a=this.rendererNeedsTextures?t.textureData:null,s={};s[de.OBJECT]={},s[de.GEOMETRY]={},s[de.MATERIAL]={};var u=0,l=!1;e.memory=0;var c=n.componentOffsets,d=n.geometries,p=n.featureIds,h=null,f=null;if(this._hasSymbolColors){h=this._componentColorManager.getBuffer(p.length),f=new Uint16Array(p.length);for(var y=0;y<p.length;y++)f[y]=h.acquireIndex()}for(var _,m=e.id+"|"+p[0],g=new Array,b=new Array,x=new Array,I=new Array,w=this.view,A=0,S=d;A<S.length;A++){var C=S[A],D=i[u++],O=this._createEngineMaterial(e,C,o,a,D.layout);_=D.corMatrices.globalTrafo,l=l||D.hasColors;var P=new re(new Float32Array(D.interleavedVertexData),D.layout,D.positionData,c||re.DefaultOffsets,D.indices||re.DefaultIndices);this._hasSymbolColors&&this._setComponentIndices(P,f);var M=null!=C.transformation?E.mat4f64.clone(C.transformation):ge,N=g.length,T=new $(P,m+(N>0?"_"+N:"")),F=w.renderSpatialReference;g.push(T),x.push(M),I.push(O);var R=B.createOrigin(e.mbs,this.elevationOffset,this._controller.crsIndex,F);b.push(R),e.memory+=this.memEstimateGeometryAdded(T.data),s[de.MATERIAL][O.id]=O,s[de.GEOMETRY][T.id]=T}var j={nodeIndex:e.index,layerUid:this._layerUid},V=new te({idHint:e.id,name:m,geometries:g,materials:I,transformations:x,origins:b,castShadow:!0,metadata:j});V.objectTransformation=_,s[de.OBJECT][V.id]=V;var G=this._addTasks.get(e.index),L=new ye;L.node=e,L.engineObject=V,L.featureIds=p,L.componentColorBuffer=h,L.componentIndices=f,L.cachedRendererVersion=this._getInvalidRendererVersion(),L.cachedSymbolInfos=[],L.attributeInfo=G.attributeInfo,!this._hasTextures&&e.resources.texture&&(this._hasTextures=!0),this._hasColors||(this._hasColors=l),this._hasData=!0,this.notifyChange("hasTexturesOrVertexColors");var U=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(L).then(function(){var t=r._stageLayer,n=r._stage,i=s[de.OBJECT];for(var o in i)i.hasOwnProperty(o)&&t.addObject(i[o]);for(var a in s)if(s.hasOwnProperty(a)){var u=s[a];for(var l in u)u.hasOwnProperty(l)&&null==n.get(a,l)&&n.add(a,u[l])}if(r._nodeId2Meta.set(e.index,L),r.suspended)r._removeNodeStageData(e.index);else{L.attributeInfo=G.attributeInfo,L.cachedRendererVersion===r._rendererVersion&&U===r.slicePlaneEnabled||r._addOrUpdateEdgeRendering(L),r._setObjectSymbology(L),r._applyFiltersToNode(L)&&r._updateEdgeRendering(L),r.visibleGeometryChanged(V),r._highlights.objectCreated(V);for(var c=0,d=L.engineObject.getGeometryRecords();c<d.length;c++)d[c].material.updateParameters({slicePlaneEnabled:r.slicePlaneEnabled});r._markParentsAsHole(e.index)}})},s.prototype._addData=function(e,t,n){var i=this,o=this._addTasks.get(e.index);return o?o.attributeInfo=t:(o=r({},v.createResolver(),{attributeInfo:t}),this._addTasks.set(e.index,o),n().then(o.resolve,o.reject).then(function(){return i._addTasks.delete(e.index)}).catch(function(t){throw i._addTasks.delete(e.index),t})),o.promise},s.prototype._markParentsAsHole=function(e){if(this._isIntegratedMesh)for(var t=this._controller,r=t.getParentIndex(e);r;r=t.getParentIndex(r))this.updateNodeStatus(r,"hole")},s.prototype._clippingAreaChanged=function(){var e=M.create();K.extentToBoundingBox(this.view.clippingArea,e,this.view.renderSpatialReference)?this._clippingArea=e:this._clippingArea=null,this._filterChange(),this._controller&&this._controller.updateClippingArea(this.view.clippingArea)},s.prototype._filterChange=function(){this._applyFilters(!1)},s.prototype._applyFilters=function(e){var t=this;this._filters=this.getFilters(),e?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(function(e){t._applyFiltersToNode(e)&&(t._addOrUpdateEdgeRendering(e),t.visibleGeometryChanged(e.engineObject))})},s.prototype.getFilters=function(){var e=this,t=[];return this._clippingArea&&t.push(function(t,r){return e._boundingboxFilter(t,r,e._clippingArea)}),t},s.prototype.addSqlFilter=function(e,t,r,n){var i=this;t&&r&&e.push(function(e,o){return i._sqlFilter(e,o,t,r,n)})},s.prototype._sqlFilter=function(e,t,r,n,i){var o={},a=this._createLayerGraphic(o),s=this.layer.objectIdField,u=t.featureIds,l=t.attributeInfo.attributeData;n.every(function(e){return null!=l[e]||e===s})&&k.filterInPlace(e,u,function(e){o[s]=u[e];for(var t=0,c=n;t<c.length;t++){var d=c[t];d!==s&&(o[d]=k.getCachedAttributeValue(l[d],e))}try{return r.testFeature(a)}catch(e){return i(e),!1}})},s.prototype._boundingboxNodeTest=function(e,t){return K.mbsToMbs(e.node.mbs,this._controller.crsIndex,Ae,this.view.renderSpatialReference),k.intersectBoundingBoxWithMbs(t,Ae)},s.prototype._boundingboxFeatureTest=function(e,t,r){var n=e.engineObject.geometryRecords[0].geometry;return M.intersects(r,n.getComponentAABB(t,xe))},s.prototype._boundingboxFilter=function(e,t,r){var n=this,i=this._boundingboxNodeTest(t,r);if(3!==i){if(0===i)return void(e.length=0);if(t.engineObject.geometryRecords[0].geometry.componentCount===t.featureIds.length){var o=k.getClipAABB(r,t.engineObject);k.filterInPlace(e,t.featureIds,function(e){return n._boundingboxFeatureTest(t,e,o)})}}},s.prototype._addOrUpdateEdgeRendering=function(e,t){if(void 0===t&&(t=!0),!this._edgeView)return v.resolve();var r=e.engineObject,n=this._edgeView.hasObject(r),i=this._extractObjectEdgeMaterials(e),o=i.hasEdges,a=i.perFeatureEdgeMaterials,s={slicePlaneEnabled:this.slicePlaneEnabled};if(o){var u=!r.isHidden(r.geometryRecords[0]);if(n)this._edgeView.updateAllComponentMaterials(r,a,s,t),this._edgeView.updateObjectVisibility(r,u);else if(u)return l.safeCast(this._edgeView.addObject(r,a,s,!1))}else n&&this._edgeView.removeObject(r);return v.resolve()},s.prototype._removeEdgeRendering=function(e){this._edgeView&&this._edgeView.hasObject(e.engineObject)&&this._edgeView.removeObject(e.engineObject)},s.prototype._applyFiltersToNode=function(e){var t=e.engineObject,r=t.areAllComponentsVisible();if(t.unhideAllComponents(),0===this._filters.length)return!r;var n=e.featureIds;null!=e.filteredIds&&e.appliedFilters===this._filters||(e.filteredIds=this._computeFilteredIds(e),e.appliedFilters=this._filters);var i=e.filteredIds;if(i===n)return!r;for(var o=t.getGeometryRecords()[0],a=0,s=0;s<n.length;s++){var u=n[s];a>=i.length||i[a]!==u?t.setComponentVisibility(o,s,!1):a++}return!0},s.prototype._computeFilteredIds=function(e){for(var t=e.featureIds.slice(),r=0,n=this._filters;r<n.length;r++)(0,n[r])(t,e);return t.length===e.featureIds.length?e.featureIds:t},s.prototype._removeAllNodeDataFromStage=function(e){var t=this;void 0===e&&(e=this.elevationOffset),this._nodeId2Meta.forEach(function(r,n){return t._removeNodeStageData(n,e)})},s.prototype.removeNodeData=function(e,t){for(;e.length>0&&!t.done;){var r=e.pop();this._removeNodeStageData(r),t.madeProgress()}},s.prototype._removeNodeStageData=function(e,t){void 0===t&&(t=this.elevationOffset);var r=this._nodeId2Meta.get(e);if(r){var n=r.engineObject;n.setHidden(n.geometryRecords[0],!0),this.visibleGeometryChanged(n),this._removeEdgeRendering(r),this._nodeId2Meta.delete(e),this._highlights.objectDeleted(n);var i=this._controller.indexDepth-r.node.level+1;this._memCache.put(this._getMemCacheKey(e,t),r,r.node.memory,i)}},s.prototype._deleteNodeStageData=function(e){var t=this._stage,r=this._stageLayer,n=e.engineObject;this._edgeView&&this._edgeView.removeObject(n),r.removeObject(n);for(var i=0,o=n.getGeometryRecords();i<o.length;i++){var a=o[i];this.memEstimateGeometryRemoved(a.geometry.data),t.remove(de.GEOMETRY,a.geometry.id),this._removeMaterial(a.material,t)}if(e.componentIndices){for(var s=0;s<e.componentIndices.length;s++)e.componentColorBuffer.releaseIndex(e.componentIndices[s]);this._componentColorManager.garbageCollect()}t.remove(de.OBJECT,n.id)},s.prototype._removeMaterial=function(e,t){t.remove(de.MATERIAL,e.id);var r=e.metadata.engineTex;r&&(this.memEstimateTextureRemoved(r),t.remove(de.TEXTURE,r.id))},s.prototype.updateNodeStatus=function(e,t){var r=this._nodeId2Meta.get(e);if(r)for(var n="hole"===t,i=0,o=r.engineObject.getGeometryRecords();i<o.length;i++){o[i].material.updateParameters({polygonOffsetEnabled:!this._isIntegratedMesh&&n,readStencil:!!this._isIntegratedMesh&&n})}},s.prototype._getInvalidRendererVersion=function(){return k.addWraparound(this._rendererVersion,-1)},s.prototype._rendererChange=function(e){return a(this,void 0,void 0,function(){var t,r,n,i,a,s,u,l;return o(this,function(o){switch(o.label){case 0:return this._currentRenderer=e,this.notifyChange("rendererNeedsTextures"),this._rendererVersion=k.addWraparound(this._rendererVersion,1),this._rendererFields=null,this._colorVariable=null,this._opacityVariable=null,e?(t=this,r=k.findFieldsCaseInsensitive,[4,e.getRequiredFields(this.layer.fields)]):[3,2];case 1:t._rendererFields=r.apply(void 0,[o.sent(),this.layer.fields]),o.label=2;case 2:if(e&&"visualVariables"in e&&e.visualVariables)for(n=0,i=e.visualVariables;n<i.length;n++)"color"===(a=i[n]).type?this._colorVariable=a:"opacity"===a.type?this._opacityVariable=a:pe.warn("Unsupported visual variable type for 3D Object Scene Services: "+a.type);if(e)for(s=0,u=e.getSymbols();s<u.length;s++)"mesh-3d"!==(l=u[s]).type&&pe.error("Symbols of type '"+l.type+"' are not supported for 3D Object Scene Services.");return this._controller&&this._controller.requestUpdate(),[2]}})})},s.prototype._getSymbolInfos=function(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedSymbolInfos},s.prototype._getSymbolColors=function(e){return this._hasSymbolColors&&e.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(e),e.cachedSymbolColors},s.prototype._updateCachedRendererData=function(e){if(e.cachedRendererVersion=this._rendererVersion,this._hasSymbolColors){var t=e.featureIds?e.featureIds.length:1,r={},n=this._tmpAttributeOnlyGraphic;n.attributes=r;var i=this._currentRenderer,o=e.attributeInfo.attributeData,a=null!=e.featureIds?this.layer.objectIdField:null,s=null!=o?this._rendererFields:null;null==e.cachedSymbolColors&&(e.cachedSymbolColors=new Uint8Array(4*e.featureIds.length));for(var u=e.cachedSymbolColors,l=!0,c=0;c<t;c++){if(null!=a&&(r[a]=e.featureIds[c]),null!=s)for(var d=0,p=s;d<p.length;d++){var h=p[d];o[h]&&(r[h]=k.getCachedAttributeValue(o[h],c))}var f=i&&i.getSymbol(n,{arcadeUtils:F}),y=null;f instanceof R&&(this._symbolInfos.has(f.id)||this._symbolInfos.set(f.id,k.getSymbolInfo(f)),y=this._symbolInfos.get(f.id)),e.cachedSymbolInfos[c]=y;var _=null,m=null,g=!0,v=!0;if(i&&"visualVariables"in i){if(this._colorVariable){var b=T.getColor(this._colorVariable,n,{color:we});b&&((_=Ie)[0]=b.r/255,_[1]=b.g/255,_[2]=b.b/255,this._opacityVariable||null===b.a||(m=b.a))}this._opacityVariable&&(m=T.getOpacity(this._opacityVariable,n))}if(y&&y.material){var x=y.material;_=null==_||null==m?G.overrideColor(_,m,x.color,x.alpha,he,Ie):G.overrideColor(_,m,null,null,he,Ie),W.encodeSymbolColor(_,x.colorMixMode,u,4*c),g=y.castShadows}else W.encodeSymbolColor(null,null,u,4*c),g=!0;if(c>0&&l){for(var I=4*(c-1);I<4*c;I++)u[I]!==u[I+4]&&(l=!1);g!==v&&(l=!1)}v=g}e.uniformSymbolColor=l}},s.prototype._extractObjectEdgeMaterials=function(e){for(var t=[],r=e.engineObject,n=e.featureIds?e.featureIds.length:1,i={opacity:this.fullOpacity},o=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),a=!1,s=null,u=null,l=this._getSymbolInfos(e),c=0;c<n;c++){var d=l[c];r.getComponentVisibility(r.getGeometryRecords()[0],c)&&d?(u!==d&&(u=d,(s=Q.createMaterialFromEdges(this._edgeView,d.edges,i))&&(a=!0)),t.push(m.isSome(s)?s:o)):t.push(o)}return{hasEdges:a,perFeatureEdgeMaterials:t}},s.prototype._setObjectSymbology=function(e){if(this._hasSymbolColors){var t=e.featureIds?e.featureIds.length:1,r=this._getSymbolColors(e);if(e.uniformSymbolColor){var n=W.decodeSymbolColor(r,0),i=n.color,o=n.colorMixMode,a=!0;e.cachedSymbolInfos[0]&&(a=e.cachedSymbolInfos[0].castShadows);for(var s=0,u=e.engineObject.getGeometryRecords();s<u.length;s++){u[s].material.updateParameters({componentData:{castShadows:a,externalColor:i,externalColorMixMode:o}})}var l=i[3]<1;this._updateObjectOpacity(e.engineObject,l)}else{for(var c=e.componentColorBuffer.textureBuffer,d=!0,p=0;p<t;p++){var h=4*p,f=e.componentIndices[p],y=1;e.cachedSymbolInfos[p]&&(y=!0===e.cachedSymbolInfos[p].castShadows?1:0),c.setData(f,0,r[h],r[h+1],254&r[h+2]|y,r[h+3]),d=d&&W.isOpaqueSymbolColor(r,h)}for(var _=0,m=e.engineObject.getGeometryRecords();_<m.length;_++){m[_].material.updateParameters({componentData:c})}this._updateObjectOpacity(e.engineObject,!d),this._stage.renderView.setNeedsRender()}}},s.prototype._setComponentIndices=function(e,t){for(var r=e.getAttribute(ie.VertexAttrConstants.COMPONENTINDEX),n=r.data,i=r.offsetIdx,o=r.strideIdx,a=e.getIndices(ie.VertexAttrConstants.COMPONENTINDEX),s=0;s<t.length;s++)for(var u=e.componentOffsets[s],l=e.componentOffsets[s+1],c=u;c<l;c++){n[i+a[c]*o]=t[s]}},s.prototype._reloadAll=function(e){void 0===e&&(e=this.elevationOffset),this._removeAllNodeDataFromStage(e),null!=this._controller&&this._controller.restartNodeLoading()},s.prototype._opacityChange=function(e){var t=this;this._nodeId2Meta.forEach(function(e){t._updateObjectOpacity(e.engineObject),t._updateEdgeRendering(e)})},s.prototype._updateObjectOpacity=function(e,t){for(var r=0,n=e.getGeometryRecords();r<n.length;r++){var i=n[r].material,o=i.metadata;void 0!==t&&(o.symbolIsTransparent=t);var a=this._calcEngineMaterialTransparencyParams(o.i3sTex,o.i3sMatParams,o.symbolIsTransparent);i.updateParameters(a)}},s.prototype._updateEngineObject=function(e){this._setObjectSymbology(e),this._applyFiltersToNode(e),this._addOrUpdateEdgeRendering(e),this.visibleGeometryChanged(e.engineObject)},s.prototype._slicePlaneEnabledChange=function(e){var t=this,r={slicePlaneEnabled:e};this._stageLayer.isSliceable=e,this._nodeId2Meta.forEach(function(e){for(var n=0,i=e.engineObject.getGeometryRecords();n<i.length;n++)i[n].material.updateParameters(r);t._updateEdgeRendering(e,!1)})},s.prototype._updateEdgeRendering=function(e,t){void 0===t&&(t=!0),this._edgeView&&this._edgeView.hasObject(e.engineObject)&&this._addOrUpdateEdgeRendering(e,t)},s.prototype._forAllFeatures=function(e,t,r){var n=this;void 0===r&&(r=0),f.everyMap(this._nodeId2Meta,function(i,o){if(m.isSome(t))switch(t(i)){case 0:return!1;case 2:return!0}return 0!==n._forAllFeaturesOfNode(i,e,r)})},s.prototype._forAllFeaturesOfNode=function(e,t,r){void 0===r&&(r=0);var n=e.featureIds,i=e.engineObject.geometryRecords[0],o=2===r&&this._clippingArea?k.getClipAABB(this._clippingArea,e.engineObject):null,a=o?this._boundingboxNodeTest(e,this._clippingArea):3;if(0===a)return 1;for(var s=0;s<n.length;s++)if(e.engineObject.getComponentVisibility(i,s)||1===r||2===r&&(3===a||this._boundingboxFeatureTest(e,s,o))){var u=t(n[s],s,e,i);switch(u){case 0:return u}}return 1},s.prototype._createGraphic=function(e,t){var r={};null!=t.featureIds&&(r[this._getObjectIdField()]=t.featureIds[e]);var n=t.attributeInfo.attributeData;if(null!=n)for(var i=0,o=Object.keys(n);i<o.length;i++){var a=o[i];r[a]=k.getCachedAttributeValue(n[a],e)}return this._createLayerGraphic(r)},s.prototype._boundingBoxCornerPoints=function(e,t,r){for(var n=t.geometries[0].getComponentAABB(e,be),i=0;i<8;++i)ve[0]=1&i?n[0]:n[3],ve[1]=2&i?n[1]:n[4],ve[2]=4&i?n[2]:n[5],O.vec3.transformMat4(ve,ve,t.objectTransformation),r[3*i]=ve[0],r[3*i+1]=ve[1],r[3*i+2]=ve[2];return r},s.prototype.highlight=function(e,t){var r=this;void 0===t&&(t={});var n=this._highlights;if("number"==typeof e?e=[e]:e instanceof u?e=[e]:e instanceof c&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof u){var i=e.map(function(e){return q.attributeLookup(e.attributes,r._getObjectIdField())}),o=n.acquireSet(t),a=o.set,s=o.handle;return n.setFeatureIds(a,i),s}if("number"==typeof e[0]){i=e;var l=n.acquireSet(t);a=l.set,s=l.handle;return n.setFeatureIds(a,i),s}}return Se},s.prototype.visibleGeometryChanged=function(e){var t=this;e?this._elevationProvider.objectChanged(e):this._elevationProvider.layerChanged(),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=x.schedule(function(){t.emit("visible-geometry-changed"),t._visibleGeometryChangedSchedulerHandle=null}))},s.prototype.test=function(){var e=this;return{controller:this._controller,get visibleObjectIds(){var t=[];return e._forAllFeatures(function(e,r,n,i){return n.engineObject.isHidden(i)||n.engineObject.areAllComponentsHidden()||!n.engineObject.getComponentVisibility(i,r)||t.push(e),1}),t.sort(function(e,t){return e-t}),t},get numNodes(){return e._nodeId2Meta.size}}},i([D.property()],s.prototype,"view",void 0),i([D.property()],s.prototype,"layer",void 0),i([D.property()],s.prototype,"_controller",void 0),i([D.property({dependsOn:["_controller.updating"]})],s.prototype,"updating",void 0),i([D.property({dependsOn:["_controller.rootNodeVisible"]})],s.prototype,"suspended",void 0),i([D.property(H.updatingPercentage)],s.prototype,"updatingPercentage",void 0),i([D.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],s.prototype,"updatingPercentageValue",void 0),i([D.property({readOnly:!0})],s.prototype,"hasTexturesOrVertexColors",null),i([D.property({readOnly:!0})],s.prototype,"rendererNeedsTextures",null),i([D.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],s.prototype,"elevationOffset",null),i([D.property({type:Boolean})],s.prototype,"slicePlaneEnabled",void 0),i([D.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],s.prototype,"uncompressedTextureDownsamplingEnabled",null),i([D.property({dependsOn:["layer.version"]})],s.prototype,"useCompressedTextures",null),i([D.subclass("esri.views.3d.layers.I3SMeshView3D")],s)}(D.declared(p,d,g));t.I3SMeshView3D=me;var ge=E.mat4f64.create(),ve=P.vec3f64.create(),be=M.create(),xe=M.create(),Ie=[0,0,0,0],we=new s([0,0,0,0]),Ae=[0,0,0,0],Se={remove:function(){},pause:function(){},resume:function(){}}}.apply(null,n))||(e.exports=i)},1624:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1529)],void 0===(i=function(e,t,r){var n=function(){return function(e){this.highlightSet=new r,this.ids=new Set,this.paused=!1,this.options=e}}();return function(){function e(e){this.highlights=[],this.layerView=e}return e.prototype.destroy=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()}),this.highlights=null},e.prototype.acquireSet=function(e){var t=this,r=new n(e);return this.highlights.push(r),{set:r,handle:{remove:function(){return t.releaseSet(r)},pause:function(){r.highlightSet.removeAll(),r.paused=!0},resume:function(){r.paused=!1,t.initializeSet(r)}}}},e.prototype.releaseSet=function(e){e.highlightSet.removeAll();var t=this.highlights?this.highlights.indexOf(e):-1;-1!==t&&this.highlights.splice(t,1)},e.prototype.setFeatureIds=function(e,t){t.forEach(function(t){return e.ids.add(t)}),this.initializeSet(e)},e.prototype.initializeSet=function(e){this.layerView._forAllFeatures(function(t,r,n,i){if(e.ids.has(t)){var o=n.engineObject.setComponentHighlight(i,r,e.options);e.highlightSet.addObject(n.engineObject,o)}return 1},null,1)},e.prototype.objectCreated=function(e){var t=this;this.highlights.forEach(function(r){r.paused||t.layerView._forAllFeaturesOfNode(t.layerView._getMetadata(e),function(t,n,i,o){if(r.ids.has(t)){var a=e.setComponentHighlight(o,n,r.options);r.highlightSet.addObject(e,a)}return 1},1)})},e.prototype.objectDeleted=function(e){this.highlights.forEach(function(t){t.highlightSet.removeObject(e)})},e.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(e){return e.highlightSet.removeAll()})},e}()}.apply(null,n))||(e.exports=i)},1625:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(37),r(12),r(0),r(4),r(3),r(35),r(95),r(173)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p){var h=c.empty(),f={spatialReference:null,extent:h},y=l.vec3f64.create(),_=l.vec3f64.create(),m=l.vec3f64.create(),g=a.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(e){function t(t){return e.call(this)||this}return r(t,e),t.prototype.initialize=function(){var e=this.layerView.view;this.view=e,this.renderCoordsHelper=e.renderCoordsHelper,this.intersectLayers=[this.stageLayer],this.intersector=new p(e.viewingMode);var t=this.layerView.layer.fullExtent;this.zmin=t.zmin,this.zmax=t.zmax},t.prototype.getElevation=function(e){if(d.isPoint(e)){if(!this.renderCoordsHelper.toRenderCoords(e,y))return g.error("could not project point for elevation alignment"),-1/0}else if(!this.renderCoordsHelper.toRenderCoords(e,this.spatialReference,y))return g.error("could not project point for elevation alignment"),-1/0;var t=this.layerView.elevationOffset,r=this.zmin+t,n=this.zmax+t;return u.vec3.copy(_,y),u.vec3.copy(m,y),this.renderCoordsHelper.setAltitude(n,_),this.renderCoordsHelper.setAltitude(r,m),this.intersector.intersect(this.intersectLayers,_,m,null,null,1,!1),this.intersector.results.min.getIntersectionPoint(y)?this.renderCoordsHelper.getAltitude(y):-1/0},t.prototype.layerChanged=function(){this.spatialReference&&(f.extent=this.computeLayerExtent(this.intersectLayers[0]),f.spatialReference=this.spatialReference,this.emit("elevation-change",f))},t.prototype.objectChanged=function(e){this.spatialReference&&(f.extent=this.computeObjectExtent(e),f.spatialReference=this.spatialReference,this.emit("elevation-change",f))},t.prototype.computeObjectExtent=function(e){return c.empty(h),this.expandExtent(e,h),h},t.prototype.computeLayerExtent=function(e){c.empty(h);for(var t=0,r=e.getObjects();t<r.length;t++){var n=r[t];this.expandExtent(n,h)}return h},t.prototype.expandExtent=function(e,t){for(var r=e.getBBMin(!0),n=e.getBBMax(!0),i=0;i<8;++i)y[0]=1&i?r[0]:n[0],y[1]=2&i?r[1]:n[1],y[2]=4&i?r[2]:n[2],u.vec3.transformMat4(y,y,e.objectTransformation),this.renderCoordsHelper.fromRenderCoords(y,y,this.spatialReference),c.expand(t,y);return t},n([s.property({constructOnly:!0})],t.prototype,"layerView",void 0),n([s.property({constructOnly:!0})],t.prototype,"stageLayer",void 0),n([s.property()],t.prototype,"view",void 0),n([s.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],t.prototype,"spatialReference",void 0),n([s.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],t)}(s.declared(i,o))}.apply(null,n))||(e.exports=i)},1626:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(15),r(9)],void 0===(i=function(e,t,r,n){function i(e){return n.create(function(t,r){e.oncomplete=function(){return t()},e.onerror=function(){return r(e.error)},e.onabort=function(){return r(e.error)}})}function o(e){return n.create(function(t,r){"done"===e.readyState?null!=e.error?r(e.error):t(e.result):(e.onsuccess=function(){return t(e.result)},e.onerror=function(){return r(e.error)})})}Object.defineProperty(t,"__esModule",{value:!0});var a=14,s=function(){function e(e,t,r){void 0===r&&(r=a),this._version=r,this._db=null,this._quotaReductionPromise=null,this._gcCounter=0,this._hit=0,this._miss=0,this._destroyed=!1,this.gcFrequency=50,this.maxByteSize=1073741824,this.quotaReductionFactor=.2,this._dbName=e,this._storeName=t}return e.prototype.init=function(){var e=this;return n.resolve().then(function(){var t=indexedDB.open(e._dbName,e._version);return t.onupgradeneeded=function(r){var n=t.result,i=t.transaction,o=n.objectStoreNames.contains(e._storeName)?i.objectStore(e._storeName):n.createObjectStore(e._storeName),a=n.objectStoreNames.contains("last_access")?i.objectStore("last_access"):n.createObjectStore("last_access");a.indexNames.contains("date")||a.createIndex("date","date",{unique:!1}),a.indexNames.contains("byteSize")||a.createIndex("byteSize","byteSize",{unique:!1}),r.oldVersion<e._version&&(o.clear(),a.clear())},o(t)}).then(function(t){e._destroyed?t.close():e._db=t})},e.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null),this._destroyed=!0},Object.defineProperty(e.prototype,"initialized",{get:function(){return null!=this._db},enumerable:!0,configurable:!0}),e.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)},e.prototype.put=function(e,t){var i=this;return null==this._db?n.reject(new r("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:n.resolve()).then(function(){return i._put(e,t)}).catch(function(r){if(r&&"QuotaExceededError"===r.name)return null==i._quotaReductionPromise&&(i._quotaReductionPromise=i._getCacheSize().then(function(e){return i._removeLeastRecentlyAccessed(t.byteSize+Math.ceil(e*i.quotaReductionFactor))}),i._quotaReductionPromise.then(function(){return i._quotaReductionPromise=null},function(){return i._quotaReductionPromise=null})),i._quotaReductionPromise.then(function(){return i._put(e,t)});throw r}).then(function(){--i._gcCounter<0&&null!=i._db&&(i._gcCounter=i.gcFrequency,i._getCacheSize().then(function(e){return i._removeLeastRecentlyAccessed(e-i.maxByteSize)}))})},e.prototype.get=function(e){var t=this;return null==this._db?n.resolve(null):n.resolve().then(function(){return o(t._db.transaction(t._storeName,"readonly").objectStore(t._storeName).get(e))}).then(function(r){if(null==r)++t._miss;else if(t._db){++t._hit,t._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:r.byteSize},e)}return r}).catch(function(e){return++t._miss,null})},e.prototype.remove=function(e){var t=this;return null==this._db?n.resolve():n.resolve().then(function(){var r=t._db.transaction([t._storeName,"last_access"],"readwrite"),a=r.objectStore(t._storeName),s=r.objectStore("last_access"),u=a.delete(e),l=s.delete(e);return n.all([o(u),o(l),i(r)])})},e.prototype._put=function(e,t){var r=this._db.transaction([this._storeName,"last_access"],"readwrite"),a=r.objectStore(this._storeName),s=r.objectStore("last_access"),u=a.put(t,e),l=s.put({date:Date.now(),byteSize:t.byteSize},e);return n.all([o(u),o(l),i(r)])},e.prototype._removeLeastRecentlyAccessed=function(e){if(!(e<=0)){var t=this._db.transaction([this._storeName,"last_access"],"readwrite"),r=t.objectStore(this._storeName),n=t.objectStore("last_access"),o=0,a=n.index("date").openCursor(null,"next");return a.onsuccess=function(t){var i=a.result;null!=i&&(null!=i.value.byteSize&&(o+=i.value.byteSize),r.delete(i.primaryKey),n.delete(i.primaryKey),o<e&&i.continue())},i(t)}},e.prototype._getCacheSize=function(){var e=this._db.transaction("last_access"),t=0,r=e.objectStore("last_access").index("byteSize").openKeyCursor();return r.onsuccess=function(e){var n=r.result;if(n){var i=n.key;null!=i&&(t+=i),n.continue()}},i(e).then(function(){return t})},e}();t.IDBCache=s,t.whenTransaction=i,t.whenRequest=o}.apply(null,n))||(e.exports=i)},1627:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1628),r(1546)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.create=function(e,t,n){return new r.ComponentMaterial(e,t,n)},e.vertexBufferLayout=n.createVertexBufferLayout}(t.ComponentMaterial||(t.ComponentMaterial={}))}.apply(null,n))||(e.exports=i)},1628:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(7),r(14),r(122),r(1629),r(1545),r(1546),r(58),r(1631)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t,r,n){var i=e.call(this,n)||this;return i.supportsEdges=!0,i._parameters=s.fillDefaults(t),i._geometryParameters=r,i}return r(t,e),Object.defineProperty(t.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryParameters",{get:function(){return this._geometryParameters},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasTransparency",{get:function(){var e=this._parameters.forceTransparency;if(i.isSome(e))return e;if(this._parameters.baseColorOpacity<1||this._parameters.layerOpacity<1)return!0;var t=this._parameters.componentData;return!s.isUniformComponentData(t)||"replace"!==t.externalColorMixMode||t.externalColor[3]<1},enumerable:!0,configurable:!0}),t.prototype.isVisibleInPass=function(e){if(3!==e)return!0;var t=this._parameters.componentData;return!s.isUniformComponentData(t)||t.castShadows},t.prototype.isVisible=function(){var t=this.parameters;if(!e.prototype.isVisible.call(this))return!1;if(0===t.layerOpacity)return!1;var r=t.componentData;return!s.isUniformComponentData(r)||("replace"===r.externalColorMixMode?r.externalColor[3]>0:t.baseColorOpacity>0)},t.prototype.updateParameters=function(e){var t=!1;for(var r in e){var n=this._parameters[r],i=e[r];n!==i&&(t=!0,this._parameters[r]=i)}return t&&this.notifyDirty("matChanged"),t},t.prototype.intersect=function(e,t,r,n,i,o,a){l.intersectTriangleGeometry(e,t,r,n,i,o,a)},t.prototype.getGLMaterials=function(){return{color:a.GLMaterialColor,depthShadowMap:a.GLMaterialDepthShadowMap,normal:a.GLMaterialNormal,depth:a.GLMaterialDepth,highlight:a.GLMaterialHighlight}},t.prototype.createRenderer=function(e,t){return new c(e,t,this)},t.prototype.createBufferWriter=function(){throw Error("Not supported")},t.prototype.createBufferLayout=function(){return u.createVertexBufferLayout(this.geometryParameters)},t}(o);t.ComponentMaterial=d}.apply(null,n))||(e.exports=i)},1629:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(5),r(1),r(213),r(585),r(139),r(1545),r(58),r(58),r(1630),r(589),r(44)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p){function h(e){if(function(e){return"none"!==e.parameters.cullFace}(e))return{face:"front"===e.parameters.cullFace?1028:1029,mode:2305}}Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(t,r,n,i){var a=e.call(this,r,n)||this;a._passName=t,a.material=r;var s=r.parameters;return a._baseColorTexture=new c.TextureBinding(i,s.baseColorTexture,{textureUniform:"tex",textureSizeUniform:"texSize",textureUnit:o.DefaultTextureUnits.DIFFUSE}),a.createPrograms(),a.selectPipeline(),a.selectSlot(),a}return r(t,e),t.prototype.createPrograms=function(){var e=this;this.programs=u.BindParametersMap.create(this.material.parameters,function(t){return e._createProgram(t)})},t.prototype._createProgram=function(e){var t=this.material.parameters,r=this.material.geometryParameters,n=t.baseColorTexture?r.textureCoordinateRegions?"AtlasTextured":"Textured":"none",i="screen-space"===t.normals||"screen-space"===r.normals||"none"===r.normals?"screenDerivative":"compressed"===r.normals?"compressed":"default";return"color"===this._passName?this.programRep.getProgram(d.colorPass,{textureMode:n,colorTexture:!!t.baseColorTexture,vertexColors:r.colors,doubleSided:t.doubleSidedShading,groundNormalShading:"ground"===t.normals,normals:i,componentColor:r.componentData&&!s.isUniformComponentData(t.componentData),textureAlphaMode:"maskBlend",slice:t.slicePlaneEnabled,receiveShadows:e.receiveShadows,receiveSSAO:e.receiveSSAO}):"depth"===this._passName||"depthShadowMap"===this._passName?this.programRep.getProgram(d.depthPass,{textureMode:n,colorTexture:!!t.baseColorTexture,vertexColors:r.colors,groundNormalShading:"ground"===t.normals,normals:i,componentColor:r.componentData&&!s.isUniformComponentData(t.componentData),textureAlphaMode:"maskBlend",shadowMap:"depthShadowMap"===this._passName,slice:t.slicePlaneEnabled}):"normal"===this._passName?this.programRep.getProgram(d.normalPass,{textureMode:n,colorTexture:!!t.baseColorTexture,vertexColors:r.colors,groundNormalShading:"ground"===t.normals,normals:i,componentColor:r.componentData&&!s.isUniformComponentData(t.componentData),textureAlphaMode:"maskBlend",slice:t.slicePlaneEnabled}):"highlight"===this._passName?this.programRep.getProgram(d.highlightPass,{textureMode:n,colorTexture:!!t.baseColorTexture,vertexColors:r.colors,groundNormalShading:"ground"===t.normals,normals:i,componentColor:r.componentData&&!s.isUniformComponentData(t.componentData),textureAlphaMode:"maskBlend",slice:t.slicePlaneEnabled}):void 0},t.prototype.selectPipeline=function(){var e=this.material.parameters;"color"===this._passName?this.pipelineState=p.makePipelineState({blending:function(e){if(e.hasTransparency)return p.separateBlendingParams(770,1,771,771)}(this.material),culling:h(this.material),polygonOffset:e.polygonOffsetEnabled&&I,stencilTest:e.writeStencil&&{function:{func:e.readStencil?517:519,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7681}},stencilWrite:e.writeStencil&&{mask:255},depthTest:{func:513},depthWrite:p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams}):this.pipelineState=p.makePipelineState({culling:h(this.material),polygonOffset:e.polygonOffsetEnabled&&I,depthTest:{func:513},depthWrite:p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams})},t.prototype.selectSlot=function(){this.slot=this.material.hasTransparency?7:this.material.parameters.readStencil?3:this.material.parameters.writeStencil?2:5},t.prototype.beginSlot=function(e){return e===this.slot},t.prototype.getProgram=function(){return this.program||this.getPrograms()[0]},t.prototype.getPrograms=function(){return u.BindParametersMap.programs(this.programs)},t.prototype.updateParameters=function(){var e=this.material.parameters;this._baseColorTexture.update(e.baseColorTexture),this.createPrograms(),this.selectPipeline(),this.selectSlot()},t.prototype.bind=function(e,t){var r=this.material.parameters,n=this.program=u.BindParametersMap.lookup(this.programs,t);e.bindProgram(n),e.setPipelineState(this.pipelineState),n.setUniform3fv("ambient",r.baseColor),n.setUniform3fv("diffuse",r.baseColor),n.setUniform3fv("specular",x),n.setUniform1f("opacity",r.baseColorOpacity),n.setUniform1f("layerOpacity",r.layerOpacity),s.isUniformComponentData(r.componentData)?(n.setUniform4fv("externalColor",r.componentData.externalColor),n.setUniform1i("colorMixMode",l.colorMixModes[r.componentData.externalColorMixMode])):(n.setUniform4fv("externalColor",b),n.setUniform1i("colorMixMode",l.colorMixModes.multiply),this.material.geometryParameters.componentData&&(r.componentData.updateTexture(),r.componentData.bind(n,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:o.DefaultTextureUnits.COMPONENT_COLOR}))),this._baseColorTexture.bind(e,n),n.setUniform1f("textureAlphaCutoff",.1),"depth"!==this._passName&&"depthShadowMap"!==this._passName||n.setUniform2fv("nearFar",t.nearFar),"highlight"===this._passName&&l.bindHighlightRendering(e,t,n)},t.prototype.bindView=function(e,t){var r=this.material.parameters,n=this.program=u.BindParametersMap.lookup(this.programs,t),i=t.origin;l.bindView(i,t.view,n),l.bindCamPos(i,t.viewInvTransp,n),r.slicePlaneEnabled&&l.bindSlicePlane(i,t.slicePlane,n),"color"===this._passName&&t.shadowMappingEnabled&&t.shadowMap.bindView(n,i),"normal"===this._passName&&n.setUniformMatrix4fv("viewNormal",t.viewInvTransp)},t.prototype.bindInstance=function(e,t){var r=this.program;r.setUniformMatrix4fv("model",t.transformation),r.setUniformMatrix4fv("modelNormal",t.transformationNormal)},n([i.autoDispose()],t.prototype,"_baseColorTexture",void 0),t}(a),y=function(e){function t(t,r,n){var i=e.call(this,"color",t,r,n)||this;return i.material=t,i}return r(t,e),t}(f);t.GLMaterialColor=y;var _=function(e){function t(t,r,n){var i=e.call(this,"depth",t,r,n)||this;return i.material=t,i}return r(t,e),t}(f);t.GLMaterialDepth=_;var m=function(e){function t(t,r,n){var i=e.call(this,"depthShadowMap",t,r,n)||this;return i.material=t,i}return r(t,e),t}(f);t.GLMaterialDepthShadowMap=m;var g=function(e){function t(t,r,n){var i=e.call(this,"normal",t,r,n)||this;return i.material=t,i}return r(t,e),t}(f);t.GLMaterialNormal=g;var v=function(e){function t(t,r,n){var i=e.call(this,"highlight",t,r,n)||this;return i.material=t,i}return r(t,e),t}(f);t.GLMaterialHighlight=v;var b=[1,1,1,1],x=[0,0,0],I={factor:2,units:2}}.apply(null,n))||(e.exports=i)},1630:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(14)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){var i=this;this._textureRep=e,this._textureId=t,this._options=n,this._textureRef=r.applySome(this._textureId,function(e){return i._textureRep.acquire(e,!!i._options.initTransparent)})}return e.prototype.dispose=function(){var e=this;this._textureRef=r.applySome(this._textureId,function(t){e._textureRep.release(t)})},e.prototype.bind=function(e,t){if(r.isSome(this._textureRef)&&(t.setUniform1i(this._options.textureUniform,this._options.textureUnit),e.bindTexture(this._textureRef.getGLTexture(),this._options.textureUnit),this._options.textureSizeUniform)){var n=this._textureRef.getGLTexture();t.setUniform2f(this._options.textureSizeUniform,n.descriptor.width,n.descriptor.height)}},e.prototype.update=function(e){var t=this;e!==this._textureId&&(r.applySome(this._textureId,function(e){t._textureRep.release(e)}),this._textureRef=r.applySome(e,function(e){return t._textureRep.acquire(e,!!t._options.initTransparent)}))},e}();t.TextureBinding=n}.apply(null,n))||(e.exports=i)},1631:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(21),r(19),r(98),r(50),r(18),r(377),r(378),r(67),r(46),r(70)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d){var p=function(){function e(e,t,r){this._material=r,this._dataByOrigin=new Map,this._highlightCount=0,this._rctx=e,this._materialRep=t,this._glMaterials=u.acquireMaterials(this._material,this._materialRep)}return e.prototype.dispose=function(){u.releaseMaterials(this._material,this._materialRep)},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._highlightCount>0},enumerable:!0,configurable:!0}),e.prototype.hasWater=function(){return!1},e.prototype.renderPriority=function(){return this._material.renderPriority},e.prototype.modify=function(e){this.updateGeometries(e.toUpdate),this.addAndRemoveGeometries(e.toAdd,e.toRemove),this.updateHighlightCount()},e.prototype.addAndRemoveGeometries=function(e,t){var c=this,p=this._rctx,f=this._dataByOrigin;e.forEach(function(e){var t=e.data;if(t.preinterleaved)if(null!=t.vertexData){var y=e.origin.id,_=e.origin.vec3,m=e.uniqueName,g=f.get(y);g||(g={origin:_,highlightCount:0,dataByGeometry:new Map},f.set(y,g)),a.setMatrixTranslation3(h,-_[0],-_[1],-_[2]);var v=n.mat4f64.create();r.mat4.multiply(v,h,e.transformation);var b=u.generateRenderGeometryVisibleIndexRanges(e),x=u.generateRenderGeometryHighlightRanges(e);x&&(g.highlightCount=null);var I=t.indexCount,w=t.id,A=new s(e.name,0,I,b,x,v,e.instanceParameters,e.idx,w),S=t.indexData?l.createIndex(p,35044,t.indexData):null,C=c._material.createBufferLayout(),D=new d(p,o.Default3D,{geometry:i.glLayout(C)},{geometry:l.createVertex(p,35044)},S);D.vertexBuffers.geometry.setData(t.vertexData),t.indexData=null,t.vertexData=null,g.dataByGeometry.set(m,{instance:A,vao:D})}else a.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available.");else a.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}),t.forEach(function(e){var t=e.origin.id,r=e.uniqueName,n=f.get(t);n.dataByGeometry.get(r).vao.dispose(),n.dataByGeometry.delete(r),0===n.dataByGeometry.size&&f.delete(t)})},e.prototype.updateGeometries=function(e){var t=this;e.forEach(function(e){var r=e.updateType,n=e.renderGeometry,i=n.origin.id,o=n.uniqueName,a=t._dataByOrigin.get(i),s=a&&a.dataByGeometry.get(o).instance;s&&(1&r&&(s.displayedIndexRange=u.generateRenderGeometryVisibleIndexRanges(n)),17&r&&(s.highlightedIndexRanges=u.generateRenderGeometryHighlightRanges(n),a.highlightCount=null),2&r&&console.error("Updating Preinterleaved geometry not supported"),4&r&&u.calculateTransformRelToOrigin(n,s.transformation,s.transformationNormal))})},e.prototype.updateHighlightCount=function(){var e=this;this._highlightCount=0,this._dataByOrigin.forEach(function(t){if(null==t.highlightCount){var r=0;t.dataByGeometry.forEach(function(e){e.instance.highlightedIndexRanges&&++r}),t.highlightCount=r}e._highlightCount+=t.highlightCount})},e.prototype.render=function(e,t,r,n){var i=this,o=this._rctx,a=this._glMaterials.get(t.pass),s=4===t.pass;if(!a||null!=e&&!a.beginSlot(e)||s&&0===this._highlightCount)return!1;a.bind(o,r);var u=!1;return this._dataByOrigin.forEach(function(e){s&&0===e.highlightCount||(r.origin=e.origin,a.bindView(o,r),s?e.dataByGeometry.forEach(function(e){u=i.renderInstanceHighlight(a,e,n)||u}):e.dataByGeometry.forEach(function(e){u=i.renderInstance(a,e,n)||u}))}),a.release(o,r),o.bindVAO(null),u},e.prototype.renderInstance=function(e,t,r){var n=t.instance,i=t.vao,o=n.displayedIndexRange;if(o&&0===o.length)return!1;var a=this._rctx,s=e.getProgram(),l=e.getDrawMode();c.assertCompatibleVertexAttributeLocations(i,s),a.bindVAO(i),e.bindInstance(a,n);var d=i.indexBuffer&&i.indexBuffer.indexType;if(o)d?u.drawElementsFaceRange(a,o,n.from,l,d,r):u.drawArraysFaceRange(a,o,n.from,l,r);else{var p=n.to-n.from;d?u.drawElements(a,l,d,n.from,p,r):u.drawArrays(a,l,n.from,p,r)}return!0},e.prototype.renderInstanceHighlight=function(e,t,r){var n=t.instance,i=t.vao,o=n.highlightedIndexRanges;if(!o)return!1;var a=this._rctx,s=e.getProgram(),l=e.getDrawMode();c.assertCompatibleVertexAttributeLocations(i,s),a.bindVAO(i),e.bindInstance(a,n);for(var d=i.indexBuffer&&i.indexBuffer.indexType,p=!1,h=0;h<o.length;h++){var f=o[h],y=f.range?f.range[0]+n.from:n.from,_=f.range?f.range[1]-f.range[0]+1:n.to-n.from;d?u.drawElements(a,l,d,y,_,r):u.drawArrays(a,l,y,_,r),p=!0}return p},e}(),h=n.mat4f64.create();return p}.apply(null,n))||(e.exports=i)},1632:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(12),r(0),r(557),r(1477)],void 0===(i=function(e,t,r,n,i,o,a,s,u){Object.defineProperty(t,"__esModule",{value:!0});var l=o.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._definitionExpressionErrors=0,t._maxDefinitionExpressionErrors=20,t.logError=function(e){t._definitionExpressionErrors<t._maxDefinitionExpressionErrors&&l.error("Error while evaluating definitionExpression: "+e),++t._definitionExpressionErrors===t._maxDefinitionExpressionErrors&&l.error("Further errors are ignored")},t}return r(t,e),Object.defineProperty(t.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer.definitionExpression)try{var e=s.WhereClause.create(this.layer.definitionExpression,this.layer.fieldsIndex);if(!e.isStandardized)return l.error("definitionExpression is using non standard function"),null;var t=[],r=e.fieldNames;return u.findFieldsCaseInsensitive(r,this.layer.fields,{missingFields:t}),t.length>0?(l.error("definitionExpression references unknown fields: "+t.join(", ")),null):(this._definitionExpressionErrors=0,e)}catch(e){return l.error("Failed to parse definitionExpression: "+e),null}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null},enumerable:!0,configurable:!0}),t.prototype._evaluateClause=function(e,t){try{return e.testFeature(t)}catch(e){return this.logError(e),!1}},t.prototype._addDefinitionExpressionToQuery=function(e){if(!this.parsedDefinitionExpression)return e;var t=this.layer.definitionExpression,r=e.clone();return r.where?r.where="("+t+") AND ("+r.where+")":r.where=t,r},n([a.property()],t.prototype,"layer",void 0),n([a.property({readOnly:!0,dependsOn:["layer.definitionExpression","layer.fieldsIndex"]})],t.prototype,"parsedDefinitionExpression",null),n([a.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],t.prototype,"definitionExpressionFields",null),n([a.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t)}(a.declared(i));t.DefinitionExpressionSceneLayerView=c,t.default=c}.apply(null,n))||(e.exports=i)},1633:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(106)],void 0===(i=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields","layer.outFields","requiredFields"],get:function(){var e=this,t=e.layer,n=e.layer.fields,i=e.requiredFields;return t.outFields?r.fixFields(n,r.unpackFieldNames(n,t.outFields).concat(i)):r.fixFields(n,i)}}}}}.apply(null,n))||(e.exports=i)},1650:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(11),r(13),r(9),r(256),r(4),r(260),r(43),r(372),r(1495),r(38),r(18)],void 0===(i=function(e,t,n,i,o,a,s,u,l,c,d,p,h){function f(e,t,r,n,i,o,a){switch(r){case 1:for(var s=0;s<a;s++)n[i]=e[t],t+=1,i+=o;break;case 2:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],t+=2,i+=o;break;case 3:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],n[i+2]=e[t+2],t+=3,i+=o;break;case 4:for(s=0;s<a;s++)n[i]=e[t],n[i+1]=e[t+1],n[i+2]=e[t+2],n[i+3]=e[t+3],t+=4,i+=o;break;default:throw b("Unhandled stride size "+r)}}function y(e,t,r,n,i,o){switch(t){case 1:for(var a=0;a<o;a++)r[n]=e,n+=i;break;case 2:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,n+=i;break;case 3:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,r[n+2]=e,n+=i;break;case 4:for(a=0;a<o;a++)r[n]=e,r[n+1]=e,r[n+2]=e,r[n+3]=e,n+=i;break;default:throw b("Unhandled stride size "+t)}}function _(e){switch(e){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw new Error("Unhandled data type: "+e)}function m(e){switch(e){case 5120:return"Int8";case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw new Error("Unhandled data type: "+e)}function g(e){return e%Uint32Array.BYTES_PER_ELEMENT==0}function v(e){return e>0&&e%Uint32Array.BYTES_PER_ELEMENT==0}function b(e){return new Error("I3SGeometryUtil processing failed: "+e)}function x(e){var t=e.normals,r=e.positions,n=e.normalInd,i=e.positionInd;h.assert(e.normalInd.length===e.positionInd.length);for(var o=u.vec3f32.create(),l=u.vec3f32.create(),c=a.vec2f32.create(),d=r.data,p=r.offsetIdx,f=r.strideIdx,y=t.data,_=t.offsetIdx,m=t.strideIdx,g=0;g<i.length;g+=3){var v=i[g],b=p+f*v,x=d[b],I=d[b+1],w=d[b+2];b=p+f*(v=i[g+1]),o[0]=d[b]-x,o[1]=d[b+1]-I,o[2]=d[b+2]-w,b=p+f*(v=i[g+2]),l[0]=d[b]-x,l[1]=d[b+1]-I,l[2]=d[b+2]-w,s.vec3.cross(o,o,l),h.encodeNormal(o,c);for(var A=0;A<3;A++){var S=_+m*n[g+A];y[S]=h.encodeInt16(c[0]),y[S+1]=h.encodeInt16(c[1])}}}function I(){return!!C}function w(e,t){switch(t){case 0:switch(e.type){case"intersects":case"contains":case"crosses":case"envelope-intersects":case"overlaps":case"touches":case"within":return 1;case"disjoint":return 0}break;case 2:switch(e.type){case"intersects":case"contains":case"envelope-intersects":case"within":return 0;case"disjoint":case"crosses":case"overlaps":case"touches":return 1}break;case 1:switch(e.type){case"envelope-intersects":return 0}}return 2}function A(e,t){return C.contains(e.mask,t)?2:C.intersects(e.mask,t)?1:0}Object.defineProperty(t,"__esModule",{value:!0});var S=new Uint8Array(64);t.interleaveGeometryBuffer=function(e,t,r,n,i){void 0===n&&(n=[]),void 0===i&&(i=[]);var o=e.params.vertexAttributes,a=o.position.count;if(!v(r[0].stride))throw b("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");for(var s=r[0].stride/Uint32Array.BYTES_PER_ELEMENT,u=new Uint32Array(s*a),l=0,c=r=r.slice(0).sort(function(e,t){return e.offset-t.offset});l<c.length;l++)!function(e){if(-1!==i.indexOf(e.name))return"continue";var r=o[e.name],s=_(e.type),l=void 0,c=!1;if(null==r){var d=n.filter(function(t){return t.name===e.name})[0];if(!d)throw b("Geometry definition is missing attribute");r={valueType:m(e.type),byteOffset:0,count:a,valuesPerElement:e.count};for(var p=0;p<S.length;p++)S[p]=d.byteValue;l=S.buffer,c=!0}else l=t;if(m(e.type)!==r.valueType)throw b("Geometry definition type must match attribute type");if(!g(r.byteOffset)||!g(e.offset))throw b(e.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!v(r.valuesPerElement*s.BYTES_PER_ELEMENT)||!v(e.count*s.BYTES_PER_ELEMENT))throw b(e.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var h=new Uint32Array(l),x=r.byteOffset/Uint32Array.BYTES_PER_ELEMENT,I=r.valuesPerElement*s.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,w=e.offset/Uint32Array.BYTES_PER_ELEMENT,A=e.stride/Uint32Array.BYTES_PER_ELEMENT;c?y(h[0],I,u,w,A,a):f(h,x,I,u,w,A,a)}(c[l]);return u.buffer},t.processAndInterleaveNormals=function(e,t,r,n,i){if("none"===e)x(i);else{var o=d.createTypedView(r,t.params.vertexAttributes.normal),a="earth-centered"===e?n:null;!function(e,t,r){var n=e.length/3,i=t.data,o=t.offsetIdx,a=t.strideIdx;if(null!=r)for(var s=r,u=s[0],l=s[1],c=s[2],d=s[4],p=s[5],f=s[6],y=s[8],_=s[9],m=s[10],g=0;g<n;g++){var v=e[3*g],b=e[3*g+1],x=e[3*g+2];P[0]=u*v+l*b+c*x,P[1]=d*v+p*b+f*x,P[2]=y*v+_*b+m*x,h.encodeNormal(P,M),i[o+g*a]=h.encodeInt16(M[0]),i[o+g*a+1]=h.encodeInt16(M[1])}else for(var g=0;g<n;g++)P[0]=e[3*g],P[1]=e[3*g+1],P[2]=e[3*g+2],h.encodeNormal(P,M),i[o+g*a]=h.encodeInt16(M[0]),i[o+g*a+1]=h.encodeInt16(M[1])}(o,i.normals,a)}},t.computeCompressedNormals=x;var C,D=65536;t.extractPositionData=function(e,t,r){var n=t[0];if(null==n||"position"!==n.name||5126!==n.type)return null;for(var i=new Float32Array(e),o=n.stride/4,a=n.offset/4,s=3*i.length/o,u=new Float32Array(s),l=0;l<s/3;l++)u[3*l]=i[l*o+a],u[3*l+1]=i[l*o+a+1],u[3*l+2]=i[l*o+a+2];var d=c.default(u.buffer,3,r);return d.uniqueCount<D?{data:new Float32Array(d.buffer),indices:new Uint16Array(d.indices)}:{data:new Float32Array(d.buffer),indices:d.indices}},t.isGeometryEngineLoaded=I,t.loadGeometryEngine=function(){return i(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return I()?[2,C]:[4,o.create(function(e,t){return Promise.resolve().then(function(){var t=[r(168)];e.apply(null,t)}.bind(this)).catch(r.oe)})];case 1:return[2,C=e.sent()]}})})},t.acquireMaskFilterContext=function(e,t,r,n){var i=r.spatialReference||t.spatialReference,o=t.renderSpatialReference,a={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:i};a.rings[0][4]=a.rings[0][0];var s=n.objectTransformation,u=n.getGeometryRecords()[0].geometry,l={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:i};l.rings[0][3]=l.rings[0][0];var c=C[e];return c||(console.error("Spatial relationship",e,"not supported"),c=function(){return!0}),{type:e,mask:r,maskSR:i,renderSR:o,aabb:a,transform:s,geometry:u,triangle:l,testFunction:c}},t.getIntersectRelation=w,t.intersectMaskWithMbs=function(e,t){var r={x:t[0],y:t[1],hasZ:!1,hasM:!1,type:"point",spatialReference:e.maskSR};return A(e,C.buffer(r,t[3],1,!0))};var E=Math.pow(2,-32);t.filterMask=function(e,t){var r=t.type,n=t.mask,i=t.transform,o=t.renderSR,a=t.maskSR,u=t.geometry,l=t.triangle,c=t.testFunction,d=t.aabb;u.getComponentAABB(e,O);var f=[d.rings[0][0],d.rings[0][1],d.rings[0][2],d.rings[0][3]];s.vec3.set(f[0],O[0],O[1],0),s.vec3.set(f[1],O[0],O[4],0),s.vec3.set(f[2],O[3],O[4],0),s.vec3.set(f[3],O[3],O[1],0);for(var y=0;y<4;++y)s.vec3.transformMat4(f[y],f[y],i),p.vectorToVector(f[y],o,f[y],a);switch(delete d._geVersion,w(t,A(t,d))){case 1:return!1;case 0:return!0}var _,m=l.rings[0][0],g=l.rings[0][1],v=l.rings[0][2],b=u.data.getIndices(h.VertexAttrConstants.POSITION),x=u.data.componentOffsets,I=u.data.getAttribute(h.VertexAttrConstants.POSITION),S=I.data,C=I.offsetIdx,D=I.strideIdx,P=x.length?x[e]:0,M=x.length?x[e+1]:b.length;switch(r){case"intersects":case"crosses":case"envelope-intersects":case"index-intersects":case"overlaps":case"touches":_=function(){return c(n,l)?0:2};break;case"contains":case"disjoint":case"within":default:_=function(){return c(n,l)?2:1}}for(y=P;y<M;y+=3){var N=C+D*b[y+0],T=C+D*b[y+1],F=C+D*b[y+2];s.vec3.set(m,S[N+0],S[N+1],S[N+2]),s.vec3.set(g,S[T+0],S[T+1],S[T+2]),s.vec3.set(v,S[F+0],S[F+1],S[F+2]),s.vec3.transformMat4(m,m,i),s.vec3.transformMat4(g,g,i),s.vec3.transformMat4(v,v,i),p.vectorToVector(m,o,m,a),p.vectorToVector(g,o,g,a),p.vectorToVector(v,o,v,a);var R=g[0]-m[0],j=g[1]-m[1],V=v[0]-m[0],G=v[1]-m[1];if(!(Math.abs(R*G-j*V)<E))switch(delete l._geVersion,_()){case 1:return!1;case 0:return!0}}switch(r){case"intersects":case"crosses":case"envelope-intersects":case"index-intersects":case"overlaps":case"touches":return!1;case"contains":case"disjoint":case"within":default:return!0}};var O=l.create(),P=u.vec3f32.create(),M=a.vec2f32.create()}.apply(null,n))||(e.exports=i)},1736:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(11),r(13),r(15),r(14),r(9),r(0),r(106),r(1476),r(1517)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype._validateFetchPopupFeatures=function(e){var t=this.layer;return t.popupEnabled?p.getFetchPopupTemplate(t,e)?void 0:new a("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new a("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})},t.prototype.fetchPopupFeatures=function(e,t){return o(this,void 0,void 0,function(){var e,r,n,o,a,l,d,h,f,y;return i(this,function(i){switch(i.label){case 0:return(e=this._validateFetchPopupFeatures(t))?[2,u.reject(e)]:(r=s.isSome(t)?t.clientGraphics:null)&&0!==r.length?(n=[],o=[],l=c.unpackFieldNames,d=[this.layer.fields],[4,p.getRequiredFields(this.layer,p.getFetchPopupTemplate(this.layer,t))]):[2,u.resolve([])];case 1:for(a=l.apply(void 0,d.concat([i.sent()])),h=0,f=r;h<f.length;h++)y=f[h],c.featureHasFields(a,y)?n.push(y):o.push(y);return 0===o.length?[2,u.resolve(n)]:[2,this.whenGraphicAttributes(o,a).catch(function(){return o}).then(function(e){return n.concat(e)})]}})})},n([l.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],t)}(l.declared(d));t.PopupSceneLayerView=h,t.default=h}.apply(null,n))||(e.exports=i)},2433:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(7),r(2),r(1),r(11),r(13),r(151),r(133),r(42),r(84),r(45),r(52),r(12),r(14),r(69),r(29),r(0),r(557),r(1598),r(43),r(56),r(106),r(347),r(1623),r(1476),r(1650),r(2434),r(2435),r(2436),r(1477),r(1632),r(1633),r(1482),r(1736),r(38),r(562)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p,h,f,y,_,m,g,v,b,x,I,w,A,S,C,D,E,O,P,M,N,T,F,R,j){var V=h.getLogger("esri.views.3d.layers.SceneLayerView3D"),G=N.defineFieldProperties(),L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._queryEngine=null,t.lodFactor=1,t.progressiveLoadFactor=1,t._elevationContext="scene",t._isIntegratedMesh=!1,t._asyncModuleLoading=0,t._projectionEngineLoaded=!1,t}return n(t,e),Object.defineProperty(t.prototype,"filter",{set:function(e){if(f.isNone(e))this._set("filter",null);else{var t=["contains","intersects","disjoint"];e.timeExtent?(V.warn("Filters with a timeExtent are not supported for mesh scene layers"),this._set("filter",null)):e.spatialRelationship&&-1===t.indexOf(e.spatialRelationship)?(V.warn("Filters with spatialRelationship other than "+t.join(", ")+" are not supported for mesh scene layers"),this._set("filter",null)):this._set("filter",e)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedFilterWhereClause",{get:function(){var e=f.isSome(this.filter)?this.filter.where:null;if(!e)return null;try{return g.WhereClause.create(e,this.layer.fieldsIndex)}catch(e){V.error("Failed to parse filter where clause: "+e)}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parsedFilterGeometry",{get:function(){var e=this;if(f.isNone(this.filter))return null;var t=this.filter,r=t.geometry,n=t.distance,i=t.units;if(!n)return r;if(!this._geometryEngine)return null;var o=i||y.getUnitString(r.spatialReference);if(r.spatialReference.isWGS84)return this._geometryEngine.geodesicBuffer(r,n,o);if(x.canProject(r,l.SpatialReference.WGS84))return x.project(this._geometryEngine.geodesicBuffer(x.project(r,l.SpatialReference.WGS84),n,o),r.spatialReference);if(!v.isSupported())return V.error("Filter by geodesic buffer (distance) unsupported due to lack of projection support."),null;if(!this._projectionEngineLoaded&&(this._loadAsyncModule(v.load()).then(function(){e._set("_projectionEngineLoaded",!0)}),!this._projectionEngineLoaded))return null;var a=null;try{a=v.project(r,l.SpatialReference.WGS84)}catch(e){}if(a)try{a=v.project(this._geometryEngine.geodesicBuffer(a,n,o),r.spatialReference)}catch(e){a=null}return a||V.error("Filter by geodesic buffer (distance) unsupported, failed to project input geometry ("+r.spatialReference.wkid+") to WGS84."),a},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.handles.add([_.init(this,["layer.renderer","definitionExpressionFields","filter"],function(){return e._updateRequiredFields()}),_.init(this.layer,"rangeInfos",function(t){return e._rangeInfosChanged(t)}),_.init(this.layer,"renderer",function(t){return e._rendererChange(t)}),this.watch(["parsedDefinitionExpression","layer.objectIdFilter","filter","parsedFilterWhereClause","parsedFilterGeometry"],function(){return e._filterChange()})])},t.prototype.destroy=function(){},t.prototype._updateRequiredFields=function(){return a(this,void 0,void 0,function(){var e,t,r,n,i,a,l,c;return o(this,function(o){switch(o.label){case 0:return t=(e=this).layer,r=e.layer,n=r.fields,i=r.renderer,a=e.definitionExpressionFields,l=e.filter,c=new u.default,i?[4,i.collectRequiredFields(c,n)]:[3,2];case 1:o.sent(),o.label=2;case 2:return f.isSome(l)?[4,I.collectFilterFields(c,t,l)]:[3,4];case 3:o.sent(),o.label=4;case 4:return I.collectFields(c,n,a),this._set("requiredFields",s.from(c).sort()),[2]}})})},t.prototype._rangeInfosChanged=function(e){null!=e&&e.length>0&&V.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")},t.prototype.createQuery=function(){var e={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return f.isSome(this.filter)?this.filter.createQuery(e):new w(e)},t.prototype.queryExtent=function(e){return p.safeCast(this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(e)))},t.prototype.queryFeatureCount=function(e){return p.safeCast(this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(e)))},t.prototype.queryFeatures=function(e){return p.safeCast(this._ensureQueryEngine().executeQuery(this._ensureQuery(e)))},t.prototype.queryObjectIds=function(e){return p.safeCast(this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(e)))},t.prototype._ensureQueryEngine=function(){return this._queryEngine||(this._queryEngine=this._createQueryEngine()),this._queryEngine},t.prototype._createQueryEngine=function(){var e=this,t=this._createGetFeatureExtent();return new D.default({layerView:this,priority:4,spatialIndex:new O.default({featureAdapter:new E.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:t}),forAllFeatures:function(t,r){return e._forAllFeatures(function(e,r,n){return t({id:e,index:r,meta:n})},r,2)},getFeatureExtent:t,sourceSpatialReference:P.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})},t.prototype._createGetFeatureExtent=function(){var e=this,t=new Float64Array(24),r=this.view.renderSpatialReference,n=this.view.spatialReference;return function(i){if(!i.meta.featureExtents){var o=new Float64Array(6*i.meta.featureIds.length);i.meta.featureExtents=o;for(var a=0;a<o.length;a+=6)o[a]=Number.POSITIVE_INFINITY}var s=i.meta.featureExtents,u=new Float64Array(s.buffer,6*i.index*Float64Array.BYTES_PER_ELEMENT,6);return u[0]===Number.POSITIVE_INFINITY?(e._boundingBoxCornerPoints(i.index,i.meta.engineObject,t),R.bufferToBuffer(t,r,0,t,n,0,8)?b.expandWithBuffer(b.NEGATIVE_INFINITY,t,0,8,u):b.set(u,b.ZERO)):u}},t.prototype.highlight=function(e,t){void 0===t&&(t={});var r=this._highlights;if(e instanceof w){var n=r.acquireSet(t),i=n.set,o=n.handle;return this.queryObjectIds(e).then(function(e){return r.setFeatureIds(i,e)}),o}return this.inherited(arguments)},t.prototype._createLayerGraphic=function(e){var t=new c(null,null,e);return t.layer=this.layer,t.sourceLayer=this.layer,t},t.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},t.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)||this._asyncModuleLoading>0},t.prototype.getFilters=function(){var e=this,t=this.inherited(arguments);if(this.layer.objectIdFilter){var r=new Float64Array(this.layer.objectIdFilter.ids),n="include"===this.layer.objectIdFilter.method;r.sort(),t.push(function(t){return e._objectIdFilter(r,n,t)})}if(this.addSqlFilter(t,this.parsedDefinitionExpression,this.definitionExpressionFields,this.logError),f.isSome(this.filter)){if(f.isSome(this.parsedFilterGeometry)){var i=this.parsedFilterGeometry;t.push(function(t,r){return e._maskFilter(t,r,i)})}if(this.filter.objectIds){var o=new Float64Array(this.filter.objectIds);o.sort(),t.push(function(t){return e._objectIdFilter(o,!0,t)})}}return f.isSome(this.parsedFilterWhereClause)&&this.addSqlFilter(t,this.parsedFilterWhereClause,this.parsedFilterWhereClause.fieldNames,this.logError),t},t.prototype._maskFilter=function(e,t,r){if(!f.isNone(this.filter)){var n=r,i=n.spatialReference||this.view.spatialReference;R.mbsToMbs(t.node.mbs,this._controller.crsIndex,U,i);var o=this.filter.spatialRelationship,a=C.acquireMaskFilterContext(o,this.view,n,t.engineObject),s=C.intersectMaskWithMbs(a,U);switch(C.getIntersectRelation(a,s)){case 1:return void(e.length=0);case 0:return}t.engineObject.getGeometryRecords()[0].geometry.componentCount===t.featureIds.length&&P.filterInPlace(e,t.featureIds,function(e){return C.filterMask(e,a)})}},t.prototype._filterChange=function(){var e=this;f.isSome(this.filter)&&this.filter.geometry&&!this._geometryEngine?this._loadAsyncModule(C.loadGeometryEngine()).then(function(t){e.destroyed||(e._set("_geometryEngine",t),e._applyFilters(!0))}):this.inherited(arguments)},t.prototype._loadAsyncModule=function(e){var t=this;this._set("_asyncModuleLoading",this._asyncModuleLoading+1);var r=function(){return t._set("_asyncModuleLoading",t._asyncModuleLoading-1)};return e.then(function(e){return r(),e},function(e){throw r(),e})},t.prototype._objectIdFilter=function(e,t,r){for(var n=0,i=0;n<r.length;)d.binaryIndexOf(e,r[n])>=0===t&&(r[i]=r[n],i++),n++;r.length=i},t.prototype._ensureQuery=function(e){return this._addDefinitionExpressionToQuery(f.isNone(e)?this.createQuery():w.from(e))},i([m.property()],t.prototype,"layer",void 0),i([m.property({dependsOn:["_controller.updating","_asyncModuleLoading"]})],t.prototype,"updating",void 0),i([m.property({dependsOn:["_controller.rootNodeVisible"]})],t.prototype,"suspended",void 0),i([m.property(T.updatingPercentage)],t.prototype,"updatingPercentage",void 0),i([m.property({type:j})],t.prototype,"filter",null),i([m.property({readOnly:!0,dependsOn:["filter.where"]})],t.prototype,"parsedFilterWhereClause",null),i([m.property({readOnly:!0,dependsOn:["filter.geometry","filter.distance","filter.units","_geometryEngine","_projectionEngineLoaded"]})],t.prototype,"parsedFilterGeometry",null),i([m.property(G.requiredFields)],t.prototype,"requiredFields",void 0),i([m.property(G.availableFields)],t.prototype,"availableFields",void 0),i([m.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],t.prototype,"lodFactor",void 0),i([m.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],t.prototype,"updatingPercentageValue",void 0),i([m.property({readOnly:!0})],t.prototype,"_asyncModuleLoading",void 0),i([m.property({readOnly:!0})],t.prototype,"_geometryEngine",void 0),i([m.property({readOnly:!0})],t.prototype,"_projectionEngineLoaded",void 0),i([m.subclass("esri.views.3d.layers.SceneLayerView3D")],t)}(m.declared(S,A.I3SMeshView3D,F.PopupSceneLayerView,M.DefinitionExpressionSceneLayerView)),U=[0,0,0,0];return L}.apply(null,n))||(e.exports=i)},2434:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1),r(2),r(11),r(13),r(6),r(15),r(20),r(14),r(0),r(36),r(1515),r(1416),r(347)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,p,h,f){Object.defineProperty(t,"__esModule",{value:!0});var y=p.default,_=function(e){function t(t){var r=e.call(this)||this;return r._dataQueryEngineInstance=null,r._handles=new u,r}return n(t,e),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new f({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this._handles.add(this.layerView.on("visible-geometry-changed",function(){return e.spatialIndex.events.emit("changed")}))},t.prototype.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null),this._handles&&(this._handles.destroy(),this._handles=null),this._set("layerView",null)},t.prototype.executeQueryForCount=function(e,t){return o(this,void 0,void 0,function(){return i(this,function(r){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForExtent=function(e,t){return o(this,void 0,void 0,function(){var r,n,o,a;return i(this,function(i){switch(i.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return r=i.sent(),n=r.count,o=r.extent,a=d.fromJSON(o),[2,{count:n,extent:a}]}})})},t.prototype.executeQueryForIds=function(e,t){return o(this,void 0,void 0,function(){return i(this,function(r){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQuery=function(e,t){return o(this,void 0,void 0,function(){var r,n,o,a=this;return i(this,function(i){switch(i.label){case 0:if((r=this._ensureQueryJSON(e)).returnGeometry)throw new s("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(r.returnCentroid)throw new s("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");return[4,this.dataQueryEngine.executeQuery(r,t)];case 1:return n=i.sent(),(o=h.fromJSON(n)).features.forEach(function(e){e.geometry=null,e.layer=a.layer,e.sourceLayer=a.layer}),[2,o]}})})},t.prototype._ensureQueryJSON=function(e){if(l.isNone(e))return this.defaultQueryJSON;var t=e.toJSON();return t.outSpatialReference||(e.outSpatialReference=this.spatialReference),t},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e=this.layer.objectIdField||"OBJECTID",t=this.layer.fields.map(function(e){return e.toJSON()}),r=this.layerView.view.resourceController.scheduler,n=this.spatialReference.toJSON(),i=this.priority,o=this.spatialIndex;return this._dataQueryEngineInstance=new y({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:t,timeInfo:null,spatialReference:n,objectIdField:e,featureStore:o,scheduler:r,priority:i}),this._dataQueryEngineInstance},r([c.property({constructOnly:!0})],t.prototype,"layerView",void 0),r([c.property({constructOnly:!0})],t.prototype,"priority",void 0),r([c.property({constructOnly:!0})],t.prototype,"spatialIndex",void 0),r([c.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),r([c.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),r([c.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),r([c.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],t)}(c.declared(a));t.I3SQueryEngine=_,t.default=_}.apply(null,n))||(e.exports=i)},2435:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(43),r(1494),r(552),r(1477)],void 0===(i=function(e,t,r,n,i,o){Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){this.objectIdField=e.objectIdField,this.getFeatureExtent=e.getFeatureExtent}return e.prototype.getObjectId=function(e){return e.id},e.prototype.getAttributes=function(e){var t=e.meta,r=e.index,n={};this.objectIdField&&(n[this.objectIdField]=e.id);var i=t.attributeInfo.attributeData;if(null!=i)for(var a=0,s=Object.keys(i);a<s.length;a++){var u=s[a];n[u]=o.getCachedAttributeValue(i[u],r)}return n},e.prototype.getAttribute=function(e,t){if(t===this.objectIdField)return e.id;var r=e.meta,n=e.index,i=r.attributeInfo.attributeData;return null==i?null:o.getCachedAttributeValue(i[t],n)},e.prototype.getGeometry=function(e){if(e.geometry)return e.geometry;var t=this.getFeatureExtent(e,s),r=t[0],n=t[1],o=t[2],a=t[3],u=t[4];return new i.default([5],[r,n,o,a,n,o,a,u,o,r,u,o,r,n,o])},e.prototype.getCentroid=function(e,t){if(e.geometry)return n.getCentroidOptimizedGeometry(new i.default,e.geometry,t.hasZ,t.hasM);var r=this.getFeatureExtent(e,s),o=r[0],a=r[1],u=r[2],l=r[3],c=r[4],d=r[5];return new i.default([0],[(o+l)/2,(a+c)/2,(u+d)/2])},e.prototype.cloneWithGeometry=function(e,t){return{id:e.id,index:e.index,meta:e.meta,geometry:t}},e}();t.I3SQueryFeatureAdapter=a;var s=r.create()}.apply(null,n))||(e.exports=i)},2436:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(6),r(37),r(0),r(33),r(43),r(35),r(38)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t){var r=e.call(this)||this;return r.events=new o,r}return r(t,e),t.prototype.destroy=function(){},t.prototype.forEach=function(e){this.forAllFeatures(function(t){return e(t),1})},t.prototype.forEachBounds=function(e,t,r){for(var n=this.getFeatureExtent,i=0,o=e;i<o.length;i++)t(n(o[i],r))},t.prototype.forEachInBounds=function(e,t){var r=this;this.forAllFeatures(function(n){var i=r.getFeatureExtent(n,h);return l.intersects(e,u.toRect(i,f))&&t(n),1},function(t){if(c.mbsToMbs(t.node.mbs,r.sourceSpatialReference,p,r.viewSpatialReference),p[0]>=e[0]&&p[2]<=e[2]&&p[1]>=e[1]&&p[3]<=e[3])return 1;var n=Math.max(e[0],Math.min(p[0],e[2])),i=Math.max(e[1],Math.min(p[1],e[3])),o=p[0]-n,a=p[1]-i;return o*o+a*a<=p[3]*p[3]?1:2})},n([a.property({constructOnly:!0})],t.prototype,"featureAdapter",void 0),n([a.property({constructOnly:!0})],t.prototype,"forAllFeatures",void 0),n([a.property({constructOnly:!0})],t.prototype,"getFeatureExtent",void 0),n([a.property({constructOnly:!0})],t.prototype,"sourceSpatialReference",void 0),n([a.property({constructOnly:!0})],t.prototype,"viewSpatialReference",void 0),n([a.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],t)}(a.declared(i));t.I3SQueryFeatureStore=d;var p=s.vec4f64.create(),h=u.create(),f=l.create();t.default=d}.apply(null,n))||(e.exports=i)}}]);