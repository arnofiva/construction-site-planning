(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/pbf":1481,"esri/core/MapPool":1683,"esri/views/2d/layers/features/processors/BaseProcessor":1734,"esri/views/2d/layers/features/processors/SymbolProcessor":2430})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{1481:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(22)],void 0===(n=function(e,t,r){var i=r("esri-text-decoder")?TextDecoder:null;return function(){function e(e,t,r,n){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=n||e.byteLength,this._textDecoder=i?new i("utf-8"):null}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,i=new e(this._data,this._dataView,r,r+t);return this._skip(t),i},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){if(r=Math.min(this._end,r),this._textDecoder){var i=e.subarray(t,r);return this._textDecoder.decode(i)}for(var n="",o="",s=t;s<r;++s){var a=e[s];128&a?o+="%"+a.toString(16):(n+=decodeURIComponent(o)+String.fromCharCode(a),o="")}return o.length&&(n+=decodeURIComponent(o)),n},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,i))||(e.exports=n)},1683:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(85)],void 0===(n=function(e,t,r){var i=function(){function e(e,t){void 0===e&&(e=50),void 0===t&&(t=50),this._pool=new r(Map,!1,function(e){return e.clear()},t,e)}return e.prototype.acquire=function(){return this._pool.acquire()},e.prototype.release=function(e){this._pool.release(e)},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}(),n=new i(100);return i}.apply(null,i))||(e.exports=n)},1734:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(13),r(6),r(37),r(348),r(0)],void 0===(n=function(e,t,r,i,n,o,s,a,p,l){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.initialize=function(){},t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null},enumerable:!0,configurable:!0}),i([l.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),i([l.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),i([l.property({constructOnly:!0})],t.prototype,"service",void 0),i([l.property({dependsOn:["tileStore.tileScheme.spatialReference"]})],t.prototype,"spatialReference",null),i([l.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),i([l.property({constructOnly:!0})],t.prototype,"tileStore",void 0),i([l.subclass("esri.views.2d.layers.features.processors.BaseProcessor")],t)}(l.declared(s,p,a));t.default=u}.apply(null,i))||(e.exports=n)},2430:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(7),r(11),r(13),r(52),r(15),r(22),r(12),r(1683),r(14),r(9),r(0),r(39),r(570),r(612),r(359),r(1472),r(1555),r(1734)],void 0===(n=function(e,t,r,i,n,o,s,a,p,l,u,c,h,f,d,y,g,_,v,b,m,w){function I(e,t,r){r.has(e)||r.set(e,new Set);for(var i=r.get(e),n=t.length,o=0;o<n;o++){var s=t.charCodeAt(o);i.add(s)}}Object.defineProperty(t,"__esModule",{value:!0});var S=u.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor"),k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._symbolToMosaicItemMap=new Map,t._visualSetPromises=new Map,t.type="symbol",t}return r(t,e),t.prototype.destroy=function(){this._visualSetPromises.clear(),this._symbolToMosaicItemMap.clear(),this.notifyChange("updating")},Object.defineProperty(t.prototype,"supportsTileUpdates",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelingInfo",{get:function(){return!this.config||h.isNone(this.config.labelingInfo)?null:this.config.labelingInfo.map(function(e){return g.fromJSON(e)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelClassInfos",{get:function(){var e=this;return this.labelingInfo?f.all(this.labelingInfo.map(function(t,r){return s(e,void 0,void 0,function(){var e;return o(this,function(i){switch(i.label){case 0:return e={index:r,minScale:t.minScale,maxScale:t.maxScale},[4,_.createLabelFunction(t,this.fields,this.spatialReference)];case 1:return[2,(e.builder=i.sent(),e.symbol=t.symbol,e)]}})})})):f.resolve()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hydrate",{get:function(){return m.createHydrateFactory(this.service.geometryType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factory",{get:function(){var e=this;if(!this.config)return S.error(new p("mapview-processor","Unable to create factory without a configuration")),null;var t=this.service,r=t.geometryType,i=t.objectIdField,n={geometryType:r,fields:t.fields,spatialReference:y.fromJSON(this.spatialReference)},o=new b.WGLTemplateStore(function(t,r){return e.remoteClient.invoke("tileRenderer.getMaterialItems",t,r)}),s=this.tileStore.tileScheme.tileInfo;return this._matcher=b.createMatcher(this.renderer,o,n),new b.WGLMeshFactory(r,i,this.renderer,o,this.labelingInfo,s)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?v.fromJSON(this.config.renderer):(l("esri-2d-debug")&&console.debug("Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._visualSetPromises.size>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fields",{get:function(){return this.service.fields},enumerable:!0,configurable:!0}),t.prototype.update=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){return this._set("config",e),[2]})})},t.prototype.onTileData=function(e,t,r){var i,n=this,o=t.addOrUpdate,s=t.remove,a=t.clear;i=o&&o.length?this._processFeatures(e,o,t.transformParams):f.resolve();var p=r.signal,l=i.then(function(t){var r=t&&t.message||null,i=t&&t.transferList||null;return n.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{addOrUpdate:r,remove:s,clear:a}},{transferList:i,signal:p})}).catch(function(t){return n._handleError(e,t,r)});return this._visualSetPromises.set(e,l),f.always(l,function(){return n._cleanPromise(e)}),this.notifyChange("updating"),l},t.prototype.onTileError=function(e,t,r){var i=this,n=r.signal,o=this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},{signal:n});return this._visualSetPromises.set(e,o),f.always(o,function(){return i._cleanPromise(e)}),this.notifyChange("updating"),o},t.prototype._cleanPromise=function(e){this._visualSetPromises.delete(e),this.notifyChange("updating")},t.prototype._processFeatures=function(e,t,r){var i=this;if(!t||!t.length)return f.resolve(null);var n=this.factory,o={viewingMode:"",scale:e.scale};return a.safeCast(this._matcher.then(function(e){return n.analyze(t,e,r,o)})).then(function(t){return a.safeCast(i._getLabelMosaicItems(e,t,r)).then(function(o){return i._writeFeatures(e,t,r,o,n)})})},t.prototype._writeFeatures=function(e,t,r,i,n){for(var o=n.createMeshData(t.length),s={viewingMode:"",scale:e.scale},a=this._symbolToMosaicItemMap,p=0,l=t;p<l.length;p++){var u=l[p];n.write(o,u,r,s,e.level,i,a)}return this._encodeDisplayData(o)},t.prototype._encodeDisplayData=function(e){var t={},r=new Array;return e.encode(t,r),{message:t,transferList:r}},t.prototype._handleError=function(e,t,r){var i=r.signal;if(!f.isAbortError(t))return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t.message},{signal:i})},t.prototype._getLabelMosaicItems=function(e,t,r){return s(this,void 0,void 0,function(){var i,n,s,a,p,l;return o(this,function(o){switch(o.label){case 0:return i=c.acquire(),[4,this._createLabelFeatures(e.scale,t,i,r)];case 1:return n=o.sent(),s=this._symbolToMosaicItemMap,a=c.acquire(),p=[],l=0,i.forEach(function(e,t){if(s.has(t.id)){var r=s.get(t.id).glyphMosaicItems,i=[];e.forEach(function(e){(r&&r.length<e||!r[e])&&(i[e]=e)}),i.length>0&&(a.set(l,t),p.push({symbol:t.toJSON(),id:l,glyphIds:i}),l++)}else{a.set(l,t);var n=[];e.forEach(function(e){return n.push(e)}),p.push({symbol:t.toJSON(),id:l,glyphIds:n}),l++}}),p.length>0?[2,this.remoteClient.invoke("tileRenderer.getMaterialItems",p).then(function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],o=a.get(i.id);if(o)if(b.Utils.isTextSymbol(o))if(s.has(o.id)){var p=s.get(o.id).glyphMosaicItems,l=i.mosaicItem.glyphMosaicItems;if(l)for(var u=0;u<l.length;u++)null!=l[u]&&(p[u]=l[u])}else s.set(o.id,i.mosaicItem);else s.set(o.id,i.mosaicItem)}return c.release(a),n})]:(c.release(i),[2,f.resolve(n)])}})})},t.prototype._getLabelClassInfosForScale=function(e){return s(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,this.labelClassInfos];case 1:return[2,t.sent().filter(function(t){var r=t.minScale,i=t.maxScale;return(!r||r>=e||0===r)&&(!i||i<=e||0===i)})]}})})},t.prototype._createLabelFeatures=function(e,t,r,i){return s(this,void 0,void 0,function(){var s,a,p,l,u,f,d,g,_,v,m,w,k,O,M,P,T,x,C,L,E,V,U,F,R,j,D,J;return o(this,function(o){switch(o.label){case 0:return this.labelingInfo&&t&&0!==t.length?[4,this._getLabelClassInfosForScale(e)]:[2,null];case 1:if(0===(s=o.sent()).length)return[2,null];for(a=c.acquire(),p=new b.CollisionGrid(b.definitions.COLLISION_EARLY_REJECT_BUCKET_SIZE),l=0,u=t;l<u.length;l++)if(f=u[l],d=this.service.geometryType,g=0,_=0,"esriGeometryPoint"!==d&&"esriGeometryPolygon"!==d||("esriGeometryPoint"===d?(v=f.geometry,g=v.x,_=v.y):(g=f.centroid.x,_=f.centroid.y),!p.checkOverlap(g,_))){for(m=f.localId,w=new Array,k=0;k<s.length;k++){if(O=s[k],M=O.index,P=O.builder,T=O.symbol,x=f,!i)return S.error("mapview-labeling","Tried to evaluate geometry expression but no transformation found"),[2];C=i.transform,L=i.hasZ,E=i.hasM,V=this.hydrate(f.geometry,C,L,E),U=n({},f,{geometry:V}),V.spatialReference=y.fromJSON(this.spatialReference),x=U,F=P.evaluate(x),h.isNone(F)||(b.definitions.DEBUG_LABELS&&(R="-"+m,F=F.substring(0,F.length-R.length)+R),j=b.bidiText(F),D=j[0],J=j[1],I(T,D,r),w.push({text:D,rtl:J,id:M}))}a.set(m,w)}return[2,a]}})})},i([d.property({readOnly:!0})],t.prototype,"supportsTileUpdates",null),i([d.property()],t.prototype,"config",void 0),i([d.property({dependsOn:["config"]})],t.prototype,"labelingInfo",null),i([d.property({dependsOn:["labelingInfo","fields","spatialReference"]})],t.prototype,"labelClassInfos",null),i([d.property({dependsOn:["service"]})],t.prototype,"hydrate",null),i([d.property({dependsOn:["config","service","renderer","fields","tileStore"]})],t.prototype,"factory",null),i([d.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),i([d.property({readOnly:!0})],t.prototype,"updating",null),i([d.property({dependsOn:["service"]})],t.prototype,"fields",null),i([d.subclass("esri.views.2d.layers.features.processors.SymbolProcessor")],t)}(d.declared(w.default));t.default=k}.apply(null,i))||(e.exports=n)}}]);