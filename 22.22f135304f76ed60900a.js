(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/tiling/TileSpan":1479,"esri/views/2d/layers/LayerView2D":1485,"esri/views/2d/tiling/LODInfo":1486,"esri/views/2d/tiling/TileCoverage":1487,"esri/views/2d/tiling/TileInfoView":1490,"esri/renderers/support/clickToleranceUtils":1499,"esri/views/2d/layers/support/popupUtils2D":1612,"esri/views/2d/layers/FeatureLayerView2D":1729,"esri/views/2d/layers/features/support/rendererUtils":1860,"esri/views/2d/layers/features/tileRenderers":2404,"esri/views/2d/layers/support/FeatureLayerProxy":2405,"esri/views/2d/layers/support/util":2406})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1479:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(85)],void 0===(n=function(e,t,r){return function(){function e(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}return e.pool=new r(e,!0),e}()}.apply(null,i))||(e.exports=n)},1485:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(29),r(0),r(1471)],void 0===(n=function(e,t,r,i,n,o,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.attached=!1,t.lastUpdateId=-1,t.moving=!1,t.updateRequested=!1,t}return r(t,e),t.prototype.initialize=function(){var e=this;this.when(function(){e.requestUpdate()});var t=function(){return e.notifyChange("rendering")};this.handles.add([n.init(this,"suspended",function(t){e.container&&(e.container.visible=!t),e.view&&!t&&e.updateRequested&&e.view.requestLayerViewUpdate(e)},!0),n.init(this,"fullOpacity",function(t){e.container&&(e.container.opacity=t)},!0),n.on(this,"container","post-render",t),n.on(this,"container","will-render",t)])},t.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach()),this.handles.remove("initialize"),this.updateRequested=!1,this.layer=null},Object.defineProperty(t.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0}),t.prototype.isVisibleAtScale=function(e){var t=!0,r=this.layer,i=r.minScale,n=r.maxScale;if(null!=i&&null!=n){var o=!i,s=!n;!o&&e<=i&&(o=!0),!s&&e>=n&&(s=!0),t=o&&s}return t},t.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))},t.prototype.processUpdate=function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1},t.prototype.isUpdating=function(){return!1},t.prototype.isRendering=function(){return!1},t.prototype.canResume=function(){var e=this.inherited(arguments);return e&&(e=this.isVisibleAtScale(this.view.scale)),e},i([o.property()],t.prototype,"attached",void 0),i([o.property()],t.prototype,"container",void 0),i([o.property()],t.prototype,"moving",void 0),i([o.property({dependsOn:["attached","suspended","moving"]})],t.prototype,"rendering",null),i([o.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),i([o.property({readOnly:!0})],t.prototype,"updateParameters",void 0),i([o.property()],t.prototype,"updateRequested",void 0),i([o.property({dependsOn:["updateRequested","attached"]})],t.prototype,"updating",null),i([o.property()],t.prototype,"view",void 0),i([o.subclass("esri.views.2d.layers.LayerView2D")],t)}(o.declared(s))}.apply(null,i))||(e.exports=n)},1486:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(94),r(349)],void 0===(n=function(e,t,r,i){function n(e,t){return[e,t]}function o(e,t,r){return e[0]=t,e[1]=r,e}var s=new i("0/0/0/0");return function(){function e(e,t,r,i,n,o,s,a,l,u,c,h){this.level=e,this.resolution=t,this.scale=r,this.origin=i,this.first=n,this.last=o,this.size=s,this.norm=a,this.worldStart=l,this.worldEnd=u,this.worldSize=c,this.wrap=h}return e.create=function(t,i,s){var a,l,u,c,h=r.getInfo(t.spatialReference),p=n(t.origin.x,t.origin.y),f=n(t.size[0]*i.resolution,t.size[1]*i.resolution),d=n(-1/0,-1/0),y=n(1/0,1/0),v=n(1/0,1/0);return s&&(o(d,Math.max(0,Math.floor((s.xmin-p[0])/f[0])),Math.max(0,Math.floor((p[1]-s.ymax)/f[1]))),o(y,Math.max(0,Math.floor((s.xmax-p[0])/f[0])),Math.max(0,Math.floor((p[1]-s.ymin)/f[1]))),o(v,y[0]-d[0]+1,y[1]-d[1]+1)),t.isWrappable?(a=n(Math.ceil(Math.round(2*h.origin[1]/i.resolution)/t.size[0]),v[1]),l=n(Math.floor((h.origin[0]-p[0])/f[0]),d[1]),u=n(a[0]+l[0]-1,y[1]),c=!0):(l=d,u=y,a=v,c=!1),new e(i.level,i.resolution,i.scale,p,d,y,v,f,l,u,a,c)},e.prototype.normalizeCol=function(e){if(!this.wrap)return e;var t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t},e.prototype.denormalizeCol=function(e,t){return this.wrap?this.worldSize[0]*t+e:e},e.prototype.getWorldForColumn=function(e){return this.wrap?Math.floor(e/this.worldSize[0]):0},e.prototype.getFirstColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]},e.prototype.getLastColumnForWorld=function(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1},e.prototype.getColumnForX=function(e){return(e-this.origin[0])/this.norm[0]},e.prototype.getXForColumn=function(e){return this.origin[0]+e*this.norm[0]},e.prototype.getRowForY=function(e){return(this.origin[1]-e)/this.norm[1]},e.prototype.getYForRow=function(e){return this.origin[1]-e*this.norm[1]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),s.set(t);var i=r?s.col:this.denormalizeCol(s.col,s.world),n=s.row;return function(e,t,r,i,n){e[0]=t,e[1]=r,e[2]=i,e[3]=n}(e,this.getXForColumn(i),this.getYForRow(n+1),this.getXForColumn(i+1),this.getYForRow(n)),e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),s.set(t);var i=r?s.col:this.denormalizeCol(s.col,s.world);return Array.isArray(e)?o(e,this.getXForColumn(i),this.getYForRow(s.row)):(e.x=this.getXForColumn(i),e.y=this.getYForRow(s.row)),e},e}()}.apply(null,i))||(e.exports=n)},1487:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(204),r(85),r(1479)],void 0===(n=function(e,t,r,i,n){return function(){function e(e){this.lodInfo=e,this.spans=r.acquire()}return e.prototype.release=function(){for(var e=0,t=this.spans;e<t.length;e++){var i=t[e];n.pool.release(i)}r.release(this.spans)},e.prototype.forEach=function(e,t){var r=this.spans,i=this.lodInfo,n=i.level;if(0!==r.length)for(var o=0,s=r;o<s.length;o++)for(var a=s[o],l=a.row,u=a.colFrom,c=a.colTo,h=u;h<=c;h++)e.call(t,n,l,i.normalizeCol(h),i.getWorldForColumn(h))},e.pool=new i(e,!0),e}()}.apply(null,i))||(e.exports=n)},1490:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(94),r(1486),r(1487),r(349),r(1479)],void 0===(n=function(e,t,r,i,n,o,s){var a=new o("0/0/0/0"),l=function(){function e(e,t,r,i,n,o,s,a){this.x=e,this.ymin=t,this.ymax=r,this.invM=i,this.leftAdjust=n,this.rightAdjust=o,this.leftBound=s,this.rightBound=a}return e.create=function(t,r){var i;t[1]>r[1]&&(t=(i=[r,t])[0],r=i[1]);var n=t[0],o=t[1],s=r[0],a=r[1],l=s-n,u=a-o,c=0!==u?l/u:0,h=(Math.ceil(o)-o)*c,p=(Math.floor(o)-o)*c;return new e(n,Math.floor(o),Math.ceil(a),c,l<0?h:p,l<0?p:h,l<0?s:n,l<0?n:s)},e.prototype.incrRow=function(){this.x+=this.invM},e.prototype.getLeftCol=function(){return Math.max(this.x+this.leftAdjust,this.leftBound)},e.prototype.getRightCol=function(){return Math.min(this.x+this.rightAdjust,this.rightBound)},e}(),u=[[0,0],[0,0],[0,0],[0,0]];return function(){function e(e,t){var r=this;this.tileInfo=e,this.fullExtent=t,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};var n=e.lods.slice();n.sort(function(e,t){return t.scale-e.scale});var o=this._lodInfos=n.map(function(r){return i.create(e,r,t)});n.forEach(function(e,t){r._infoByLevel[e.level]=o[t],r._infoByScale[e.scale]=o[t],r.scales[t]=e.scale},this),this._wrap=e.isWrappable}return Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this.tileInfo.spatialReference},enumerable:!0,configurable:!0}),e.prototype.getLODInfoAt=function(e){return this._infoByLevel["number"==typeof e?e:e.level]},e.prototype.getTileBounds=function(e,t,r){void 0===r&&(r=!1),a.set(t);var i=this._infoByLevel[a.level];return i?i.getTileBounds(e,a,r):e},e.prototype.getTileCoords=function(e,t,r){void 0===r&&(r=!1),a.set(t);var i=this._infoByLevel[a.level];return i?i.getTileCoords(e,a,r):e},e.prototype.getTileCoverage=function(e,t,r){void 0===t&&(t=192),void 0===r&&(r="closest");var i,o,a,c="closest"===r?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),h=n.pool.acquire(c),p=this._wrap,f=1/0,d=-1/0,y=h.spans;u[0][0]=u[0][1]=u[1][1]=u[3][0]=-t,u[1][0]=u[2][0]=e.size[0]+t,u[2][1]=u[3][1]=e.size[1]+t;for(var v=0,g=u;v<g.length;v++){var m=g[v];e.toMap(m,m),m[0]=c.getColumnForX(m[0]),m[1]=c.getRowForY(m[1])}for(var _=[],b=3,w=0;w<4;w++)if(u[w][1]!==u[b][1]){var S=l.create(u[w],u[b]);f=Math.min(S.ymin,f),d=Math.max(S.ymax,d),void 0===_[S.ymin]&&(_[S.ymin]=[]),_[S.ymin].push(S),b=w}else b=w;if(null==f||null==d||d-f>100)return null;var R=[];for(i=f;i<d;){null!=_[i]&&(R=R.concat(_[i])),o=1/0,a=-1/0;for(w=R.length-1;w>=0;w--){S=R[w];o=Math.min(o,S.getLeftCol()),a=Math.max(a,S.getRightCol())}if(o=Math.floor(o),a=Math.floor(a),i>=c.first[1]&&i<=c.last[1])if(p)if(c.size[0]<c.worldSize[0]){var x=Math.floor(a/c.worldSize[0]);for(w=Math.floor(o/c.worldSize[0]);w<=x;w++)y.push(new s(i,Math.max(c.getFirstColumnForWorld(w),o),Math.min(c.getLastColumnForWorld(w),a)))}else y.push(new s(i,o,a));else o>c.last[0]||a<c.first[0]||(o=Math.max(o,c.first[0]),a=Math.min(a,c.last[0]),y.push(new s(i,o,a)));i+=1;for(w=R.length-1;w>=0;w--){(S=R[w]).ymax>=i?S.incrRow():R.splice(w,1)}}return h},e.prototype.getTileParentId=function(e){a.set(e);var t=this._infoByLevel[a.level],r=this._lodInfos.indexOf(t)-1;return r<0?null:(this._getTileIdAtLOD(a,this._lodInfos[r],a),a.id)},e.prototype.getTileResolution=function(e){var t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1},e.prototype.getTileScale=function(e){var t=this._infoByLevel[e.level];return t?t.scale:-1},e.prototype.intersects=function(e,t){a.set(t);var r=this._infoByLevel[a.level],i=e.lodInfo;if(i.resolution>r.resolution){this._getTileIdAtLOD(a,i,a);for(var n=i.denormalizeCol(a.col,a.world),o=0,s=e.spans;o<s.length;o++){var l=s[o];if(l.row===a.row&&l.colFrom<=n&&l.colTo>=n)return!0}}if(i.resolution<r.resolution){var u=e.spans.reduce(function(e,t){return e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e},[1/0,-1/0,1/0,-1/0]),c=u[0],h=u[1],p=u[2],f=u[3],d=r.denormalizeCol(a.col,a.world),y=i.getColumnForX(r.getXForColumn(d)),v=i.getRowForY(r.getYForRow(a.row)),g=i.getColumnForX(r.getXForColumn(d+1))-1,m=i.getRowForY(r.getYForRow(a.row+1))-1;return!(y>f||g<p||v>h||m<c)}var _=i.denormalizeCol(a.col,a.world);return e.spans.some(function(e){return e.row===a.row&&e.colFrom<=_&&e.colTo>=_})},e.prototype.normalizeBounds=function(e,t,i){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){var n=r.getInfo(this.tileInfo.spatialReference),o=-i*(n.valid[1]-n.valid[0]);e[0]+=o,e[2]+=o}return e},e.prototype.getSmallestInfoForScale=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(var r=1;r<t.length-1;r++)if(e>t[r]+1e-6)return this._infoByScale[t[r-1]];return this._infoByScale[t[t.length-1]]},e.prototype.getClosestInfoForScale=function(e){var t=this.scales;return this._infoByScale[e]?this._infoByScale[e]:(e=t.reduce(function(t,r,i,n){return Math.abs(r-e)<Math.abs(t-e)?r:t},t[0]),this._infoByScale[e])},e.prototype.scaleToLevel=function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(var r=t.length-1;r>=0;r--)if(e<t[r]){return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1])}return this._infoByScale[t[0]].level},e.prototype.scaleToZoom=function(e){return this.tileInfo.scaleToZoom(e)},e.prototype._getTileIdAtLOD=function(e,t,r){var i=this._infoByLevel[r.level];return e.set(r),t.resolution<i.resolution?null:t.resolution===i.resolution?e:(e.level=t.level,e.col=Math.floor(r.col*i.resolution/t.resolution+.01),e.row=Math.floor(r.row*i.resolution/t.resolution+.01),e)},e}()}.apply(null,i))||(e.exports=n)},1499:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):t&&t.yoffset?Math.max(e,Math.abs(t.yoffset)):e}function i(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,i=0;i<e.length;i++){var n=e[i].size;"number"==typeof n&&(t+=n,r++)}return t/r}(e.stops):t}function n(e,t){if(!t)return e;for(var r=t.filter(function(e){return"size"===e.type}).map(function(t){var r=t.maxSize,n=t.minSize;return(i(r,e)+i(n,e))/2}),n=0,o=r.length,s=0;s<o;s++)n+=r[s];var a=Math.floor(n/o);return Math.max(a,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=function(e){if(!e)return 6;var t="visualVariables"in e?n(6,e.visualVariables):6;if("simple"===e.type)return r(t,e.symbol);if("unique-value"===e.type){var i=t;return e.uniqueValueInfos.forEach(function(e){i=r(i,e.symbol)}),i}if("class-breaks"===e.type){var o=t;return e.classBreakInfos.forEach(function(e){o=r(o,e.symbol)}),o}return e.type,t}}.apply(null,i))||(e.exports=n)},1612:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(1),r(36)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryGeometry=function(e,t,r){var i=r.get("state.resolution"),o=t*("number"==typeof i?i:1),s=e.clone().offset(-o,-o),a=e.clone().offset(o,o),l=r.spatialReference;return new n({xmin:Math.min(s.x,a.x),ymin:Math.min(s.y,a.y),xmax:Math.max(s.x,a.x),ymax:Math.max(s.y,a.y),spatialReference:l})}}.apply(null,i))||(e.exports=n)},1729:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(119),r(7),r(11),r(13),r(151),r(133),r(42),r(84),r(45),r(52),r(28),r(15),r(22),r(12),r(14),r(9),r(59),r(29),r(0),r(1499),r(1416),r(347),r(1472),r(1485),r(2404),r(1860),r(2405),r(1612),r(2406),r(1593),r(1861),r(562),r(1862)],void 0===(n=function(e,t,r,i,n,o,s,a,l,u,c,h,p,f,d,y,v,g,m,_,b,w,S,R,x,F,O,C,I,M,q,T,P,j,L,V,E){var z=g.getLogger("esri.views.2d.layers.FeatureLayerView2D");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._pipelineIsUpdating=!0,t._updatingPipelineConfig=!1,t._visibilityOverrides=new u.default,t._effect=null,t._highlightIDs=new u.default,t._highlightRequested=!1,t._outstandingIdRequests=0,t.container=new O.Container,t.filter=null,t._onRenderingConfigChange=_.debounce(f.safeCastFunction(function(){return a(t,void 0,void 0,function(){var e,t,r,i,n,o,a,l,u,c,h;return s(this,function(s){switch(s.label){case 0:return this._hasRequiredSupport(this.layer)?(this._set("_updatingPipelineConfig",!0),e=this._createLayerFilterHash(),t=this._createTileRendererHash(),r=this._createFeatureDataHash(),i=this._createMeshHash(),[4,this._updateRequiredFields()]):[2];case 1:return s.sent(),t===this._tileRendererHash?[3,8]:[4,this._initTileRenderer()];case 2:return s.sent(),function(e){return e&&"openPorts"in e}(this.layer.source)?[4,this._createMemoryServiceOptions(this.layer.source)]:[3,4];case 3:return o=s.sent(),[3,5];case 4:o=this._createServiceOptions(),s.label=5;case 5:return n=o,[4,this._proxy.startup(this.view.featuresTilingScheme,this._createConfiguration(),n)];case 6:return s.sent(),[4,this._onceTilesUpdated()];case 7:return s.sent(),[3,13];case 8:return a=e!==this._layerFilterHash,l=r!==this._featureDataHash,u=i!==this._meshHash,c=this._createConfiguration(),a||l||u?(h={invalidateFeatureData:l,invalidateMesh:u,layerFilterChanged:a},[4,this._proxy.update(c,h)]):[3,10];case 9:s.sent(),s.label=10;case 10:return a?[4,this._onceTilesUpdated()]:[3,12];case 11:s.sent(),s.label=12;case 12:this.tileRenderer.onConfigUpdate(),s.label=13;case 13:return this._layerFilterHash=e,this._tileRendererHash=t,this._meshHash=i,this._featureDataHash=r,this.effects.forEach(function(e){return m.isSome(e)&&m.isSome(e.filter)&&e.filter.enable()}),this.tileRenderer.invalidateLabels(),this.requestUpdate(),[2]}})})})),t}return r(t,e),t.prototype.destroy=function(){this._proxy.destroy()},t.prototype.initialize=function(){this.addResolvingPromise(f.safeCast(this._initProxy()))},t.prototype._initProxy=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){if(this.layer.isTable)throw new y("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});return this._proxy&&this._proxy.destroy(),e=this._createClientOptions(),this._proxy=new q.default({client:e}),[2,this._proxy.when()]})})},Object.defineProperty(t.prototype,"labelsVisible",{get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effect",{get:function(){return m.unwrapOr(this._effect,null)},set:function(e){var t=this._effect;m.isSome(t)&&m.isSome(t.filter)&&t.filter.enabled&&m.isSome(e)&&m.isSome(e.filter)&&e.filter.enable(),this._effect=e,this.notifyChange("effect")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effects",{get:function(){return this.effect&&[this.effect]||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numFeatures",{get:function(){var e=0;return this.attached&&this._tileStrategy.tiles.forEach(function(t){e+=t.iconDisplayRecords?t.iconDisplayRecords.length:0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingConfigHash",{get:function(){if(!this.layer)return null;var e=this.availableFields,t=this.layer,r=t.definitionExpression,i=t.renderer,n=t.labelingInfo,o="historicMoment"in this.layer?this.layer.historicMoment:null,s=this.timeExtent,a="filter"in this.layer&&this.layer.filter&&""+JSON.stringify(this.layer.filter.geometry)+this.layer.filter.where;return JSON.stringify({filterHash:m.isSome(this.filter)&&this.filter.toJSON(),effectHash:m.isSome(this.effect)&&this.effect.toJSON(),streamFilter:a,definitionExpression:r,historicMoment:o,availableFields:e,renderer:i,labelingInfo:n,timeExtent:s})},enumerable:!0,configurable:!0}),t.prototype.highlight=function(e){var t,r=this;return e instanceof h?t=[e.getAttribute(this.layer.objectIdField||"__esri_stream_id__")]:"number"==typeof e?t=[e]:d.isCollection(e)?t=e.map(function(e){return e&&e.getAttribute(r.layer.objectIdField)}).toArray():Array.isArray(e)&&e.length>0&&(t="number"==typeof e[0]?e:e.map(function(e){return e&&e.getAttribute(r.layer.objectIdField)})),(t=t.filter(function(e){return null!=e})).length&&this._addHighlight(t),{remove:function(){return r._removeHighlight(t)},pause:function(){return r._removeHighlight(t)},resume:function(){return r._addHighlight(t)}}},t.prototype.getLocalIdsToHighlight=function(){return a(this,void 0,void 0,function(){var e,t,r,i,n;return s(this,function(o){switch(o.label){case 0:if(e=[],!this.hasHighlight())return[2,{isEmpty:!0,has:function(e){return!1}}];this._set("_outstandingIdRequests",this._outstandingIdRequests+1),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._proxy.mapValidLocalIds(l.from(this._highlightIDs))];case 2:return e=o.sent(),[3,4];case 3:return o.sent(),v("esri-2d-debug")&&console.debug("Unable to map valid local Ids"),[3,4];case 4:for(this._set("_outstandingIdRequests",this._outstandingIdRequests-1),t=new u.default,r=0,i=e;r<i.length;r++)n=i[r],t.add(n);return[2,{isEmpty:0===t.size,has:function(e){return t.has(e)}}]}})})},t.prototype.hasHighlight=function(){return!!this._highlightIDs.size},t.prototype.hitTest=function(e,t){return f.safeCast(this._hitTest(e,t))},t.prototype.queryFeatures=function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then(function(e){var t=x.fromJSON(e);return t.features.forEach(function(e){e.layer=r.layer,e.sourceLayer=r.layer}),t})},t.prototype.queryFeaturesJSON=function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)},t.prototype.queryObjectIds=function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)},t.prototype.queryFeatureCount=function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)},t.prototype.queryExtent=function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then(function(e){return{count:e.count,extent:c.Extent.fromJSON(e.extent)}})},t.prototype.setVisibility=function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._renderingConfigHashChanged()},t.prototype.update=function(e){this.attached&&this._tileStrategy&&this.tileRenderer&&(this._tileStrategy.update(e)||this.requestUpdate(),this._proxy.setViewState(e.state),this.notifyChange("numFeatures"),this.notifyChange("updating"))},t.prototype.attach=function(){var e=this;this._tileStrategy=new j({cachePolicy:"purge",acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add([w.watch(this,"layer.processing?.version",function(t){return e._proxy.redraw()}),this.layer.on("edits",function(t){return e._proxy.onEdits(t)}),w.init(this,"renderingConfigHash",function(){return e._renderingConfigHashChanged()})],"attach")},t.prototype.detach=function(){this.container.removeAllChildren(),this.handles.remove("attach"),this._updatingPipelineConfig=!1,this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null)},t.prototype.moveStart=function(){this.requestUpdate()},t.prototype.viewChange=function(){this.requestUpdate()},t.prototype.moveEnd=function(){this.requestUpdate()},t.prototype.fetchPopupFeatures=function(e,t){return a(this,void 0,void 0,function(){var r,i,n;return s(this,function(o){return(r=this.validateFetchPopupFeatures(t))?[2,_.reject(r)]:(i=this.fetchClientPopupFeatures(t),e?(n=this._fetchServicePopupFeatures(e,t),[2,_.eachAlwaysValues([i,n]).then(p.flatten)]):[2,i])})})},t.prototype._fetchServicePopupFeatures=function(e,t){return a(this,void 0,void 0,function(){var r,i,n,o,a,l,c,h,p,f;return s(this,function(s){switch(s.label){case 0:return[4,this.createPopupQuery(t)];case 1:if(r=s.sent(),i=this.layer,n=i.renderer,o=R.calculateTolerance(n),r.geometry=this.createFetchPopupFeaturesQueryGeometry(e,o),a=new u.default,l=i.objectIdField,c=m.isSome(t)?t.clientGraphics:null)for(h=0,p=c;h<p.length;h++)f=p[h],a.add(f.attributes[l]);return[2,i.queryFeatures(r).then(function(e){return e.features.filter(function(e){return!a.has(e.attributes[l])})})]}})})},t.prototype.createFetchPopupFeaturesQueryGeometry=function(e,t){return T.createQueryGeometry(e,t,this.view)},t.prototype.doRefresh=function(e){return a(this,void 0,void 0,function(){return s(this,function(e){return this._proxy.refresh(),[2]})})},t.prototype.isUpdating=function(){return null!=this.layer.renderer&&(null==this.tileRenderer||0!==this._outstandingIdRequests||this._pipelineIsUpdating||this._updatingPipelineConfig||this.tileRenderer.updating)},t.prototype._createClientOptions=function(){var e=this;return{executeProcessing:function(t){if(!("processing"in e.layer&&e.layer.processing))return t.featureSet;var r=e.layer.processing;return r.process(t.featureSet,r.options)||_.reject(new y("FeatureLayer","invalid processing.process() method, returns nothing"))},setUpdating:function(t){e._set("_pipelineIsUpdating",t)}}},t.prototype._createServiceOptions=function(){var e=this.layer,t=e.capabilities,r=e.objectIdField,i=e.fields.map(function(e){return e.toJSON()}),n=e.fullExtent&&e.fullExtent.toJSON(),o=P.toJSONGeometryType(e.geometryType),s=e.timeInfo&&e.timeInfo.toJSON()||null;return{type:"on-demand",maxRecordCount:"maxRecordCount"in this.layer&&this.layer.maxRecordCount,tileMaxRecordCount:"tileMaxRecordCount"in this.layer&&this.layer.tileMaxRecordCount,capabilities:t,fields:i,fullExtent:n,geometryType:o,objectIdField:r,source:"dynamicDataSource"in e?e.dynamicDataSource?e.parsedUrl:e.url+"/"+e.layerId:e.parsedUrl,timeInfo:s}},t.prototype._createMemoryServiceOptions=function(e){return a(this,void 0,void 0,function(){var t;return s(this,function(r){switch(r.label){case 0:return[4,e.openPorts()];case 1:return t=r.sent(),[2,o({},this._createServiceOptions(),{type:"memory",source:t})]}})})},t.prototype._cleanUpQuery=function(e){var t=F.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t},t.prototype._acquireTile=function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",function(){t.requestUpdate()}),r},t.prototype._releaseTile=function(e){this.tileRenderer.releaseTile(e)},t.prototype._initTileRenderer=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return[4,I.createOrReuseTileRenderer(this.tileRenderer,this.layer.renderer,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer})];case 1:return e=t.sent(),this.tileRenderer?(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null,[4,this._initProxy()]):[3,3];case 2:t.sent(),t.label=3;case 3:return this.tileRenderer=this._proxy.tileRenderer=e,this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(),[2,this.tileRenderer]}})})},t.prototype._createLayerFilterHash=function(){return this.layer.definitionExpression+"."+(("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.historicMoment&&this.layer.historicMoment.getTime())+"."+(("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.gdbVersion)},t.prototype._createTileRendererHash=function(){return("heatmap"===this.layer.renderer.type?"heatmap":"symbol")+"."+("dot-density"===this.layer.renderer.type)},t.prototype._createFeatureDataHash=function(){var e=this.layer.renderer.getAttributeHash(),t=JSON.stringify(this.filter),r=m.isSome(this.effect)&&JSON.stringify(this.effect.filter),i=JSON.stringify(this.timeExtent),n="";return this._visibilityOverrides.forEach(function(e){return n+=e}),e+"."+t+"."+r+"."+i+"."+n},t.prototype._createMeshHash=function(){var e=this.layer.renderer,t=O.getVVFlags("visualVariables"in e&&e.visualVariables||[]),r=this.layer.labelingInfo&&this.layer.labelingInfo.map(function(e){return JSON.stringify(e)}).join("/");return e.getMeshHash()+"."+t+"."+r},t.prototype._injectOverrides=function(e){var t=this.filter&&this.filter.timeExtent,r=this.timeExtent&&t?this.timeExtent.intersection(t):this.timeExtent||t;if(!this._visibilityOverrides.size&&!r)return e;var i=m.isSome(this.filter)&&this.filter.clone()||new V;return i.hiddenIds=this._visibilityOverrides,i.timeExtent=r,i},t.prototype._createConfiguration=function(){var e=M.simplifyVVRenderer(this.layer.renderer),t=this.layer.labelingInfo,r=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.historicMoment&&this.layer.historicMoment.getTime(),i=("feature"===this.layer.type||"csv"===this.layer.type)&&this.layer.gdbVersion,n=new Array(O.definitions.MAX_FILTERS),o=this._injectOverrides(this.filter);return n[0]=m.isSome(o)&&o.toJSON()||null,n[1]=m.isSome(this.effect)&&this.effect.filter&&this.effect.filter.toJSON()||null,{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,labelingInfo:t&&t.map(function(e){return e.toJSON()}),renderer:e.toJSON(),gdbVersion:i,historicMoment:r,devicePixelRatio:window.devicePixelRatio||1,filters:n,processing:"processing"in this.layer&&this.layer.processing&&this.layer.processing.toWorker()}},t.prototype._hasRequiredSupport=function(e){return!("dot-density"===e.renderer.type&&!v("esri-webgl-texture-float")&&(z.error(new y("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))},t.prototype._onceTilesUpdated=function(){return this.requestUpdate(),w.once(this,"_pipelineIsUpdating")},t.prototype._renderingConfigHashChanged=function(){var e=this,t=this._onRenderingConfigChange();this._updatingPromise=t;var r=function(){return t===e._updatingPromise&&e._set("_updatingPipelineConfig",!1)};t.then(r).catch(function(e){_.isAbortError(e)||z.error(e),r()})},t.prototype._requestHighlight=function(){var e=this;this._highlightRequested||(this._highlightRequested=!0,b.schedule(function(){e.tileRenderer&&"updateHighlight"in e.tileRenderer&&e.tileRenderer.updateHighlight(),e._highlightRequested=!1}))},t.prototype._addHighlight=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._highlightIDs.add(i)}this._requestHighlight()},t.prototype._removeHighlight=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._highlightIDs.delete(i)}this._requestHighlight()},t.prototype._hitTest=function(e,t){return a(this,void 0,void 0,function(){var r,i,n,o,a=this;return s(this,function(s){switch(s.label){case 0:return this.suspended||!this.tileRenderer?[2,null]:[4,this.tileRenderer.hitTest(e,t)];case 1:return 0===(r=s.sent()).length?[2,null]:[4,_.all(r.map(function(e){return a._proxy.getObjectId(e)}))];case 2:return i=s.sent(),[4,this._proxy.queryFeatures(new F({objectIds:i,outSpatialReference:this.view.spatialReference,returnGeometry:!0}))];case 3:return(n=s.sent()).features[0]?((o=h.fromJSON(n.features[0])).layer=this.layer,o.sourceLayer=this.layer,m.isSome(o.geometry)&&(o.geometry.spatialReference=this.view.spatialReference),[2,o]):[2,null]}})})},i([S.property()],t.prototype,"_pipelineIsUpdating",void 0),i([S.property()],t.prototype,"_updatingPipelineConfig",void 0),i([S.property()],t.prototype,"_outstandingIdRequests",void 0),i([S.property({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],t.prototype,"labelsVisible",null),i([S.property({type:V})],t.prototype,"filter",void 0),i([S.property({type:E})],t.prototype,"effect",null),i([S.property({readOnly:!0,dependsOn:["effect"]})],t.prototype,"effects",null),i([S.property()],t.prototype,"numFeatures",null),i([S.property({dependsOn:["layer.renderer","availableFields","layer.definitionExpression","layer.filter?","layer.historicMoment?","layer.labelingInfo","filter","effect","timeExtent"]})],t.prototype,"renderingConfigHash",null),i([S.property()],t.prototype,"tileRenderer",void 0),i([S.property({dependsOn:["layer.renderer","tileRenderer.updating","_updatingPipelineConfig","_pipelineIsUpdating","_outstandingIdRequests"]})],t.prototype,"updating",void 0),i([S.subclass("esri.views.2d.layers.FeatureLayerView2D")],t)}(S.declared(C,L))}.apply(null,i))||(e.exports=n)},1860:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(12),r(17),r(1472)],void 0===(n=function(e,t,r,i,n){function o(e){return e.stops=function(e,t){return t.length<=l?t:(u.warn("Found "+t.length+" Visual Variable stops, but MapView only supports "+l+". Displayed stops will be simplified."),t.length>2*l?function(e,t){for(var r=t[0],n=t.slice(1),o=n.pop(),l=n[0].value,u=n[n.length-1].value,c=(u-l)/a,h=[],p=l;p<u;p+=c){for(var f=0;p>=n[f].value;)f++;var d=n[f],y=t[f-1],v=p-y.value,g=d.value===y.value?1:v/(d.value-y.value);if("color"===e){var m=n[f],_=t[f-1],b=m.color.clone();b.r=s(_.color.r,b.r,g),b.g=s(_.color.g,b.g,g),b.b=s(_.color.b,b.b,g),b.a=s(_.color.a,b.a,g),h.push({value:p,color:b,label:m.label})}else if("size"===e){var w=n[f],S=t[f-1],R=i.toPt(w.size),x=i.toPt(S.size),F=s(x,R,g);h.push({value:p,size:F,label:w.label})}else{var O=n[f],C=t[f-1],I=s(C.opacity,O.opacity,g);h.push({value:p,opacity:I,label:O.label})}}return[r].concat(h,[o])}(e,t):function(e){for(var t=e[0],r=e.slice(1),i=r.pop();r.length>a;){for(var n=0,o=0,s=1;s<r.length;s++){var l=r[s-1],u=r[s],c=Math.abs(u.value-l.value);c>o&&(o=c,n=s)}r.splice(n,1)}return[t].concat(r,[i])}(t))}(e.type,e.stops),e}function s(e,t,r){return(1-r)*e+r*t}Object.defineProperty(t,"__esModule",{value:!0});var a=n.definitions.WEBGL_MAX_INNER_STOPS,l=n.definitions.WEBGL_MAX_STOPS,u=r.getLogger("esri.renderers.visualVariables.support.utils");t.simplifyVVRenderer=function(e){if(!("visualVariables"in e&&e.visualVariables&&e.visualVariables.length))return e;var t=e.clone(),r=t.visualVariables.map(function(e){return function(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}(e)?o(e):e});return t.visualVariables=r,t}}.apply(null,i))||(e.exports=n)},2404:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(270),r(9)],void 0===(n=function(e,t,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.createOrReuseTileRenderer=function(e,t,o){if(!t)return n.resolve(null);switch(t.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":return n.create(function(e){i(function(){return r.e(82).then(function(){var t=[r(2461)];e.apply(null,t)}.bind(this)).catch(r.oe)})}).then(function(e){return e.default}).then(function(e){return new e(o)});case"heatmap":return n.create(function(e){i(function(){return r.e(80).then(function(){var t=[r(2463)];e.apply(null,t)}.bind(this)).catch(r.oe)})}).then(function(e){return e.default}).then(function(e){return new e(o)})}return n.resolve(null)}}.apply(null,i))||(e.exports=n)},2405:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(7),r(11),r(13),r(6),r(201),r(9),r(353),r(352),r(0),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,o,s,a,l,u,c,h,p,f){Object.defineProperty(t,"__esModule",{value:!0});var d=function(t){function n(e){return t.call(this,e)||this}return r(n,t),n.prototype.initialize=function(){this._controller=u.createAbortController(),this.addResolvingPromise(this._startWorker(this._controller.signal))},n.prototype.destroy=function(){this._connection.close(),this._controller.abort()},Object.defineProperty(n.prototype,"tileRenderer",{set:function(e){this.client.tileRenderer=e},enumerable:!0,configurable:!0}),n.prototype.startup=function(e,t,r){var i=this._controller.signal,n=function(e){return Array.isArray(e)}(r.source)?{transferList:r.source,signal:i}:void 0,o={service:r,config:t,tileInfo:e.tileInfo.toJSON()};return this._connection.invoke("startup",o,n)},n.prototype.update=function(e,t){var r={config:e,options:t};return this._connection.invoke("update",r)},n.prototype.refresh=function(){return this._connection.invoke("controller.refresh")},n.prototype.redraw=function(){return this._connection.invoke("controller.redraw")},n.prototype.setViewState=function(e){return this._connection.invoke("setViewState",e.toJSON())},n.prototype.queryFeatures=function(e,t){return this._connection.invoke("controller.queryFeatures",e.toJSON(),t)},n.prototype.queryObjectIds=function(e,t){return this._connection.invoke("controller.queryObjectIds",e.toJSON(),t)},n.prototype.queryFeatureCount=function(e,t){return this._connection.invoke("controller.queryFeatureCount",e.toJSON(),t)},n.prototype.queryExtent=function(e,t){return this._connection.invoke("controller.queryExtent",e.toJSON(),t)},n.prototype.queryLatestObservations=function(e,t){return this._connection.invoke("controller.queryLatestObservations",e.toJSON(),t)},n.prototype.getObjectId=function(e){return this._connection.invoke("controller.getObjectId",e)},n.prototype.getLocalId=function(e){return this._connection.invoke("controller.getLocalId",e)},n.prototype.mapValidLocalIds=function(e){return this._connection.invoke("controller.mapValidLocalIds",e)},n.prototype.onEdits=function(e){var t=e.addedFeatures,r=e.deletedFeatures,i=e.updatedFeatures;return this._connection.invoke("controller.onEdits",{addedFeatures:t,deletedFeatures:r,updatedFeatures:i})},n.prototype.enableEvent=function(e,t){return this._connection.invoke("controller.enableEvent",{name:e,value:t})},n.prototype._startWorker=function(t){return s(this,void 0,void 0,function(){var r,i;return o(this,function(n){switch(n.label){case 0:return r=c.getAbsMid("../features/Pipeline",e,f),[4,h.open(r,{client:this.client,strategy:"dedicated",signal:t})];case 1:return i=n.sent(),this._connection=i,[2]}})})},i([p.property()],n.prototype,"client",void 0),i([p.property()],n.prototype,"tileRenderer",null),i([p.subclass("esri.views.2d.layers.support.FeatureLayerProxy")],n)}(p.declared(a,l));t.default=d}.apply(null,i))||(e.exports=n)},2406:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=new r.default({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});t.toJSONGeometryType=function(e){return i.toJSON(e)}}.apply(null,i))||(e.exports=n)}}]);