(function(){(this||window).webpackJsonp.registerAbsMids({"esri/tasks/operations/PBFWorker":1417,"esri/tasks/operations/query":1418,"esri/geometry/support/normalizeUtils":1473,"esri/tasks/geometry/cut":1474,"esri/tasks/geometry/simplify":1475,"esri/core/pbf":1481,"esri/tasks/operations/pbfQueryUtils":1491,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1492,"esri/tasks/operations/pbfFeatureServiceParser":1507,"esri/tasks/operations/pbfDehydratedFeatureSet":1508,"esri/tasks/operations/pbfOptimizedFeatureSet":1509,"esri/tasks/operations/urlUtils":1510,"esri/layers/graphics/data/FeatureStore":1514,"esri/layers/graphics/data/QueryEngineCapabilities":1516,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":1527,"esri/views/2d/layers/graphics/graphicsUtils":1528,"esri/layers/support/FeatureProcessing":1538,"esri/views/2d/layers/features/support/AttributeStore":1556,"esri/views/2d/layers/features/controllers/BaseController":1621,"esri/views/2d/layers/features/support/pixelBuffering":1622,"esri/layers/graphics/data/executeTileQuery":1732,"esri/views/2d/layers/features/support/TileUpdateQueue":1733,"esri/views/2d/layers/features/controllers/OnDemandController":2417,"esri/views/2d/layers/features/support/DataTile":2418,"esri/views/2d/layers/features/support/DataTileFeaturesIndex":2419,"esri/core/SetPool":2420,"esri/views/support/OrderedQueueProcessor":2421})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[49,60,71,78],{1417:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(5),r(84),r(9),r(353),r(352),r(39),r(550),r(1491),r.dj.m(e)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l,c){Object.defineProperty(t,"__esModule",{value:!0});var p=function(){function e(){}return e.prototype._parseFeatureQuery=function(e){var t=l.parsePBFFeatureQuery(e.buffer,e.options);if(e.options&&"dehydrated"===e.options.type){var r=t;if(t.spatialReference=r.spatialReference.toJSON(),r.fields)for(var i=0;i<r.fields.length;i++)r.fields[i]=r.fields[i].toJSON()}return n.resolve(t)},e}(),d=function(t){function p(){var r=t.call(this)||this;return r._thread=void 0,o.open(s.getAbsMid("./PBFWorker",e,c),{strategy:"dedicated"}).then(function(e){void 0===r._thread?r._thread=e:e.close()}),r}return r(p,t),p.prototype.destroy=function(){this._thread&&this._thread.close(),this._thread=null},p.prototype.parseFeatureQuery=function(e,t){return e&&0!==e.byteLength?this._thread?this._thread.invoke("_parseFeatureQuery",{buffer:e,options:t},{transferList:[e]}).then(function(e){if(t&&"dehydrated"===t.type){var r=e;if(r.spatialReference=a.fromJSON(r.spatialReference),r.fields)for(var n=0;n<r.fields.length;n++)r.fields[n]=u.fromJSON(r.fields[n]);for(var s=r.spatialReference,o=0,l=r.features;o<l.length;o++){var c=l[o];c.uid=i.generateUID(),c.geometry&&(c.geometry.spatialReference=s)}}return e}):n.resolve(l.parsePBFFeatureQuery(e,t)):n.resolve(null)},p}(p);t.PBFWorker=d,t.default=function(){return new p}}.apply(null,i))||(e.exports=n)},1418:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(48),r(52),r(14),r(31),r(71),r(1473),r(1491),r(1417),r(1510),r(153)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l,c,p){function d(e,t){var r=e.geometry,i=e.toJSON(),n=i;if(r&&(n.geometry=JSON.stringify(r),n.geometryType=a.getJsonType(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),i.groupByFieldsForStatistics&&(n.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(",")),i.objectIds&&(n.objectIds=i.objectIds.join(",")),i.orderByFields&&(n.orderByFields=i.orderByFields.join(",")),!i.outFields||t&&(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)?delete n.outFields:-1!==i.outFields.indexOf("*")?n.outFields="*":n.outFields=i.outFields.join(","),i.outSR?n.outSR=i.outSR.wkid||JSON.stringify(i.outSR):r&&(i.returnGeometry||i.returnCentroid)&&(n.outSR=n.inSR),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(n.outStatistics=JSON.stringify(i.outStatistics)),i.pixelSize&&(n.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(n.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.source&&(n.layer=JSON.stringify({source:i.source}),delete i.source),i.timeExtent){var s=i.timeExtent,o=s.start,u=s.end;null==o&&null==u||(n.time=o===u?o:(null==o?"null":o)+","+(null==u?"null":u)),delete i.timeExtent}return n}function f(e,t,a,l,c){void 0===l&&(l={});var f="string"==typeof e?o.urlToObject(e):e,h=t.geometry?[t.geometry]:[];return l.responseType="pbf"===a?"array-buffer":"json",n.safeCast(u.normalizeCentralMeridian(h,null,l)).then(function(e){var n=e&&e[0];s.isSome(n)&&((t=t.clone()).geometry=n);var o=p.mapParameters(r({},f.query,{f:a},c,d(t,c)));return i(f.path+"/query",r({},l,{query:o}))})}Object.defineProperty(t,"__esModule",{value:!0});var h,y="Layer does not support extent calculation.";t.queryToQueryStringParameters=d,t.executeQuery=function(e,t,r){return f(e,t,"json",r)},t.executeQueryPBF=function(e,t,r,i){return f(e,t,"pbf",i).then(function(e){var t=function(t){var r=e;return r.data=t,r};return r.useWorker?(null==h&&(h=new c.PBFWorker),h).parseFeatureQuery(e.data,r).then(function(e){return t(e)}):t(l.parsePBFFeatureQuery(e.data,r))})},t.executeQueryForIds=function(e,t,r){return f(e,t,"json",r,{returnIdsOnly:!0})},t.executeQueryForCount=function(e,t,r){return f(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})},t.executeQueryForExtent=function(e,t,r){return f(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then(function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(y);if(t.hasOwnProperty("count"))throw new Error(y);return e})}}.apply(null,i))||(e.exports=n)},1473:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(97),r(15),r(12),r(14),r(9),r(63),r(96),r(39),r(94),r(56),r(1474),r(1475)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l,c,p,d,f,h,y){function g(e){return"polygon"===e.type}function v(e){return"polygon"===e[0].type}function m(e){return"polyline"===e[0].type}function _(e){return g(e)?e.rings:e.paths}function b(e,t){return Math.ceil((e-t)/(2*t))}function x(e,t){for(var r=0,i=_(e);r<i.length;r++)for(var n=0,s=i[r];n<s.length;n++){s[n][0]+=t}return e}function I(e){for(var t=[],r=0,i=0,n=0;n<e.length;n++){for(var s=e[n],o=null,a=0;a<s.length;a++)o=s[a],t.push(o),0===a?i=r=o[0]:(r=Math.min(r,o[0]),i=Math.max(i,o[0]));o&&t.push([(r+i)/2,0])}return t}function T(e,t){if(!(e instanceof c||e instanceof l)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw M.error(r),new s(r)}for(var i=[],n=0,o=_(e);n<o.length;n++){var a=o[n],u=[];i.push(u),u.push([a[0][0],a[0][1]]);for(var p=0;p<a.length-1;p++){var d=a[p][0],f=a[p][1],h=a[p+1][0],y=a[p+1][1],v=Math.sqrt((h-d)*(h-d)+(y-f)*(y-f)),m=(y-f)/v,b=(h-d)/v,x=v/t;if(x>1){for(var I=1;I<=x-1;I++){var T=I*t,S=b*T+d,F=m*T+f;u.push([S,F])}var w=(v+Math.floor(x-1)*t)/2,k=b*w+d,P=m*w+f;u.push([k,P])}u.push([h,y])}}return g(e)?new l({rings:i,spatialReference:e.spatialReference}):new c({paths:i,spatialReference:e.spatialReference})}function S(e,t,r){if(t){var i=T(e,1e6);e=f.webMercatorToGeographic(i,!0)}return r&&(e=x(e,r)),e}function F(e,t,r){var i;if(Array.isArray(e)){if((i=e[0])>t){var n=b(i,t);e[0]=i+n*(-2*t)}else if(i<r){n=b(i,r);e[0]=i+n*(-2*r)}}else if((i=e.x)>t){n=b(i,t);e=e.clone().offset(n*(-2*t),0)}else if(i<r){n=b(i,r);e=e.clone().offset(n*(-2*r),0)}return e}function w(e,t){for(var r=-1,i=0;i<t.cutIndexes.length;i++)!function(i){for(var n=t.cutIndexes[i],s=t.geometries[i],o=_(s),a=0;a<o.length;a++)!function(e){var t=o[e];t.some(function(r){if(r[0]<180)return!0;for(var i=0,n=0;n<t.length;n++){var o=t[n][0];i=o>i?o:i}for(var a=-360*b(i=Number(i.toFixed(9)),180),u=0;u<t.length;u++){var l=s.getPoint(e,u);s.setPoint(e,u,l.clone().offset(a,0))}return!0})}(a);if(n===r){if(v(e))for(var u=0,l=_(s);u<l.length;u++){var c=l[u];e[n]=e[n].addRing(c)}else if(m(e))for(var p=0,d=_(s);p<d.length;p++){var f=d[p];e[n]=e[n].addPath(f)}}else r=n,e[n]=s}(i);return e}Object.defineProperty(t,"__esModule",{value:!0});var M=o.getLogger("esri.geometry.support.normalizeUtils"),k={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new c({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator}),minus180Line:new c({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:p.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new c({paths:[[[180,-180],[180,180]]],spatialReference:p.WebMercator}),minus180Line:new c({paths:[[[-180,-180],[-180,180]]],spatialReference:p.WebMercator})}};t.straightLineDensify=T,t.normalizeCentralMeridian=function e(t,s,o){return i(this,void 0,void 0,function(){var i,p,g,v,m,_,I,T,M,P,E,O,C,B,j,R,q,z,D,A,N,V,Q,L,G,U,X,J,H,Z,W,Y,K,$,ee,te,re;return r(this,function(r){switch(r.label){case 0:if(!Array.isArray(t))return[2,e([t],s)];for(i=s?s.url:n.geometryServiceUrl,P=0,E=[],O=[],C=0,B=t;C<B.length;C++)j=B[C],a.isNone(j)?O.push(j):(p||(p=j.spatialReference,g=d.getInfo(p),v=p.isWebMercator,m=k[I=v?102100:4326].maxX,_=k[I].minX,T=k[I].plus180Line,M=k[I].minus180Line),g?"mesh"===j.type?O.push(j):"point"===j.type?O.push(F(j.clone(),m,_)):"multipoint"===j.type?((R=j.clone()).points=R.points.map(function(e){return F(e,m,_)}),O.push(R)):"extent"===j.type?(z=j.clone(),q=z._normalize(!1,!1,g),O.push(q.rings?new l(q):q)):j.extent?(z=j.extent,D=b(z.xmin,_),N=0==(A=D*(2*m))?j.clone():x(j.clone(),A),z.offset(A,0),z.intersects(T)&&z.xmax!==m?(P=z.xmax>P?z.xmax:P,N=S(N,v),E.push(N),O.push("cut")):z.intersects(M)&&z.xmin!==_?(P=z.xmax*(2*m)>P?z.xmax*(2*m):P,N=S(N,v,360),E.push(N),O.push("cut")):O.push(N)):O.push(j.clone()):O.push(j));for(V=b(P,m),Q=-90,L=V,G=new c;V>0;)U=360*V-180,G.addPath([[U,Q],[U,-1*Q]]),Q*=-1,V--;return E.length>0&&L>0?[4,h.cut(i,E,G,o)]:[3,3];case 1:for(X=r.sent(),J=w(E,X),H=[],Z=[],ee=0;ee<O.length;ee++)"cut"!==(te=O[ee])?Z.push(te):(re=J.shift(),W=t[ee],a.isSome(W)&&"polygon"===W.type&&W.rings&&W.rings.length>1&&re.rings.length>=W.rings.length?(H.push(re),Z.push("simplify")):Z.push(v?f.geographicToWebMercator(re):re));return H.length?[4,y.simplify(i,H,o)]:[2,Z];case 2:for(Y=r.sent(),K=[],ee=0;ee<Z.length;ee++)"simplify"!==(te=Z[ee])?K.push(te):K.push(v?f.geographicToWebMercator(Y.shift()):Y.shift());return[2,K];case 3:for($=[],ee=0;ee<O.length;ee++)"cut"!==(te=O[ee])?$.push(te):(re=E.shift(),$.push(!0===v?f.geographicToWebMercator(re):re));return[2,u.resolve($)]}})})},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var r=e.extent;if(!r)return null;var i=e.spatialReference&&d.getInfo(e.spatialReference);if(!i)return r;var n,s=i.valid,o=s[0],a=s[1],u=2*a,l=r.width,c=r.xmin,p=r.xmax;if(c=(t=[p,c])[0],p=t[1],"extent"===e.type||0===l||l<=a||l>u||c<o||p>a)return r;switch(e.type){case"polygon":if(!(e.rings.length>1))return r;n=I(e.rings);break;case"polyline":if(!(e.paths.length>1))return r;n=I(e.paths);break;case"multipoint":n=e.points}for(var f=r.clone(),h=0;h<n.length;h++){var y=n[h][0];y<0?(y+=a,p=Math.max(y,p)):(y-=a,c=Math.min(y,c))}return f.xmin=c,f.xmax=p,f.width<l?(f.xmin-=a,f.xmax-=a,f):r},t.normalizeMapX=function(e,t){var r=d.getInfo(t);if(r){var i=r.valid,n=i[0],s=i[1],o=s-n;if(e<n)for(;e<n;)e+=o;if(e>s)for(;e>s;)e-=o}return e}}.apply(null,i))||(e.exports=n)},1474:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(13),r(11),r(42),r(48),r(31),r(71)],void 0===(n=function(e,t,r,i,n,s,o,a,u){Object.defineProperty(t,"__esModule",{value:!0}),t.cut=function(e,t,l,c){return i(this,void 0,void 0,function(){var i,p,d,f,h,y,g;return n(this,function(n){switch(n.label){case 0:return i="string"==typeof e?a.urlToObject(e):e,p=t[0].spatialReference,d=r({},c,{query:r({},i.query,{f:"json",sr:JSON.stringify(p),target:JSON.stringify({geometryType:u.getJsonType(t[0]),geometries:t}),cutter:JSON.stringify(l)})}),[4,o(i.path+"/cut",d)];case 1:return f=n.sent(),h=f.data,y=h.cutIndexes,g=h.geometries,[2,{cutIndexes:y,geometries:(void 0===g?[]:g).map(function(e){return s.fromJSON(e).set(p)})}]}})})}}.apply(null,i))||(e.exports=n)},1475:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(13),r(11),r(48),r(31),r(71)],void 0===(n=function(e,t,r,i,n,s,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.simplify=function(e,t,u){return i(this,void 0,void 0,function(){var i,l,c,p;return n(this,function(n){switch(n.label){case 0:return i="string"==typeof e?o.urlToObject(e):e,l=t[0].spatialReference,c=a.getJsonType(t[0]),p=r({},u,{query:r({},i.query,{f:"json",sr:l.wkid?l.wkid:JSON.stringify(l),geometries:JSON.stringify(function(e){return{geometryType:a.getJsonType(e[0]),geometries:e.map(function(e){return e.toJSON()})}}(t))})}),[4,s(i.path+"/simplify",p)];case 1:return[2,function(e,t,r){var i=a.getGeometryType(t);return e.map(function(e){var t=i.fromJSON(e);return t.spatialReference=r,t})}(n.sent().data,c,l)]}})})}}.apply(null,i))||(e.exports=n)},1481:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(22)],void 0===(n=function(e,t,r){var i=r("esri-text-decoder")?TextDecoder:null;return function(){function e(e,t,r,n){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=n||e.byteLength,this._textDecoder=i?new i("utf-8"):null}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,i=new e(this._data,this._dataView,r,r+t);return this._skip(t),i},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){if(r=Math.min(this._end,r),this._textDecoder){var i=e.subarray(t,r);return this._textDecoder.decode(i)}for(var n="",s="",o=t;o<r;++o){var a=e[o];128&a?s+="%"+a.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(a),s="")}return s.length&&(n+=decodeURIComponent(s)),n},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,i))||(e.exports=n)},1491:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1507)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.parsePBFFeatureQuery=function(e,t){var i=r.parseFeatureQuery(e,t).queryResult.featureResult;if(i&&i.features&&i.features.length&&i.objectIdFieldName)for(var n=i.objectIdFieldName,s=0,o=i.features;s<o.length;s++){var a=o[s];a.attributes&&(a.objectId=a.attributes[n])}return i}}.apply(null,i))||(e.exports=n)},1492:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1494),r(554),r(552)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new i.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,i))||(e.exports=n)},1507:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(15),r(12),r(1481),r(1508),r(1509)],void 0===(n=function(e,t,r,i,n,s,o){function a(e){return e>=F.length?null:F[e]}function u(e){return e>=w.length?null:w[e]}function l(e){return e>=M.length?null:M[e]}function c(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){for(var i=e.createPointGeometry(t);r.next();)switch(r.tag()){case 3:for(var n=r.getUInt32(),s=r.pos()+n,o=0;r.pos()<s;)e.addCoordinatePoint(i,r.getSInt64(),0,o++);break;case 1:case 2:default:r.skip()}return i}function d(e,t,r){for(var i=e.createGeometry(t),n=2+(t.hasZ?1:0)+(t.hasM?1:0);r.next();)switch(r.tag()){case 2:for(var s=r.getUInt32(),o=r.pos()+s,a=0;r.pos()<o;)e.addLength(i,r.getUInt32(),a++);break;case 3:for(var u=r.getUInt32(),l=(o=r.pos()+u,0),c=0;r.pos()<o;)e.addCoordinate(i,r.getSInt64(),c,l),++l===n&&(c++,l=0);break;case 1:default:r.skip()}return i}function f(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function h(e){for(var t={type:a(0)};e.next();)switch(e.tag()){case 1:t.name=e.getString();break;case 2:t.type=a(e.getEnum());break;case 3:t.alias=e.getString();break;case 4:t.sqlType=u(e.getEnum());break;case 5:case 6:default:e.skip()}return t}function y(e,t,r,i){for(var n=e.createFeature(t),s=0;r.next();)switch(r.tag()){case 1:var o=i[s++].name;n.attributes[o]=f(r.getMessage());break;case 2:n.geometry=d(e,t,r.getMessage());break;case 4:n.centroid=p(e,t,r.getMessage());break;default:r.skip()}return n}function g(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function v(e){for(var t=[0,0,0,0];e.next();)switch(e.tag()){case 1:t[0]=e.getDouble();break;case 2:t[1]=e.getDouble();break;case 4:t[2]=e.getDouble();break;case 3:t[3]=e.getDouble();break;default:e.skip()}return t}function m(e){for(var t={originPosition:l(0)};e.next();)switch(e.tag()){case 1:t.originPosition=l(e.getEnum());break;case 2:t.scale=g(e.getMessage());break;case 3:t.translate=v(e.getMessage());break;default:e.skip()}return t}function _(e){for(var t={};e.next();)switch(e.tag()){case 1:t.shapeAreaFieldName=e.getString();break;case 2:t.shapeLengthFieldName=e.getString();break;case 3:t.units=e.getString();break;default:e.skip()}return t}function b(e,t){for(var r=e.createSpatialReference();t.next();)switch(t.tag()){case 1:r.wkid=t.getUInt32();break;case 5:r.wkt=t.getString();break;case 2:case 3:case 4:default:t.skip()}return r}function x(e,t){var r=e.createFeatureResult();r.geometryType=c(e,0);for(var i=!1;t.next();)switch(t.tag()){case 1:r.objectIdFieldName=t.getString();break;case 3:r.globalIdFieldName=t.getString();break;case 4:r.geohashFieldName=t.getString();break;case 5:r.geometryProperties=_(t.getMessage());break;case 7:r.geometryType=c(e,t.getEnum());break;case 8:r.spatialReference=b(e,t.getMessage());break;case 10:r.hasZ=t.getBool();break;case 11:r.hasM=t.getBool();break;case 12:r.transform=m(t.getMessage());break;case 9:var n=t.getBool();r.exceededTransferLimit=n;break;case 13:e.addField(r,h(t.getMessage()));break;case 15:i||(e.prepareFeatures(r),i=!0),e.addFeature(r,y(e,r,t.getMessage(),r.fields));break;case 2:case 6:default:t.skip()}return e.finishFeatureResult(r),r}function I(e,t){for(var r={};t.next();)switch(t.tag()){case 1:r.featureResult=x(e,t.getMessage());break;default:t.skip()}return r}function T(e){return e&&"dehydrated"===e.type?new s.Context(e):new o.Context(e)}Object.defineProperty(t,"__esModule",{value:!0});var S=i.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),F=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],w=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],M=["upperLeft","lowerLeft"];t.parseFeatureQuery=function(e,t){var i=T(t);try{for(var s=new n(new Uint8Array(e),new DataView(e)),o={};s.next();)switch(s.tag()){case 2:o.queryResult=I(i,s.getMessage());break;default:s.skip()}return o}catch(e){var a=new r("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});return S.error(a),{queryResult:{featureResult:i.createFeatureResult()}}}}}.apply(null,i))||(e.exports=n)},1508:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(84),r(25),r(39),r(95),r(550)],void 0===(n=function(e,t,r,i,n,s,o){function a(e,t,r,i){return t}function u(e,t,r,i){switch(r){case 0:return d(e,t+i,0);case 1:return f(e,t+i,1)}}function l(e,t,r,i){switch(r){case 0:return d(e,t+i,0);case 1:return f(e,t+i,1);case 2:return d(e,t,2)}}function c(e,t,r,i){switch(r){case 0:return d(e,t+i,0);case 1:return f(e,t+i,1);case 2:return d(e,t,3)}}function p(e,t,r,i){switch(r){case 0:return d(e,t+i,0);case 1:return f(e,t+i,1);case 2:case 3:return d(e,t,3)}}function d(e,t,r){var i=e.translate,n=e.scale;return i[r]+t*n[r]}function f(e,t,r){var i=e.translate,n=e.scale;return i[r]-t*n[r]}Object.defineProperty(t,"__esModule",{value:!0});var h=function(){function e(e){this.options=e,this.geometryTypes=["point","multipoint","polyline","polygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=a,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this.AttributesConstructor=function(){}}return e.prototype.createFeatureResult=function(){return new s.DehydratedFeatureSetClass},e.prototype.finishFeatureResult=function(e){this.options.applyTransform&&(e.transform=null),this.AttributesConstructor=function(){},this.coordinateBuffer=null,this.lengths.length=0},e.prototype.createSpatialReference=function(){return new n},e.prototype.addField=function(e,t){e.fields.push(o.fromJSON(t));var r=e.fields.map(function(e){return e.name});this.AttributesConstructor=function(){for(var e=0,t=r;e<t.length;e++)this[t[e]]=null}},e.prototype.addFeature=function(e,t){var r=this.options.maxStringAttributeLength?this.options.maxStringAttributeLength:0;if(r>0)for(var i in t.attributes){var n=t.attributes[i];"string"==typeof n&&n.length>r&&(t.attributes[i]="")}e.features.push(t)},e.prototype.prepareFeatures=function(e){switch(this.options.applyTransform&&e.transform&&(this.transform=e.transform,this.applyTransform=this.deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"point":this.addCoordinate=this.addCoordinatePoint.bind(this),this.createGeometry=this.createPointGeometry.bind(this);break;case"polygon":this.addCoordinate=this.addCoordinatePolygon.bind(this),this.createGeometry=this.createPolygonGeometry.bind(this);break;case"polyline":this.addCoordinate=this.addCoordinatePolyline.bind(this),this.createGeometry=this.createPolylineGeometry.bind(this);break;case"multipoint":this.addCoordinate=this.addCoordinateMultipoint.bind(this),this.createGeometry=this.createMultipointGeometry.bind(this);break;default:i.neverReached(e.geometryType)}},e.prototype.createFeature=function(e){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,new s.DehydratedFeatureClass(r.generateUID(),null,new this.AttributesConstructor)},e.prototype.addLength=function(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)},e.prototype.createPointGeometry=function(e){var t={type:"point",x:0,y:0,spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM};return t.hasZ&&(t.z=0),t.hasM&&(t.m=0),t},e.prototype.addCoordinatePoint=function(e,t,r,i){switch(t=this.applyTransform(this.transform,t,i,0),i){case 0:e.x=t;break;case 1:e.y=t;break;case 2:e.hasZ?e.z=t:e.m=t;break;case 3:e.m=t}},e.prototype.transformPathLikeValue=function(e,t){var r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)},e.prototype.addCoordinatePolyline=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.paths,t,r,i)},e.prototype.addCoordinatePolygon=function(e,t,r,i){this.dehydratedAddPointsCoordinate(e.rings,t,r,i)},e.prototype.addCoordinateMultipoint=function(e,t,r){0===r&&e.points.push([]);var i=this.transformPathLikeValue(t,r);e.points[e.points.length-1].push(i)},e.prototype.createPolygonGeometry=function(e){return{type:"polygon",rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createPolylineGeometry=function(e){return{type:"polyline",paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.createMultipointGeometry=function(e){return{type:"multipoint",points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}},e.prototype.dehydratedAddPointsCoordinate=function(e,t,r,i){if(null===this.coordinateBuffer){var n=this.lengths.reduce(function(e,t){return e+t},0);this.coordinateBuffer=new Float64Array(n*this.vertexDimension)}0===i&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);var s=this.transformPathLikeValue(t,i),o=e[e.length-1];0===i&&o.push(new Float64Array(this.coordinateBuffer.buffer,this.coordinateBufferPtr*Float64Array.BYTES_PER_ELEMENT,this.vertexDimension)),this.coordinateBuffer[this.coordinateBufferPtr++]=s},e.prototype.deriveApplyTransform=function(e){var t=e.hasZ,r=e.hasM;return t&&r?p:t?l:r?c:u},e}();t.Context=h}.apply(null,i))||(e.exports=n)},1509:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(554),r(569),r(552)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"]}return e.prototype.createFeatureResult=function(){return new i.default},e.prototype.prepareFeatures=function(){},e.prototype.finishFeatureResult=function(){},e.prototype.addFeature=function(e,t){e.features.push(t)},e.prototype.createFeature=function(){return new r.default},e.prototype.createSpatialReference=function(){return{wkid:0}},e.prototype.createGeometry=function(){return new n.default},e.prototype.addField=function(e,t){e.fields.push(t)},e.prototype.addCoordinate=function(e,t){e.coords.push(t)},e.prototype.addCoordinatePoint=function(e,t){e.coords.push(t)},e.prototype.addLength=function(e,t){e.lengths.push(t)},e.prototype.createPointGeometry=function(){return new n.default},e}();t.Context=s}.apply(null,i))||(e.exports=n)},1510:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.mapParameters=function e(t){var r={};for(var i in t)if("declaredClass"!==i){var n=t[i];if(null!=n&&"function"!=typeof n)if(Array.isArray(n)){r[i]=[];for(var s=0;s<n.length;s++)r[i][s]=e(n[s])}else"object"==typeof n?n.toJSON&&(r[i]=JSON.stringify(n)):r[i]=n}return r}}.apply(null,i))||(e.exports=n)},1514:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(5),r(553),r(15),r(37),r(22),r(12),r(14),r(1504),r(43),r(35),r(355),r(1492)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l,c,p,d,f,h,y){Object.defineProperty(t,"__esModule",{value:!0});var g=[],v=l.getLogger("esri.layers.graphics.data.FeatureStore"),m={minX:0,minY:0,maxX:0,maxY:0},_=function(){function e(e,t,r){this._geometryInfo=e,this._onFeatureAdd=t,this._onFeatureRemove=r,this._featuresById=new s.default,this._boundsByFeature=new s.default,this._featuresByBounds=new s.default,this._index=p(9,u("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this.events=new a,this.featureAdapter=y.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var e=f.create(f.NEGATIVE_INFINITY);return this._boundsByFeature.forEach(function(t){t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]))}),e},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e,g),this._index.load(g),this._emitChanged(),g.length=0},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i,g)}this._index.load(g),this._emitChanged(),g.length=0},e.prototype.clear=function(){this._featuresById.clear(),this._boundsByFeature.clear(),this._featuresByBounds.clear(),this._index.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);if(!t)return null;var r=this._boundsByFeature.get(t);return r&&(this._index.remove(r),this._featuresByBounds.delete(r)),this._boundsByFeature.delete(t),this._featuresById.delete(e),this._emitChanged(),t},e.prototype.removeIf=function(e,t){var r=this;this._featuresById.forEach(function(i,n){t(i)&&(r._remove(i),e.push(i))}),this._emitChanged()},e.prototype.removeManyById=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);if(n){var s=this._boundsByFeature.get(n);s&&(this._index.remove(s),this._featuresByBounds.delete(s)),this._boundsByFeature.delete(n)}this._featuresById.delete(i)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var s=n[i],o=this._boundsByFeature.get(s);o&&t(d.fromRect(r,o))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachInBounds=function(e,t){for(var r=0,i=function(e,t){return m.minX=t[0],m.minY=t[1],m.maxX=t[2],m.maxY=t[3],e.search(m)}(this._index,e);r<i.length;r++){var n=i[r];t(this._featuresByBounds.get(n))}},e.prototype.transferById=function(e,t){var r=this._featuresById.get(t);r&&(this._remove(r),e.add(r),this._emitChanged())},e.prototype.transferByIds=function(e,t){for(var r=[],i=0,n=t;i<n.length;i++){var s=n[i],o=this._featuresById.get(s);o&&(this._remove(o),r.push(o))}e.addMany(r),this._emitChanged()},e.prototype.transferIdRange=function(e,t,r){for(var i=[],n=t;n<r;n++){var s=this._featuresById.get(n);s&&(this._remove(s),i.push(s))}e.addMany(i),this._emitChanged()},e.prototype.transferIf=function(e,t){var r=this,i=[];this._featuresById.forEach(function(e,n){t(e)&&(r._remove(e),i.push(e))}),e.addMany(i),this._emitChanged()},e.prototype.transferAll=function(e){var t=this,r=[];this._featuresById.forEach(function(e,i){t._remove(e),r.push(e)}),e.addMany(r),this._emitChanged()},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e,t){if(e){var r=e.objectId;if(null==r)return void v.error(new o("featurestore:invalid-feature","feature id is missing",{feature:e}));var i,n=this._featuresById.get(r);if(n?(i=this._boundsByFeature.get(n),e.localId=n.localId,i&&(this._index.remove(i),this._boundsByFeature.delete(n),this._featuresByBounds.delete(i))):c.isSome(this._onFeatureAdd)&&this._onFeatureAdd(e),!e.geometry)return this._boundsByFeature.set(e,null),void this._featuresById.set(r,e);i=h.getBoundsOptimizedGeometry(i||f.create(),e.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(e,i),this._featuresByBounds.set(i,e),this._featuresById.set(r,e),t.push(i)}},e.prototype._remove=function(e){var t;e&&(c.isSome(this._onFeatureRemove)&&this._onFeatureRemove(e),(t=this._boundsByFeature.get(e))&&(this._index.remove(t),this._boundsByFeature.delete(e),this._featuresByBounds.delete(t)),this._featuresById.delete(e.objectId))},e}();t.default=_}.apply(null,i))||(e.exports=n)},1516:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1527:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(17),r(1472),r(208)],void 0===(n=function(e,t,r,i,n){function s(e){return{value:e.value,size:r.toPt(e.size)}}function o(e){return e.map(function(e){return s(e)})}function a(e){if("string"==typeof e||"number"==typeof e)return r.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:o(t.stops)}}function u(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(i.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,n=0;n<8;++n){var s=r[Math.min(n,r.length-1)];t.values[n]=s.value,t.opacities[n]=s.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var o=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=o}return t}Object.defineProperty(t,"__esModule",{value:!0});var l=i.enums.WGLVVFlag;t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=s,t.normalizeSizeStops=o,t.normalizeSizeElement=a,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach(function(e){var r=e.type;e.field&&(t[r]=e.field)}),t},t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,s=t?{}:null;if(!t)return{vvFields:t,vvRanges:s};for(var c=0,p=e;c<p.length;c++){var d=p[c],f=d.type;if(d.field&&(t[f]=d.field),"size"===f){s.size||(s.size={});var h=d;switch(i.getTypeOfSizeVisualVariable(h)){case l.SIZE_MINMAX_VALUE:s.size.minMaxValue={minDataValue:h.minDataValue,maxDataValue:h.maxDataValue,minSize:a(h.minSize),maxSize:a(h.maxSize)};break;case l.SIZE_SCALE_STOPS:s.size.scaleStops={stops:o(h.stops)};break;case l.SIZE_FIELD_STOPS:for(var y=[],g=[],v=o(h.stops),m=v.length,_=0;_<6;_++){var b=v[Math.min(_,m-1)];y.push(b.value),g.push(r.pt2px(b.size))}s.size.fieldStops={values:y,sizes:g};break;case l.SIZE_UNIT_VALUE:s.size.unitValue={unit:h.valueUnit,valueRepresentation:h.valueRepresentation}}}else if("color"===f){var x=n.convertVisualVariables([d],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});for(s.color=x.color,_=0;_<32;_+=4)i.color.premultiplyAlpha(s.color.colors,_,!0)}else if("opacity"===f)s.opacity=u(d);else if("rotation"===f){var I=d;s.rotation={type:I.rotationType}}}return{vvFields:t,vvRanges:s}}}.apply(null,i))||(e.exports=n)},1528:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(14),r(17),r(261),r(563),r(40),r(256),r(39),r(35),r(561),r(364),r(71),r(1473),r(94),r(94),r(1472)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l,c,p,d,f,h,y,g){function v(e,t,r,s,a){var u,l,c=i.pt2px(r.xoffset),p=i.pt2px(r.yoffset),d=M*r.angle,f=M*a;switch(r.type){case"simple-marker":var h=r;u=l=i.pt2px(h.size);break;case"picture-marker":var y=r;u=i.pt2px(y.width),l=i.pt2px(y.height)}var g=n.mat2d.identity(O);n.mat2d.translate(g,g,o.vec2.set(C,e,t)),n.mat2d.rotate(g,g,f-d),n.mat2d.scale(g,g,o.vec2.set(C,s,-s)),n.mat2d.translate(g,g,o.vec2.set(C,c,-p));var v=[0,0];o.vec2.transformMat2d(v,o.vec2.set(C,-.5*u,-.5*l),g);var m=[0,0];o.vec2.transformMat2d(m,o.vec2.set(C,-.5*u,.5*l),g);var _=[0,0];o.vec2.transformMat2d(_,o.vec2.set(C,.5*u,-.5*l),g);var b=[0,0];return o.vec2.transformMat2d(b,o.vec2.set(C,.5*u,.5*l),g),{rings:[[v,_,b,m,v]]}}function m(e,t,r,s,a){var u=g.CIMSymbolHelper.getEnvelope(r.data);if(!u)return null;var l=i.pt2px(u.width),c=i.pt2px(u.height),p=i.pt2px(u.x),d=i.pt2px(u.y),f=0*M,h=M*a,y=n.mat2d.identity(O);n.mat2d.translate(y,y,o.vec2.set(C,e,t)),n.mat2d.rotate(y,y,h-f),n.mat2d.scale(y,y,o.vec2.set(C,s,-s)),n.mat2d.translate(y,y,o.vec2.set(C,p,-d));var v=[0,0];o.vec2.transformMat2d(v,o.vec2.set(C,-.5*l,-.5*c),y);var m=[0,0];o.vec2.transformMat2d(m,o.vec2.set(C,-.5*l,.5*c),y);var _=[0,0];o.vec2.transformMat2d(_,o.vec2.set(C,.5*l,-.5*c),y);var b=[0,0];return o.vec2.transformMat2d(b,o.vec2.set(C,.5*l,.5*c),y),{rings:[[v,_,b,m,v]]}}function _(e,t,r,s,a,u){var l=g.alignmentUtils.getYAnchorDirection(r.verticalAlignment||"baseline"),c="baseline"===(r.verticalAlignment||"baseline"),p=i.pt2px(r.xoffset),d=i.pt2px(r.yoffset),f=i.pt2px(r.font.size)/24,h=4*f,y=c?25*f:s[1]+(1+l)*s[3]*.5,v=M*r.angle,m=M*u,_=n.mat2d.identity(O);n.mat2d.translate(_,_,o.vec2.set(C,e,t)),n.mat2d.rotate(_,_,m-v),n.mat2d.scale(_,_,o.vec2.set(C,a,-a)),n.mat2d.translate(_,_,o.vec2.set(C,p,-d)),n.mat2d.translate(_,_,o.vec2.set(C,-h,-h-y));var b=[0,0];o.vec2.transformMat2d(b,o.vec2.set(C,s[0],s[1]),_);var x=[0,0];o.vec2.transformMat2d(x,o.vec2.set(C,s[0],s[1]+s[3]),_);var I=[0,0];o.vec2.transformMat2d(I,o.vec2.set(C,s[0]+s[2],s[1]),_);var T=[0,0];return o.vec2.transformMat2d(T,o.vec2.set(C,s[0]+s[2],s[1]+s[3]),_),{rings:[[b,I,T,x,b]]}}function b(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var n=g.bidiText(t.text),s=n[0],o=n[1],a=g.alignmentUtils.getJustification(t.horizontalAlignment||"center"),u=g.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),l=r.glyphMosaicItems,c=new g.TextShapingNew([l],g.definitions.TEXT_MAX_WIDTH,g.definitions.TEXT_LINE_HEIGHT,g.definitions.TEXT_SPACING,[0,.5*-P],.5*(1-u),0,a).getShaping(s,o),p=g.fontUtils.getFontDecorationTop(t.font.decoration);isNaN(p)||g.TextShapingNew.addDecoration(c,p);var d=g.TextShapingNew.getBox(c),f=i.pt2px(t.font.size)/V;return e[0]=f*d.x,e[1]=f*d.y,e[2]=f*d.width,e[3]=f*d.height,e}function x(e,t,r,i,n,s,o){var a;switch(i.type){case"simple-marker":case"picture-marker":a=v(t,r,i,s,0);break;case"text":a=_(t,r,i,n,s,0);break;case"cim":a=m(t,r,i,s,0)}for(var u,l,c=0,p=0;p<a.rings[0].length-1;p++)u=(t-(l=a.rings[0][p])[0])*(t-l[0])+(r-l[1])*(r-l[1]),c=Math.max(c,u);c=Math.sqrt(c);var d=f.normalizeMapX(t-c,o),h=f.normalizeMapX(t+c,o);if(d>h){var g=y.getInfo(o);if(g){var b=g.valid;d=b[0],h=b[1]}}return e[0]=d,e[1]=r-c,e[2]=h,e[3]=r+c,e}function I(e,t){return Math.ceil((e-t)/(2*t))}function T(e,t){var r,i=t.valid,n=i[0],s=i[1],o=2*s,a=0;return e>s?(e-=(r=Math.ceil(Math.abs(e-s)/o))*o,a=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/o))*o,a=-r),{x:e,frameId:a}}function S(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,s=t.ymax;return F(e,r,i)&&F(e,r,s)&&F(e,n,s)&&F(e,n,i)}function F(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function w(e,t,r){var i;if(Array.isArray(e)){if((i=e[0])>t){var n=I(i,t);e[0]=i+n*(-2*t)}else if(i<r){n=I(i,r);e[0]=i+n*(-2*r)}}else if((i=e.x)>t){n=I(i,t);e.x+=n*(-2*t)}else if(i<r){n=I(i,r);e.x+=n*(-2*r)}return e}Object.defineProperty(t,"__esModule",{value:!0});var M=Math.PI/180,k=g.definitions.TEXT_MAX_WIDTH,P=g.definitions.TEXT_LINE_HEIGHT,E=g.definitions.TEXT_SPACING,O=s.mat2df32.create(),C=a.vec2f32.create(),B=l.create();t.ensureClosedRings=function(e){if(d.isPolygon(e))for(var t=0,r=e.rings;t<r.length;t++){var i=r[t];i.length<3||i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]||i.push(i[0])}},t.getBounds=function(e,t,r,i,n,s,o,a){if(!i||!r)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var u=i;if(!d.isPoint(u)){c.getBoundsXY(e,u);var l=t[0];0===l&&(l=function(e,t){var r=0;switch(e.type){case"simple-fill":case"picture-fill":var i=e.outline;if(!i)return 0;r=i.width;break;case"simple-line":r=e.width;break;case"simple-marker":r=e.size;break;case"picture-marker":r=Math.max(e.width,e.height);break;case"text":var n=[0,0,0,0];b(n,e,t),r=Math.max(n[0],n[1]);break;case"cim":var s=g.CIMSymbolHelper.getEnvelope(e.data);r=Math.sqrt(s.width*s.width+s.height*s.height)}return r}(r,n),t[0]=l);var p=s*l/2;return e[0]-=p,e[1]-=p,e[2]+=p,e[3]+=p,e}var f=u.x,h=u.y;return"text"===r.type&&0===t[2]&&0===t[3]&&b(t,r,n),x(e,f,h,r,t,s,a),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(r.expect(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var j=a.vec2f32.create(),R=a.vec2f32.create(),q=a.vec2f32.create(),z=a.vec2f32.create(),D=a.vec2f32.create(),A=a.vec2f32.create(),N=a.vec2f32.create();t.isPointOnPolyline=function(e,t,r,i){o.vec2.set(q,t,r);for(var n,s,a,u,l,c,p,d,f,h=e.paths,y=1/0,g=0;g<h.length;g++){var v=h[g];if(!(v.length<2))for(var m=1;m<v.length;m++)n=v[m-1][0],a=v[m-1][1],s=v[m][0],u=v[m][1],l=Math.min(n,s)-i,c=Math.min(a,u)-i,p=Math.max(n,s)+i,d=Math.max(a,u)+i,t<l||t>p||r<c||r>d||(o.vec2.set(j,n,a),o.vec2.set(R,s,u),o.vec2.subtract(z,R,j),o.vec2.subtract(D,j,q),o.vec2.scale(A,z,o.vec2.dot(z,D)/o.vec2.dot(z,z)),o.vec2.subtract(N,D,A),y>(f=o.vec2.dot(N,N))&&(y=f))}return Math.sqrt(y)<=i},t.getMarkerSymbolBounds=v,t.getCIMMarkerBounds=m,t.getTextSymbolBounds=_,t.normalizeCentralMeridian=function(e){var t,r,i,n,s,o,a,u,l=null;if(!e)return null;t=e.spatialReference,r=h.getInfo(t),i=t.isWebMercator,n=Q[o=i?102100:4326].maxX,s=Q[o].minX,a=Q[o].plus180Line,u=Q[o].minus180Line;var f,y=e.toJSON();if(!r)return y;if("mesh"===e.type)f=y;else if(d.isPoint(y))f=w(y,n,s);else if(d.isMultipoint(y))y.points=y.points.map(function(e){return w(e,n,s)}),f=y;else if(d.isExtent(y))f=function(e,t){if(!t)return e;var r=function(e,t){var r,i=[],n=e.ymin,s=e.ymax,o=e.xmax-e.xmin,a=e.xmin,u=e.xmax,l=t.valid,c=l[0],p=l[1],d=(r=T(e.xmin,t)).x,f=r.frameId,h=(r=T(e.xmax,t)).x,y=r.frameId,g=d===h&&o>0;if(o>2*p){var v={xmin:a<u?d:h,ymin:n,xmax:p,ymax:s},m={xmin:c,ymin:n,xmax:a<u?h:d,ymax:s},_={xmin:0,ymin:n,xmax:p,ymax:s},b={xmin:c,ymin:n,xmax:0,ymax:s},x=[],I=[];S(v,_)&&x.push(f),S(v,b)&&I.push(f),S(m,_)&&x.push(y),S(m,b)&&I.push(y);for(var F=f+1;F<y;F++)x.push(F),I.push(F);i.push({extent:v,frameIds:[f]},{extent:m,frameIds:[y]},{extent:_,frameIds:x},{extent:b,frameIds:I})}else d>h||g?i.push({extent:{xmin:d,ymin:n,xmax:p,ymax:s},frameIds:[f]},{extent:{xmin:c,ymin:n,xmax:h,ymax:s},frameIds:[y]}):i.push({extent:{xmin:d,ymin:n,xmax:h,ymax:s},frameIds:[f]});return i}(e,t).map(function(e){return e.extent});return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map(function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]})}}(y,r);else if(d.isPolygon(y)||d.isPolyline(y)){var g=B;c.getBoundsXY(g,y);var v={xmin:g[0],ymin:g[1],xmax:g[2],ymax:g[3]},m=I(v.xmin,s)*(2*n),_=0===m?y:function(e,t){for(var r=0,i=function(e){return d.isPolygon(e)?e.rings:e.paths}(e);r<i.length;r++)for(var n=0,s=i[r];n<s.length;n++){var o=s[n];o[0]+=t}return e}(y,m);v.xmin+=m,v.xmax+=m,p.extentIntersectsPolyline(v,a)&&v.xmax!==n?l=_:p.extentIntersectsPolyline(v,u)&&v.xmin!==s?l=_:f=_}else f=e.clone();return null!==l?(new L).cut(l,n):f};var V=24;t.getTextSymbolSize=b,t.getTextSymbolEstimatedSize=function(e,t,r){var n=g.bidiText(t.text),s=n[0],o=n[1],a=g.alignmentUtils.getJustification(t.horizontalAlignment||"center"),u=g.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),l=new g.TextShapingNew([],k,P,E,[0,.5*-P],.5*(1-u),0,a).getEstimatedShaping(s,o,r),c=g.TextShapingNew.getBox(l),p=i.pt2px(t.font.size)/V;return e[0]=p*c.x,e[1]=p*c.y,e[2]=p*c.width,e[3]=p*c.height,e};var Q={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:u.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:u.WGS84}}},L=function(){function e(){}return e.prototype.cut=function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,n=-2*t,s=0;s<i;s++){var o=r[s];if(o&&o.length>=this.minPts){for(var a=[],u=0,l=o;u<l.length;u++){var c=l[u];a.push([c[0]+n,c[1]])}r.push(a)}}return this.closed?e.rings=r:e.paths=r,e},e}()}.apply(null,i))||(e.exports=n)},1538:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(10),r(0),r(550),r(106)],void 0===(n=function(e,t,r,i,n,s,o,a,u){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r(t,e),n=t,t.fromWorker=function(e){if(!e)return null;var t=JSON.parse(e),r=new n;return r.fields=t.fields&&t.fields.map(function(e){return a.fromJSON(e)}),r.options=t.options,r.process=new(Function.bind.apply(Function,[void 0].concat(t.process.args,[t.process.body]))),r},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n(s.clone({fields:this.fields,options:this.options,process:this.process}))},t.prototype.getField=function(e){return u.getField(this.fields,e)},t.prototype.refresh=function(){this.notifyChange("version")},t.prototype.toWorker=function(){var e=this.process.toString();return JSON.stringify({fields:this.fields,options:this.options,process:{body:e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),args:e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/([^\s,]+)/g)}})},i([o.property({type:[a]})],t.prototype,"fields",void 0),i([o.property()],t.prototype,"options",void 0),i([o.property()],t.prototype,"process",void 0),i([o.property({readOnly:!0,dependsOn:["process","options","fields"]})],t.prototype,"version",null),n=i([o.subclass("esri.layers.support.FeatureProcessing")],t)}(o.declared(n))}.apply(null,i))||(e.exports=n)},1556:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(15),r(22),r(12),r(24),r(14),r(9),r(555),r(169),r(548),r(1472),r(1555),r(1527),r(553),r(153)],void 0===(n=function(e,t,i,n,s,o,a,u,l,c,p,d,f,h,y,g){Object.defineProperty(t,"__esModule",{value:!0});var v=(f.enums.PixelType,a.getLogger("esri.views.layers.2d.features.support.AttributeStore")),m=h.debug.createDebugLogger(h.debug.DEBUG_ATTR_UPDATES,v),_=function(e,t){return function(r,i,n){var s;try{s=t(r,i,n)}catch(e){s=NaN}return(null===s||isNaN(s)||s===1/0)&&e||s}},b={sharedArrayBuffer:o("esri-shared-array-buffer"),oesTextureFloat:o("esri-webgl-texture-float"),maxTextureSize:o("esri-webgl-max-texture-size")},x=function(){function e(e,t,r,i){this.texelSize=4,this.descriptors=[];var n=i.pixelType,s=i.layout;this.data=this._initData(n,r,e,t),this.pixelType=n,this.layout=s,this._resetRange(),this._shared=e,this._ctype=t}return Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){return this.data[e*this.texelSize+t]},e.prototype.setData=function(e,t,r){var i=1<<t;0!=(this.layout&i)?(this.data[e*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,e),this.dirtyEnd=Math.max(this.dirtyEnd,e)):v.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},e.prototype.expand=function(e){var t=this._initData(this.pixelType,e,this._shared,this._ctype);t.set(this.data),this.data=t},e.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var i=!(this._shared||"local"===this._ctype),n=this.pixelType,s=this.layout;return this.data.slice?{start:e,end:t,data:i&&this.data.slice(e*r,(t+1)*r)||null,pixelType:n,layout:s}:i?{start:e,end:t,data:new(h.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:n,layout:s}:{start:e,end:t,data:null,pixelType:n,layout:s}},e.prototype._initData=function(e,t,r,i){for(var n=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,s=h.Utils.getPixelArrayCtor(e),o=new s(new n(t*t*4*s.BYTES_PER_ELEMENT)),a=0;a<o.length;a+=4)o[a+1]=255;return o},e.prototype._resetRange=function(){this.dirtyStart=this.data.length/4,this.dirtyEnd=0},e}(),I=function(){function e(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(h.definitions.MAX_FILTERS),this._freeList=[],this._abortController=c.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=0;var t=b.oesTextureFloat?5126:5121;m("Creating AttributeStore "+(b.sharedArrayBuffer?"with":"without")+" shared memory"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:7},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map(function(e){return null})}return e.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(e.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),e.prototype.createLocalId=function(e){if(!this._idMap.has(e)){var t=this._getFreeId();this._idMap.set(e,-1===t?0:t),this._localToObjectId.set(t,e)}return this._idMap.get(e)},e.prototype.freeLocalId=function(e){var t=this._idMap.get(e);this._idMap.delete(e),this._localToObjectId.delete(t),this._freeList.push(t)},e.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},e.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},e.prototype.updateFilters=function(e){return n(this,void 0,void 0,function(){var t,r,n,s,o,a,u=this;return i(this,function(i){switch(i.label){case 0:return t=e.config,r=e.service,n=e.spatialReference,s=t.filters,o=t.definitionExpression,a=s.map(function(t,i){return u._updateFilter(e,t,i,r,o,n)}),[4,c.all(a)];case 1:return i.sent(),[2]}})})},e.prototype.setAttributeBindings=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(this._hasScaleExpr=!1,e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(e.visualVariables,t)];case"dot-density":return[2,this._bindDDEvaluators(e.attributes,t)];case"heatmap":break;default:v.error(new s("attribute-store","Found invalid renderer type: "+e))}return[2]})})},e.prototype.setData=function(e,t,r,i){this._getBlock(t).setData(e,r,i)},e.prototype.setAttributeData=function(e,t,r,i){var n=this,s=e;this._getBlock(0).setData(s,0,this._getFilterFlags(t));var o=this._attributeComputeMap,a=b.oesTextureFloat?1:2;o.forEach(function(e,o){var l=o*a%4,c=Math.floor(o*a/4),p=n._getBlock(c+1),d=e(t,{$view:i},r);if(b.oesTextureFloat)p.setData(s,l,d);else if(d===h.definitions.NAN_MAGIC_NUMBER)p.setData(s,l,255),p.setData(s,l+1,255);else{var f=u.clamp(Math.round(d),-32767,32766)+32768,y=255&f,g=(65280&f)>>8;p.setData(s,l,y),p.setData(s,l+1,g)}})},e.prototype.sendUpdates=function(){var e=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=c.createResolver(),this._nextUpdate.promise;var t={blocks:this._blocks.map(function(e){return l.isSome(e)?e.toMessage():null})};return this._currUpdate=this._createResources().then(function(){var r=e._client.update(t,e._signal).then(function(){if(e._currUpdate=null,e._nextUpdate){var t=e._nextUpdate;e._nextUpdate=null,e.sendUpdates().then(function(){return t.resolve()})}});return e._client.render(),r}),this._currUpdate},e.prototype._createResources=function(){var e=this;if(l.isSome(this._createResourcesPromise))return this._createResourcesPromise;m("Initializing AttributeStore");var t={shared:b.sharedArrayBuffer||"local"===this._client.type,size:this._size,blocks:l.mapMany(this._blocks,function(e){return{buffer:e.buffer,pixelType:e.pixelType}})},r=this._client.initialize(t,this._signal);return this._createResourcesPromise=r,r.then(function(){if(l.isNone(e._createResourcesPromise))return e._createResources()}),r},e.prototype._getBlock=function(e){var t=this._blocks[e];if(l.isSome(t))return t;m("Initializing AttributeBlock at index "+e);var r=b.sharedArrayBuffer,i=this._client.type,n=new x(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n},e.prototype._expand=function(){if(this._size<b.maxTextureSize){var e=this._size<<=1;return m("Expanding block size to",e,this._blocks),l.forEachSome(this._blocks,function(t){return t.expand(e)}),this._createResourcesPromise=null,this._size=e,0}return v.error(new s("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},e.prototype._getFreeId=function(){return this._freeList.length?this._freeList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},e.prototype._updateFilter=function(e,t,r,s,o,a){return n(this,void 0,void 0,function(){var n,u,c,p,d,f,h,y=this;return i(this,function(i){switch(i.label){case 0:return n=this._filters[r],(l.isSome(n)&&n.hash)===JSON.stringify(t)?[2]:(u=1<<r,l.isNone(t)?(this._filters[r]=null,this._idMap.forEach(function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t|u)}),[2]):[4,e.queryObjectIds(t)]);case 1:return c=i.sent(),t.hiddenIds&&t.hiddenIds.length&&(c=c.filter(function(e){return-1===t.hiddenIds.indexOf(e)})),p=c.map(function(e){return y._idMap.get(e)}),[4,this._getFilter(r,s)];case 2:for(i.sent().update(t,o,a),this._idMap.forEach(function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t&~u)}),d=0;d<p.length;d++)null!=(f=p[d])&&(h=this._getBlock(0).getData(f,0),this._getBlock(0).setData(f,0,h|u));return[2]}})})},e.prototype._getFilter=function(e,t){return n(this,void 0,void 0,function(){var n,s,o;return i(this,function(i){switch(i.label){case 0:return n=this._filters[e],l.isSome(n)?[2,n]:[4,new Promise(function(e,t){Promise.all([r.e(2),r.e(65)]).then(function(){var t=[r(1655)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})];case 1:return s=i.sent().default,o=new s({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new p(t.fields)}),this._filters[e]=o,[2,o]}})})},e.prototype._getFilterFlags=function(e){for(var t=0,r=0;r<this._filters.length;r++){var i=this._filters[r];t|=(l.isNone(i)||i.check(e)?1:0)<<r}return t},e.prototype._bindVVEvaluators=function(e,t){return n(this,void 0,void 0,function(){var r=this;return i(this,function(s){switch(s.label){case 0:return this._attributeComputeMap.clear(),l.isSome(e)?[4,c.all(e.map(function(e){return n(r,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:return r=h.Utils.getVVType(e.type),[4,this._createGetValueFunction(e,t)];case 1:return n=i.sent(),l.isSome(n)&&this._attributeComputeMap.set(r,n),[2]}})})}))]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},e.prototype._bindDDEvaluators=function(e,t){return n(this,void 0,void 0,function(){var r,n,s,o=this;return i(this,function(i){switch(i.label){case 0:return this._attributeComputeMap.clear(),e.length>h.definitions.DOT_DENSITY_MAX_FIELDS&&v.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+h.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+e.length),[4,c.all(e.map(function(e){return o._createNormalizedFunction(e,t)}))];case 1:for(r=i.sent().map(function(e){return _(0,e)}),n=0;n<h.definitions.DOT_DENSITY_MAX_FIELDS;n++)(s=n<e.length&&r[n])?this._attributeComputeMap.set(n,s):this._attributeComputeMap.has(n)&&this._attributeComputeMap.delete(n);return[2]}})})},e.prototype._createGetValueFunction=function(e,t){return n(this,void 0,void 0,function(){var r,n,s,o,a,u,l;return i(this,function(i){switch(i.label){case 0:return"size"!==e.type?[3,2]:(r=h.getTypeOfSizeVisualVariable(e))===h.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(n=r===h.enums.WGLVVFlag.SIZE_UNIT_VALUE,s=n&&function(t){return g.getVisualVariableSizeValueRepresentationRatio(t,e.valueRepresentation)},o=_,a=[h.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t,s)]);case 1:return[2,o.apply(void 0,a.concat([i.sent()]))];case 2:return u=_,l=[h.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t)];case 3:return[2,u.apply(void 0,l.concat([i.sent()]))]}})})},e.prototype._createNormalizedFunction=function(e,t,r){return n(this,void 0,void 0,function(){var n,o,a;return i(this,function(i){switch(i.label){case 0:return(n=e.field)?"string"==typeof n?(o=e.normalizationField)?[2,function(e){if(e.attributes[n]&&e.attributes[o]){var t=e.attributes[n]/e.attributes[o];return r?r(t):t}}]:[2,r?function(e){return r(e.attributes[n])}:function(e){return e.attributes[n]}]:(v.error(new s("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof n)),[2,function(e){}]):e.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==e.valueExpression.indexOf("scale"),[4,d.createVVExpression(e.valueExpression,t.spatialReference,t.fields)]):[3,2];case 1:return a=i.sent(),[2,y.callWithOptimizedFeature.bind(null,a)];case 2:return v.error("Unable to create a normalized function for visual variable: "+e),[2,function(e){}]}})})},e}();t.default=I}.apply(null,i))||(e.exports=n)},1621:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(11),r(13),r(2),r(7),r(6),r(15),r(348),r(22),r(12),r(14),r(9),r(0),r(1542),r(1514),r(1515),r(1538),r(555),r(359),r(568),r(347),r(1472),r(1556),r(1622)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l,c,p,d,f,h,y,g,v,m,_,b,x,I,T,S,F){Object.defineProperty(t,"__esModule",{value:!0});var w=p.getLogger("esri.views.2d.layers.features.controllers.BaseController");t.needsGeometry=function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol||t.some(function(e){return"simple-fill"===e.type||"picture-fill"===e.type})}(t);default:return w.error(new u("mapview-invalid-type",e+" is not supported")),!1}};var M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._processingInMainThread=!1,t._availableFields=[],t._pixelBuffer=0,t.config=null,t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t.filters=new Array(T.definitions.MAX_FILTERS),t}return s(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.startup=function(){return n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,f.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}})})},t.prototype.destroy=function(){this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new _(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){function i(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t}if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;switch(r.type){case"simple":return i(r.symbol);case"unique-value":return i(r.defaultSymbol)||r.uniqueValueInfos.some(function(e){return i(e.symbol)});case"class-breaks":return i(r.defaultSymbol)||r.classBreakInfos.some(function(e){return i(e.symbol)});default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){var e=null;if("heatmap"!==this.renderer.type){var t=this.renderer.visualVariables;t&&t.some(function(t){if("size"===t.type&&t.field&&!t.normalizationField)return e=[t.field+" DESC"],!0})}return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,orderByFields:e,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?b.fromJSON(this.config.renderer):(w.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return m.fromWorker(this.config.processing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter(function(t){return-1===e._availableFields.indexOf(t)});return this._availableFields=this._availableFields.concat(t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map(function(e){return t.attributeStore.getLocalId(e)}).filter(function(e){return null!=e})},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return n(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,F.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}})})},t.prototype.validateConfig=function(e,t){for(var r=0,i=e.filters;r<i.length;r++){var n=i[r];if(d.isSome(n)&&n.where)try{y.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new u("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&c("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore=new S.default(o({type:"remote"},"heatmap"===this.renderer.type?{initialize:function(e,t){return f.resolve()},update:function(e,t){return f.resolve()},render:function(){return f.resolve()}}:{initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}}))},t.prototype._createQueryEngine=function(e){void 0===e&&(e=this._createFeatureStore());var t=this.queryInfo,r=t.definitionExpression,i=t.gdbVersion,n=t.historicMoment;return new v.default({definitionExpression:r,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,gdbVersion:i,historicMoment:null!=n&&new Date(n),featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore(!1)),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(e){void 0===e&&(e=!0);var t={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};if(e){var r=this.onFeatureAdd.bind(this),i=this.onFeatureRemove.bind(this);return new g.default(t,r,i)}return new g.default(t)},t.prototype._createDefaultQuery=function(e){var t=this,r=new I;r.outSpatialReference=this.spatialReference;var i=e.outFields,n=e.orderByFields,s=this.config,o=s.gdbVersion,a=s.historicMoment,u=s.definitionExpression;return this.processing&&(i=i&&i.filter(function(e){return!t.processing.getField(e)}),n=n&&n.filter(function(e){return!t.processing.getField(e)})),i=i.length/this.service.fields.length>=.75?["*"]:i,r.gdbVersion=o,r.historicMoment=null!=a?new Date(a):null,r.outFields=i,r.where=u||"1=1",r.returnGeometry=e.returnGeometry,r.returnCentroid=e.returnCentroid,r.orderByFields=n,r.start=e.resultOffset,r.num=e.num,r},t.prototype._createQuery=function(e,t,r,i,n,s){var o=this.service.geometryType,a=this._createDefaultQuery(i);return a.maxRecordCountFactor=n,a.returnExceededLimitFeatures=s,a.resultType="tile",a.geometry=e,this.service.capabilities.query.supportsQuantization?(a.quantizationParameters=new x.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===o&&(a.maxAllowableOffset=r)):"esriGeometryPolyline"!==o&&"esriGeometryPolygon"!==o||(a.maxAllowableOffset=r),a},t.prototype._applyProcessing=function(e,t){var r=this.processing;if(!r)return f.resolve(e);if(this._processingInMainThread)return this.remoteClient.invoke("executeProcessing",{featureSet:e},t);try{var i=r.process(e,r.options);return i?"then"in i?i:f.resolve(i):f.reject(new u("FeatureLayer","invalid processing.process() method, returns nothing"))}catch(r){return this._processingInMainThread=!0,this.remoteClient.invoke("executeProcessing",{featureSet:e},t)}},t.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return d.isSome(e)&&!!e.geometry})},r([h.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r([h.property()],t.prototype,"config",void 0),r([h.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r([h.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r([h.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r([h.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r([h.property()],t.prototype,"processor",void 0),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"processing",null),r([h.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r([h.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([h.property({constructOnly:!0})],t.prototype,"service",void 0),r([h.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([h.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([h.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([h.property()],t.prototype,"filters",void 0),r([h.property({readOnly:!0})],t.prototype,"viewState",void 0),r([h.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r([h.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(h.declared(a,l));t.default=M}.apply(null,i))||(e.exports=n)},1622:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(9),r(17),r(1472),r(1528)],void 0===(n=function(e,t,r,i,n,s,o,a){function u(e,t){return null==e?t:e}function l(e,t){return i(this,void 0,void 0,function(){var i,n,s,c,d,f,m,_,b,x,I;return r(this,function(r){switch(r.label){case 0:return"simple-marker"===e.type?(i=Math.max(u(e.size,12),t),[2,p(e)+i*h]):"picture-marker"===e.type?(n=Math.max(u(e.height,12),t),s=u(e.width,12)*(n/u(e.height,12)),c=s/2,d=n/2,[2,p(e)+Math.sqrt(c*c+d*d)]):"text"===e.type?(a.getTextSymbolEstimatedSize(y,e,o.definitions.AVERAGE_GLYPH_MOSAIC_ITEM),f=y[2]*(u(e.horizontalAlignment,"top")in g?1:.5),m=y[3]*(u(e.horizontalAlignment,"center")in v?1:.5),_=function(e,t){return null==e.font?t:u(e.font.size,t)}(e,9),b=Math.max(_,t)/_,[2,p(e)+Math.sqrt(f*f+m*m)*b]):"simple-line"===e.type?[2,Math.max(u(e.width,.75),t)/2]:"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(function(e,t){return null==e.outline?t:u(e.outline.width,t)}(e,.75),t)/2]:"cim"===e.type?(x=o.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(x.width*x.width+x.height*x.height)]:[2,0]:"web-style"!==e.type?[3,2]:(I=l,[4,e.fetchCIMSymbol()]);case 1:return[2,I.apply(void 0,[r.sent(),t])];case 2:return[2]}})})}function c(e,t){return i(this,void 0,void 0,function(){var i,n,s,o,a;return r(this,function(r){switch(r.label){case 0:return function(e){return e.type in f}(e)?(n=(i=Math).min,o=(s=Math).max,a=[5],[4,l(e,t)]):[2,0];case 1:return[2,n.apply(i,[o.apply(s,a.concat([r.sent()])),75])]}})})}function p(e){var t=u(e.xoffset,0),r=u(e.yoffset,0);return Math.sqrt(t*t+r*r)}function d(e,t){return Math.max(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var f={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1},h=.707;t.computePxBuffer=function(e,t){return i(this,void 0,void 0,function(){var i,o,a,u,l,p,f;return r(this,function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(i=e.getSymbols(),o=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map(function(e){return e.size}).reduce(d,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map(function(e){return e.size}).reduce(d,0):"real-world-size"===r.transformationType?30:void 0}(e),a=[],u=0,l=i;u<l.length;u++)p=l[u],a.push(c(p,o));return[4,n.all(a)];case 1:return f=r.sent(),[2,s.pt2px(f.reduce(d,0))]}})})};var y=[0,0,0,0],g={left:1,right:1},v={top:1,bottom:1,baseline:1}}.apply(null,i))||(e.exports=n)},1732:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(11),r(13),r(133),r(35),r(94),r(1515),r(1543)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l){function c(e,t,r,i,n,s,o,a){o&&!s?i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=l.getCentroid(r,i,a),s=i.attributes;n&&(t.add(i.objectId),e.push(new u.Feature(s,i.localId,null,n)))}}):s&&!o?i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=i.attributes,s=l.getGeometry(r,i,0,a);s&&(t.add(i.objectId),e.push(new u.Feature(n,i.localId,s,null)))}}):i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=i.attributes,s=l.getGeometry(r,i,0,a),o=l.getCentroid(r,i,a);s&&o&&(t.add(i.objectId),e.push(new u.Feature(n,i.localId,s,o)))}})}Object.defineProperty(t,"__esModule",{value:!0}),t.executeTileQueryForIds=function(e,t,r){var i=r.pixelBuffer*t.resolution,n=o.pad(t.bounds,i,o.create()),s=[];return e.featureStore.forEachInBounds(n,function(t){return s.push(e.featureAdapter.getObjectId(t))}),s},t.executeTileQuery=function(e,t,r){var i=r.returnGeometry,n=r.returnCentroid,u=r.pixelBuffer,l=new s.default,p=[],d=u*t.resolution,f=o.pad(t.bounds,d,o.create());if(c(p,l,e,e.featureStore,f,i,n,{originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]}),"esriGeometryPoint"===e.geometryType||n){var h=a.getInfo(e.spatialReference);if(h){var y=h.valid,g=y[0],v=y[1];if(f[0]<g){var m=o.fromValues(v-d,f[1],v,f[3]);c(p,l,e,e.featureStore,m,i,n,{originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[v,t.bounds[3]]})}if(f[2]>v){var _=o.fromValues(g,f[1],g+d,f[3]);c(p,l,e,e.featureStore,_,i,n,{originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[g-v+t.bounds[0],t.bounds[3]]})}}}return p.sort(function(t,r){return t.attributes[e.objectIdField]-r.attributes[e.objectIdField]}),{features:p,objectIds:l}}}.apply(null,i))||(e.exports=n)},1733:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(13),r(6),r(9),r(59),r(0),r(40),r(1638)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l,c,p){Object.defineProperty(t,"__esModule",{value:!0});var d=[0,0],f=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingTile},enumerable:!0,configurable:!0}),t.prototype.abort=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingTile&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){if(!this._queue.has(e)){var r=a.createAbortController();this._queue.set(e,{tileId:e,key:p.TileKey.pool.acquire(e),timestamp:t||this._timestamp,abortController:r}),this._scheduleNext(),this.notifyChange("updating")}},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=u.schedule(this._next))},t.prototype._next=function(){return s(this,void 0,void 0,function(){var e,t,r,i,s;return n(this,function(n){switch(n.label){case 0:if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)return this._scheduledNextHandle=null,[2];if(this._scheduledNextHandle=null,e=this._peek(),t=e.abortController.signal,r=e.tileId,i=e.key,p.TileKey.pool.release(i),this._queue.delete(r),this._onGoingTile=e,s=this.process(r,this._timestamp,{signal:t}),this.notifyChange("updating"),!function(e){return e&&"function"==typeof e.then}(s))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,s];case 2:return n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return this._finalize(),[2]}})})},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=null;return this._queue.forEach(function(o,a){t.getTileCoords(d,o.key);var u=e._timestamp-o.timestamp;if(isNaN(u))(l=c.vec2.distance(d,r))<n&&(n=l,s=o);else if(u===i){var l;(l=c.vec2.distance(d,r))<n&&(n=l,s=o)}else u>i&&(i=u,n=Number.POSITIVE_INFINITY,s=o)}),s},i([l.property({readOnly:!0})],t.prototype,"length",null),i([l.property({constructOnly:!0})],t.prototype,"process",void 0),i([l.property()],t.prototype,"state",void 0),i([l.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),i([l.property({readOnly:!0})],t.prototype,"updating",null),i([l.subclass("esri.views.2d.layers.features.support.TileUpdateQueue")],t)}(l.declared(o));t.default=f}.apply(null,i))||(e.exports=n)},2417:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(7),r(11),r(13),r(133),r(52),r(15),r(22),r(12),r(9),r(0),r(36),r(355),r(1732),r(1418),r(1472),r(1621),r(2418),r(2419),r(1599),r(1733),r(1592),r(2421)],void 0===(n=function(e,t,r,i,n,s,o,a,u,l,c,p,d,f,h,y,g,v,m,_,b,x,I,T,S,F){Object.defineProperty(t,"__esModule",{value:!0});var w=p.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),M=c("esri-featurelayer-webgl"),k=c("esri-mobile"),P={maxDrillLevel:M&&"object"==typeof M&&null!=M.maxDrillLevel?M.maxDrillLevel:k?1:4,maxRecordCountFactor:M&&"object"==typeof M&&null!=M.maxRecordCountFactor?M.maxRecordCountFactor:k?1:3,enablePBFQuery:!M||"object"!=typeof M||null==M.enablePBFQuery||M.enablePBFQuery},E=new a.default,O=[],C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="on-demand",t._queryInfoHash=null,t._dataTileIndex=new x.default,t._editsQueue=new F.OrderedQueueProcessor({concurrency:1,process:function(e,r){return t._processEditsEvent(e,r)}}),t._featuresInFlight=new Map,t}return r(t,e),t.prototype.initialize=function(){var e=this;this._set("queryEngine",this._createQueryEngine()),this._set("featureStore",this.queryEngine.featureStore),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach(function(e){return e.done=!1}),this._fetchQueue=new S({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchTile(t,e.queryInfo,r)}}),this._patchQueue=new S({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchTile(t.dataTile,t.queryInfo,r)}}),this._updateQueue=new T.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r,i){return e._updateTile(t,r,i)}})},t.prototype.destroy=function(){this._fetchQueue.clear(),this._patchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine.destroy()},Object.defineProperty(t.prototype,"updating",{get:function(){return this._fetchQueue.updating||this._updateQueue.updating},enumerable:!0,configurable:!0}),t.prototype.update=function(e,t){return o(this,void 0,void 0,function(){var r,i,n=this;return s(this,function(s){switch(s.label){case 0:return this.validateConfig(e,t),r=this.renderer.getAttributeHash(),i=e.availableFields.filter(function(e){return-1===n.availableFields.indexOf(e)}),this._set("config",e),[4,this.updatePixelBuffer()];case 1:return s.sent(),t?r===this.renderer.getAttributeHash()?[3,3]:[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,5];case 2:s.sent(),s.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return s.sent(),this.refresh(),[2];case 5:return i.length?[4,this._handleAttributeChange(i)]:[3,7];case 6:s.sent(),s.label=7;case 7:return"heatmap"===this.renderer.type?[2]:r===this.renderer.getAttributeHash()?[3,9]:[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 8:s.sent(),this.featureStore.forEach(function(e){return n.attributeStore.setAttributeData(e.localId,e,n.geometryInfo,n.viewParams)}),s.label=9;case 9:return[4,this.attributeStore.updateFilters(this)];case 10:return s.sent(),[4,this.attributeStore.sendUpdates()];case 11:return s.sent(),[2]}})})},t.prototype.invalidate=function(){for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._updateQueue.push(r.id,Date.now())}},t.prototype.onEdits=function(e){var t=this;this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then(function(){0===t._editsQueue.length&&t._fetchQueue.resume()})},t.prototype.queryFeatures=function(e){return u.safeCast(this.queryEngine.executeQuery(e))},t.prototype.queryFeatureCount=function(e){return u.safeCast(this.queryEngine.executeQueryForCount(e))},t.prototype.queryObjectIds=function(e){return u.safeCast(this.queryEngine.executeQueryForIds(e))},t.prototype.queryExtent=function(e){return u.safeCast(this.queryEngine.executeQueryForExtent(e))},t.prototype.redraw=function(){this._updateQueue.pause(),this._manageTiles(this.tileStore.tiles),this._updateQueue.resume()},t.prototype.refresh=function(){this._queryInfoHash=Math.random().toString(),this.queryEngine&&this.queryEngine.destroy(),this.featureStore&&this.featureStore.clear(),this._set("queryEngine",this._createQueryEngine()),this._set("featureStore",this.queryEngine.featureStore),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach(function(e){return e.done=!1}),this._editsQueue.pause(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.clear(),this._updateQueue.clear(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),this._editsQueue.resume(),this._updateQueue.resume()},t.prototype.setViewState=function(e){var t=this,r=this.viewState&&this.viewState.scale;this.inherited(arguments),this._fetchQueue.state=e,this._updateQueue.state=e,r!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.featureStore.forEach(function(e){return t.attributeStore.setAttributeData(e.localId,e,t.geometryInfo,t.viewParams)}),this.attributeStore.sendUpdates())},t.prototype.onTileUpdate=function(e){this._manageTiles(e.added,e.removed)},t.prototype.onFeatureAdd=function(e){if(this._featuresInFlight.has(e.objectId)){var t=this._featuresInFlight.get(e.objectId).attributes;e.attributes=n({},t,e.attributes),this._featuresInFlight.delete(e.objectId)}e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype._handleAttributeChange=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._fetchChangedFields(e)];case 1:return t.sent(),[2]}})})},t.prototype._fetchChangedTileFields=function(e,t){return o(this,void 0,void 0,function(){var r;return s(this,function(i){return(r=this._dataTileIndex.get(e.id))?this.service.capabilities.query.supportsPagination?[2,this._fetchChangedTileFieldsPaged(r,t)]:[2,this._fetchChangedTileFieldsDrill(r,t)]:[2]})})},t.prototype._fetchChangedTileFieldsDrill=function(e,t,r){return void 0===r&&(r=0),o(this,void 0,void 0,function(){var i,o,a,u,l,c,p,f,h,y,g=this;return s(this,function(s){switch(s.label){case 0:return i=n({},this.queryInfo,{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField])}),e.returnExceeded=e.returnExceeded||r>=P.maxDrillLevel,o=e.key,a={key:o,dataTile:e,queryInfo:i},[4,this._patchQueue.push(a)];case 1:return(u=s.sent()).exceededTransferLimit&&r<P.maxDrillLevel?(l=e.tile.createChildTiles(),c=l.map(function(t){var r=new b.default;return r.tile=t,r.displayTile=e.displayTile,r}),[4,d.all(c.map(function(e){return g._fetchChangedTileFieldsDrill(e,t,r+1)}))]):[3,3];case 2:return s.sent(),[2];case 3:for(p=0,f=u.features;p<f.length;p++)h=f[p],this.featureStore.has(h.objectId)?(y=this.featureStore.getFeature(h.objectId)).attributes=n({},y.attributes,h.attributes):this._featuresInFlight.set(h.objectId,h);return[2]}})})},t.prototype._fetchChangedTileFieldsPaged=function(e,t,r){return void 0===r&&(r=0),o(this,void 0,void 0,function(){var i,o,a,u,l,c,p,d,f,h,y;return s(this,function(s){switch(s.label){case 0:return i=this.service.capabilities.query.supportsMaxRecordCountFactor,o=this.service.tileMaxRecordCount,a=o*(i?1:P.maxRecordCountFactor),u=n({},this.queryInfo,{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField]),resultOffset:r*a,num:a}),e.returnExceeded=!0,l=e.key,c={key:l,dataTile:e,queryInfo:u},[4,this._patchQueue.push(c)];case 1:for(p=s.sent(),d=0,f=p.features;d<f.length;d++)h=f[d],this.featureStore.has(h.objectId)?(y=this.featureStore.getFeature(h.objectId)).attributes=n({},y.attributes,h.attributes):this._featuresInFlight.set(h.objectId,h);return p.exceededTransferLimit?[2,this._fetchChangedTileFieldsPaged(e,t,r+1)]:[2]}})})},t.prototype._fetchChangedFields=function(e){return o(this,void 0,void 0,function(){var t,r,i=this;return s(this,function(n){switch(n.label){case 0:return t=this.tileStore.tiles,r=t.map(function(t){return i._fetchChangedTileFields(t,e)}),[4,d.all(r)];case 1:return n.sent(),[2]}})})},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,i=this._fetchQueue,n=this._updateQueue,s="esriGeometryPoint"===this.service.geometryType,o=this,a=0,u=e;a<u.length;a++){!function(e){var t=r.get(e.id);t?(t.displayTile=e,s?r.forEach(function(r){I.isChildOf(r,t)&&(r.displayTile=e)}):t.done=!1):((t=new b.default).tile=e.clone(),t.displayTile=e,r.add(t)),o._processDataTile(t)}(p=u[a])}if(t)for(var l=0,c=t;l<c.length;l++){var p=c[l];E.add(p),n.abort(p.id)}r.forEach(function(e){E.has(e.displayTile)&&O.push(e)});for(var d=0,f=O;d<f.length;d++){var h=f[d];i.abort(h.id),r.delete(h)}O.length=0,E.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,i=e.key,n=this._dataTileIndex,s=this._fetchQueue,o=i.id,a=this._queryInfoHash,u=i.level-r.key.level>=P.maxDrillLevel;if(n.add(e),e.done||s.has(o)){if(e.queryInfoHash!==a||e.returnExceeded!==u)if(e.done)e.done=!1;else{if(!s.isOngoing(o))return e.queryInfoHash=a,void(e.returnExceeded=u);s.abort(o)}}else e.queryInfoHash=a,e.returnExceeded=u;e.done?this._invalidateTile(e.displayTile):s.has(o)||s.push(e).then(function(r){return t._handleResponse(e,r)}).catch(function(t){d.isAbortError(t)||w.error(new l("featurelayer-controller:tile-error","Encountered an error when handling tile response",t)),e.done=!0})},t.prototype._handleResponse=function(e,t){if(e.done=!0,y.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else for(var r=0,i=e.tile.createChildTiles();r<i.length;r++){var n=i[r],s=new b.default;s.tile=n,s.displayTile=e.displayTile,this._processDataTile(s)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile),this.attributeStore.sendUpdates()},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach(function(t){I.isChildOf(t,e)&&O.push(t)});for(var t=0,r=O;t<r.length;t++){var i=r[t];this._fetchQueue.abort(i.id),this._dataTileIndex.delete(i)}O.length=0},t.prototype._fetchTile=function(e,t,r){return o(this,void 0,void 0,function(){var i,n,o,a,u,l,c,p,d,f=this;return s(this,function(s){return i=new h({xmin:e.bounds[0],ymin:e.bounds[1],xmax:e.bounds[2],ymax:e.bounds[3],spatialReference:this.spatialReference}),n="esriGeometryPoint"===this.service.geometryType?e.tile:e.displayTile,o=n.extent,a=n.resolution,u=e.returnExceeded,l=this._createQuery(i,o,a,t,P.maxRecordCountFactor,u),c=this.service.source,p=P.enablePBFQuery&&this.service.capabilities.query.supportsFormatPBF,d=r.signal,[2,p?v.executeQueryPBF(c,l,{type:"optimized"},{signal:d}).then(function(e){return e.data}):v.executeQuery(c,l,{signal:d}).then(function(e){return y.convertFromFeatureSet(e.data,f.service.objectIdField)})]})})},t.prototype._invalidateTile=function(e){for(var t=this._pixelBuffer,r=this._updateQueue,i=0,n=this.tileStore.intersections(e,t);i<n.length;i++){var s=n[i].tile;r.push(s.id,s.updateTimestamp)}},t.prototype._updateTile=function(e,t,r){var i=this,n=this.tileStore.get(e),s=this.queryInfo,o=s.returnCentroid,a=s.returnGeometry,u={pixelBuffer:this._pixelBuffer,returnGeometry:a,returnCentroid:o},l=g.executeTileQuery(this.queryEngine,n,u),c=l.features,p=l.objectIds,f={geometryType:this.service.geometryType,features:c,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:n.transform};return this._applyProcessing(f,r).then(function(e){var s=[],o=!0;return i._dataTileIndex.forEach(function(e){n.id!==e.id&&I.isChildOf(e,n)&&o&&!e.done&&(o=!1)}),o&&n&&n.objectIds.forEach(function(e){if(!p.has(e)){var t=i.attributeStore.getLocalId(e);s.push(t)}}),p.forEach(function(e){n.objectIds.add(e)}),n.updateTimestamp=t,i.attributeStore.sendUpdates(),i.processor.onTileData(n,{clear:!0,addOrUpdate:e.features,remove:s,transformParams:m.Utils.getTransformParams(e)},r).catch(function(e){d.isAbortError(e)||w.error("update-tile",e)})})},t.prototype._processEditsEvent=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,a,u,l,c,p=this;return s(this,function(s){switch(s.label){case 0:return r=function(e){return e.objectId},i=e.addedFeatures.concat(e.updatedFeatures).map(r),o=e.deletedFeatures.map(r),a=this._createTempQueryEngine(),u=this._createObjectIdsQuery(i),i.length?[4,v.executeQuery(this.service.source,u)]:[3,2];case 1:l=s.sent().data,c=y.convertFromFeatureSet(l,this.service.objectIdField).features,this._dataTileIndex.addOrUpdateFeatures(c),a.featureStore.addMany(c),s.label=2;case 2:return this._dataTileIndex.deleteFeaturesById(o),this.attributeStore.sendUpdates(),this.tileStore.tiles.map(function(e){var r=g.executeTileQuery(a,e,n({},p.queryInfo,{pixelBuffer:p._pixelBuffer})).features,s=o.concat(i).map(function(e){return p.attributeStore.getLocalId(e)}),u={transform:e.transform,hasZ:!1,hasM:!1};return p.processor.onTileData(e,{addOrUpdate:r,remove:s,transformParams:u},{signal:t}).catch(function(e){d.isAbortError(e)||w.error("update-tile",e)})}),a.destroy(),[2]}})})},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery(this.queryInfo);return t.objectIds=e,t},i([f.property()],t.prototype,"_fetchQueue",void 0),i([f.property()],t.prototype,"_patchQueue",void 0),i([f.property()],t.prototype,"_updateQueue",void 0),i([f.property({readOnly:!0})],t.prototype,"queryEngine",void 0),i([f.property({readOnly:!0})],t.prototype,"featureStore",void 0),i([f.property({dependsOn:["_fetchQueue.updating","_updateQueue.updating"]})],t.prototype,"updating",null),i([f.subclass("esri.views.2d.layers.features.controllers.OnDemandController")],t)}(f.declared(_.default));t.default=C}.apply(null,i))||(e.exports=n)},2418:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=r}.apply(null,i))||(e.exports=n)},2419:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(553),r(133),r(2420),r(1514),r(1599)],void 0===(n=function(e,t,r,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});var a=[],u=new i.default,l=function(){function e(){this._tileById=new r.default,this._tilesToFeatures=new r.default,this._featureToTiles=new r.default}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var r=e;this._tileById.set(r.id,r),this._tilesToFeatures.set(r,n.default.acquire()),this._tilesToFeatures.forEach(function(e,i){r!==i&&(o.isParentOf(r,i)?e.forEach(function(e){t._link(r,e)}):o.isChildOf(r,i)&&t.featureStore.forEachInBounds(r.bounds,function(i){e.has(i.objectId)&&t._link(r,i.objectId)}))})}},e.prototype.clear=function(){this._tilesToFeatures.forEach(function(e){return n.default.release(e)}),this._tilesToFeatures.clear(),this._featureToTiles.forEach(function(e){return n.default.release(e)}),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);a.length=0,this._tilesToFeatures.get(r).forEach(function(e){var i=t._featureToTiles.get(e);i.has(r)&&1===i.size?a.push(e):t._unlink(r,e)});for(var i=0,n=a;i<n.length;i++){var s=n[i];this._unlink(r,s)}this.featureStore.removeManyById(a),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),a.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var r=this,i=this.get(e.id);this._tilesToFeatures.has(i)||(this._tileById.set(i.id,i),this._tilesToFeatures.set(i,n.default.acquire()));for(var s=0,o=t;s<o.length;s++){var l=o[s];u.add(l.objectId)}a.length=0,this._tilesToFeatures.get(i).forEach(function(e){if(!u.has(e)){var t=r._featureToTiles.get(e);t.has(i)&&1===t.size?a.push(e):r._unlink(i,e)}});for(var c=0,p=a;c<p.length;c++){var d=p[c];this._unlink(i,d)}this.featureStore.removeManyById(a),this.featureStore.addMany(t),u.forEach(function(e){r._link(i,e)}),u.clear(),a.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new i.default,n=new s.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ},null),o=0,a=this.deleteFeaturesById(e.map(function(e){return e.objectId}));o<a.length;o++){var u=a[o];r.add(u)}n.addMany(e),this._tileById.forEach(function(e){n.forEachInBounds(e.bounds,function(i){t._link(e,i.objectId),r.add(e)})}),this.featureStore.addMany(e);var l=[];return r.forEach(function(e){return l.push(e)}),l},e.prototype.deleteFeaturesById=function(e){for(var t=this,r=new i.default,s=this,o=0,a=e;o<a.length;o++){!function(e){var i=s._featureToTiles.get(e);i&&(i.forEach(function(i){r.add(i),t._tilesToFeatures.get(i).delete(e)}),n.default.release(i),s._featureToTiles.delete(e))}(a[o])}this.featureStore.removeManyById(e);var u=[];return r.forEach(function(e){return u.push(e)}),u},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,n.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(n.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=l}.apply(null,i))||(e.exports=n)},2420:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(133)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._pool=[],this._set=new r.default}return e.prototype.acquire=function(){if(0===this._pool.length)return new r.default;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}();t.default=i;var n=new i}.apply(null,i))||(e.exports=n)},2421:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(9),r(1639)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e,t){this.item=e,this.promise=t,this.deferred=n.createDeferred(),this.status=0,this.value=null,this.error=null}}(),a=function(){function e(e){this._queue=[],this._queueMap=new Map,this._processor=new s.QueueProcessor(e)}return e.prototype.destroy=function(){this.clear(),this._processor.destroy()},Object.defineProperty(e.prototype,"length",{get:function(){return this._queue.length},enumerable:!0,configurable:!0}),e.prototype.abort=function(e){var t=this._queueMap.get(e);t&&(0===t.status?this._processor.abort(e):(t.status=1,t.error=n.createAbortError()))},e.prototype.clear=function(){this._queue.length=0,this._queueMap.clear(),this._processor.clear()},e.prototype.get=function(e){return i(this,void 0,void 0,function(){var t;return r(this,function(r){return[2,(t=this._queueMap.get(e))?t.promise:void 0]})})},e.prototype.isOngoing=function(e){return this._processor.isOngoing(e)},e.prototype.has=function(e){return this._queueMap.has(e)},e.prototype.pause=function(){this._processor.pause()},e.prototype.resume=function(){this._processor.resume()},e.prototype.reset=function(){this._processor.reset()},e.prototype.push=function(e){return i(this,void 0,void 0,function(){var t,i,n=this;return r(this,function(r){return t=this._processor.push(e),i=new o(e,t),this._queue.push(i),this._queueMap.set(e,i),t.then(function(e){return n._success(i,e)},function(e){return n._error(i,e)}),[2,i.deferred.promise]})})},e.prototype._success=function(e,t){e.status=2,e.value=t,this._drain()},e.prototype._error=function(e,t){e.status=1,e.error=t,this._drain()},e.prototype._drain=function(){for(;;){var e=this._queue[0];if(!e||0===e.status)return;this._queue.shift(),this._queueMap.delete(e.item),2===e.status?e.deferred.resolve(e.value):e.deferred.reject(e.error)}},e}();t.OrderedQueueProcessor=a}.apply(null,i))||(e.exports=n)}}]);