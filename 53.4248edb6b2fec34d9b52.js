(function(){(this||window).webpackJsonp.registerAbsMids({"esri/geometry/support/normalizeUtils":1473,"esri/tasks/geometry/cut":1474,"esri/tasks/geometry/simplify":1475,"esri/core/pbf":1481,"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":1492,"esri/layers/graphics/data/FeatureStore":1514,"esri/layers/graphics/data/QueryEngineCapabilities":1516,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":1527,"esri/views/2d/layers/graphics/graphicsUtils":1528,"esri/layers/support/FeatureProcessing":1538,"esri/views/2d/layers/features/support/AttributeStore":1556,"esri/views/2d/layers/features/controllers/BaseController":1621,"esri/views/2d/layers/features/support/pixelBuffering":1622,"esri/views/2d/layers/features/support/TileUpdateQueue":1733,"esri/views/2d/layers/features/controllers/MemoryController":2422})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[53,78],{1473:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(97),r(15),r(12),r(14),r(9),r(63),r(96),r(39),r(94),r(56),r(1474),r(1475)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,f,h,d,y){function m(e){return"polygon"===e.type}function g(e){return"polygon"===e[0].type}function v(e){return"polyline"===e[0].type}function _(e){return m(e)?e.rings:e.paths}function b(e,t){return Math.ceil((e-t)/(2*t))}function x(e,t){for(var r=0,i=_(e);r<i.length;r++)for(var n=0,o=i[r];n<o.length;n++){o[n][0]+=t}return e}function I(e){for(var t=[],r=0,i=0,n=0;n<e.length;n++){for(var o=e[n],s=null,a=0;a<o.length;a++)s=o[a],t.push(s),0===a?i=r=s[0]:(r=Math.min(r,s[0]),i=Math.max(i,s[0]));s&&t.push([(r+i)/2,0])}return t}function S(e,t){if(!(e instanceof p||e instanceof l)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw F.error(r),new o(r)}for(var i=[],n=0,s=_(e);n<s.length;n++){var a=s[n],u=[];i.push(u),u.push([a[0][0],a[0][1]]);for(var c=0;c<a.length-1;c++){var f=a[c][0],h=a[c][1],d=a[c+1][0],y=a[c+1][1],g=Math.sqrt((d-f)*(d-f)+(y-h)*(y-h)),v=(y-h)/g,b=(d-f)/g,x=g/t;if(x>1){for(var I=1;I<=x-1;I++){var S=I*t,w=b*S+f,M=v*S+h;u.push([w,M])}var T=(g+Math.floor(x-1)*t)/2,E=b*T+f,O=v*T+h;u.push([E,O])}u.push([d,y])}}return m(e)?new l({rings:i,spatialReference:e.spatialReference}):new p({paths:i,spatialReference:e.spatialReference})}function w(e,t,r){if(t){var i=S(e,1e6);e=h.webMercatorToGeographic(i,!0)}return r&&(e=x(e,r)),e}function M(e,t,r){var i;if(Array.isArray(e)){if((i=e[0])>t){var n=b(i,t);e[0]=i+n*(-2*t)}else if(i<r){n=b(i,r);e[0]=i+n*(-2*r)}}else if((i=e.x)>t){n=b(i,t);e=e.clone().offset(n*(-2*t),0)}else if(i<r){n=b(i,r);e=e.clone().offset(n*(-2*r),0)}return e}function T(e,t){for(var r=-1,i=0;i<t.cutIndexes.length;i++)!function(i){for(var n=t.cutIndexes[i],o=t.geometries[i],s=_(o),a=0;a<s.length;a++)!function(e){var t=s[e];t.some(function(r){if(r[0]<180)return!0;for(var i=0,n=0;n<t.length;n++){var s=t[n][0];i=s>i?s:i}for(var a=-360*b(i=Number(i.toFixed(9)),180),u=0;u<t.length;u++){var l=o.getPoint(e,u);o.setPoint(e,u,l.clone().offset(a,0))}return!0})}(a);if(n===r){if(g(e))for(var u=0,l=_(o);u<l.length;u++){var p=l[u];e[n]=e[n].addRing(p)}else if(v(e))for(var c=0,f=_(o);c<f.length;c++){var h=f[c];e[n]=e[n].addPath(h)}}else r=n,e[n]=o}(i);return e}Object.defineProperty(t,"__esModule",{value:!0});var F=s.getLogger("esri.geometry.support.normalizeUtils"),E={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new p({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:c.WebMercator}),minus180Line:new p({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:c.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new p({paths:[[[180,-180],[180,180]]],spatialReference:c.WebMercator}),minus180Line:new p({paths:[[[-180,-180],[-180,180]]],spatialReference:c.WebMercator})}};t.straightLineDensify=S,t.normalizeCentralMeridian=function e(t,o,s){return i(this,void 0,void 0,function(){var i,c,m,g,v,_,I,S,F,O,B,k,P,z,C,A,V,N,R,j,D,L,G,U,q,X,Q,W,H,J,Y,Z,K,$,ee,te,re;return r(this,function(r){switch(r.label){case 0:if(!Array.isArray(t))return[2,e([t],o)];for(i=o?o.url:n.geometryServiceUrl,O=0,B=[],k=[],P=0,z=t;P<z.length;P++)C=z[P],a.isNone(C)?k.push(C):(c||(c=C.spatialReference,m=f.getInfo(c),g=c.isWebMercator,v=E[I=g?102100:4326].maxX,_=E[I].minX,S=E[I].plus180Line,F=E[I].minus180Line),m?"mesh"===C.type?k.push(C):"point"===C.type?k.push(M(C.clone(),v,_)):"multipoint"===C.type?((A=C.clone()).points=A.points.map(function(e){return M(e,v,_)}),k.push(A)):"extent"===C.type?(N=C.clone(),V=N._normalize(!1,!1,m),k.push(V.rings?new l(V):V)):C.extent?(N=C.extent,R=b(N.xmin,_),D=0==(j=R*(2*v))?C.clone():x(C.clone(),j),N.offset(j,0),N.intersects(S)&&N.xmax!==v?(O=N.xmax>O?N.xmax:O,D=w(D,g),B.push(D),k.push("cut")):N.intersects(F)&&N.xmin!==_?(O=N.xmax*(2*v)>O?N.xmax*(2*v):O,D=w(D,g,360),B.push(D),k.push("cut")):k.push(D)):k.push(C.clone()):k.push(C));for(L=b(O,v),G=-90,U=L,q=new p;L>0;)X=360*L-180,q.addPath([[X,G],[X,-1*G]]),G*=-1,L--;return B.length>0&&U>0?[4,d.cut(i,B,q,s)]:[3,3];case 1:for(Q=r.sent(),W=T(B,Q),H=[],J=[],ee=0;ee<k.length;ee++)"cut"!==(te=k[ee])?J.push(te):(re=W.shift(),Y=t[ee],a.isSome(Y)&&"polygon"===Y.type&&Y.rings&&Y.rings.length>1&&re.rings.length>=Y.rings.length?(H.push(re),J.push("simplify")):J.push(g?h.geographicToWebMercator(re):re));return H.length?[4,y.simplify(i,H,s)]:[2,J];case 2:for(Z=r.sent(),K=[],ee=0;ee<J.length;ee++)"simplify"!==(te=J[ee])?K.push(te):K.push(g?h.geographicToWebMercator(Z.shift()):Z.shift());return[2,K];case 3:for($=[],ee=0;ee<k.length;ee++)"cut"!==(te=k[ee])?$.push(te):(re=B.shift(),$.push(!0===g?h.geographicToWebMercator(re):re));return[2,u.resolve($)]}})})},t.getDenormalizedExtent=function(e){var t;if(!e)return null;var r=e.extent;if(!r)return null;var i=e.spatialReference&&f.getInfo(e.spatialReference);if(!i)return r;var n,o=i.valid,s=o[0],a=o[1],u=2*a,l=r.width,p=r.xmin,c=r.xmax;if(p=(t=[c,p])[0],c=t[1],"extent"===e.type||0===l||l<=a||l>u||p<s||c>a)return r;switch(e.type){case"polygon":if(!(e.rings.length>1))return r;n=I(e.rings);break;case"polyline":if(!(e.paths.length>1))return r;n=I(e.paths);break;case"multipoint":n=e.points}for(var h=r.clone(),d=0;d<n.length;d++){var y=n[d][0];y<0?(y+=a,c=Math.max(y,c)):(y-=a,p=Math.min(y,p))}return h.xmin=p,h.xmax=c,h.width<l?(h.xmin-=a,h.xmax-=a,h):r},t.normalizeMapX=function(e,t){var r=f.getInfo(t);if(r){var i=r.valid,n=i[0],o=i[1],s=o-n;if(e<n)for(;e<n;)e+=s;if(e>o)for(;e>o;)e-=s}return e}}.apply(null,i))||(e.exports=n)},1474:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(13),r(11),r(42),r(48),r(31),r(71)],void 0===(n=function(e,t,r,i,n,o,s,a,u){Object.defineProperty(t,"__esModule",{value:!0}),t.cut=function(e,t,l,p){return i(this,void 0,void 0,function(){var i,c,f,h,d,y,m;return n(this,function(n){switch(n.label){case 0:return i="string"==typeof e?a.urlToObject(e):e,c=t[0].spatialReference,f=r({},p,{query:r({},i.query,{f:"json",sr:JSON.stringify(c),target:JSON.stringify({geometryType:u.getJsonType(t[0]),geometries:t}),cutter:JSON.stringify(l)})}),[4,s(i.path+"/cut",f)];case 1:return h=n.sent(),d=h.data,y=d.cutIndexes,m=d.geometries,[2,{cutIndexes:y,geometries:(void 0===m?[]:m).map(function(e){return o.fromJSON(e).set(c)})}]}})})}}.apply(null,i))||(e.exports=n)},1475:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(7),r(13),r(11),r(48),r(31),r(71)],void 0===(n=function(e,t,r,i,n,o,s,a){Object.defineProperty(t,"__esModule",{value:!0}),t.simplify=function(e,t,u){return i(this,void 0,void 0,function(){var i,l,p,c;return n(this,function(n){switch(n.label){case 0:return i="string"==typeof e?s.urlToObject(e):e,l=t[0].spatialReference,p=a.getJsonType(t[0]),c=r({},u,{query:r({},i.query,{f:"json",sr:l.wkid?l.wkid:JSON.stringify(l),geometries:JSON.stringify(function(e){return{geometryType:a.getJsonType(e[0]),geometries:e.map(function(e){return e.toJSON()})}}(t))})}),[4,o(i.path+"/simplify",c)];case 1:return[2,function(e,t,r){var i=a.getGeometryType(t);return e.map(function(e){var t=i.fromJSON(e);return t.spatialReference=r,t})}(n.sent().data,p,l)]}})})}}.apply(null,i))||(e.exports=n)},1481:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(22)],void 0===(n=function(e,t,r){var i=r("esri-text-decoder")?TextDecoder:null;return function(){function e(e,t,r,n){this._tag=0,this._dataType=99,this._data=e,this._dataView=t,this._pos=r||0,this._end=n||e.byteLength,this._textDecoder=i?new i("utf-8"):null}return e.prototype.clone=function(){return new e(this._data,this._dataView,this._pos,this._end)},e.prototype.pos=function(){return this._pos},e.prototype.next=function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0},e.prototype.empty=function(){return this._pos>=this._end},e.prototype.tag=function(){return this._tag},e.prototype.getInt32=function(){return this._decodeVarint()},e.prototype.getInt64=function(){return this._decodeVarint()},e.prototype.getUInt32=function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))},e.prototype.getUInt64=function(){return this._decodeVarint()},e.prototype.getSInt32=function(){var e=this.getUInt32();return e>>>1^-(1&e)|0},e.prototype.getSInt64=function(){return this._decodeSVarint()},e.prototype.getBool=function(){var e=0!==this._data[this._pos];return this._skip(1),e},e.prototype.getEnum=function(){return this._decodeVarint()},e.prototype.getFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getUint32(t+4,!0);return this._skip(8),r},e.prototype.getSFixed64=function(){var e=this._dataView,t=this._pos,r=e.getUint32(t,!0)+4294967296*e.getInt32(t+4,!0);return this._skip(8),r},e.prototype.getDouble=function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e},e.prototype.getFixed32=function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e},e.prototype.getSFixed32=function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e},e.prototype.getFloat=function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e},e.prototype.getString=function(){var e=this._getLength(),t=this._pos,r=this._toString(this._data,t,t+e);return this._skip(e),r},e.prototype.getBytes=function(){var e=this._getLength(),t=this._pos,r=this._toBytes(this._data,t,t+e);return this._skip(e),r},e.prototype.getMessage=function(){var t=this._getLength(),r=this._pos,i=new e(this._data,this._dataView,r,r+t);return this._skip(t),i},e.prototype.skip=function(){switch(this._dataType){case 0:this._decodeVarint();break;case 1:this._skip(8);break;case 2:this._skip(this._getLength());break;case 5:this._skip(4);break;default:throw new Error("Invalid data type!")}},e.prototype._skip=function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e},e.prototype._decodeVarint=function(){var e,t=this._data,r=this._pos,i=0;if(this._end-r>=10)do{if(i|=127&(e=t[r++]),0==(128&e))break;if(i|=(127&(e=t[r++]))<<7,0==(128&e))break;if(i|=(127&(e=t[r++]))<<14,0==(128&e))break;if(i|=(127&(e=t[r++]))<<21,0==(128&e))break;if(i+=268435456*(127&(e=t[r++])),0==(128&e))break;if(i+=34359738368*(127&(e=t[r++])),0==(128&e))break;if(i+=4398046511104*(127&(e=t[r++])),0==(128&e))break;if(i+=562949953421312*(127&(e=t[r++])),0==(128&e))break;if(i+=72057594037927940*(127&(e=t[r++])),0==(128&e))break;if(i+=0x8000000000000000*(127&(e=t[r++])),0==(128&e))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;r!==this._end&&0!=(128&(e=t[r]));)++r,i+=(127&e)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,i+=e*n}return this._pos=r,i},e.prototype._decodeSVarint=function(){var e=this._decodeVarint();return e%2?-(e+1)/2:e/2},e.prototype._getLength=function(){if(2!==this._dataType)throw new Error("Not a delimited data type!");return this._decodeVarint()},e.prototype._toString=function(e,t,r){if(r=Math.min(this._end,r),this._textDecoder){var i=e.subarray(t,r);return this._textDecoder.decode(i)}for(var n="",o="",s=t;s<r;++s){var a=e[s];128&a?o+="%"+a.toString(16):(n+=decodeURIComponent(o)+String.fromCharCode(a),o="")}return o.length&&(n+=decodeURIComponent(o)),n},e.prototype._toBytes=function(e,t,r){return r=Math.min(this._end,r),new Uint8Array(e.buffer,t,r-t)},e}()}.apply(null,i))||(e.exports=n)},1492:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1494),r(554),r(552)],void 0===(n=function(e,t,r,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.optimizedFeatureQueryEngineAdapter={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new i.default(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=r.getCentroidOptimizedGeometry(new n.default,e.geometry,t.hasZ,t.hasM)),e.centroid}},t.default=t.optimizedFeatureQueryEngineAdapter}.apply(null,i))||(e.exports=n)},1514:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(5),r(553),r(15),r(37),r(22),r(12),r(14),r(1504),r(43),r(35),r(355),r(1492)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,f,h,d,y){Object.defineProperty(t,"__esModule",{value:!0});var m=[],g=l.getLogger("esri.layers.graphics.data.FeatureStore"),v={minX:0,minY:0,maxX:0,maxY:0},_=function(){function e(e,t,r){this._geometryInfo=e,this._onFeatureAdd=t,this._onFeatureRemove=r,this._featuresById=new o.default,this._boundsByFeature=new o.default,this._featuresByBounds=new o.default,this._index=c(9,u("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this.events=new a,this.featureAdapter=y.optimizedFeatureQueryEngineAdapter}return Object.defineProperty(e.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var e=h.create(h.NEGATIVE_INFINITY);return this._boundsByFeature.forEach(function(t){t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]))}),e},enumerable:!0,configurable:!0}),e.prototype.add=function(e){this._add(e,m),this._index.load(m),this._emitChanged(),m.length=0},e.prototype.addMany=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._add(i,m)}this._index.load(m),this._emitChanged(),m.length=0},e.prototype.clear=function(){this._featuresById.clear(),this._boundsByFeature.clear(),this._featuresByBounds.clear(),this._index.clear(),this._emitChanged()},e.prototype.removeById=function(e){var t=this._featuresById.get(e);if(!t)return null;var r=this._boundsByFeature.get(t);return r&&(this._index.remove(r),this._featuresByBounds.delete(r)),this._boundsByFeature.delete(t),this._featuresById.delete(e),this._emitChanged(),t},e.prototype.removeIf=function(e,t){var r=this;this._featuresById.forEach(function(i,n){t(i)&&(r._remove(i),e.push(i))}),this._emitChanged()},e.prototype.removeManyById=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],n=this._featuresById.get(i);if(n){var o=this._boundsByFeature.get(n);o&&(this._index.remove(o),this._featuresByBounds.delete(o)),this._boundsByFeature.delete(n)}this._featuresById.delete(i)}this._emitChanged()},e.prototype.forEachBounds=function(e,t,r){for(var i=0,n=e;i<n.length;i++){var o=n[i],s=this._boundsByFeature.get(o);s&&t(f.fromRect(r,s))}},e.prototype.getFeature=function(e){return this._featuresById.get(e)},e.prototype.has=function(e){return this._featuresById.has(e)},e.prototype.forEach=function(e){this._featuresById.forEach(function(t){return e(t)})},e.prototype.forEachInBounds=function(e,t){for(var r=0,i=function(e,t){return v.minX=t[0],v.minY=t[1],v.maxX=t[2],v.maxY=t[3],e.search(v)}(this._index,e);r<i.length;r++){var n=i[r];t(this._featuresByBounds.get(n))}},e.prototype.transferById=function(e,t){var r=this._featuresById.get(t);r&&(this._remove(r),e.add(r),this._emitChanged())},e.prototype.transferByIds=function(e,t){for(var r=[],i=0,n=t;i<n.length;i++){var o=n[i],s=this._featuresById.get(o);s&&(this._remove(s),r.push(s))}e.addMany(r),this._emitChanged()},e.prototype.transferIdRange=function(e,t,r){for(var i=[],n=t;n<r;n++){var o=this._featuresById.get(n);o&&(this._remove(o),i.push(o))}e.addMany(i),this._emitChanged()},e.prototype.transferIf=function(e,t){var r=this,i=[];this._featuresById.forEach(function(e,n){t(e)&&(r._remove(e),i.push(e))}),e.addMany(i),this._emitChanged()},e.prototype.transferAll=function(e){var t=this,r=[];this._featuresById.forEach(function(e,i){t._remove(e),r.push(e)}),e.addMany(r),this._emitChanged()},e.prototype._emitChanged=function(){this.events.emit("changed",void 0)},e.prototype._add=function(e,t){if(e){var r=e.objectId;if(null==r)return void g.error(new s("featurestore:invalid-feature","feature id is missing",{feature:e}));var i,n=this._featuresById.get(r);if(n?(i=this._boundsByFeature.get(n),e.localId=n.localId,i&&(this._index.remove(i),this._boundsByFeature.delete(n),this._featuresByBounds.delete(i))):p.isSome(this._onFeatureAdd)&&this._onFeatureAdd(e),!e.geometry)return this._boundsByFeature.set(e,null),void this._featuresById.set(r,e);i=d.getBoundsOptimizedGeometry(i||h.create(),e.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(e,i),this._featuresByBounds.set(i,e),this._featuresById.set(r,e),t.push(i)}},e.prototype._remove=function(e){var t;e&&(p.isSome(this._onFeatureRemove)&&this._onFeatureRemove(e),(t=this._boundsByFeature.get(e))&&(this._index.remove(t),this._boundsByFeature.delete(e),this._featuresByBounds.delete(t)),this._featuresById.delete(e.objectId))},e}();t.default=_}.apply(null,i))||(e.exports=n)},1516:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0}}.apply(null,i))||(e.exports=n)},1527:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(17),r(1472),r(208)],void 0===(n=function(e,t,r,i,n){function o(e){return{value:e.value,size:r.toPt(e.size)}}function s(e){return e.map(function(e){return o(e)})}function a(e){if("string"==typeof e||"number"==typeof e)return r.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:s(t.stops)}}function u(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(i.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var r=e.stops,n=0;n<8;++n){var o=r[Math.min(n,r.length-1)];t.values[n]=o.value,t.opacities[n]=o.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=s}return t}Object.defineProperty(t,"__esModule",{value:!0});var l=i.enums.WGLVVFlag;t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=o,t.normalizeSizeStops=s,t.normalizeSizeElement=a,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach(function(e){var r=e.type;e.field&&(t[r]=e.field)}),t},t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,o=t?{}:null;if(!t)return{vvFields:t,vvRanges:o};for(var p=0,c=e;p<c.length;p++){var f=c[p],h=f.type;if(f.field&&(t[h]=f.field),"size"===h){o.size||(o.size={});var d=f;switch(i.getTypeOfSizeVisualVariable(d)){case l.SIZE_MINMAX_VALUE:o.size.minMaxValue={minDataValue:d.minDataValue,maxDataValue:d.maxDataValue,minSize:a(d.minSize),maxSize:a(d.maxSize)};break;case l.SIZE_SCALE_STOPS:o.size.scaleStops={stops:s(d.stops)};break;case l.SIZE_FIELD_STOPS:for(var y=[],m=[],g=s(d.stops),v=g.length,_=0;_<6;_++){var b=g[Math.min(_,v-1)];y.push(b.value),m.push(r.pt2px(b.size))}o.size.fieldStops={values:y,sizes:m};break;case l.SIZE_UNIT_VALUE:o.size.unitValue={unit:d.valueUnit,valueRepresentation:d.valueRepresentation}}}else if("color"===h){var x=n.convertVisualVariables([f],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});for(o.color=x.color,_=0;_<32;_+=4)i.color.premultiplyAlpha(o.color.colors,_,!0)}else if("opacity"===h)o.opacity=u(f);else if("rotation"===h){var I=f;o.rotation={type:I.rotationType}}}return{vvFields:t,vvRanges:o}}}.apply(null,i))||(e.exports=n)},1528:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(14),r(17),r(261),r(563),r(40),r(256),r(39),r(35),r(561),r(364),r(71),r(1473),r(94),r(94),r(1472)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,f,h,d,y,m){function g(e,t,r,o,a){var u,l,p=i.pt2px(r.xoffset),c=i.pt2px(r.yoffset),f=F*r.angle,h=F*a;switch(r.type){case"simple-marker":var d=r;u=l=i.pt2px(d.size);break;case"picture-marker":var y=r;u=i.pt2px(y.width),l=i.pt2px(y.height)}var m=n.mat2d.identity(k);n.mat2d.translate(m,m,s.vec2.set(P,e,t)),n.mat2d.rotate(m,m,h-f),n.mat2d.scale(m,m,s.vec2.set(P,o,-o)),n.mat2d.translate(m,m,s.vec2.set(P,p,-c));var g=[0,0];s.vec2.transformMat2d(g,s.vec2.set(P,-.5*u,-.5*l),m);var v=[0,0];s.vec2.transformMat2d(v,s.vec2.set(P,-.5*u,.5*l),m);var _=[0,0];s.vec2.transformMat2d(_,s.vec2.set(P,.5*u,-.5*l),m);var b=[0,0];return s.vec2.transformMat2d(b,s.vec2.set(P,.5*u,.5*l),m),{rings:[[g,_,b,v,g]]}}function v(e,t,r,o,a){var u=m.CIMSymbolHelper.getEnvelope(r.data);if(!u)return null;var l=i.pt2px(u.width),p=i.pt2px(u.height),c=i.pt2px(u.x),f=i.pt2px(u.y),h=0*F,d=F*a,y=n.mat2d.identity(k);n.mat2d.translate(y,y,s.vec2.set(P,e,t)),n.mat2d.rotate(y,y,d-h),n.mat2d.scale(y,y,s.vec2.set(P,o,-o)),n.mat2d.translate(y,y,s.vec2.set(P,c,-f));var g=[0,0];s.vec2.transformMat2d(g,s.vec2.set(P,-.5*l,-.5*p),y);var v=[0,0];s.vec2.transformMat2d(v,s.vec2.set(P,-.5*l,.5*p),y);var _=[0,0];s.vec2.transformMat2d(_,s.vec2.set(P,.5*l,-.5*p),y);var b=[0,0];return s.vec2.transformMat2d(b,s.vec2.set(P,.5*l,.5*p),y),{rings:[[g,_,b,v,g]]}}function _(e,t,r,o,a,u){var l=m.alignmentUtils.getYAnchorDirection(r.verticalAlignment||"baseline"),p="baseline"===(r.verticalAlignment||"baseline"),c=i.pt2px(r.xoffset),f=i.pt2px(r.yoffset),h=i.pt2px(r.font.size)/24,d=4*h,y=p?25*h:o[1]+(1+l)*o[3]*.5,g=F*r.angle,v=F*u,_=n.mat2d.identity(k);n.mat2d.translate(_,_,s.vec2.set(P,e,t)),n.mat2d.rotate(_,_,v-g),n.mat2d.scale(_,_,s.vec2.set(P,a,-a)),n.mat2d.translate(_,_,s.vec2.set(P,c,-f)),n.mat2d.translate(_,_,s.vec2.set(P,-d,-d-y));var b=[0,0];s.vec2.transformMat2d(b,s.vec2.set(P,o[0],o[1]),_);var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(P,o[0],o[1]+o[3]),_);var I=[0,0];s.vec2.transformMat2d(I,s.vec2.set(P,o[0]+o[2],o[1]),_);var S=[0,0];return s.vec2.transformMat2d(S,s.vec2.set(P,o[0]+o[2],o[1]+o[3]),_),{rings:[[b,I,S,x,b]]}}function b(e,t,r){if(!r||0===r.glyphMosaicItems.length)return e;var n=m.bidiText(t.text),o=n[0],s=n[1],a=m.alignmentUtils.getJustification(t.horizontalAlignment||"center"),u=m.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),l=r.glyphMosaicItems,p=new m.TextShapingNew([l],m.definitions.TEXT_MAX_WIDTH,m.definitions.TEXT_LINE_HEIGHT,m.definitions.TEXT_SPACING,[0,.5*-O],.5*(1-u),0,a).getShaping(o,s),c=m.fontUtils.getFontDecorationTop(t.font.decoration);isNaN(c)||m.TextShapingNew.addDecoration(p,c);var f=m.TextShapingNew.getBox(p),h=i.pt2px(t.font.size)/L;return e[0]=h*f.x,e[1]=h*f.y,e[2]=h*f.width,e[3]=h*f.height,e}function x(e,t,r,i,n,o,s){var a;switch(i.type){case"simple-marker":case"picture-marker":a=g(t,r,i,o,0);break;case"text":a=_(t,r,i,n,o,0);break;case"cim":a=v(t,r,i,o,0)}for(var u,l,p=0,c=0;c<a.rings[0].length-1;c++)u=(t-(l=a.rings[0][c])[0])*(t-l[0])+(r-l[1])*(r-l[1]),p=Math.max(p,u);p=Math.sqrt(p);var f=h.normalizeMapX(t-p,s),d=h.normalizeMapX(t+p,s);if(f>d){var m=y.getInfo(s);if(m){var b=m.valid;f=b[0],d=b[1]}}return e[0]=f,e[1]=r-p,e[2]=d,e[3]=r+p,e}function I(e,t){return Math.ceil((e-t)/(2*t))}function S(e,t){var r,i=t.valid,n=i[0],o=i[1],s=2*o,a=0;return e>o?(e-=(r=Math.ceil(Math.abs(e-o)/s))*s,a=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/s))*s,a=-r),{x:e,frameId:a}}function w(e,t){var r=t.xmin,i=t.ymin,n=t.xmax,o=t.ymax;return M(e,r,i)&&M(e,r,o)&&M(e,n,o)&&M(e,n,i)}function M(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function T(e,t,r){var i;if(Array.isArray(e)){if((i=e[0])>t){var n=I(i,t);e[0]=i+n*(-2*t)}else if(i<r){n=I(i,r);e[0]=i+n*(-2*r)}}else if((i=e.x)>t){n=I(i,t);e.x+=n*(-2*t)}else if(i<r){n=I(i,r);e.x+=n*(-2*r)}return e}Object.defineProperty(t,"__esModule",{value:!0});var F=Math.PI/180,E=m.definitions.TEXT_MAX_WIDTH,O=m.definitions.TEXT_LINE_HEIGHT,B=m.definitions.TEXT_SPACING,k=o.mat2df32.create(),P=a.vec2f32.create(),z=l.create();t.ensureClosedRings=function(e){if(f.isPolygon(e))for(var t=0,r=e.rings;t<r.length;t++){var i=r[t];i.length<3||i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]||i.push(i[0])}},t.getBounds=function(e,t,r,i,n,o,s,a){if(!i||!r)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var u=i;if(!f.isPoint(u)){p.getBoundsXY(e,u);var l=t[0];0===l&&(l=function(e,t){var r=0;switch(e.type){case"simple-fill":case"picture-fill":var i=e.outline;if(!i)return 0;r=i.width;break;case"simple-line":r=e.width;break;case"simple-marker":r=e.size;break;case"picture-marker":r=Math.max(e.width,e.height);break;case"text":var n=[0,0,0,0];b(n,e,t),r=Math.max(n[0],n[1]);break;case"cim":var o=m.CIMSymbolHelper.getEnvelope(e.data);r=Math.sqrt(o.width*o.width+o.height*o.height)}return r}(r,n),t[0]=l);var c=o*l/2;return e[0]-=c,e[1]-=c,e[2]+=c,e[3]+=c,e}var h=u.x,d=u.y;return"text"===r.type&&0===t[2]&&0===t[3]&&b(t,r,n),x(e,h,d,r,t,o,a),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(r.expect(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var C=a.vec2f32.create(),A=a.vec2f32.create(),V=a.vec2f32.create(),N=a.vec2f32.create(),R=a.vec2f32.create(),j=a.vec2f32.create(),D=a.vec2f32.create();t.isPointOnPolyline=function(e,t,r,i){s.vec2.set(V,t,r);for(var n,o,a,u,l,p,c,f,h,d=e.paths,y=1/0,m=0;m<d.length;m++){var g=d[m];if(!(g.length<2))for(var v=1;v<g.length;v++)n=g[v-1][0],a=g[v-1][1],o=g[v][0],u=g[v][1],l=Math.min(n,o)-i,p=Math.min(a,u)-i,c=Math.max(n,o)+i,f=Math.max(a,u)+i,t<l||t>c||r<p||r>f||(s.vec2.set(C,n,a),s.vec2.set(A,o,u),s.vec2.subtract(N,A,C),s.vec2.subtract(R,C,V),s.vec2.scale(j,N,s.vec2.dot(N,R)/s.vec2.dot(N,N)),s.vec2.subtract(D,R,j),y>(h=s.vec2.dot(D,D))&&(y=h))}return Math.sqrt(y)<=i},t.getMarkerSymbolBounds=g,t.getCIMMarkerBounds=v,t.getTextSymbolBounds=_,t.normalizeCentralMeridian=function(e){var t,r,i,n,o,s,a,u,l=null;if(!e)return null;t=e.spatialReference,r=d.getInfo(t),i=t.isWebMercator,n=G[s=i?102100:4326].maxX,o=G[s].minX,a=G[s].plus180Line,u=G[s].minus180Line;var h,y=e.toJSON();if(!r)return y;if("mesh"===e.type)h=y;else if(f.isPoint(y))h=T(y,n,o);else if(f.isMultipoint(y))y.points=y.points.map(function(e){return T(e,n,o)}),h=y;else if(f.isExtent(y))h=function(e,t){if(!t)return e;var r=function(e,t){var r,i=[],n=e.ymin,o=e.ymax,s=e.xmax-e.xmin,a=e.xmin,u=e.xmax,l=t.valid,p=l[0],c=l[1],f=(r=S(e.xmin,t)).x,h=r.frameId,d=(r=S(e.xmax,t)).x,y=r.frameId,m=f===d&&s>0;if(s>2*c){var g={xmin:a<u?f:d,ymin:n,xmax:c,ymax:o},v={xmin:p,ymin:n,xmax:a<u?d:f,ymax:o},_={xmin:0,ymin:n,xmax:c,ymax:o},b={xmin:p,ymin:n,xmax:0,ymax:o},x=[],I=[];w(g,_)&&x.push(h),w(g,b)&&I.push(h),w(v,_)&&x.push(y),w(v,b)&&I.push(y);for(var M=h+1;M<y;M++)x.push(M),I.push(M);i.push({extent:g,frameIds:[h]},{extent:v,frameIds:[y]},{extent:_,frameIds:x},{extent:b,frameIds:I})}else f>d||m?i.push({extent:{xmin:f,ymin:n,xmax:c,ymax:o},frameIds:[h]},{extent:{xmin:p,ymin:n,xmax:d,ymax:o},frameIds:[y]}):i.push({extent:{xmin:f,ymin:n,xmax:d,ymax:o},frameIds:[h]});return i}(e,t).map(function(e){return e.extent});return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map(function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]})}}(y,r);else if(f.isPolygon(y)||f.isPolyline(y)){var m=z;p.getBoundsXY(m,y);var g={xmin:m[0],ymin:m[1],xmax:m[2],ymax:m[3]},v=I(g.xmin,o)*(2*n),_=0===v?y:function(e,t){for(var r=0,i=function(e){return f.isPolygon(e)?e.rings:e.paths}(e);r<i.length;r++)for(var n=0,o=i[r];n<o.length;n++){var s=o[n];s[0]+=t}return e}(y,v);g.xmin+=v,g.xmax+=v,c.extentIntersectsPolyline(g,a)&&g.xmax!==n?l=_:c.extentIntersectsPolyline(g,u)&&g.xmin!==o?l=_:h=_}else h=e.clone();return null!==l?(new U).cut(l,n):h};var L=24;t.getTextSymbolSize=b,t.getTextSymbolEstimatedSize=function(e,t,r){var n=m.bidiText(t.text),o=n[0],s=n[1],a=m.alignmentUtils.getJustification(t.horizontalAlignment||"center"),u=m.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),l=new m.TextShapingNew([],E,O,B,[0,.5*-O],.5*(1-u),0,a).getEstimatedShaping(o,s,r),p=m.TextShapingNew.getBox(l),c=i.pt2px(t.font.size)/L;return e[0]=c*p.x,e[1]=c*p.y,e[2]=c*p.width,e[3]=c*p.height,e};var G={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:u.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:u.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:u.WGS84}}},U=function(){function e(){}return e.prototype.cut=function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,n=-2*t,o=0;o<i;o++){var s=r[o];if(s&&s.length>=this.minPts){for(var a=[],u=0,l=s;u<l.length;u++){var p=l[u];a.push([p[0]+n,p[1]])}r.push(a)}}return this.closed?e.rings=r:e.paths=r,e},e}()}.apply(null,i))||(e.exports=n)},1538:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(6),r(10),r(0),r(550),r(106)],void 0===(n=function(e,t,r,i,n,o,s,a,u){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return r(t,e),n=t,t.fromWorker=function(e){if(!e)return null;var t=JSON.parse(e),r=new n;return r.fields=t.fields&&t.fields.map(function(e){return a.fromJSON(e)}),r.options=t.options,r.process=new(Function.bind.apply(Function,[void 0].concat(t.process.args,[t.process.body]))),r},Object.defineProperty(t.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0}),t.prototype.clone=function(){return new n(o.clone({fields:this.fields,options:this.options,process:this.process}))},t.prototype.getField=function(e){return u.getField(this.fields,e)},t.prototype.refresh=function(){this.notifyChange("version")},t.prototype.toWorker=function(){var e=this.process.toString();return JSON.stringify({fields:this.fields,options:this.options,process:{body:e.substring(e.indexOf("{")+1,e.lastIndexOf("}")),args:e.slice(e.indexOf("(")+1,e.indexOf(")")).match(/([^\s,]+)/g)}})},i([s.property({type:[a]})],t.prototype,"fields",void 0),i([s.property()],t.prototype,"options",void 0),i([s.property()],t.prototype,"process",void 0),i([s.property({readOnly:!0,dependsOn:["process","options","fields"]})],t.prototype,"version",null),n=i([s.subclass("esri.layers.support.FeatureProcessing")],t)}(s.declared(n))}.apply(null,i))||(e.exports=n)},1556:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(15),r(22),r(12),r(24),r(14),r(9),r(555),r(169),r(548),r(1472),r(1555),r(1527),r(553),r(153)],void 0===(n=function(e,t,i,n,o,s,a,u,l,p,c,f,h,d,y,m){Object.defineProperty(t,"__esModule",{value:!0});var g=(h.enums.PixelType,a.getLogger("esri.views.layers.2d.features.support.AttributeStore")),v=d.debug.createDebugLogger(d.debug.DEBUG_ATTR_UPDATES,g),_=function(e,t){return function(r,i,n){var o;try{o=t(r,i,n)}catch(e){o=NaN}return(null===o||isNaN(o)||o===1/0)&&e||o}},b={sharedArrayBuffer:s("esri-shared-array-buffer"),oesTextureFloat:s("esri-webgl-texture-float"),maxTextureSize:s("esri-webgl-max-texture-size")},x=function(){function e(e,t,r,i){this.texelSize=4,this.descriptors=[];var n=i.pixelType,o=i.layout;this.data=this._initData(n,r,e,t),this.pixelType=n,this.layout=o,this._resetRange(),this._shared=e,this._ctype=t}return Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){return this.data[e*this.texelSize+t]},e.prototype.setData=function(e,t,r){var i=1<<t;0!=(this.layout&i)?(this.data[e*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,e),this.dirtyEnd=Math.max(this.dirtyEnd,e)):g.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},e.prototype.expand=function(e){var t=this._initData(this.pixelType,e,this._shared,this._ctype);t.set(this.data),this.data=t},e.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();var i=!(this._shared||"local"===this._ctype),n=this.pixelType,o=this.layout;return this.data.slice?{start:e,end:t,data:i&&this.data.slice(e*r,(t+1)*r)||null,pixelType:n,layout:o}:i?{start:e,end:t,data:new(d.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*r,(t+1)*r)),pixelType:n,layout:o}:{start:e,end:t,data:null,pixelType:n,layout:o}},e.prototype._initData=function(e,t,r,i){for(var n=r&&"local"!==i?SharedArrayBuffer:ArrayBuffer,o=d.Utils.getPixelArrayCtor(e),s=new o(new n(t*t*4*o.BYTES_PER_ELEMENT)),a=0;a<s.length;a+=4)s[a+1]=255;return s},e.prototype._resetRange=function(){this.dirtyStart=this.data.length/4,this.dirtyEnd=0},e}(),I=function(){function e(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(d.definitions.MAX_FILTERS),this._freeList=[],this._abortController=p.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=0;var t=b.oesTextureFloat?5126:5121;v("Creating AttributeStore "+(b.sharedArrayBuffer?"with":"without")+" shared memory"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:7},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map(function(e){return null})}return e.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(e.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),e.prototype.createLocalId=function(e){if(!this._idMap.has(e)){var t=this._getFreeId();this._idMap.set(e,-1===t?0:t),this._localToObjectId.set(t,e)}return this._idMap.get(e)},e.prototype.freeLocalId=function(e){var t=this._idMap.get(e);this._idMap.delete(e),this._localToObjectId.delete(t),this._freeList.push(t)},e.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},e.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},e.prototype.updateFilters=function(e){return n(this,void 0,void 0,function(){var t,r,n,o,s,a,u=this;return i(this,function(i){switch(i.label){case 0:return t=e.config,r=e.service,n=e.spatialReference,o=t.filters,s=t.definitionExpression,a=o.map(function(t,i){return u._updateFilter(e,t,i,r,s,n)}),[4,p.all(a)];case 1:return i.sent(),[2]}})})},e.prototype.setAttributeBindings=function(e,t){return n(this,void 0,void 0,function(){return i(this,function(r){switch(this._hasScaleExpr=!1,e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(e.visualVariables,t)];case"dot-density":return[2,this._bindDDEvaluators(e.attributes,t)];case"heatmap":break;default:g.error(new o("attribute-store","Found invalid renderer type: "+e))}return[2]})})},e.prototype.setData=function(e,t,r,i){this._getBlock(t).setData(e,r,i)},e.prototype.setAttributeData=function(e,t,r,i){var n=this,o=e;this._getBlock(0).setData(o,0,this._getFilterFlags(t));var s=this._attributeComputeMap,a=b.oesTextureFloat?1:2;s.forEach(function(e,s){var l=s*a%4,p=Math.floor(s*a/4),c=n._getBlock(p+1),f=e(t,{$view:i},r);if(b.oesTextureFloat)c.setData(o,l,f);else if(f===d.definitions.NAN_MAGIC_NUMBER)c.setData(o,l,255),c.setData(o,l+1,255);else{var h=u.clamp(Math.round(f),-32767,32766)+32768,y=255&h,m=(65280&h)>>8;c.setData(o,l,y),c.setData(o,l+1,m)}})},e.prototype.sendUpdates=function(){var e=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=p.createResolver(),this._nextUpdate.promise;var t={blocks:this._blocks.map(function(e){return l.isSome(e)?e.toMessage():null})};return this._currUpdate=this._createResources().then(function(){var r=e._client.update(t,e._signal).then(function(){if(e._currUpdate=null,e._nextUpdate){var t=e._nextUpdate;e._nextUpdate=null,e.sendUpdates().then(function(){return t.resolve()})}});return e._client.render(),r}),this._currUpdate},e.prototype._createResources=function(){var e=this;if(l.isSome(this._createResourcesPromise))return this._createResourcesPromise;v("Initializing AttributeStore");var t={shared:b.sharedArrayBuffer||"local"===this._client.type,size:this._size,blocks:l.mapMany(this._blocks,function(e){return{buffer:e.buffer,pixelType:e.pixelType}})},r=this._client.initialize(t,this._signal);return this._createResourcesPromise=r,r.then(function(){if(l.isNone(e._createResourcesPromise))return e._createResources()}),r},e.prototype._getBlock=function(e){var t=this._blocks[e];if(l.isSome(t))return t;v("Initializing AttributeBlock at index "+e);var r=b.sharedArrayBuffer,i=this._client.type,n=new x(r,i,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n},e.prototype._expand=function(){if(this._size<b.maxTextureSize){var e=this._size<<=1;return v("Expanding block size to",e,this._blocks),l.forEachSome(this._blocks,function(t){return t.expand(e)}),this._createResourcesPromise=null,this._size=e,0}return g.error(new o("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},e.prototype._getFreeId=function(){return this._freeList.length?this._freeList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},e.prototype._updateFilter=function(e,t,r,o,s,a){return n(this,void 0,void 0,function(){var n,u,p,c,f,h,d,y=this;return i(this,function(i){switch(i.label){case 0:return n=this._filters[r],(l.isSome(n)&&n.hash)===JSON.stringify(t)?[2]:(u=1<<r,l.isNone(t)?(this._filters[r]=null,this._idMap.forEach(function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t|u)}),[2]):[4,e.queryObjectIds(t)]);case 1:return p=i.sent(),t.hiddenIds&&t.hiddenIds.length&&(p=p.filter(function(e){return-1===t.hiddenIds.indexOf(e)})),c=p.map(function(e){return y._idMap.get(e)}),[4,this._getFilter(r,o)];case 2:for(i.sent().update(t,s,a),this._idMap.forEach(function(e){var t=y._getBlock(0).getData(e,0);y._getBlock(0).setData(e,0,t&~u)}),f=0;f<c.length;f++)null!=(h=c[f])&&(d=this._getBlock(0).getData(h,0),this._getBlock(0).setData(h,0,d|u));return[2]}})})},e.prototype._getFilter=function(e,t){return n(this,void 0,void 0,function(){var n,o,s;return i(this,function(i){switch(i.label){case 0:return n=this._filters[e],l.isSome(n)?[2,n]:[4,new Promise(function(e,t){Promise.all([r.e(2),r.e(65)]).then(function(){var t=[r(1655)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})];case 1:return o=i.sent().default,s=new o({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new c(t.fields)}),this._filters[e]=s,[2,s]}})})},e.prototype._getFilterFlags=function(e){for(var t=0,r=0;r<this._filters.length;r++){var i=this._filters[r];t|=(l.isNone(i)||i.check(e)?1:0)<<r}return t},e.prototype._bindVVEvaluators=function(e,t){return n(this,void 0,void 0,function(){var r=this;return i(this,function(o){switch(o.label){case 0:return this._attributeComputeMap.clear(),l.isSome(e)?[4,p.all(e.map(function(e){return n(r,void 0,void 0,function(){var r,n;return i(this,function(i){switch(i.label){case 0:return r=d.Utils.getVVType(e.type),[4,this._createGetValueFunction(e,t)];case 1:return n=i.sent(),l.isSome(n)&&this._attributeComputeMap.set(r,n),[2]}})})}))]:[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},e.prototype._bindDDEvaluators=function(e,t){return n(this,void 0,void 0,function(){var r,n,o,s=this;return i(this,function(i){switch(i.label){case 0:return this._attributeComputeMap.clear(),e.length>d.definitions.DOT_DENSITY_MAX_FIELDS&&g.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+d.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+e.length),[4,p.all(e.map(function(e){return s._createNormalizedFunction(e,t)}))];case 1:for(r=i.sent().map(function(e){return _(0,e)}),n=0;n<d.definitions.DOT_DENSITY_MAX_FIELDS;n++)(o=n<e.length&&r[n])?this._attributeComputeMap.set(n,o):this._attributeComputeMap.has(n)&&this._attributeComputeMap.delete(n);return[2]}})})},e.prototype._createGetValueFunction=function(e,t){return n(this,void 0,void 0,function(){var r,n,o,s,a,u,l;return i(this,function(i){switch(i.label){case 0:return"size"!==e.type?[3,2]:(r=d.getTypeOfSizeVisualVariable(e))===d.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(n=r===d.enums.WGLVVFlag.SIZE_UNIT_VALUE,o=n&&function(t){return m.getVisualVariableSizeValueRepresentationRatio(t,e.valueRepresentation)},s=_,a=[d.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t,o)]);case 1:return[2,s.apply(void 0,a.concat([i.sent()]))];case 2:return u=_,l=[d.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t)];case 3:return[2,u.apply(void 0,l.concat([i.sent()]))]}})})},e.prototype._createNormalizedFunction=function(e,t,r){return n(this,void 0,void 0,function(){var n,s,a;return i(this,function(i){switch(i.label){case 0:return(n=e.field)?"string"==typeof n?(s=e.normalizationField)?[2,function(e){if(e.attributes[n]&&e.attributes[s]){var t=e.attributes[n]/e.attributes[s];return r?r(t):t}}]:[2,r?function(e){return r(e.attributes[n])}:function(e){return e.attributes[n]}]:(g.error(new o("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof n)),[2,function(e){}]):e.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==e.valueExpression.indexOf("scale"),[4,f.createVVExpression(e.valueExpression,t.spatialReference,t.fields)]):[3,2];case 1:return a=i.sent(),[2,y.callWithOptimizedFeature.bind(null,a)];case 2:return g.error("Unable to create a normalized function for visual variable: "+e),[2,function(e){}]}})})},e}();t.default=I}.apply(null,i))||(e.exports=n)},1621:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(11),r(13),r(2),r(7),r(6),r(15),r(348),r(22),r(12),r(14),r(9),r(0),r(1542),r(1514),r(1515),r(1538),r(555),r(359),r(568),r(347),r(1472),r(1556),r(1622)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,f,h,d,y,m,g,v,_,b,x,I,S,w,M){Object.defineProperty(t,"__esModule",{value:!0});var T=c.getLogger("esri.views.2d.layers.features.controllers.BaseController");t.needsGeometry=function(e,t){switch(e){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryMultipoint":return!0;case"esriGeometryPolygon":return function(e){var t=e&&e.getSymbols();return"backgroundFillSymbol"in e&&null!=e.backgroundFillSymbol||t.some(function(e){return"simple-fill"===e.type||"picture-fill"===e.type})}(t);default:return T.error(new u("mapview-invalid-type",e+" is not supported")),!1}};var F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._processingInMainThread=!1,t._availableFields=[],t._pixelBuffer=0,t.config=null,t.processor=null,t.remoteClient=null,t.service=null,t.tileStore=null,t.filters=new Array(S.definitions.MAX_FILTERS),t}return o(t,e),t.prototype.initialize=function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])},t.prototype.startup=function(){return n(this,void 0,void 0,function(){return i(this,function(e){switch(e.label){case 0:return this._initAttributeStore(),[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 1:return e.sent(),[4,h.all([this.attributeStore.updateFilters(this),this.updatePixelBuffer()])];case 2:return e.sent(),[2]}})})},t.prototype.destroy=function(){this.attributeStore.destroy()},Object.defineProperty(t.prototype,"arcadeInfo",{get:function(){return{geometryType:this.service.geometryType,fields:this.service.fields,spatialReference:this.spatialReference}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldsIndex",{get:function(){return new _(this.service.fields)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"geometryInfo",{get:function(){return{geometryType:this.service.geometryType,hasZ:!1,hasM:!1}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnCentroid",{get:function(){return this._get("returnCentroid")||function(e,t,r){function i(e){if(!e)return!1;var t=e.type;return"simple-marker"===t||"picture-marker"===t||"text"===t||"web-style"===t}if("esriGeometryPolygon"===t&&e.labelingInfo)return!0;if("esriGeometryPolygon"!==t)return!1;switch(r.type){case"simple":return i(r.symbol);case"unique-value":return i(r.defaultSymbol)||r.uniqueValueInfos.some(function(e){return i(e.symbol)});case"class-breaks":return i(r.defaultSymbol)||r.classBreakInfos.some(function(e){return i(e.symbol)});default:return!0}}(this.config,this.service.geometryType,this.renderer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"queryInfo",{get:function(){var e=null;if("heatmap"!==this.renderer.type){var t=this.renderer.visualVariables;t&&t.some(function(t){if("size"===t.type&&t.field&&!t.normalizationField)return e=[t.field+" DESC"],!0})}return{returnCentroid:this.returnCentroid,returnGeometry:!0,outFields:this.availableFields,orderByFields:e,definitionExpression:this.config.definitionExpression,gdbVersion:this.config.gdbVersion,historicMoment:this.config.historicMoment}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderer",{get:function(){return this.config?b.fromJSON(this.config.renderer):(T.error("mapview-controller","Unable to create renderer for undefined configuration"),null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return v.fromWorker(this.config.processing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"availableFields",{get:function(){var e=this,t=this.config.availableFields.filter(function(t){return-1===e._availableFields.indexOf(t)});return this._availableFields=this._availableFields.concat(t),this._availableFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spatialReference",{get:function(){return this.tileStore.tileScheme.spatialReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewParams",{get:function(){return{viewingMode:"",scale:this.viewState&&this.viewState.scale||1}},enumerable:!0,configurable:!0}),t.prototype.getObjectId=function(e){return this.attributeStore.getFeatureId(e)},t.prototype.getLocalId=function(e){return this.attributeStore.getLocalId(e)},t.prototype.mapValidLocalIds=function(e){var t=this;return e.map(function(e){return t.attributeStore.getLocalId(e)}).filter(function(e){return null!=e})},t.prototype.setViewState=function(e){this._set("viewState",e)},t.prototype.updatePixelBuffer=function(){return n(this,void 0,void 0,function(){var e;return i(this,function(t){switch(t.label){case 0:return[4,M.computePxBuffer(this.renderer,this.service.geometryType)];case 1:return e=t.sent(),this._pixelBuffer=Math.max(this._pixelBuffer,e),[2]}})})},t.prototype.validateConfig=function(e,t){for(var r=0,i=e.filters;r<i.length;r++){var n=i[r];if(f.isSome(n)&&n.where)try{y.validateWhere(this.fieldsIndex,n.where)}catch(e){throw new u("mapview-bad-filter",e.message,{filter:n,missingFields:e.details})}}},t.prototype.onFeatureAdd=function(e){e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype.onFeatureRemove=function(e){!e.localId&&p("esri-2d-debug")&&console.debug("Feature must have localId"),this.attributeStore.freeLocalId(e.objectId)},t.prototype.enableEvent=function(e){},t.prototype._initAttributeStore=function(){var e=this;this.attributeStore=new w.default(s({type:"remote"},"heatmap"===this.renderer.type?{initialize:function(e,t){return h.resolve()},update:function(e,t){return h.resolve()},render:function(){return h.resolve()}}:{initialize:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",t,{signal:r})},update:function(t,r){return e.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",t,{signal:r})},render:function(){return e.remoteClient.invoke("tileRenderer.featuresView.requestRender")}}))},t.prototype._createQueryEngine=function(e){void 0===e&&(e=this._createFeatureStore());var t=this.queryInfo,r=t.definitionExpression,i=t.gdbVersion,n=t.historicMoment;return new g.default({definitionExpression:r,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,gdbVersion:i,historicMoment:null!=n&&new Date(n),featureStore:e,timeInfo:this.service.timeInfo})},t.prototype._createTempQueryEngine=function(e){return void 0===e&&(e=this._createFeatureStore(!1)),this._createQueryEngine(e)},t.prototype._createFeatureStore=function(e){void 0===e&&(e=!0);var t={geometryType:this.service.geometryType,hasM:!1,hasZ:!1};if(e){var r=this.onFeatureAdd.bind(this),i=this.onFeatureRemove.bind(this);return new m.default(t,r,i)}return new m.default(t)},t.prototype._createDefaultQuery=function(e){var t=this,r=new I;r.outSpatialReference=this.spatialReference;var i=e.outFields,n=e.orderByFields,o=this.config,s=o.gdbVersion,a=o.historicMoment,u=o.definitionExpression;return this.processing&&(i=i&&i.filter(function(e){return!t.processing.getField(e)}),n=n&&n.filter(function(e){return!t.processing.getField(e)})),i=i.length/this.service.fields.length>=.75?["*"]:i,r.gdbVersion=s,r.historicMoment=null!=a?new Date(a):null,r.outFields=i,r.where=u||"1=1",r.returnGeometry=e.returnGeometry,r.returnCentroid=e.returnCentroid,r.orderByFields=n,r.start=e.resultOffset,r.num=e.num,r},t.prototype._createQuery=function(e,t,r,i,n,o){var s=this.service.geometryType,a=this._createDefaultQuery(i);return a.maxRecordCountFactor=n,a.returnExceededLimitFeatures=o,a.resultType="tile",a.geometry=e,this.service.capabilities.query.supportsQuantization?(a.quantizationParameters=new x.default({mode:"view",originPosition:"upper-left",tolerance:r,extent:t}),"esriGeometryPolyline"===s&&(a.maxAllowableOffset=r)):"esriGeometryPolyline"!==s&&"esriGeometryPolygon"!==s||(a.maxAllowableOffset=r),a},t.prototype._applyProcessing=function(e,t){var r=this.processing;if(!r)return h.resolve(e);if(this._processingInMainThread)return this.remoteClient.invoke("executeProcessing",{featureSet:e},t);try{var i=r.process(e,r.options);return i?"then"in i?i:h.resolve(i):h.reject(new u("FeatureLayer","invalid processing.process() method, returns nothing"))}catch(r){return this._processingInMainThread=!0,this.remoteClient.invoke("executeProcessing",{featureSet:e},t)}},t.prototype.hasGeometryFilter=function(){return this.filters.some(function(e){return f.isSome(e)&&!!e.geometry})},r([d.property({readOnly:!0,dependsOn:["config","service","spatialReference"]})],t.prototype,"arcadeInfo",null),r([d.property()],t.prototype,"config",void 0),r([d.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"fieldsIndex",null),r([d.property({readOnly:!0,dependsOn:["service"]})],t.prototype,"geometryInfo",null),r([d.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"returnCentroid",null),r([d.property({readOnly:!0,dependsOn:["config","availableFields"]})],t.prototype,"queryInfo",null),r([d.property({dependsOn:["config"],readOnly:!0})],t.prototype,"renderer",null),r([d.property()],t.prototype,"processor",void 0),r([d.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"processing",null),r([d.property({readOnly:!0,dependsOn:["config"]})],t.prototype,"availableFields",null),r([d.property({constructOnly:!0})],t.prototype,"remoteClient",void 0),r([d.property({constructOnly:!0})],t.prototype,"service",void 0),r([d.property({dependsOn:["tileStore"]})],t.prototype,"spatialReference",null),r([d.property({constructOnly:!0})],t.prototype,"tileInfo",void 0),r([d.property({constructOnly:!0})],t.prototype,"tileStore",void 0),r([d.property()],t.prototype,"filters",void 0),r([d.property({readOnly:!0})],t.prototype,"viewState",void 0),r([d.property({readOnly:!0,dependsOn:["viewState"]})],t.prototype,"viewParams",null),r([d.subclass("esri.views.2d.layers.features.controllers.BaseController")],t)}(d.declared(a,l));t.default=F}.apply(null,i))||(e.exports=n)},1622:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(11),r(13),r(9),r(17),r(1472),r(1528)],void 0===(n=function(e,t,r,i,n,o,s,a){function u(e,t){return null==e?t:e}function l(e,t){return i(this,void 0,void 0,function(){var i,n,o,p,f,h,v,_,b,x,I;return r(this,function(r){switch(r.label){case 0:return"simple-marker"===e.type?(i=Math.max(u(e.size,12),t),[2,c(e)+i*d]):"picture-marker"===e.type?(n=Math.max(u(e.height,12),t),o=u(e.width,12)*(n/u(e.height,12)),p=o/2,f=n/2,[2,c(e)+Math.sqrt(p*p+f*f)]):"text"===e.type?(a.getTextSymbolEstimatedSize(y,e,s.definitions.AVERAGE_GLYPH_MOSAIC_ITEM),h=y[2]*(u(e.horizontalAlignment,"top")in m?1:.5),v=y[3]*(u(e.horizontalAlignment,"center")in g?1:.5),_=function(e,t){return null==e.font?t:u(e.font.size,t)}(e,9),b=Math.max(_,t)/_,[2,c(e)+Math.sqrt(h*h+v*v)*b]):"simple-line"===e.type?[2,Math.max(u(e.width,.75),t)/2]:"simple-fill"===e.type||"picture-fill"===e.type?[2,Math.max(function(e,t){return null==e.outline?t:u(e.outline.width,t)}(e,.75),t)/2]:"cim"===e.type?(x=s.CIMSymbolHelper.getEnvelope(e.data))?[2,Math.sqrt(x.width*x.width+x.height*x.height)]:[2,0]:"web-style"!==e.type?[3,2]:(I=l,[4,e.fetchCIMSymbol()]);case 1:return[2,I.apply(void 0,[r.sent(),t])];case 2:return[2]}})})}function p(e,t){return i(this,void 0,void 0,function(){var i,n,o,s,a;return r(this,function(r){switch(r.label){case 0:return function(e){return e.type in h}(e)?(n=(i=Math).min,s=(o=Math).max,a=[5],[4,l(e,t)]):[2,0];case 1:return[2,n.apply(i,[s.apply(o,a.concat([r.sent()])),75])]}})})}function c(e){var t=u(e.xoffset,0),r=u(e.yoffset,0);return Math.sqrt(t*t+r*r)}function f(e,t){return Math.max(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var h={"simple-marker":1,"picture-marker":1,text:1,"simple-line":1,"simple-fill":1,"picture-fill":1,cim:1,"web-style":1},d=.707;t.computePxBuffer=function(e,t){return i(this,void 0,void 0,function(){var i,s,a,u,l,c,h;return r(this,function(r){switch(r.label){case 0:if("heatmap"===e.type)return[2,Math.round(3*e.blurRadius)];if("dot-density"===e.type)return[2,0];if("dictionary"===e.type)return"esriGeometryPoint"===t||"esriGeometryMultipoint"===t?[2,100]:[2,50];for(i=e.getSymbols(),s=function(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];return"stops"===r.transformationType?r.stops.map(function(e){return e.size}).reduce(f,0):"clamped-linear"===r.transformationType?"number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map(function(e){return e.size}).reduce(f,0):"real-world-size"===r.transformationType?30:void 0}(e),a=[],u=0,l=i;u<l.length;u++)c=l[u],a.push(p(c,s));return[4,n.all(a)];case 1:return h=r.sent(),[2,o.pt2px(h.reduce(f,0))]}})})};var y=[0,0,0,0],m={left:1,right:1},g={top:1,bottom:1,baseline:1}}.apply(null,i))||(e.exports=n)},1733:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(11),r(13),r(6),r(9),r(59),r(0),r(40),r(1638)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c){Object.defineProperty(t,"__esModule",{value:!0});var f=[0,0],h=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingTile},enumerable:!0,configurable:!0}),t.prototype.abort=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingTile&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){if(!this._queue.has(e)){var r=a.createAbortController();this._queue.set(e,{tileId:e,key:c.TileKey.pool.acquire(e),timestamp:t||this._timestamp,abortController:r}),this._scheduleNext(),this.notifyChange("updating")}},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=u.schedule(this._next))},t.prototype._next=function(){return o(this,void 0,void 0,function(){var e,t,r,i,o;return n(this,function(n){switch(n.label){case 0:if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)return this._scheduledNextHandle=null,[2];if(this._scheduledNextHandle=null,e=this._peek(),t=e.abortController.signal,r=e.tileId,i=e.key,c.TileKey.pool.release(i),this._queue.delete(r),this._onGoingTile=e,o=this.process(r,this._timestamp,{signal:t}),this.notifyChange("updating"),!function(e){return e&&"function"==typeof e.then}(o))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o];case 2:return n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return this._finalize(),[2]}})})},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,o=null;return this._queue.forEach(function(s,a){t.getTileCoords(f,s.key);var u=e._timestamp-s.timestamp;if(isNaN(u))(l=p.vec2.distance(f,r))<n&&(n=l,o=s);else if(u===i){var l;(l=p.vec2.distance(f,r))<n&&(n=l,o=s)}else u>i&&(i=u,n=Number.POSITIVE_INFINITY,o=s)}),o},i([l.property({readOnly:!0})],t.prototype,"length",null),i([l.property({constructOnly:!0})],t.prototype,"process",void 0),i([l.property()],t.prototype,"state",void 0),i([l.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),i([l.property({readOnly:!0})],t.prototype,"updating",null),i([l.subclass("esri.views.2d.layers.features.support.TileUpdateQueue")],t)}(l.declared(s));t.default=h}.apply(null,i))||(e.exports=n)},2422:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2),r(1),r(7),r(11),r(13),r(42),r(12),r(9),r(352),r(0),r(94),r(355),r(1472),r(1621),r(1733)],void 0===(n=function(e,t,r,i,n,o,s,a,u,l,p,c,f,h,d,y,m){Object.defineProperty(t,"__esModule",{value:!0});var g=u.getLogger("esri.views.2d.layers.features.controllers.MemoryController"),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="memory",t}return r(t,e),t.prototype.initialize=function(){var e=this;this._tileQueue=new m.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r,i){return e._fetchFeatureSet(t,r,i)}}),this._memorySource=p.openWithPorts(this.service.source,{client:this}),this.refresh(),this._tileQueue.resume()},t.prototype.destroy=function(){this._memorySource.close(),this._memorySource=null,this._tileQueue.clear(),this._tileQueue.pause()},Object.defineProperty(t.prototype,"updating",{get:function(){return this._tileQueue.updating},enumerable:!0,configurable:!0}),t.prototype.update=function(e,t){return s(this,void 0,void 0,function(){var r,i=this;return o(this,function(n){switch(n.label){case 0:return this.validateConfig(e,t),r=this.renderer.getAttributeHash(),this._set("config",e),[4,this.updatePixelBuffer()];case 1:return n.sent(),t?r===this.renderer.getAttributeHash()?[3,3]:[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,5];case 2:n.sent(),n.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return n.sent(),this.refresh(),[2];case 5:return"heatmap"===this.renderer.type?[2]:r===this.renderer.getAttributeHash()?[3,8]:[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 6:return n.sent(),[4,l.all(this.tileStore.tiles.map(function(e){return i._updateTileAttrData(e)}))];case 7:n.sent(),n.label=8;case 8:return[4,this.attributeStore.updateFilters(this)];case 9:return n.sent(),[4,this.attributeStore.sendUpdates()];case 10:return n.sent(),[2]}})})},t.prototype.invalidate=function(){this.refresh()},t.prototype.onEdits=function(e){this.refresh()},t.prototype.queryFeatures=function(e){return this._memorySource.invoke("queryFeatures",e)},t.prototype.queryFeatureCount=function(e){return this._memorySource.invoke("queryFeatureCount",e)},t.prototype.queryObjectIds=function(e){return this._memorySource.invoke("queryObjectIds",e)},t.prototype.queryExtent=function(e){return this._memorySource.invoke("queryExtent",e)},t.prototype.redraw=function(){this.refresh()},t.prototype.refresh=function(){this._tileQueue.refresh();for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._tileQueue.push(r.id,r.updateTimestamp)}},t.prototype.setViewState=function(e){this.inherited(arguments),this._tileQueue.state=e},t.prototype.onTileUpdate=function(e){this._tileQueue.pause();for(var t=0,r=e.removed;t<r.length;t++){var i=r[t];this._tileQueue.abort(i.id)}for(var n=0,o=e.added;n<o.length;n++){i=o[n];this._tileQueue.push(i.id,i.updateTimestamp)}this.processor&&this._tileQueue.resume()},t.prototype._updateTileAttrData=function(e){return s(this,void 0,void 0,function(){var t,r,i,n,s,a;return o(this,function(o){switch(o.label){case 0:return[4,this._query(e,this.queryInfo)];case 1:for(t=o.sent(),r=h.convertFromFeatureSet(t,this.service.objectIdField),r=h.hydrateOptimizedFeatureSet(r),i=0,n=r.features;i<n.length;i++)s=n[i],a=this.attributeStore.createLocalId(s.objectId),this.attributeStore.setAttributeData(a,s,this.geometryInfo,this.viewParams);return[2]}})})},t.prototype._fetchFeatureSet=function(e,t,r){var i=this,n=this.tileStore.get(e),o=this.queryInfo;return this._query(n,o,r).then(function(e){return i._wrapPoints(e,o)}).then(function(e){return i._sortFeatures(e,o)}).then(function(e){return e.features.length?e:null}).then(function(e){return n.updateTimestamp=t,i.processor.onTileData(n,{addOrUpdate:e&&e.features,clear:!0,transformParams:e&&d.Utils.getTransformParams(e)},r)}).catch(function(e){return n.updateTimestamp=t,l.isAbortError(e)||(i.processor.onTileError(n,e.message,r),g.error("query-error",{error:e})),l.reject(e)})},t.prototype._query=function(e,t,r){var i=this,n=this._pixelBuffer*e.resolution,o=e.bounds.slice();o[0]-=n,o[1]-=n,o[2]+=n,o[3]+=n;var s=a.Extent.fromBounds(o,this.spatialReference),u=this._createQuery(s,e.extent,e.resolution,this.queryInfo);return this.queryFeatures(u.toJSON()).then(function(e){return t.returnCentroid?e.features=e.features.filter(function(e){return null!=e.geometry&&null!=e.centroid}):e.features=e.features.filter(function(e){return null!=e.geometry}),e}).then(function(e){return i._applyProcessing(e,r)}).then(function(e){var t=h.convertFromFeatureSet(e,i.service.objectIdField);t=h.hydrateOptimizedFeatureSet(t);for(var r=0;r<e.features.length;r++){var n=e.features[r],o=t.features[r],s=i.attributeStore.getLocalId(o.objectId);null==s&&(s=i.attributeStore.createLocalId(o.objectId)),n.localId=s,i.attributeStore.setAttributeData(s,o,i.geometryInfo,i.viewParams)}return i.attributeStore.sendUpdates(),e})},t.prototype._wrapPoints=function(e,t){if(0===e.features.length)return e;var r=t.returnCentroid,i=this._pixelBuffer,o=e.geometryType,s=e.spatialReference,a=e.transform;if("esriGeometryPoint"!==o&&"esriGeometryMultipoint"!==o&&!r||!f.isWrappable(s))return e;var u=e.features,l=f.getInfo(s),p=Math.round((l.valid[1]-l.valid[0])/a.scale[0]);if(p===d.definitions.TILE_SIZE){for(var c=[],h=0,y=u;h<y.length;h++){var m=y[h],g=m.geometry,v=m.attributes;if(g)if(g.x<i){(_={geometry:n({},g),attributes:v}).geometry.x+=p,c.push(_)}else if(g.x>d.definitions.TILE_SIZE-i){var _;(_={geometry:n({},g),attributes:v}).geometry.x-=p,c.push(_)}}u.push.apply(u,c)}else for(var b=0,x=u;b<x.length;b++){(g=x[b].geometry)&&(g.x<-i?g.x+=p:g.x>d.definitions.TILE_SIZE+i&&(g.x-=p))}return e},t.prototype._sortFeatures=function(e,t){var r=t.orderByFields;if(r){var i=r[0].split(" "),n=i[0];"DESC"===i[1]&&e.features.sort(function(e,t){return t.attributes[n]-e.attributes[n]})}return e},i([c.property()],t.prototype,"_tileQueue",void 0),i([c.property({dependsOn:["_tileQueue.updating"]})],t.prototype,"updating",null),i([c.subclass("esri.views.2d.layers.features.controllers.MemoryController")],t)}(c.declared(y.default));t.default=v}.apply(null,i))||(e.exports=n)}}]);